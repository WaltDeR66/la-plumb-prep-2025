{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# LA Plumb Prep\n\n## Overview\n\nThis is a comprehensive plumbing certification platform designed specifically for Louisiana plumbers. The application provides course management, certification preparation, professional tools, job board functionality, and AI-powered mentoring. It serves as a one-stop platform for plumbing professionals to advance their careers through education, tools, and career opportunities.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\nThe frontend is built using React with TypeScript and follows a component-based architecture. It uses shadcn/ui components for consistent UI design with Tailwind CSS for styling. The application implements client-side routing using wouter and state management through React Query for server state synchronization.\n\nKey architectural decisions:\n- **Component Library**: Uses shadcn/ui for consistent, accessible UI components\n- **Styling**: Tailwind CSS with CSS variables for theming and responsive design\n- **State Management**: React Query for server state, React hooks for local state\n- **Routing**: wouter for lightweight client-side routing\n- **Form Management**: React Hook Form with Zod validation\n\n### Backend Architecture\nThe backend follows a Node.js Express server architecture with a modular structure separating concerns into distinct layers.\n\nKey architectural decisions:\n- **Framework**: Express.js with TypeScript for type safety\n- **Authentication**: Passport.js with local strategy and session-based authentication\n- **File Handling**: Multer for file uploads with validation and size limits\n- **API Structure**: RESTful API design with consistent error handling middleware\n- **Validation**: Zod schemas shared between client and server\n\n### Data Layer\nThe application uses Drizzle ORM with PostgreSQL for data persistence, providing type-safe database operations.\n\nKey architectural decisions:\n- **Database**: PostgreSQL with Neon serverless hosting\n- **ORM**: Drizzle ORM for type-safe database operations\n- **Schema**: Centralized schema definitions in shared directory\n- **Migrations**: Drizzle Kit for database migrations and schema management\n\n### Authentication & Authorization\nSession-based authentication using express-session with bcrypt for password hashing.\n\nKey architectural decisions:\n- **Strategy**: Session-based authentication for simplicity and security\n- **Password Security**: bcrypt for password hashing with salt rounds\n- **Session Storage**: PostgreSQL session store using connect-pg-simple\n- **User Management**: Role-based access with subscription tiers\n\n### AI Integration\nOpenAI GPT-5 integration for photo analysis, plan review, and AI mentoring capabilities.\n\nKey architectural decisions:\n- **Model**: GPT-5 for advanced analysis capabilities\n- **Photo Analysis**: Code compliance checking for plumbing installations\n- **Plan Review**: Technical drawing analysis for code violations\n- **AI Mentor**: Conversational support for plumbing questions\n- **Response Format**: Structured JSON responses for consistent data handling\n\n## Recent Changes\n\n### September 19, 2025 - Beta Pricing Structure\n- **Beta Pricing Implementation**: Added special beta pricing for launch users\n  - Regular Pricing: Basic $49.99, Professional $79.99, Master $99.99\n  - Beta Pricing: Basic $19.99, Professional $29.99, Master $49.99 \n  - Beta users get 60-62% discount from regular pricing\n- **Profitability Analysis**: Architect-confirmed beta pricing maintains >80% profit margins even under heavy usage due to implemented caching systems\n- **Cost Optimization**: AI response caching and TTS audio caching provide ~70% reduction in OpenAI API costs\n\n### January 30, 2025 - OpenAI Podcast Player Enhancement\n- **OpenAI Text-to-Speech Integration**: Replaced synthetic speech with high-quality OpenAI text-to-speech API for podcast lessons\n- **Single Sentence Display**: Implemented sentence-by-sentence display that shows one sentence at a time, replacing it as each is spoken\n- **Enhanced User Experience**: Audio now generates using OpenAI's \"alloy\" voice model for natural, clear pronunciation\n- **API Endpoint**: Added `/api/openai/speech` endpoint for real-time text-to-speech generation\n- **Improved Interface**: Shows \"AI Text-to-Speech Available\" with loading states during audio generation\n\n### January 30, 2025\n- **Course Management Updates**: Removed pricing display from course cards, all \"Start Course\" buttons now redirect to unified pricing page\n- **Course Status System**: Implemented \"Coming Soon\" functionality - all courses except Louisiana Journeyman Prep are marked as inactive with disabled buttons and yellow badges\n- **Course Data Updates**: \n  - Updated Backflow Prevention from \"certification\" to \"training course\" for testing, repairs, and field report completion\n  - Added complete course database with 5 total courses (only Journeyman active)\n- **Referral System**: Implemented tiered commission system with plan-based caps (Basic: $4.90, Professional: $7.90, Master: $9.90)\n- **Database Schema**: Added referral tracking, commission calculations, and course status management\n\n### Current Course Status\n- **Active**: Louisiana Journeyman Prep (fully functional)\n- **Coming Soon**: Backflow Prevention Training, Natural Gas Certification, Medical Gas Installer Certification, Master Plumber Prep\n\n## External Dependencies\n\n### Core Infrastructure\n- **Database**: Neon PostgreSQL serverless database\n- **File Storage**: Local filesystem with configurable upload limits\n- **Session Storage**: PostgreSQL-backed session storage\n\n### Payment Processing\n- **Stripe**: Complete payment processing for subscriptions\n  - Subscription management with multiple tiers (basic, professional, master)\n  - Payment Elements for secure payment collection\n  - Webhook handling for subscription lifecycle events\n\n### AI Services\n- **OpenAI API**: GPT-5 model integration for:\n  - Photo analysis of plumbing installations\n  - Plan review and code compliance checking\n  - AI mentor chat functionality\n  - Pipe sizing calculations and recommendations\n\n### Development & Build Tools\n- **Vite**: Development server and build tool with hot module replacement\n- **TypeScript**: Type safety across the entire application\n- **ESBuild**: Fast JavaScript bundling for production builds\n- **Drizzle Kit**: Database migration and schema management\n\n### UI & Styling\n- **shadcn/ui**: Component library built on Radix UI primitives\n- **Tailwind CSS**: Utility-first CSS framework\n- **Radix UI**: Accessible component primitives\n- **Lucide React**: Icon library for consistent iconography\n\n### State Management & Data Fetching\n- **React Query**: Server state management and caching\n- **React Hook Form**: Form state management and validation\n- **Zod**: Runtime type validation for forms and API responses","size_bytes":6864},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2755},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { emailAutomation } from \"./email-automation\";\nimport { bulkPricingService } from \"./bulk-pricing\";\nimport { seedDatabase } from \"./seed-data\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\n// Serve static audio files\napp.use('/audio', express.static('public/audio'));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, async () => {\n    log(`serving on port ${port}`);\n    \n    // Seed database with initial course data\n    await seedDatabase();\n    \n    // Initialize email campaigns on startup\n    await emailAutomation.initializeCampaigns();\n    \n    // Initialize bulk pricing tiers\n    await bulkPricingService.initializeBulkTiers();\n    \n    // Initialize beta feedback system\n    const { initializeBetaFeedbackSystem } = await import('./betaFeedbackSystem');\n    await initializeBetaFeedbackSystem();\n    \n    // Start email queue processor (runs every 5 minutes)\n    setInterval(async () => {\n      try {\n        await emailAutomation.processEmailQueue();\n      } catch (error) {\n        console.error(\"Error processing email queue:\", error);\n      }\n    }, 5 * 60 * 1000); // 5 minutes\n    \n    // Check for monthly beta feedback sending (runs daily at 9 AM)\n    const checkBetaFeedback = async () => {\n      const now = new Date();\n      const isFirstOfMonth = now.getDate() === 1;\n      const isNineAM = now.getHours() === 9;\n      \n      if (isFirstOfMonth && isNineAM) {\n        try {\n          const { BetaFeedbackService } = await import('./betaFeedbackSystem');\n          const result = await BetaFeedbackService.sendMonthlyFeedbackEmails();\n          console.log(`Monthly beta feedback sent to ${result.emailsSent} testers`);\n        } catch (error) {\n          console.error(\"Error sending monthly beta feedback:\", error);\n        }\n      }\n    };\n    \n    // Run beta feedback check every hour\n    setInterval(checkBetaFeedback, 60 * 60 * 1000); // 1 hour\n    \n    // Also run on startup if it's the first day of the month\n    setTimeout(checkBetaFeedback, 5000); // After 5 seconds\n    \n    // Run feedback monitoring every 4 hours to check for concerning patterns\n    const runFeedbackMonitoring = async () => {\n      try {\n        const { BetaFeedbackService } = await import('./betaFeedbackSystem');\n        await BetaFeedbackService.runAutomatedMonitoring();\n      } catch (error) {\n        console.error(\"Error running feedback monitoring:\", error);\n      }\n    };\n    \n    // Monitor feedback patterns every 4 hours\n    setInterval(runFeedbackMonitoring, 4 * 60 * 60 * 1000); // 4 hours\n    \n    // Run initial monitoring after 30 seconds\n    setTimeout(runFeedbackMonitoring, 30000);\n    \n    log(\"Email automation system initialized\");\n    log(\"Bulk pricing system initialized\");\n    log(\"Beta feedback system initialized\");\n  });\n})();\n","size_bytes":4687},"server/openai.ts":{"content":"import OpenAI from \"openai\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport PDFDocument from \"pdfkit\";\nimport crypto from \"crypto\";\nimport { storage } from \"./storage\";\n\nif (!process.env.OPENAI_API_KEY) {\n  throw new Error(\"OPENAI_API_KEY environment variable is required\");\n}\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\n// Ensure audio directory exists\nconst audioDir = path.join(process.cwd(), 'public', 'audio');\nif (!fs.existsSync(audioDir)) {\n  fs.mkdirSync(audioDir, { recursive: true });\n}\n\nexport async function analyzePhoto(base64Image: string): Promise<{\n  isCompliant: boolean;\n  violations: string[];\n  recommendations: string[];\n  confidence: number;\n}> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a Louisiana plumbing code expert. Analyze plumbing installations for code compliance. Respond with JSON in this format: {\n            \"isCompliant\": boolean,\n            \"violations\": string[],\n            \"recommendations\": string[],\n            \"confidence\": number (0-1)\n          }`\n        },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"text\",\n              text: \"Analyze this plumbing installation for Louisiana plumbing code compliance. Check for proper pipe sizing, joint connections, support spacing, clearances, and any visible code violations.\"\n            },\n            {\n              type: \"image_url\",\n              image_url: {\n                url: `data:image/jpeg;base64,${base64Image}`\n              }\n            }\n          ],\n        },\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 1000,\n    });\n\n    return JSON.parse(response.choices[0].message.content || \"{}\");\n  } catch (error) {\n    throw new Error(\"Failed to analyze photo: \" + (error as Error).message);\n  }\n}\n\nexport async function analyzePlans(base64Image: string): Promise<{\n  materialList: Array<{\n    item: string;\n    quantity: number;\n    unit: string;\n    estimatedCost: number;\n  }>;\n  numberedFittings: Array<{\n    number: number;\n    description: string;\n    size: string;\n    type: string;\n    location: string;\n    connections: string[];\n    pipeLength?: number;\n    pipeSize?: string;\n    position: {\n      x: number; // normalized coordinate 0-1 from left edge\n      y: number; // normalized coordinate 0-1 from top edge\n      confidence: number; // 0-1 confidence in position accuracy\n    };\n  }>;\n  codeCompliance: {\n    issues: string[];\n    recommendations: string[];\n  };\n  totalEstimatedCost: number;\n}> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a Louisiana plumbing expert who analyzes construction plans to generate detailed material lists, numbered fitting placement diagrams, and code compliance checks. \n          \n          For numbered fittings, assign sequential numbers (1, 2, 3...) to each fitting, valve, fixture connection, and pipe run visible in the plans. Include precise measurements when visible on professional plans.\n          \n          CRITICAL: For each numbered fitting, provide spatial coordinates as normalized values (0.0 to 1.0) where:\n          - x: 0.0 = left edge, 1.0 = right edge of the plan image\n          - y: 0.0 = top edge, 1.0 = bottom edge of the plan image\n          - confidence: 0.0-1.0 indicating how certain you are of the position\n          \n          Respond with JSON in this format: {\n            \"materialList\": [{\"item\": string, \"quantity\": number, \"unit\": string, \"estimatedCost\": number}],\n            \"numberedFittings\": [{\"number\": number, \"description\": string, \"size\": string, \"type\": string, \"location\": string, \"connections\": string[], \"pipeLength\": number, \"pipeSize\": string, \"position\": {\"x\": number, \"y\": number, \"confidence\": number}}],\n            \"codeCompliance\": {\"issues\": string[], \"recommendations\": string[]},\n            \"totalEstimatedCost\": number\n          }`\n        },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"text\",\n              text: \"Analyze these plumbing plans and generate: 1) A comprehensive material list with quantities and costs, 2) A numbered fitting placement system where each fitting, valve, connection point, and pipe run gets a sequential number with detailed specifications including pipe lengths, sizes, AND precise spatial coordinates (x,y as 0-1 normalized values) for accurate overlay positioning, 3) Louisiana plumbing code compliance analysis. The numbered fittings should create a 'puzzle system' for plumbers doing rough-in work with precise positioning data for professional installation diagrams.\"\n            },\n            {\n              type: \"image_url\",\n              image_url: {\n                url: `data:image/jpeg;base64,${base64Image}`\n              }\n            }\n          ],\n        },\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 1500,\n    });\n\n    const rawResult = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    // Validate and sanitize coordinates\n    if (rawResult.numberedFittings) {\n      rawResult.numberedFittings = rawResult.numberedFittings.map((fitting: any) => ({\n        ...fitting,\n        position: fitting.position ? {\n          x: Math.max(0, Math.min(1, fitting.position.x || 0.5)),\n          y: Math.max(0, Math.min(1, fitting.position.y || 0.5)),\n          confidence: Math.max(0, Math.min(1, fitting.position.confidence || 0))\n        } : {\n          x: 0.5,\n          y: 0.5,\n          confidence: 0\n        }\n      }));\n    }\n    \n    return rawResult;\n  } catch (error) {\n    throw new Error(\"Failed to analyze plans: \" + (error as Error).message);\n  }\n}\n\n// Helper functions for section-specific validation and content\nfunction getSectionContent(section: string): string {\n  const sectionContent: { [key: string]: string } = {\n    '101': `**Louisiana Plumbing Code Section 101 - Administration:**\n    - Enforcement Authority: State health officer has primary responsibility, can delegate to local inspectors\n    - Legal Basis: R.S. 36:258(B), Title 40 Chapters 1 & 4, supporting statutes R.S. 40:4(A)(7) and R.S. 40:5\n    - Historical: Originally promulgated June 2002, major amendments November 2012 (LR 38:2795)\n    - Delegation Process: Authority flows from state to local parishes and municipalities\n    - Local Jurisdiction: Can be more restrictive than state code, but not less restrictive`,\n    '103': `**Louisiana Plumbing Code Section 103 - Permits:**\n    - Permit Requirements: When permits are required and exemptions\n    - Application Process: Required documentation and procedures\n    - Permit Validity: Duration and conditions of permits\n    - Inspection Requirements: Mandatory inspection points`,\n    '105': `**Louisiana Plumbing Code Section 105 - Inspections:**\n    - Inspector Qualifications: Training and certification requirements\n    - Inspection Procedures: Standard practices and protocols\n    - Inspection Records: Documentation and reporting requirements\n    - Compliance Verification: Testing and validation methods`,\n    '107': `**Louisiana Plumbing Code Section 107 - Violations:**\n    - Violation Procedures: Notice requirements and processes\n    - Penalties: Types of sanctions and enforcement actions\n    - Emergency Procedures: Immediate response protocols\n    - Appeal Process: Rights and procedures for challenging violations`,\n    '109': `**Louisiana Plumbing Code Section 109 - Plan Review:**\n    - Plan Requirements: Technical drawing specifications\n    - Review Process: Submission and approval procedures\n    - Plan Standards: Engineering requirements and standards\n    - Review Timeline: Processing timeframes and requirements`\n  };\n  return sectionContent[section] || sectionContent['101'];\n}\n\nasync function validateSectionRelevance(message: string, currentSection: string): Promise<{isRelevant: boolean, redirectMessage: string}> {\n  // Simple keyword-based validation for common section topics\n  const sectionKeywords: { [key: string]: string[] } = {\n    '101': ['administration', 'enforcement', 'authority', 'legal', 'delegate', 'health officer', 'jurisdiction'],\n    '103': ['permit', 'application', 'documentation', 'validity', 'exemption'],\n    '105': ['inspection', 'inspector', 'qualification', 'procedure', 'record', 'compliance'],\n    '107': ['violation', 'penalty', 'notice', 'emergency', 'appeal', 'enforcement'],\n    '109': ['plan', 'review', 'drawing', 'engineering', 'standard', 'approval']\n  };\n  \n  const currentKeywords = sectionKeywords[currentSection] || [];\n  const messageWords = message.toLowerCase().split(/\\s+/);\n  \n  // Check if message contains section-relevant keywords\n  const hasRelevantKeywords = currentKeywords.some(keyword => \n    messageWords.some(word => word.includes(keyword) || keyword.includes(word))\n  );\n  \n  if (hasRelevantKeywords) {\n    return { isRelevant: true, redirectMessage: '' };\n  }\n  \n  // Check if asking about other sections\n  const otherSections = Object.keys(sectionKeywords).filter(s => s !== currentSection);\n  for (const section of otherSections) {\n    const keywords = sectionKeywords[section];\n    const hasOtherSectionKeywords = keywords.some(keyword => \n      messageWords.some(word => word.includes(keyword) || keyword.includes(word))\n    );\n    if (hasOtherSectionKeywords) {\n      return {\n        isRelevant: false,\n        redirectMessage: `Your question seems to be about Section ${section}. I'm currently focused on Section ${currentSection} topics like administration, enforcement, authority, and legal basis.`\n      };\n    }\n  }\n  \n  // Generic questions might still be relevant\n  const genericQuestions = ['what', 'how', 'when', 'why', 'where', 'explain', 'help', 'tell me'];\n  const hasGenericQuestion = genericQuestions.some(q => message.toLowerCase().includes(q));\n  \n  if (hasGenericQuestion) {\n    return { isRelevant: true, redirectMessage: '' };\n  }\n  \n  return {\n    isRelevant: false,\n    redirectMessage: `I can help you with Section ${currentSection} topics including administration, enforcement authority, legal basis, and delegation processes.`\n  };\n}\n\n// AI Response Caching Functions\nfunction normalizeQuestion(question: string): string {\n  return question\n    .toLowerCase()\n    .replace(/[^\\w\\s]/g, '') // Remove punctuation\n    .replace(/\\s+/g, ' ') // Normalize whitespace\n    .trim();\n}\n\nfunction generateQuestionHash(\n  normalizedQuestion: string, \n  subscriptionTier: string, \n  currentSection?: string\n): string {\n  const contextString = `${normalizedQuestion}|${subscriptionTier}|${currentSection || 'all'}`;\n  return crypto.createHash('sha256').update(contextString).digest('hex');\n}\n\nasync function getCachedMentorResponse(\n  message: string,\n  subscriptionTier: string,\n  currentSection?: string\n): Promise<string | null> {\n  try {\n    const normalizedQuestion = normalizeQuestion(message);\n    const questionHash = generateQuestionHash(normalizedQuestion, subscriptionTier, currentSection);\n    \n    const cachedResponse = await storage.getCachedAiResponse(questionHash);\n    if (cachedResponse) {\n      console.log(`Using cached AI response for question hash: ${questionHash}`);\n      // Update access tracking\n      await storage.updateAiResponseAccess(questionHash);\n      return cachedResponse.response;\n    }\n    \n    return null;\n  } catch (error) {\n    console.error('Error checking cached response:', error);\n    return null;\n  }\n}\n\nasync function cacheMentorResponse(\n  originalMessage: string,\n  response: string,\n  subscriptionTier: string,\n  currentSection?: string,\n  tokensUsed?: number\n): Promise<void> {\n  try {\n    const normalizedQuestion = normalizeQuestion(originalMessage);\n    const questionHash = generateQuestionHash(normalizedQuestion, subscriptionTier, currentSection);\n    \n    await storage.createCachedAiResponse({\n      questionHash,\n      originalQuestion: originalMessage,\n      response,\n      subscriptionTier: subscriptionTier as any,\n      currentSection,\n      modelUsed: 'gpt-4o',\n      tokensUsed\n    });\n    \n    console.log(`Cached AI response for question hash: ${questionHash}`);\n  } catch (error) {\n    console.error('Error caching AI response:', error);\n  }\n}\n\nexport async function getMentorResponse(\n  message: string, \n  context?: string, \n  currentSection: string = '101', \n  subscriptionTier: string = 'basic'\n): Promise<string> {\n  try {\n    // Check for cached response first\n    const cachedResponse = await getCachedMentorResponse(message, subscriptionTier, currentSection);\n    if (cachedResponse) {\n      return cachedResponse;\n    }\n\n    // Basic plan users are restricted to current section only\n    if (subscriptionTier === 'basic') {\n      const sectionValidation = await validateSectionRelevance(message, currentSection);\n      if (!sectionValidation.isRelevant) {\n        return `I'm focused specifically on **Section ${currentSection}** of the Louisiana State Plumbing Code. ðŸ“–\\n\\n${sectionValidation.redirectMessage}\\n\\nðŸ’¡ **Want access to the complete codebook?** Upgrade to Professional or Master plan for unlimited AI mentor access across all Louisiana plumbing code sections!\\n\\nFor now, please ask me questions about Section ${currentSection} topics! ðŸ”§`;\n      }\n\n      const sectionContent = getSectionContent(currentSection);\n      const systemPrompt = `You are an expert Louisiana plumbing mentor specializing in the Louisiana State Plumbing Code (LSPC). You are currently helping a BASIC PLAN student with **SECTION ${currentSection}** ONLY.\n\n      ${sectionContent}\n\n      **Your teaching approach:**\n      - ONLY answer questions related to Section ${currentSection} \n      - Provide detailed, educational responses with specific code references\n      - Use formatting like **bold**, â€¢ bullet points, and emojis for clarity\n      - Connect concepts to real-world applications in Louisiana\n      - Encourage further learning with follow-up questions about Section ${currentSection}\n      - Always be supportive and encouraging to students\n      - Reference specific Louisiana statutes and code sections when relevant\n      \n      **Context provided:** ${context || `Louisiana Plumbing Code Section ${currentSection} content`}\n      \n      Answer questions ONLY about Section ${currentSection} topics. If asked about other sections, redirect them back to Section ${currentSection} content.`;\n\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          { role: \"system\", content: systemPrompt },\n          { role: \"user\", content: message }\n        ],\n        max_tokens: 1200,\n        temperature: 0.7,\n      });\n\n      const responseContent = response.choices[0].message.content || \"I'm sorry, I couldn't provide a response at this time.\";\n      \n      // Cache the response for future use\n      await cacheMentorResponse(message, responseContent, subscriptionTier, currentSection, response.usage?.total_tokens);\n      \n      return responseContent;\n    }\n\n    // Professional and Master users get complete codebook access\n    const systemPrompt = `You are an expert Louisiana plumbing mentor specializing in the Louisiana State Plumbing Code (LSPC). You are helping a ${subscriptionTier.toUpperCase()} PLAN student with COMPLETE CODEBOOK ACCESS.\n\n    **Complete Louisiana Plumbing Code Knowledge:**\n    - **Section 101 - Administration**: Enforcement, authority, legal basis, delegation\n    - **Section 103 - Permits**: Requirements, applications, validity, exemptions\n    - **Section 105 - Inspections**: Procedures, qualifications, records, compliance\n    - **Section 107 - Violations**: Penalties, notices, appeals, emergency procedures\n    - **Section 109 - Plan Review**: Requirements, standards, approval processes\n    - **Installation Codes**: Pipe sizing, fixtures, connections, materials\n    - **Safety Standards**: Testing, backflow prevention, pressure requirements\n    - **Specialized Systems**: Medical gas, natural gas, backflow devices\n\n    **Your teaching approach:**\n    - Answer questions about ANY section of the Louisiana plumbing code\n    - Provide detailed, educational responses with specific code references\n    - Use formatting like **bold**, â€¢ bullet points, and emojis for clarity\n    - Connect concepts to real-world applications in Louisiana\n    - Cross-reference between different code sections when relevant\n    - Always be supportive and encouraging to students\n    - Reference specific Louisiana statutes and code sections\n    \n    **Context provided:** ${context || 'Complete Louisiana Plumbing Code access'}\n    \n    Answer questions about ANY Louisiana plumbing code section, installation technique, safety standard, or compliance requirement.`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: message }\n      ],\n      max_tokens: 1500,\n      temperature: 0.7,\n    });\n\n    const responseContent = response.choices[0].message.content || \"I'm sorry, I couldn't provide a response at this time.\";\n    \n    // Cache the response for future use (no currentSection for pro/master users)\n    await cacheMentorResponse(message, responseContent, subscriptionTier, undefined, response.usage?.total_tokens);\n    \n    return responseContent;\n  } catch (error) {\n    console.error(\"OpenAI API error:\", error);\n    // Provide a fallback response based on common Louisiana plumbing questions\n    if (message.toLowerCase().includes(\"enforce\")) {\n      return \"The Louisiana State Plumbing Code (LSPC) is enforced by the state health officer, who can delegate this authority to local plumbing inspectors and other qualified entities at the parish and municipal level.\";\n    } else if (message.toLowerCase().includes(\"legal basis\")) {\n      return \"The legal foundation for the Louisiana State Plumbing Code stems from Louisiana Revised Statutes (R.S.), primarily R.S. 36:258(B), with additional provisions in Chapters 1 and 4 of Title 40.\";\n    } else if (message.toLowerCase().includes(\"historical\") || message.toLowerCase().includes(\"promulgate\")) {\n      return \"The Louisiana State Plumbing Code was first promulgated in June 2002 (Louisiana Register, Vol. 28, No. 6) and was amended in November 2012 (Louisiana Register, Vol. 38, No. 11).\";\n    }\n    return \"I'm having trouble connecting to the AI service right now, but I can help you learn about Louisiana Plumbing Code administration. Please try asking about enforcement authority, legal basis, or historical notes.\";\n  }\n}\n\nexport async function calculatePipeSize(fixtureUnits: number, pipeLength: number, material: string): Promise<{\n  recommendedSize: string;\n  velocityCheck: boolean;\n  pressureLoss: number;\n  explanation: string;\n}> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a plumbing hydraulics expert. Calculate proper pipe sizing based on fixture units, pipe length, and material. Respond with JSON in this format: {\n            \"recommendedSize\": string,\n            \"velocityCheck\": boolean,\n            \"pressureLoss\": number,\n            \"explanation\": string\n          }`\n        },\n        {\n          role: \"user\",\n          content: `Calculate the proper pipe size for ${fixtureUnits} fixture units over ${pipeLength} feet using ${material} pipe material. Follow Louisiana plumbing code requirements.`\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 500,\n    });\n\n    return JSON.parse(response.choices[0].message.content || \"{}\");\n  } catch (error) {\n    throw new Error(\"Failed to calculate pipe size: \" + (error as Error).message);\n  }\n}\n\nexport async function generateEducationalPodcastContent(\n  topic: string, \n  section: string, \n  learningObjectives: string[]\n): Promise<string> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are an expert Louisiana plumbing instructor creating engaging educational podcast scripts. \n          Create comprehensive, professional audio lesson content that:\n          - Uses conversational, engaging tone suitable for audio learning\n          - Includes real-world examples and practical applications\n          - Covers Louisiana-specific plumbing code requirements\n          - Incorporates interactive elements (questions for listeners to consider)\n          - Uses professional plumbing terminology correctly\n          - Is structured for 8-12 minute audio lessons\n          - Includes clear introductions, main content, and summary wrap-ups\n          - Provides actionable takeaways for plumbing professionals`\n        },\n        {\n          role: \"user\", \n          content: `Create a comprehensive educational podcast script for Louisiana Plumbing Code ${section}: ${topic}.\n\nLearning Objectives:\n${learningObjectives.map(obj => `- ${obj}`).join('\\n')}\n\nThe script should be engaging, informative, and specifically tailored for Louisiana plumbing professionals studying for certification. Include practical examples, real-world scenarios, and key code requirements they need to know.\n\nFormat as a natural, conversational podcast script that flows well when read aloud.`\n        }\n      ],\n      max_tokens: 2000,\n      temperature: 0.7\n    });\n\n    return response.choices[0].message.content || '';\n  } catch (error) {\n    throw new Error(\"Failed to generate educational content: \" + (error as Error).message);\n  }\n}\n\nexport async function generateAudio(text: string, contentId: string): Promise<string> {\n  try {\n    // Generate speech using OpenAI TTS\n    const mp3 = await openai.audio.speech.create({\n      model: \"tts-1-hd\", // High quality model\n      voice: \"alloy\", // Professional, clear voice\n      input: text,\n      speed: 0.9, // Slightly slower for educational content\n    });\n\n    // Save audio file\n    const fileName = `${contentId}.mp3`;\n    const filePath = path.join(audioDir, fileName);\n    \n    const buffer = Buffer.from(await mp3.arrayBuffer());\n    fs.writeFileSync(filePath, buffer);\n\n    // Return the public URL path\n    return `/audio/${fileName}`;\n  } catch (error) {\n    throw new Error(\"Failed to generate audio: \" + (error as Error).message);\n  }\n}\n\n// New function for generating and caching audio in database\nexport async function generateAndCacheAudio(text: string, contentId: string): Promise<string> {\n  try {\n    // Create a hash of the text content for caching\n    const contentHash = crypto.createHash('sha256').update(text).digest('hex');\n    \n    // Check if audio already exists in cache\n    const existingAudio = await storage.getCachedAudio(contentHash);\n    if (existingAudio) {\n      console.log(`Using cached audio for content hash: ${contentHash}`);\n      // Update access tracking\n      await storage.updateAudioAccess(contentHash);\n      return `/api/audio/cached/${contentHash}`;\n    }\n\n    console.log(`Generating new audio for content hash: ${contentHash}`);\n    \n    // Generate speech using OpenAI TTS\n    const mp3 = await openai.audio.speech.create({\n      model: \"tts-1-hd\", // High quality model\n      voice: \"alloy\", // Professional, clear voice\n      input: text,\n      speed: 0.9, // Slightly slower for educational content\n    });\n\n    const buffer = Buffer.from(await mp3.arrayBuffer());\n    const base64Audio = buffer.toString('base64');\n    \n    // Save to database cache\n    await storage.createCachedAudio({\n      contentHash,\n      contentId,\n      audioData: base64Audio,\n      mimeType: \"audio/mpeg\",\n      fileSize: buffer.length\n    });\n\n    console.log(`Audio cached successfully for content hash: ${contentHash}`);\n    \n    // Return URL to serve cached audio\n    return `/api/audio/cached/${contentHash}`;\n  } catch (error) {\n    throw new Error(\"Failed to generate and cache audio: \" + (error as Error).message);\n  }\n}\n\nexport async function generateNumberedFittingPDF(\n  planAnalysis: {\n    materialList: Array<{\n      item: string;\n      quantity: number;\n      unit: string;\n      estimatedCost: number;\n    }>;\n    numberedFittings: Array<{\n      number: number;\n      description: string;\n      size: string;\n      type: string;\n      location: string;\n      connections: string[];\n      pipeLength?: number;\n      pipeSize?: string;\n      position: {\n        x: number;\n        y: number;\n        confidence: number;\n      };\n    }>;\n    totalEstimatedCost: number;\n  },\n  planImageBase64: string\n): Promise<string> {\n  try {\n    const doc = new PDFDocument({ size: 'A4', margin: 50 });\n    const pdfPath = path.join(process.cwd(), 'public', 'pdfs', `fitting-diagram-${Date.now()}.pdf`);\n    \n    // Ensure PDF directory exists\n    const pdfDir = path.dirname(pdfPath);\n    if (!fs.existsSync(pdfDir)) {\n      fs.mkdirSync(pdfDir, { recursive: true });\n    }\n    \n    const stream = fs.createWriteStream(pdfPath);\n    doc.pipe(stream);\n    \n    // Title Page\n    doc.fontSize(20).text('Numbered Fitting Placement Diagram', 50, 50);\n    doc.fontSize(12).text(`Generated: ${new Date().toLocaleDateString()}`, 50, 80);\n    \n    // Add plan image with numbered overlays if available\n    if (planImageBase64) {\n      try {\n        const imageBuffer = Buffer.from(planImageBase64, 'base64');\n        doc.addPage();\n        doc.fontSize(16).text('Construction Plan with Numbered Fittings', 50, 50);\n        \n        // Define image placement bounds\n        const imageX = 50;\n        const imageY = 80;\n        const maxImageWidth = 500;\n        const maxImageHeight = 400;\n        \n        // Calculate image dimensions preserving aspect ratio\n        // Use a default aspect ratio for PDF layout since we can't inspect image dimensions easily\n        const originalWidth = maxImageWidth;\n        const originalHeight = maxImageHeight;\n        const aspectRatio = originalWidth / originalHeight;\n        \n        let scaledWidth, scaledHeight;\n        if (aspectRatio > maxImageWidth / maxImageHeight) {\n          // Image is wider relative to available space\n          scaledWidth = maxImageWidth;\n          scaledHeight = maxImageWidth / aspectRatio;\n        } else {\n          // Image is taller relative to available space\n          scaledHeight = maxImageHeight;\n          scaledWidth = maxImageHeight * aspectRatio;\n        }\n        \n        // Center the image in the available space\n        const centeredX = imageX + (maxImageWidth - scaledWidth) / 2;\n        const centeredY = imageY + (maxImageHeight - scaledHeight) / 2;\n        \n        // Place the plan image with preserved aspect ratio\n        doc.image(imageBuffer, centeredX, centeredY, { width: scaledWidth, height: scaledHeight });\n        \n        // Overlay numbered markers at precise coordinates\n        planAnalysis.numberedFittings.forEach((fitting) => {\n          if (fitting.position && fitting.position.confidence > 0.3) {\n            // Calculate actual position on the placed image with proper scaling\n            const markerX = centeredX + (fitting.position.x * scaledWidth);\n            const markerY = centeredY + (fitting.position.y * scaledHeight);\n            const markerRadius = 12;\n            \n            // Draw circular marker background\n            doc.circle(markerX, markerY, markerRadius)\n               .fillColor('#2563eb')\n               .fill();\n            \n            // Draw white border\n            doc.circle(markerX, markerY, markerRadius)\n               .strokeColor('#ffffff')\n               .lineWidth(2)\n               .stroke();\n            \n            // Add number text\n            doc.fillColor('#ffffff')\n               .fontSize(10)\n               .text(fitting.number.toString(), markerX - 6, markerY - 5, {\n                 width: 12,\n                 align: 'center'\n               });\n          }\n        });\n        \n        // Add legend for high-confidence vs low-confidence markers\n        const legendY = centeredY + scaledHeight + 20;\n        doc.fontSize(8).fillColor('#666666')\n           .text('â— High confidence positioning (>70%)', 50, legendY)\n           .text('â— Approximate positioning (30-70%)', 50, legendY + 15)\n           .text(`Image scaled to ${Math.round(scaledWidth)} Ã— ${Math.round(scaledHeight)} pixels`, 50, legendY + 30);\n           \n      } catch (error) {\n        console.warn('Could not add plan image to PDF:', error);\n      }\n    }\n    \n    // Numbered Fittings List\n    doc.addPage();\n    doc.fontSize(16).text('Numbered Fitting Installation Guide', 50, 50);\n    doc.fontSize(10).text('Match each number on the plan to the corresponding fitting below:', 50, 80);\n    \n    let yPosition = 110;\n    planAnalysis.numberedFittings.forEach((fitting) => {\n      if (yPosition > 700) {\n        doc.addPage();\n        yPosition = 50;\n      }\n      \n      doc.fontSize(12).fillColor('#2563eb').text(`${fitting.number}.`, 50, yPosition, { width: 30 });\n      doc.fontSize(11).fillColor('#000000')\n        .text(`${fitting.description}`, 85, yPosition)\n        .text(`Size: ${fitting.size} | Type: ${fitting.type}`, 85, yPosition + 15)\n        .text(`Location: ${fitting.location}`, 85, yPosition + 30);\n      \n      if (fitting.pipeLength && fitting.pipeSize) {\n        doc.text(`Pipe: ${fitting.pipeSize} Ã— ${fitting.pipeLength}\"`, 85, yPosition + 45);\n      }\n      \n      if (fitting.connections && fitting.connections.length > 0) {\n        doc.text(`Connections: ${fitting.connections.join(', ')}`, 85, yPosition + 60);\n      }\n      \n      // Add position confidence indicator\n      if (fitting.position) {\n        const confidenceText = fitting.position.confidence > 0.7 ? \n          'â— Precise positioning' : \n          fitting.position.confidence > 0.3 ? \n          'â— Approximate positioning' : \n          'â—‹ General area only';\n        doc.fontSize(9).fillColor('#666666')\n           .text(confidenceText, 85, yPosition + 75);\n      }\n      \n      yPosition += 95;\n    });\n    \n    // Material List Summary\n    doc.addPage();\n    doc.fontSize(16).text('Complete Material List', 50, 50);\n    \n    yPosition = 80;\n    doc.fontSize(10)\n      .text('Item', 50, yPosition)\n      .text('Qty', 300, yPosition)\n      .text('Unit', 350, yPosition)\n      .text('Cost', 450, yPosition);\n    \n    doc.moveTo(50, yPosition + 15).lineTo(500, yPosition + 15).stroke();\n    yPosition += 25;\n    \n    planAnalysis.materialList.forEach((item) => {\n      if (yPosition > 700) {\n        doc.addPage();\n        yPosition = 50;\n      }\n      \n      doc.fontSize(9)\n        .text(item.item, 50, yPosition, { width: 240 })\n        .text(item.quantity.toString(), 300, yPosition)\n        .text(item.unit, 350, yPosition)\n        .text(`$${item.estimatedCost.toFixed(2)}`, 450, yPosition);\n      \n      yPosition += 20;\n    });\n    \n    // Total cost\n    doc.moveTo(350, yPosition + 5).lineTo(500, yPosition + 5).stroke();\n    doc.fontSize(11).text(`Total Estimated Cost: $${planAnalysis.totalEstimatedCost.toFixed(2)}`, 350, yPosition + 15);\n    \n    doc.end();\n    \n    return new Promise((resolve, reject) => {\n      stream.on('finish', () => {\n        resolve(pdfPath.replace(process.cwd() + '/public', ''));\n      });\n      stream.on('error', reject);\n    });\n  } catch (error) {\n    throw new Error(\"Failed to generate PDF: \" + (error as Error).message);\n  }\n}\n\nexport async function reviewWrongAnswers(\n  wrongAnswers: Array<{\n    questionId: string;\n    question: string;\n    correctAnswer: string;\n    userAnswer: string;\n    explanation?: string;\n  }>,\n  quizType: 'section' | 'chapter',\n  sectionOrChapter: string\n): Promise<{\n  overallFeedback: string;\n  individualReviews: Array<{\n    questionId: string;\n    detailedExplanation: string;\n    keyConceptsToReview: string[];\n    studyRecommendations: string[];\n  }>;\n  nextSteps: string[];\n}> {\n  try {\n    const response = await openai.chat.completions.create({\n      // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      model: \"gpt-5\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are an expert Louisiana plumbing code instructor providing detailed review and feedback for wrong quiz answers. Your goal is to help students understand their mistakes and learn from them.\n\n          Provide comprehensive explanations that:\n          - Explain WHY the correct answer is right\n          - Clarify why the student's answer was incorrect\n          - Connect concepts to Louisiana State Plumbing Code sections\n          - Offer specific study recommendations\n          - Encourage continued learning with supportive tone\n          - Include relevant code references when applicable\n          \n          Respond with JSON in this format: {\n            \"overallFeedback\": string,\n            \"individualReviews\": [{\n              \"questionId\": string,\n              \"detailedExplanation\": string,\n              \"keyConceptsToReview\": string[],\n              \"studyRecommendations\": string[]\n            }],\n            \"nextSteps\": string[]\n          }`\n        },\n        {\n          role: \"user\",\n          content: `Please review these wrong answers from a Louisiana plumbing ${quizType} ${quizType === 'section' ? 'quiz for section' : 'test for chapter'} ${sectionOrChapter}:\n\n          ${wrongAnswers.map((qa, index) => `\n          Question ${index + 1} (ID: ${qa.questionId}):\n          Question: ${qa.question}\n          Correct Answer: ${qa.correctAnswer}\n          Student's Answer: ${qa.userAnswer}\n          ${qa.explanation ? `Existing Explanation: ${qa.explanation}` : ''}\n          `).join('\\n')}\n\n          Provide detailed explanations for each wrong answer and actionable study recommendations.`\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 2500,\n      temperature: 0.7,\n    });\n\n    return JSON.parse(response.choices[0].message.content || \"{}\");\n  } catch (error) {\n    throw new Error(\"Failed to review wrong answers: \" + (error as Error).message);\n  }\n}\n\nexport async function generateStudyPlan(\n  sectionNumber: string,\n  lessonContent: string,\n  duration: number = 45\n): Promise<{\n  title: string;\n  content: string;\n  estimatedDuration: number;\n}> {\n  try {\n    const response = await openai.chat.completions.create({\n      // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are an expert Louisiana plumbing instructor creating comprehensive study plans for Louisiana State Plumbing Code certification. Create a structured study plan that helps students master the material effectively.\n\n          Your study plans should:\n          - Be practical and time-efficient\n          - Include active learning techniques  \n          - Reference specific LSPC section numbers\n          - Include real-world applications\n          - Have clear time segments with activities\n          - Include review and practice opportunities\n          - Be engaging and motivational\n          \n          Format with clear sections using markdown:\n          - Introduction with objectives\n          - Time-segmented learning activities (**Minutes X-Y: Activity Name**)\n          - Key concepts to master\n          - Practice questions or scenarios\n          - Review summary\n          - Next steps\n          \n          Respond with JSON: {\n            \"title\": string,\n            \"content\": string (markdown formatted),\n            \"estimatedDuration\": number (minutes)\n          }`\n        },\n        {\n          role: \"user\",\n          content: `Create a comprehensive ${duration}-minute study plan for Louisiana State Plumbing Code Section ${sectionNumber}.\n\n          Base the study plan on this lesson content:\n          ${lessonContent.substring(0, 2000)}...\n          \n          The study plan should be self-contained and help students thoroughly understand Section ${sectionNumber} concepts, regulations, and practical applications.`\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 2000,\n      temperature: 0.7,\n    });\n\n    return JSON.parse(response.choices[0].message.content || \"{}\");\n  } catch (error) {\n    throw new Error(\"Failed to generate study plan: \" + (error as Error).message);\n  }\n}\n\nexport async function reviewJobPosting(\n  title: string, \n  description: string, \n  requirements: string[], \n  company: string\n): Promise<{\n  isApproved: boolean;\n  isPlumbingRelated: boolean;\n  qualityScore: number;\n  concerns: string[];\n  recommendations: string[];\n  reasoning: string;\n}> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a job board moderator for Louisiana plumbing professionals. Your role is to review job postings to ensure they are:\n\n1. **Plumbing-related**: Jobs must be relevant to plumbers, pipe fitters, or plumbing contractors\n2. **Professional**: Legitimate business opportunities, not spam or inappropriate content\n3. **Complete**: Has clear job description, requirements, and company information\n4. **Appropriate**: Safe, legal, and suitable for professional plumbers\n\nAPPROVAL CRITERIA:\nâœ… APPROVE if job is:\n- Plumber, pipe fitter, plumbing technician, or plumbing contractor roles\n- Plumbing installation, repair, maintenance, or inspection work\n- Construction roles requiring plumbing expertise\n- Legitimate companies with real job opportunities\n- Clear job descriptions with reasonable requirements\n\nâŒ REJECT if job is:\n- Not related to plumbing or pipe work\n- Spam, MLM schemes, or \"get rich quick\" offers\n- Inappropriate, illegal, or unsafe work\n- Vague descriptions or suspicious companies\n- Missing critical information\n\nRespond with JSON in this exact format: {\n  \"isApproved\": boolean,\n  \"isPlumbingRelated\": boolean,\n  \"qualityScore\": number (0-10),\n  \"concerns\": string[],\n  \"recommendations\": string[],\n  \"reasoning\": string\n}`\n        },\n        {\n          role: \"user\",\n          content: `Review this job posting:\n\n**Job Title:** ${title}\n**Company:** ${company}\n**Description:** ${description}\n**Requirements:** ${requirements.join(\", \")}\n\nDetermine if this job should be approved for Louisiana plumbing professionals.`\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 800,\n    });\n\n    return JSON.parse(response.choices[0].message.content || \"{}\");\n  } catch (error) {\n    console.error(\"Job review AI error:\", error);\n    // Default to manual review if AI fails\n    return {\n      isApproved: false,\n      isPlumbingRelated: true,\n      qualityScore: 5,\n      concerns: [\"AI review failed - requires manual approval\"],\n      recommendations: [\"Manual review recommended\"],\n      reasoning: \"AI analysis unavailable, defaulting to manual review for safety\"\n    };\n  }\n}\n","size_bytes":39377},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport express from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { emailService } from \"./email\";\nimport { insertUserSchema, insertJobSchema, insertJobApplicationSchema, insertCourseContentSchema, insertPrivateCodeBookSchema, insertCourseSchema, insertProductSchema, insertCartItemSchema, insertProductReviewSchema, insertReferralSchema, leadMagnetDownloads, studentLeadMagnetDownloads, competitionNotifications, courses, users, jobs, products, jobApplications, lessonStepProgress, betaFeedbackResponses, sectionProgress, mentorConversations, studyCompanionMessages, cartItems } from \"@shared/schema\";\nimport { competitionNotificationService } from \"./competitionNotifications\";\nimport { eq, and, or, desc, sql, count, gte, ne, inArray } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport { analyzePhoto, analyzePlans, getMentorResponse, calculatePipeSize, reviewJobPosting, generateNumberedFittingPDF, generateStudyPlan, reviewWrongAnswers, generateAudio, generateAndCacheAudio } from \"./openai\";\nimport { calculateReferralCommission, isValidSubscriptionTier } from \"@shared/referral-utils\";\nimport { contentExtractor } from \"./content-extractor\";\nimport { emailAutomation } from \"./email-automation\";\nimport { bulkPricingService } from \"./bulk-pricing\";\nimport Stripe from \"stripe\";\nimport { StudyCompanionService } from \"./openai-service\";\nimport OpenAI from \"openai\";\n\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\n// In-flight audio generation cache to prevent duplicate generation\nconst inFlightAudioGeneration = new Map<string, Promise<Buffer>>();\n\n// Rate limiting store for AI endpoints\nconst rateLimitStore = new Map<string, { count: number; windowStart: number; resets: Date }>();\n\n// Rate limiting middleware with tiered limits\nconst createRateLimit = (options: {\n  windowMs: number;\n  basicLimit: number;\n  professionalLimit: number;\n  masterLimit: number;\n  anonymousLimit?: number;\n  keyGenerator?: (req: any) => string;\n}) => {\n  const { windowMs, basicLimit, professionalLimit, masterLimit, anonymousLimit = 0, keyGenerator } = options;\n  \n  return (req: any, res: any, next: any) => {\n    const key = keyGenerator ? keyGenerator(req) : `${req.ip}:${req.originalUrl}`;\n    const now = Date.now();\n    const windowStart = Math.floor(now / windowMs) * windowMs;\n    \n    // Get or create rate limit entry\n    let entry = rateLimitStore.get(key);\n    if (!entry || entry.windowStart !== windowStart) {\n      entry = { count: 0, windowStart, resets: new Date(windowStart + windowMs) };\n      rateLimitStore.set(key, entry);\n    }\n    \n    // Determine limit based on user tier\n    let limit = anonymousLimit;\n    if (req.isAuthenticated && req.isAuthenticated()) {\n      const user = req.user as any;\n      const tier = user?.subscriptionTier || 'basic';\n      switch (tier) {\n        case 'master': limit = masterLimit; break;\n        case 'professional': limit = professionalLimit; break;\n        case 'basic': limit = basicLimit; break;\n        default: \n          // For authenticated users with unknown tiers, default to basic limit not anonymous\n          limit = basicLimit;\n          console.warn(`Unknown subscription tier '${tier}' for authenticated user, defaulting to basic limit`);\n      }\n    }\n    \n    // Check if limit exceeded\n    if (entry.count >= limit) {\n      // Set rate limit headers on 429 responses too\n      res.set({\n        'X-RateLimit-Limit': limit.toString(),\n        'X-RateLimit-Remaining': '0',\n        'X-RateLimit-Reset': entry.resets.toISOString()\n      });\n      \n      return res.status(429).json({\n        message: `Rate limit exceeded. Try again after ${entry.resets.toISOString()}`,\n        rateLimitExceeded: true,\n        resets: entry.resets.toISOString(),\n        upgradeMessage: limit === basicLimit ? \"Upgrade to Professional or Master for higher rate limits\" : undefined\n      });\n    }\n    \n    // Increment count and continue\n    entry.count++;\n    rateLimitStore.set(key, entry);\n    \n    // Set headers\n    res.set({\n      'X-RateLimit-Limit': limit.toString(),\n      'X-RateLimit-Remaining': Math.max(0, limit - entry.count).toString(),\n      'X-RateLimit-Reset': entry.resets.toISOString()\n    });\n    \n    next();\n  };\n};\n\n// Rate limiters for different endpoint types\nconst criticalAIRateLimit = createRateLimit({\n  windowMs: 60 * 1000, // 1 minute window\n  basicLimit: 2, // Basic: 2 requests per minute\n  professionalLimit: 5, // Professional: 5 requests per minute  \n  masterLimit: 10, // Master: 10 requests per minute\n  anonymousLimit: 0, // No anonymous access\n  keyGenerator: (req) => {\n    const isAuth = typeof req.isAuthenticated === 'function' && req.isAuthenticated();\n    const userId = isAuth && req.user?.id ? `user:${req.user.id}` : `ip:${req.ip}`;\n    return `${userId}:critical`;\n  }\n});\n\nconst subscriptionAIRateLimit = createRateLimit({\n  windowMs: 60 * 1000, // 1 minute window\n  basicLimit: 5, // Basic: 5 requests per minute\n  professionalLimit: 15, // Professional: 15 requests per minute\n  masterLimit: 30, // Master: 30 requests per minute  \n  anonymousLimit: 0, // No anonymous access\n  keyGenerator: (req) => {\n    const isAuth = typeof req.isAuthenticated === 'function' && req.isAuthenticated();\n    const userId = isAuth && req.user?.id ? `user:${req.user.id}` : `ip:${req.ip}`;\n    return `${userId}:subscription`;\n  }\n});\n\nconst paymentIntentRateLimit = createRateLimit({\n  windowMs: 60 * 1000, // 1 minute window\n  basicLimit: 10, // Basic: 10 payment intents per minute\n  professionalLimit: 20, // Professional: 20 payment intents per minute\n  masterLimit: 30, // Master: 30 payment intents per minute\n  anonymousLimit: 3, // Anonymous: 3 requests per minute\n  keyGenerator: (req) => {\n    const isAuth = typeof req.isAuthenticated === 'function' && req.isAuthenticated();\n    const userId = isAuth && req.user?.id ? `user:${req.user.id}` : `ip:${req.ip}`;\n    return `${userId}:payment`;\n  }\n});\n\n// Helper function to check if content has extracted data\nfunction hasExtractedContent(content: any): content is { extracted: { content?: string; description?: string } } {\n  return content && typeof content === 'object' && 'extracted' in content;\n}\n\n// Course ID resolver function - maps friendly URLs to database UUIDs\nasync function resolveCourseId(courseId: string): Promise<string | null> {\n  // If it's already a UUID format, return as-is\n  if (courseId.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)) {\n    const course = await storage.getCourse(courseId);\n    return course ? courseId : null;\n  }\n  \n  // Handle friendly course identifiers\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'louisiana-journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  \n  return courseMapping[courseId] || null;\n}\n\n// Course content seeding function\nasync function seedCourseContent() {\n  const courseId = \"b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b\"; // Louisiana Journeyman Prep\n  \n  // Force clear existing content for study plan updates\n  const existingContent = await storage.getCourseContent(courseId);\n  if (existingContent.length > 0) {\n    console.log(\"Clearing existing course content for study plan updates...\");\n    for (const content of existingContent) {\n      await storage.deleteCourseContent(content.id);\n    }\n  }\n\n  console.log(\"Auto-seeding course content...\");\n  \n  const courseContentData = [\n    // Course Introduction - appears first\n    {\n      id: \"intro-001-louisiana-plumbing\",\n      courseId,\n      title: \"Course Introduction - Louisiana Plumbing Certification Journey\",\n      type: \"lesson\",\n      chapter: 0,\n      section: 1,\n      content: {\n        \"extracted\": {\n          \"title\": \"Welcome to Louisiana Journeyman Plumber Certification Prep\",\n          \"content\": \"# Welcome to Your Louisiana Plumbing Certification Journey\\n\\n## What You'll Master in This Course\\n\\nThis comprehensive program prepares you for the **Louisiana Journeyman Plumber certification exam** using the most current Louisiana regulations and code requirements.\\n\\n### ðŸ“š Louisiana State Plumbing Code (LSPC) Foundation\\n\\nYou'll develop expertise in:\\n- **LSPC Section 101**: Administration and scope of authority\\n- **LSPC Section 103**: Permits, inspections, and compliance procedures  \\n- **Installation Standards**: Based on Louisiana-specific requirements\\n- **Code Interpretation**: Real-world application of regulations\\n\\n### ðŸŽ¯ Key Learning Outcomes\\n\\nBy completion, you will:\\nâœ… **Navigate Louisiana Sanitary Code Part XIV** with confidence\\nâœ… **Apply LSPC sections** to real installation scenarios\\nâœ… **Understand permit processes** and inspection requirements\\nâœ… **Master compliance procedures** specific to Louisiana\\nâœ… **Pass your certification exam** with 80%+ confidence\\n\\n### ðŸ“– Code Reference Method (Copyright-Safe)\\n\\nOur educational approach:\\n- **References official section numbers** (LSPC 101.1, 103.2, etc.)\\n- **Explains concepts in clear language** rather than copying text\\n- **Provides practical applications** of code requirements\\n- **Uses educational fair use** for learning purposes\\n- **Cites sources properly** for all code references\\n\\n### ðŸ”§ Real-World Focus\\n\\nEvery lesson connects code requirements to:\\n- **Actual plumbing installations** you'll encounter\\n- **Inspector expectations** based on Louisiana standards\\n- **Common violation scenarios** and how to avoid them\\n- **Best practices** from experienced Louisiana plumbers\\n\\n### ðŸ“ Study Methodology\\n\\nWe recommend this approach:\\n1. **Read each section's concept overview**\\n2. **Study the practical applications** \\n3. **Take practice quizzes** (70% to advance)\\n4. **Review chapter summaries** (80% to advance to next chapter)\\n5. **Use AI mentor** for personalized help\\n\\n### ðŸŽ“ Certification Preparation\\n\\nThis course aligns with:\\n- **Louisiana State Plumbing Board** requirements\\n- **Current 2024-2025 code updates**\\n- **Actual exam question formats**\\n- **Time management strategies**\\n\\n---\\n\\n**Ready to start?** Click 'Complete Reading' below to begin with LSPC Section 101 fundamentals.\\n\\n*Note: This course references Louisiana State Plumbing Code sections for educational purposes. All content is original educational material designed to teach code concepts and applications.*\",\n          \"extractedAt\": \"2025-01-30T22:00:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: -1\n    },\n\n    // CHAPTER 1 SECTION INTRODUCTIONS\n    {\n      id: \"intro-section-101\",\n      courseId,\n      title: \"Section 101 Introduction - Title and Adoption\",\n      type: \"lesson\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 101 Introduction - Title and Adoption of Louisiana State Plumbing Code\",\n          \"content\": \"# Section 101 Introduction - Title and Adoption of Louisiana State Plumbing Code\\n\\n## What This Section Establishes\\n\\nSection 101 serves as the **legal foundation** for all plumbing regulations in Louisiana. This critical section formally adopts the Louisiana State Plumbing Code and establishes its authority.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **Legal authority** behind Louisiana plumbing regulations\\n- **Official terminology** and how to reference the code properly\\n- **Relationship** between state and local plumbing codes\\n- **Foundation** for all subsequent code sections\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Code Authority**\\n- How the Department of Health and Hospitals adopts plumbing standards\\n- The connection between Louisiana Sanitary Code Part XIV and the Plumbing Code\\n- Why this legal foundation matters for enforcement\\n\\n**Proper Terminology**\\n- Understanding 'Louisiana State Plumbing Code' vs 'Part XIV (Plumbing) of the Sanitary Code'\\n- When and how to cite code references correctly\\n- Professional communication about code requirements\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 101 knowledge helps you:\\n- **Communicate professionally** with inspectors and officials\\n- **Reference code sections** correctly in documentation\\n- **Understand legal backing** when explaining requirements to clients\\n- **Navigate disputes** by citing proper authority\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Memorize These Key Points:**\\n- The official name and citation format for Louisiana plumbing regulations\\n- Which department has authority over plumbing code adoption\\n- How to properly reference code sections in professional settings\\n\\n**Practical Application:**\\nThis section provides the legal basis for everything else you'll learn. Consider it the 'constitutional foundation' of Louisiana plumbing work.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 101 works with:\\n- **Section 103**: Provides availability information for the code\\n- **Section 107**: Explains the purpose behind the authority established here\\n- **All subsequent sections**: Derive their legal power from this foundational section\\n\\n---\\n\\n**Study Tip:** Think of Section 101 as answering 'What gives this code its power?' - understanding this foundation makes all other sections more meaningful and enforceable.\",\n          \"extractedAt\": \"2025-01-30T22:15:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 1\n    },\n\n    {\n      id: \"intro-section-103\",\n      courseId,\n      title: \"Section 103 Introduction - Availability\",\n      type: \"lesson\",\n      chapter: 1,\n      section: 103,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 103 Introduction - Availability of the Louisiana State Plumbing Code\",\n          \"content\": \"# Section 103 Introduction - Availability of the Louisiana State Plumbing Code\\n\\n## What This Section Provides\\n\\nSection 103 ensures **public access** to the Louisiana State Plumbing Code by establishing where and how professionals and citizens can obtain copies of the regulations.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will know:\\n- **Where to obtain** official copies of the plumbing code\\n- **How to access** current regulations and updates\\n- **Professional responsibility** for staying current with code requirements\\n- **Resources available** for code research and verification\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Official Code Access**\\n- Understanding the role of the Office of the State Register\\n- How to contact authorities for official code copies\\n- Importance of using current, official versions\\n\\n**Professional Responsibility**\\n- Your obligation to work with current code versions\\n- How to verify you're using the most recent regulations\\n- When updates and amendments become effective\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 103 knowledge helps you:\\n- **Stay current** with code changes and updates\\n- **Access official information** when questions arise on job sites\\n- **Verify code requirements** for complex installations\\n- **Provide accurate information** to clients and colleagues\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Remember These Contact Points:**\\n- Office of the State Register contact information\\n- Electronic access methods for code viewing\\n- Professional requirement to use current code versions\\n\\n**Professional Practice:**\\nKnowing where to find authoritative code information demonstrates professionalism and ensures your work meets current standards.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 103 supports:\\n- **Section 101**: Provides access to the code whose authority was established\\n- **Section 105**: Works with edition information to ensure current code use\\n- **All code sections**: Ensures you can access the most current requirements\\n\\n### ðŸ’¡ Professional Tip\\n\\nBookmark official code access points and check for updates regularly. Plumbing inspectors expect you to work with current code versions, and using outdated information can lead to failed inspections and rework.\\n\\n---\\n\\n**Study Tip:** Section 103 answers 'How do I get the official code?' - this practical information ensures you always have access to authoritative regulations when needed.\",\n          \"extractedAt\": \"2025-01-30T22:16:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 2\n    },\n\n    {\n      id: \"intro-section-105\",\n      courseId,\n      title: \"Section 105 Introduction - Effective Date and Edition\",\n      type: \"lesson\",\n      chapter: 1,\n      section: 105,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 105 Introduction - Effective Date and Edition Information\",\n          \"content\": \"# Section 105 Introduction - Effective Date and Edition Information\\n\\n## What This Section Establishes\\n\\nSection 105 provides **critical timing information** about when code requirements take effect and how to identify which edition of the code applies to your work.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **When code requirements** become legally enforceable\\n- **How edition dating** works for the Louisiana Plumbing Code\\n- **Transition periods** and implementation timelines\\n- **Which code version** applies to specific projects\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Code Effective Dates**\\n- Understanding when new requirements become mandatory\\n- How effective dates affect ongoing projects\\n- Transition periods for code compliance\\n\\n**Edition Identification**\\n- How Louisiana Plumbing Code editions are named and dated\\n- Identifying which edition applies to your work\\n- Staying current with the most recent edition\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 105 knowledge helps you:\\n- **Determine which code version** applies to specific projects\\n- **Plan project timelines** around code effective dates\\n- **Communicate with inspectors** about applicable code editions\\n- **Ensure compliance** with current legal requirements\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Critical Dates to Remember:**\\n- February 20, 2013 - Key effective date for major code provisions\\n- How the 2013 Edition designation was established\\n- Understanding of transition periods and implementation\\n\\n**Professional Application:**\\nKnowing which code edition applies to your work ensures legal compliance and prevents costly rework due to using incorrect requirements.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 105 coordinates with:\\n- **Section 103**: Ensures you can access the correct edition\\n- **Section 113**: Affects how existing buildings are treated under new codes\\n- **All subsequent sections**: Determines when their requirements became enforceable\\n\\n### âš ï¸ Important Professional Note\\n\\nProjects permitted under previous code editions may continue under those requirements, but new work typically must meet current code standards. Understanding effective dates prevents compliance issues.\\n\\n### ðŸ’¡ Pro Tip for Certification Exam\\n\\nThe exam may test your understanding of when different code provisions became effective. Pay special attention to transition dates and how they affect different types of plumbing work.\\n\\n---\\n\\n**Study Tip:** Section 105 answers 'When does this code apply?' - this timing information is crucial for ensuring your work meets the correct legal requirements for its timeframe.\",\n          \"extractedAt\": \"2025-01-30T22:17:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 3\n    },\n\n    {\n      id: \"intro-section-107\",\n      courseId,\n      title: \"Section 107 Introduction - Purpose\",\n      type: \"lesson\",\n      chapter: 1,\n      section: 107,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 107 Introduction - Purpose of Louisiana Plumbing Code\",\n          \"content\": \"# Section 107 Introduction - Purpose of Louisiana Plumbing Code\\n\\n## What This Section Defines\\n\\nSection 107 clearly states the **fundamental purpose** behind Louisiana's plumbing regulations, establishing why these codes exist and what they aim to achieve.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **Primary purpose** of Louisiana plumbing regulations\\n- **Goals of administration and enforcement** procedures\\n- **How purpose guides** code interpretation and application\\n- **Connection between purpose and compliance** requirements\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Administration and Enforcement Purpose**\\n- Understanding why consistent code administration is essential\\n- How enforcement procedures protect public interests\\n- The role of uniformity in code application\\n\\n**Foundational Goals**\\n- Public safety protection through proper plumbing installation\\n- Health protection via sanitary plumbing systems\\n- General welfare promotion through code compliance\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 107 knowledge helps you:\\n- **Explain to clients** why code compliance is important\\n- **Understand inspector priorities** during inspections\\n- **Make judgment calls** when code interpretation is needed\\n- **Communicate professionally** about regulatory purpose\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Key Purpose Elements:**\\n- Administration and enforcement as the primary chapter goal\\n- How this purpose affects all subsequent code sections\\n- Professional responsibility to support code purposes\\n\\n**Understanding Intent:**\\nKnowing the code's purpose helps you apply requirements correctly even in situations not explicitly covered by specific regulations.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 107 provides context for:\\n- **Section 109**: Explains why the code is declared remedial\\n- **Section 111**: Shows how scope supports the stated purpose\\n- **Enforcement sections**: Justifies why administration and enforcement matter\\n\\n### ðŸ’¡ Professional Insight\\n\\nWhen code requirements seem unclear or when facing unique installation challenges, returning to the fundamental purpose in Section 107 can guide appropriate decision-making.\\n\\n### ðŸŽ¯ Certification Exam Focus\\n\\nExam questions may test your understanding of:\\n- Why Louisiana has plumbing code administration requirements\\n- How purpose influences code interpretation\\n- The connection between administration and public safety\\n\\n---\\n\\n**Study Tip:** Section 107 answers 'Why do we have this code?' - understanding this purpose makes all other requirements more meaningful and helps you apply them correctly in professional practice.\",\n          \"extractedAt\": \"2025-01-30T22:18:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 4\n    },\n\n    {\n      id: \"intro-section-109\",\n      courseId,\n      title: \"Section 109 Introduction - Code Remedial\",\n      type: \"lesson\",\n      chapter: 1,\n      section: 109,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 109 Introduction - Code Remedial Nature and Scope\",\n          \"content\": \"# Section 109 Introduction - Code Remedial Nature and Scope\\n\\n## What This Section Establishes\\n\\nSection 109 declares the Louisiana Plumbing Code as **remedial in nature** and defines its scope, limitations, and the responsibilities of various parties in the plumbing process.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **Remedial nature** of the plumbing code and what this means\\n- **Quality control limitations** and what the code does NOT cover\\n- **Permitting and inspection responsibilities** and limitations\\n- **Liability protections** for jurisdictions and officials\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Remedial Declaration**\\n- Understanding 'remedial' means the code aims to remedy or prevent problems\\n- How this supports public safety, health, and general welfare\\n- The focus on regulating installation and maintenance\\n\\n**Quality Control Boundaries**\\n- What aspects of quality control ARE covered by the code\\n- What quality aspects are NOT within the code's scope\\n- How this affects your responsibilities as a plumber\\n\\n**Permitting and Inspection Limitations**\\n- What permits and inspections can and cannot guarantee\\n- Professional liability considerations\\n- Understanding the limits of code compliance verification\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 109 knowledge helps you:\\n- **Understand code limitations** when discussing warranties with clients\\n- **Recognize your professional responsibilities** beyond basic code compliance\\n- **Communicate appropriately** about inspection results and their meaning\\n- **Manage client expectations** about what code compliance guarantees\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Key Remedial Aspects:**\\n- Public safety, health, and general welfare as primary goals\\n- Installation and maintenance regulation as primary focus\\n- Quality control limitations and boundaries\\n\\n**Professional Responsibility:**\\nUnderstanding what the code covers (and doesn't cover) helps you provide appropriate professional services and manage liability.\\n\\n### âš ï¸ Important Professional Implications\\n\\n**What Code Compliance DOES Provide:**\\n- Minimum safety and health standards\\n- Regulatory compliance verification\\n- Foundation for professional installation practices\\n\\n**What Code Compliance DOES NOT Guarantee:**\\n- Perfect system performance\\n- Complete protection from all failures\\n- Warranty of physical condition or adequacy\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 109 works with:\\n- **Section 107**: Builds on the purpose by defining scope\\n- **Section 111**: Complements the general scope provisions\\n- **Inspection sections**: Establishes limitations on inspection authority\\n\\n### ðŸ’¡ Professional Practice Tip\\n\\nExplain to clients that code compliance ensures minimum safety standards but doesn't replace the need for quality workmanship, proper maintenance, and appropriate system design for their specific needs.\\n\\n---\\n\\n**Study Tip:** Section 109 answers 'What can we expect from this code and what are its limits?' - this understanding helps you apply the code appropriately while managing professional expectations.\",\n          \"extractedAt\": \"2025-01-30T22:19:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 5\n    },\n\n    // CHAPTER 1 REVIEW INTRODUCTION\n    {\n      id: \"intro-chapter-1-review\",\n      courseId,\n      title: \"Chapter 1 Review Introduction - Administration Mastery\",\n      type: \"lesson\",\n      chapter: 1,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 1 Review Introduction - Administration Mastery\",\n          \"content\": \"# Chapter 1 Review Introduction - Administration Mastery\\n\\n## Chapter Overview - Administration Foundation\\n\\nChapter 1 establishes the **complete administrative framework** for Louisiana plumbing regulations. This chapter provides the legal foundation, access information, timing requirements, purpose, and scope that govern all plumbing work in Louisiana.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Legal Foundation (Section 101)**\\n- Authority of the Department of Health and Hospitals\\n- Proper code citation and terminology\\n- Relationship between state and local regulations\\n\\n**Code Access and Currency (Section 103)**\\n- Official sources for current code information\\n- Professional responsibility for using current editions\\n- Resource availability for code verification\\n\\n**Timing and Editions (Section 105)**\\n- Effective dates and edition identification\\n- Transition periods and implementation requirements\\n- Project timeline considerations\\n\\n**Purpose and Intent (Section 107)**\\n- Administration and enforcement goals\\n- Public safety, health, and welfare objectives\\n- How purpose guides code interpretation\\n\\n**Scope and Limitations (Section 109)**\\n- Remedial nature of the code\\n- Quality control boundaries and limitations\\n- Permitting and inspection responsibilities\\n\\n### ðŸ“š Integration Points - How Sections Work Together\\n\\n**Administrative Chain:**\\n1. **Section 101** establishes legal authority\\n2. **Section 103** ensures code accessibility\\n3. **Section 105** provides timing framework\\n4. **Section 107** defines purpose and goals\\n5. **Section 109** sets scope and limitations\\n\\n**Professional Application:**\\nThese sections work together to create a complete administrative framework that supports all technical requirements in subsequent chapters.\\n\\n### ðŸŽ“ Exam Preparation Strategy\\n\\n**High-Priority Topics:**\\n- Code authority and legal foundation\\n- Proper code citation methods\\n- Edition identification and effective dates\\n- Purpose-driven code interpretation\\n- Scope limitations and professional responsibilities\\n\\n**Common Exam Scenarios:**\\n- Questions about code authority and jurisdiction\\n- Situations requiring proper code citation\\n- Timeline questions involving effective dates\\n- Purpose-based code interpretation challenges\\n- Scope and limitation identification\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 1 enables you to:\\n- **Communicate professionally** with inspectors and officials\\n- **Apply code requirements** with proper legal understanding\\n- **Stay current** with code updates and changes\\n- **Understand the bigger picture** behind technical requirements\\n- **Manage client expectations** appropriately\\n\\n### âš ï¸ Chapter Review Requirements\\n\\n**80% Pass Threshold:** This chapter review requires 80% to advance to Chapter 2 (Definitions). This higher standard ensures you have a solid foundation in administrative concepts before moving to technical content.\\n\\n**Study Approach:**\\n1. Review each section's key concepts\\n2. Understand how sections integrate\\n3. Practice applying administrative knowledge to real scenarios\\n4. Focus on professional communication and compliance\\n\\n### ðŸ’¡ Success Strategy\\n\\nThink of Chapter 1 as the \\\"constitution\\\" of Louisiana plumbing work. Every technical requirement in later chapters derives its authority and context from these administrative foundations.\\n\\n---\\n\\n**Mastery Goal:** You should be able to explain Louisiana plumbing code authority, access current regulations, understand timing requirements, apply code purpose, and recognize scope limitations - all while communicating professionally about these administrative aspects.\",\n          \"extractedAt\": \"2025-01-30T22:20:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 99\n    },\n\n    // CHAPTER 2 DEFINITIONS REVIEW INTRODUCTION  \n    {\n      id: \"intro-chapter-2-review\",\n      courseId,\n      title: \"Chapter 2 Review Introduction - Definitions Mastery\",\n      type: \"lesson\",\n      chapter: 2,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 2 Review Introduction - Definitions Mastery\",\n          \"content\": \"# Chapter 2 Review Introduction - Definitions Mastery\\n\\n## Chapter Overview - Technical Vocabulary Foundation\\n\\nChapter 2 provides the **comprehensive technical vocabulary** essential for understanding and applying all Louisiana plumbing code requirements. This chapter defines hundreds of plumbing terms, from basic components to complex systems.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**System Components**\\n- Drainage system components and relationships\\n- Water distribution system terminology\\n- Venting system definitions and applications\\n- Fixture classifications and requirements\\n\\n**Installation Terms**\\n- Connection methods and joint types\\n- Installation procedures and requirements\\n- Testing and inspection terminology\\n- Pipe sizing and capacity definitions\\n\\n**Materials and Standards**\\n- Approved materials and their applications\\n- Quality standards and specifications\\n- Installation requirements for different materials\\n- Compatibility and restriction definitions\\n\\n**Safety and Code Compliance**\\n- Health and safety terminology\\n- Cross-connection protection definitions\\n- Emergency procedures and equipment\\n- Compliance and enforcement terms\\n\\n### ðŸ“š Study Strategy for Definitions\\n\\n**Since Chapter 2 is broken into 7 manageable lessons:**\\n\\n**Lesson 1**: Foundational plumbing terms and basic concepts\\n**Lesson 2**: System components and their relationships  \\n**Lesson 3**: Installation terminology and procedures\\n**Lesson 4**: Materials, fittings, and connection methods\\n**Lesson 5**: Inspection, testing, and compliance terms\\n**Lesson 6**: Safety, health, and emergency definitions\\n**Lesson 7**: Advanced concepts and specialized equipment\\n\\n### ðŸ§  Memorization Techniques\\n\\n**Group Related Terms:**\\n- Study drainage terms together (soil pipe, waste pipe, vent pipe)\\n- Learn fixture families (water closet, urinal, lavatory)\\n- Master measurement terms (fixture units, flow rates, pressures)\\n\\n**Visual Connections:**\\n- Connect definitions to actual plumbing components\\n- Visualize systems while learning terminology\\n- Relate terms to installation procedures you'll perform\\n\\n**Professional Context:**\\n- Understand how inspectors use these terms\\n- Practice using definitions in professional communication\\n- Connect terms to real-world problem solving\\n\\n### ðŸŽ“ Exam Preparation Strategy\\n\\n**High-Priority Definition Categories:**\\n- System component terminology (drainage, water supply, venting)\\n- Installation and connection definitions\\n- Testing and inspection vocabulary\\n- Safety and health protection terms\\n- Code compliance and enforcement definitions\\n\\n**Common Exam Patterns:**\\n- Definition matching questions\\n- Scenario-based term identification\\n- System component relationship questions\\n- Professional communication contexts\\n\\n### ðŸ”§ Real-World Applications\\n\\nMastering Chapter 2 definitions enables you to:\\n- **Communicate precisely** with inspectors and colleagues\\n- **Understand technical specifications** and manufacturer instructions\\n- **Read and interpret** plumbing plans and drawings correctly\\n- **Troubleshoot problems** using proper technical vocabulary\\n- **Explain work clearly** to clients using appropriate terms\\n\\n### âš ï¸ Chapter Review Requirements\\n\\n**80% Pass Threshold:** This chapter review requires 80% to advance to Chapter 3 (General Regulations). Definitions are the foundation for all technical content that follows.\\n\\n**Study Approach:**\\n1. Work through all 7 definition lessons systematically\\n2. Create flashcards for challenging terms\\n3. Practice using definitions in context\\n4. Review relationships between related terms\\n5. Test yourself on professional communication scenarios\\n\\n### ðŸ’¡ Success Strategy\\n\\nThink of Chapter 2 as learning the \\\"language of plumbing.\\\" Every technical requirement in subsequent chapters assumes you understand these foundational definitions. Strong vocabulary mastery makes all other chapters much easier to understand and apply.\\n\\n### ðŸ“ Connection to Future Chapters\\n\\nChapter 2 definitions support:\\n- **Chapter 3**: General regulations and basic principles\\n- **Chapter 4**: Fixtures and their specific requirements\\n- **Chapter 5**: Water heaters and hot water systems\\n- **All subsequent chapters**: Technical specifications and installation requirements\\n\\n---\\n\\n**Mastery Goal:** You should be able to define, use, and apply all key plumbing terminology correctly in professional contexts, enabling clear communication about technical requirements and proper system installation.\",\n          \"extractedAt\": \"2025-01-30T22:21:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 199\n    },\n\n    // CHAPTER 3 SECTION INTRODUCTIONS\n    {\n      id: \"intro-section-301\",\n      courseId,\n      title: \"Section 301 Introduction - General Regulations\",\n      type: \"lesson\",\n      chapter: 3,\n      section: 301,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 301 Introduction - General Regulations\",\n          \"content\": \"# Section 301 Introduction - General Regulations\\n\\n## What This Section Establishes\\n\\nSection 301 sets the **fundamental principles** that guide all plumbing work in Louisiana. This section establishes the basic sanitary and safety goals that underlie every technical requirement in the code.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **23 Basic Principles** that govern all plumbing installations\\n- **Scope of general regulations** and how they apply\\n- **Sanitary and safety goals** behind technical requirements\\n- **How principles guide** code interpretation and application\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Basic Principles Framework**\\n- Adequate, safe, and potable water supply requirements\\n- Proper drainage system connections and separations\\n- Minimum fixture requirements for different building types\\n- Material and installation quality standards\\n\\n**Environmental Sanitation Goals**\\n- Public health protection through proper plumbing design\\n- Prevention of contamination and cross-connections\\n- Proper waste treatment and disposal\\n- Protection from freezing and structural damage\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 301 knowledge helps you:\\n- **Understand the \\\"why\\\"** behind specific code requirements\\n- **Make sound decisions** when codes don't cover specific situations\\n- **Explain to clients** the health and safety reasons for code compliance\\n- **Apply principles** to unique installation challenges\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Critical Principles to Memorize:**\\n- Principle 1: Adequate, safe, potable water supply requirements\\n- Principle 2: Separate sewer connections for buildings\\n- Principle 3: Minimum fixture requirements for dwellings\\n- Principle 5: Water-seal trap requirements for fixtures\\n- Principle 7: Backflow prevention and contamination protection\\n\\n**Professional Application:**\\nThese principles provide the foundation for understanding why specific technical requirements exist and how to apply them correctly.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 301 principles support:\\n- **All technical chapters**: Provide the reasoning behind specific requirements\\n- **Section 303**: Material standards that implement these principles\\n- **Fixture chapters**: Minimum requirements and proper installation\\n- **System design chapters**: Integration of principles into complete systems\\n\\n### ðŸ’¡ Professional Insight\\n\\nWhen facing installation challenges not explicitly covered by code, return to these basic principles. They guide appropriate solutions that maintain health, safety, and sanitary objectives.\\n\\n---\\n\\n**Study Tip:** Section 301 answers 'What are we trying to achieve?' - understanding these principles makes all specific technical requirements more logical and easier to remember.\",\n          \"extractedAt\": \"2025-01-30T22:22:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 201\n    },\n\n    {\n      id: \"intro-section-303\",\n      courseId,\n      title: \"Section 303 Introduction - Materials\",\n      type: \"lesson\",\n      chapter: 3,\n      section: 303,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 303 Introduction - Materials\",\n          \"content\": \"# Section 303 Introduction - Materials\\n\\n## What This Section Establishes\\n\\nSection 303 defines the **approved materials and standards** for all plumbing installations in Louisiana. This comprehensive section ensures all components meet safety, durability, and performance requirements.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **Approved materials** for different plumbing applications\\n- **Quality standards** and testing requirements\\n- **Installation specifications** for various materials\\n- **Lead-free requirements** and health protection standards\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Material Standards and Approval**\\n- ASTM, ASME, and other recognized standards\\n- Material identification and marking requirements\\n- Installation according to manufacturer specifications\\n- Quality control and testing procedures\\n\\n**Lead-Free Requirements**\\n- NSF Standard 61 compliance for potable water\\n- Lead content limitations for pipes, fittings, and fixtures\\n- Solder and flux lead-free specifications\\n- Exceptions for specific applications\\n\\n**Special Materials Specifications**\\n- Lead requirements for safe pans and flashings\\n- Copper specifications for different applications\\n- Plastic pipe limitations and proper usage\\n- Cleanout and fitting requirements\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 303 knowledge helps you:\\n- **Select appropriate materials** for specific installations\\n- **Verify material compliance** with Louisiana requirements\\n- **Install materials correctly** according to standards\\n- **Ensure health protection** through proper material selection\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Critical Material Requirements:**\\n- Lead-free standards for potable water systems\\n- Approved plastic pipe applications and limitations\\n- Material identification and marking requirements\\n- Installation standards and manufacturer compliance\\n\\n**Professional Responsibility:**\\nUsing only approved materials installed correctly ensures code compliance and protects public health.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 303 supports:\\n- **All installation chapters**: Provides material specifications\\n- **Water supply chapters**: Ensures potable water protection\\n- **Drainage chapters**: Defines approved drainage materials\\n- **Protection sections**: Materials for pipe protection and support\\n\\n### ðŸ’¡ Professional Tip\\n\\nAlways verify material markings and certifications before installation. Using non-approved materials can result in failed inspections and costly rework.\\n\\n---\\n\\n**Study Tip:** Section 303 answers 'What materials can I use and how?' - this knowledge is essential for proper material selection and installation compliance.\",\n          \"extractedAt\": \"2025-01-30T22:23:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 202\n    },\n\n    // CHAPTER 3 REVIEW INTRODUCTION\n    {\n      id: \"intro-chapter-3-review\",\n      courseId,\n      title: \"Chapter 3 Review Introduction - General Regulations Mastery\",\n      type: \"lesson\",\n      chapter: 3,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 3 Review Introduction - General Regulations Mastery\",\n          \"content\": \"# Chapter 3 Review Introduction - General Regulations Mastery\\n\\n## Chapter Overview - Foundation of Technical Requirements\\n\\nChapter 3 establishes the **fundamental technical framework** for all plumbing installations in Louisiana. This chapter bridges the administrative foundation of Chapter 1 with the specific technical requirements in subsequent chapters.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Basic Principles (Section 301)**\\n- 23 fundamental principles governing all plumbing work\\n- Environmental sanitation goals and public health protection\\n- Minimum requirements for water supply, drainage, and fixtures\\n- Contamination prevention and proper waste disposal\\n\\n**Material Standards (Section 303)**\\n- Approved materials and quality standards (ASTM, ASME, etc.)\\n- Lead-free requirements for potable water systems\\n- Material identification, marking, and installation requirements\\n- Special materials specifications and limitations\\n\\n**Additional Technical Requirements**\\n- Pipe protection, support, and installation standards\\n- Testing procedures and compliance verification\\n- Structural safety and construction coordination\\n- Trenching, excavation, and backfill requirements\\n\\n### ðŸ“š Integration Points - How Sections Work Together\\n\\n**Regulatory Framework:**\\n1. **Section 301** establishes why (principles and goals)\\n2. **Section 303** defines what (approved materials and standards)\\n3. **Additional sections** specify how (installation and testing procedures)\\n\\n**Professional Foundation:**\\nChapter 3 provides the technical framework that supports all specific installation requirements in subsequent chapters.\\n\\n### ðŸŽ“ Exam Preparation Strategy\\n\\n**High-Priority Topics:**\\n- Basic principles and their practical applications\\n- Material approval standards and lead-free requirements\\n- Installation and testing procedures\\n- Structural safety and protection requirements\\n\\n**Common Exam Scenarios:**\\n- Principle-based problem solving and code interpretation\\n- Material selection and compliance verification\\n- Installation procedure and testing requirement questions\\n- Safety and protection standard applications\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 3 enables you to:\\n- **Apply fundamental principles** to unique installation challenges\\n- **Select and verify appropriate materials** for all applications\\n- **Follow proper installation procedures** ensuring code compliance\\n- **Coordinate with other trades** while maintaining structural integrity\\n- **Conduct proper testing** to verify system performance\\n\\n### âš ï¸ Chapter Review Requirements\\n\\n**80% Pass Threshold:** This chapter review requires 80% to advance to Chapter 4 (Plumbing Fixtures). Chapter 3 provides the technical foundation for all subsequent specialized chapters.\\n\\n**Study Approach:**\\n1. Master the 23 basic principles and their applications\\n2. Understand material standards and approval requirements\\n3. Learn installation procedures and testing methods\\n4. Practice applying principles to real-world scenarios\\n5. Focus on coordination with structural and safety requirements\\n\\n### ðŸ’¡ Success Strategy\\n\\nThink of Chapter 3 as the \\\"technical constitution\\\" of Louisiana plumbing work. While Chapter 1 provided legal authority, Chapter 3 provides the technical framework that guides all specific installation requirements.\\n\\n### ðŸ“ Connection to Future Chapters\\n\\nChapter 3 foundations support:\\n- **Chapter 4**: Fixture installation using approved materials and principles\\n- **Chapter 5**: Water heater installation following safety and material standards\\n- **Chapter 6**: Water supply systems implementing contamination prevention\\n- **All subsequent chapters**: Technical specifications built on these foundations\\n\\n---\\n\\n**Mastery Goal:** You should be able to apply basic plumbing principles, select appropriate materials, follow proper installation procedures, and ensure compliance with safety and testing requirements - providing the technical foundation for all specialized plumbing work.\",\n          \"extractedAt\": \"2025-01-30T22:24:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 299\n    },\n\n    // CHAPTER 4 SECTION INTRODUCTIONS\n    {\n      id: \"intro-section-401\",\n      courseId,\n      title: \"Section 401 Introduction - General Fixture Requirements\",\n      type: \"lesson\",\n      chapter: 4,\n      section: 401,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 401 Introduction - General Fixture Requirements\",\n          \"content\": \"# Section 401 Introduction - General Fixture Requirements\\n\\n## What This Section Establishes\\n\\nSection 401 sets the **fundamental requirements** for all plumbing fixtures in Louisiana. This section defines scope, prohibited fixtures, and basic installation standards that apply to all fixture types.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **Scope of fixture regulations** and what they cover\\n- **Prohibited fixture types** and why they're not allowed\\n- **Access requirements** for maintenance and repairs\\n- **Basic installation standards** for all fixtures\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Fixture Scope and Standards**\\n- Materials, design, installation, and quality requirements\\n- How fixture regulations coordinate with other code chapters\\n- Professional responsibility for proper fixture selection\\n\\n**Prohibited Fixtures**\\n- Pan, valve, plunger, offset, and washout water closets\\n- Fixtures with invisible seals or unventilated spaces\\n- Floor type trough urinals and siphonage-prone designs\\n- Health and safety reasons behind prohibitions\\n\\n**Access and Maintenance Requirements**\\n- Concealed slip-joint connection access provisions\\n- Waste and overflow fitting accessibility\\n- Access panel and utility space requirements\\n- Inspection and repair considerations\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 401 knowledge helps you:\\n- **Select appropriate fixtures** that meet Louisiana requirements\\n- **Avoid prohibited fixtures** that will fail inspection\\n- **Plan access provisions** for future maintenance needs\\n- **Ensure proper installation** according to general standards\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Critical Requirements:**\\n- Complete list of prohibited fixture types\\n- Access requirements for concealed connections\\n- General installation and quality standards\\n- Coordination with material and installation chapters\\n\\n**Professional Application:**\\nUnderstanding general fixture requirements helps you make appropriate selections and installations before moving to specific fixture types.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 401 works with:\\n- **Section 403**: Installation procedures and standards\\n- **Section 405**: Location and spacing requirements\\n- **Section 407**: Materials and performance standards\\n- **Section 411**: Minimum fixture requirements for buildings\\n\\n### ðŸ’¡ Professional Insight\\n\\nProper fixture selection and installation at the general level prevents costly problems during specific installation and inspection phases.\\n\\n---\\n\\n**Study Tip:** Section 401 answers 'What fixtures can I use and what are the basic rules?' - this foundation knowledge guides all specific fixture installation work.\",\n          \"extractedAt\": \"2025-01-30T22:25:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 301\n    },\n\n    {\n      id: \"intro-section-403\",\n      courseId,\n      title: \"Section 403 Introduction - Installation\",\n      type: \"lesson\",\n      chapter: 4,\n      section: 403,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 403 Introduction - Installation\",\n          \"content\": \"# Section 403 Introduction - Installation\\n\\n## What This Section Establishes\\n\\nSection 403 defines the **specific installation requirements** for all plumbing fixtures. This section ensures fixtures are properly positioned, supported, and sealed for optimal performance and accessibility.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **Cleaning access requirements** and fixture positioning\\n- **Watertight joint specifications** for walls and floors\\n- **Support requirements** for wall-hung fixtures\\n- **Setting standards** for level, alignment, and spacing\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Access and Positioning**\\n- Easy access for cleaning all fixture surfaces\\n- Pipe routing to nearest walls when practical\\n- Professional installation for long-term maintenance\\n\\n**Watertight Installations**\\n- Wall and floor joint sealing requirements\\n- Prevention of water damage and mold issues\\n- Proper caulking and sealing techniques\\n\\n**Support and Mounting**\\n- Wall-hung water closet support requirements\\n- Concealed metal supporting members\\n- Load distribution and structural considerations\\n\\n**Setting and Alignment**\\n- Level installation and proper alignment standards\\n- Minimum spacing requirements between fixtures\\n- Center-to-center measurements and clearances\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 403 knowledge helps you:\\n- **Install fixtures properly** for long-term performance\\n- **Prevent water damage** through proper sealing\\n- **Meet spacing requirements** for code compliance\\n- **Ensure structural support** for wall-hung fixtures\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Critical Installation Standards:**\\n- Water closet and bidet spacing (15\\\" from centerline to walls)\\n- Center-to-center spacing (30\\\" water closets, 24\\\" urinals)\\n- Front clearance requirements (21\\\" minimum)\\n- Wall-hung fixture support specifications\\n\\n**Professional Responsibility:**\\nProper installation ensures code compliance, prevents water damage, and provides long-term fixture performance.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 403 coordinates with:\\n- **Section 401**: General requirements that govern installation\\n- **Section 405**: Location requirements that affect installation\\n- **Section 407**: Material standards for installation components\\n- **Structural codes**: Building requirements for fixture support\\n\\n### ðŸ’¡ Professional Tip\\n\\nMeasure twice, install once. Proper spacing and support prevent costly rework and ensure code compliance from the start.\\n\\n---\\n\\n**Study Tip:** Section 403 answers 'How do I install fixtures correctly?' - these standards ensure professional installation that meets code and performance requirements.\",\n          \"extractedAt\": \"2025-01-30T22:26:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 302\n    },\n\n    // CHAPTER 4 REVIEW INTRODUCTION\n    {\n      id: \"intro-chapter-4-review\",\n      courseId,\n      title: \"Chapter 4 Review Introduction - Plumbing Fixtures Mastery\",\n      type: \"lesson\",\n      chapter: 4,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 4 Review Introduction - Plumbing Fixtures Mastery\",\n          \"content\": \"# Chapter 4 Review Introduction - Plumbing Fixtures Mastery\\n\\n## Chapter Overview - Complete Fixture Installation Standards\\n\\nChapter 4 provides **comprehensive requirements** for all plumbing fixtures in Louisiana. This chapter covers selection, installation, location, materials, and minimum requirements for fixtures in all building types.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**General Requirements (Section 401)**\\n- Scope of fixture regulations and prohibited fixture types\\n- Access requirements for concealed connections\\n- Basic installation standards for all fixtures\\n- Health and safety reasons behind fixture prohibitions\\n\\n**Installation Standards (Section 403)**\\n- Cleaning access and fixture positioning requirements\\n- Watertight joint specifications and support standards\\n- Setting, alignment, and spacing requirements\\n- Professional installation for code compliance\\n\\n**Location Requirements (Section 405)**\\n- Ventilation and lighting standards for fixture areas\\n- Public restroom and food service facility requirements\\n- Construction worker toilet facility provisions\\n- Clearance and accessibility standards\\n\\n**Materials and Performance (Section 407)**\\n- Approved fixture materials and construction standards\\n- Performance requirements and testing specifications\\n- Fixture fittings and accessory standards\\n- Quality and durability requirements\\n\\n**Minimum Fixture Requirements (Section 411)**\\n- Building occupancy fixture calculations\\n- Specific requirements for different building types\\n- Water closet, lavatory, and additional fixture minimums\\n- Commercial and institutional facility requirements\\n\\n### ðŸ“š Integration Points - How Sections Work Together\\n\\n**Complete Fixture Framework:**\\n1. **Section 401** defines what fixtures can be used\\n2. **Section 403** specifies how to install them\\n3. **Section 405** determines where they can be located\\n4. **Section 407** ensures proper materials and performance\\n5. **Section 411** establishes minimum quantities required\\n\\n**Professional Application:**\\nChapter 4 provides complete guidance for fixture selection, installation, and compliance in all building types.\\n\\n### ðŸŽ“ Exam Preparation Strategy\\n\\n**High-Priority Topics:**\\n- Prohibited fixture types and reasons for prohibition\\n- Installation spacing and clearance requirements\\n- Minimum fixture calculations for different occupancies\\n- Ventilation and location requirements\\n- Material standards and performance requirements\\n\\n**Common Exam Scenarios:**\\n- Fixture quantity calculations for specific building types\\n- Installation spacing and support requirements\\n- Location and ventilation requirement applications\\n- Material selection and performance standard questions\\n- Access and maintenance provision requirements\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 4 enables you to:\\n- **Select appropriate fixtures** for any building type\\n- **Calculate minimum fixture requirements** accurately\\n- **Install fixtures properly** with correct spacing and support\\n- **Meet location and ventilation requirements** for all applications\\n- **Ensure material compliance** and long-term performance\\n\\n### âš ï¸ Chapter Review Requirements\\n\\n**80% Pass Threshold:** This chapter review requires 80% to advance to Chapter 5 (Water Heaters). Fixture knowledge is essential for understanding complete plumbing system design.\\n\\n**Study Approach:**\\n1. Master prohibited fixture types and selection criteria\\n2. Learn installation spacing and support requirements\\n3. Understand location and ventilation standards\\n4. Practice fixture quantity calculations for different building types\\n5. Study material and performance requirements\\n\\n### ðŸ’¡ Success Strategy\\n\\nThink of Chapter 4 as \\\"fixture mastery\\\" - everything you need to know about selecting, installing, and calculating fixtures for complete code compliance.\\n\\n### ðŸ“ Connection to Future Chapters\\n\\nChapter 4 fixture knowledge supports:\\n- **Chapter 5**: Water heater connections to fixture supply systems\\n- **Chapter 6**: Water supply sizing based on fixture requirements\\n- **Chapter 7**: Drainage system sizing based on fixture units\\n- **All subsequent chapters**: System design based on fixture loads\\n\\n---\\n\\n**Mastery Goal:** You should be able to select appropriate fixtures, calculate minimum requirements, install with proper spacing and support, ensure location compliance, and verify material standards - providing complete fixture expertise for any Louisiana plumbing project.\",\n          \"extractedAt\": \"2025-01-30T22:27:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 399\n    },\n\n    // CHAPTER 5 SECTION INTRODUCTIONS  \n    {\n      id: \"intro-section-501\",\n      courseId,\n      title: \"Section 501 Introduction - General Water Heater Requirements\",\n      type: \"lesson\",\n      chapter: 5,\n      section: 501,\n      content: {\n        \"extracted\": {\n          \"title\": \"Section 501 Introduction - General Water Heater Requirements\",\n          \"content\": \"# Section 501 Introduction - General Water Heater Requirements\\n\\n## What This Section Establishes\\n\\nSection 501 sets the **fundamental requirements** for water heaters and hot water systems in Louisiana. This section establishes scope, safety standards, and basic installation principles for all water heating equipment.\\n\\n### ðŸŽ¯ Key Learning Objectives\\n\\nAfter studying this section, you will understand:\\n- **Scope of water heater regulations** and what they cover\\n- **Safety requirements** for installation and operation\\n- **Basic installation standards** for all water heating equipment\\n- **Coordination with other code chapters** and building systems\\n\\n### ðŸ“‹ Critical Concepts to Master\\n\\n**Water Heater Scope**\\n- Types of water heating equipment covered by regulations\\n- Installation, safety, and performance requirements\\n- Professional responsibility for proper equipment selection\\n\\n**Safety Standards**\\n- Temperature and pressure relief requirements\\n- Combustion air and venting provisions\\n- Electrical safety and grounding requirements\\n- Emergency shutdown and safety device provisions\\n\\n**Installation Principles**\\n- Accessibility for maintenance and service\\n- Clearance requirements for safe operation\\n- Support and mounting specifications\\n- Connection to plumbing and building systems\\n\\n### ðŸ”§ Real-World Applications\\n\\nAs a Louisiana plumber, Section 501 knowledge helps you:\\n- **Select appropriate water heaters** for specific applications\\n- **Ensure safety compliance** in all installations\\n- **Plan proper installation** with adequate access and clearances\\n- **Coordinate with other trades** for complete system integration\\n\\n### ðŸŽ“ Study Focus for Certification\\n\\n**Critical Safety Requirements:**\\n- Temperature and pressure relief valve specifications\\n- Combustion air and venting requirements\\n- Electrical connection and grounding standards\\n- Emergency safety device requirements\\n\\n**Professional Application:**\\nUnderstanding general water heater requirements provides the foundation for all specific installation and safety procedures.\\n\\n### ðŸ“ Connection to Other Sections\\n\\nSection 501 works with:\\n- **Section 503**: Installation procedures and requirements\\n- **Section 505**: Safety device and relief valve requirements\\n- **Section 507**: Venting and combustion air requirements\\n- **Chapter 6**: Water supply connections and sizing\\n\\n### ðŸ’¡ Professional Insight\\n\\nWater heater safety is paramount. Proper installation prevents scalding, explosion, and carbon monoxide hazards that can be life-threatening.\\n\\n---\\n\\n**Study Tip:** Section 501 answers 'What are the basic safety and installation requirements for water heaters?' - this foundation ensures safe, code-compliant installations.\",\n          \"extractedAt\": \"2025-01-30T22:28:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 401\n    },\n\n    // CHAPTER 5 REVIEW INTRODUCTION\n    {\n      id: \"intro-chapter-5-review\",\n      courseId,\n      title: \"Chapter 5 Review Introduction - Water Heaters Mastery\",\n      type: \"lesson\",\n      chapter: 5,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 5 Review Introduction - Water Heaters Mastery\",\n          \"content\": \"# Chapter 5 Review Introduction - Water Heaters Mastery\\n\\n## Chapter Overview - Complete Water Heater Safety and Installation\\n\\nChapter 5 provides **comprehensive requirements** for water heaters and hot water systems in Louisiana. This chapter covers safety, installation, relief valves, solar systems, and all aspects of safe water heating.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**General Requirements (Section 501)**\\n- Water heater scope and types covered by regulations\\n- Basic safety standards and installation principles\\n- Coordination with plumbing and building systems\\n- Professional responsibility for equipment selection\\n\\n**Installation Standards (Section 503)**\\n- Clearance requirements and accessibility standards\\n- Support and mounting specifications\\n- Connection procedures for all water heater types\\n- Electrical and gas connection requirements\\n\\n**Safety Devices (Section 511)**\\n- Temperature and pressure relief valve requirements\\n- Relief valve discharge piping and termination\\n- Emergency shutdown and safety device provisions\\n- Testing and maintenance requirements\\n\\n**Solar Water Heating (Section 513)**\\n- Closed-loop system requirements and prohibitions\\n- Heat exchanger and freeze protection standards\\n- Installation and certification requirements\\n- Integration with auxiliary heating systems\\n\\n### ðŸ“š Integration Points - How Sections Work Together\\n\\n**Complete Water Heater Framework:**\\n1. **Section 501** establishes scope and basic requirements\\n2. **Section 503** defines installation procedures and standards\\n3. **Section 511** ensures safety through relief devices\\n4. **Section 513** covers specialized solar water heating\\n\\n**Safety-First Approach:**\\nChapter 5 prioritizes safety at every level, from equipment selection through installation and ongoing operation.\\n\\n### ðŸŽ“ Exam Preparation Strategy\\n\\n**High-Priority Topics:**\\n- Temperature and pressure relief valve specifications\\n- Installation clearance and accessibility requirements\\n- Safety device testing and discharge requirements\\n- Solar system design and installation standards\\n- Emergency shutdown and safety procedures\\n\\n**Common Exam Scenarios:**\\n- Relief valve sizing and discharge piping\\n- Water heater clearance and support requirements\\n- Solar system integration and safety\\n- Emergency safety device applications\\n- Installation coordination with other systems\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 5 enables you to:\\n- **Install water heaters safely** with proper clearances and support\\n- **Size and install relief valves** correctly for all applications\\n- **Design and install solar systems** meeting Louisiana requirements\\n- **Ensure safety compliance** in all water heating installations\\n- **Coordinate effectively** with electrical and HVAC trades\\n\\n### âš ï¸ Chapter Review Requirements\\n\\n**80% Pass Threshold:** This chapter review requires 80% to advance to Chapter 6 (Water Supply). Water heater safety knowledge is critical for protecting life and property.\\n\\n**Study Approach:**\\n1. Master safety device requirements and installation\\n2. Learn clearance and accessibility standards\\n3. Understand relief valve sizing and discharge\\n4. Study solar system requirements and integration\\n5. Practice emergency safety procedures\\n\\n### ðŸ’¡ Success Strategy\\n\\nThink of Chapter 5 as \\\"water heater safety mastery\\\" - proper installation prevents scalding, explosion, and carbon monoxide hazards that can be life-threatening.\\n\\n### ðŸ“ Connection to Future Chapters\\n\\nChapter 5 water heater knowledge supports:\\n- **Chapter 6**: Water supply sizing and connection to heaters\\n- **Chapter 7**: Drainage requirements for relief valve discharge\\n- **Chapter 11**: Venting requirements for fuel-burning heaters\\n- **All system chapters**: Integration of water heating into complete systems\\n\\n---\\n\\n**Mastery Goal:** You should be able to select, install, and ensure safety of all water heating equipment, from conventional units to solar systems, while protecting life and property through proper safety device installation and testing.\",\n          \"extractedAt\": \"2025-01-30T22:29:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 499\n    },\n\n    // COMPREHENSIVE CHAPTER REVIEWS FOR REMAINING CHAPTERS 6-15\n    {\n      id: \"intro-chapter-6-review\",\n      courseId,\n      title: \"Chapter 6 Review Introduction - Water Supply Systems Mastery\",\n      type: \"lesson\",\n      chapter: 6,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 6 Review Introduction - Water Supply Systems Mastery\",\n          \"content\": \"# Chapter 6 Review Introduction - Water Supply Systems Mastery\\n\\n## Chapter Overview - Complete Water Supply System Design\\n\\nChapter 6 provides **comprehensive requirements** for water supply systems in Louisiana. This chapter covers materials, sizing, cross-connection protection, and all aspects of safe potable water delivery.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**System Design and Materials**\\n- Approved materials for water supply piping and fittings\\n- Pipe sizing calculations and pressure requirements\\n- System layout and distribution design principles\\n- Connection standards and installation procedures\\n\\n**Cross-Connection Protection**\\n- Backflow prevention device requirements and applications\\n- Air gap specifications and proper installation\\n- Cross-connection identification and elimination\\n- Testing and maintenance of protection devices\\n\\n**Pressure and Flow Requirements**\\n- Minimum pressure standards for fixtures\\n- Flow rate calculations and demand factors\\n- Pressure reducing valves and system protection\\n- Water hammer prevention and control\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 6 enables you to:\\n- **Design water supply systems** that meet all pressure and flow requirements\\n- **Install cross-connection protection** to safeguard public health\\n- **Size piping correctly** for optimal system performance\\n- **Ensure water quality** through proper material selection and installation\\n\\n---\\n\\n**Mastery Goal:** You should be able to design, install, and protect water supply systems that deliver safe, adequate potable water while preventing contamination and ensuring code compliance.\",\n          \"extractedAt\": \"2025-01-30T22:30:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 599\n    },\n\n    {\n      id: \"intro-chapter-7-review\",\n      courseId,\n      title: \"Chapter 7 Review Introduction - Drainage Systems Mastery\",\n      type: \"lesson\",\n      chapter: 7,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 7 Review Introduction - Drainage Systems Mastery\",\n          \"content\": \"# Chapter 7 Review Introduction - Drainage Systems Mastery\\n\\n## Chapter Overview - Complete Drainage System Design\\n\\nChapter 7 provides **comprehensive requirements** for sanitary drainage systems in Louisiana. This chapter covers pipe sizing, fixture units, system layout, and proper waste removal.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**System Design and Sizing**\\n- Fixture unit calculations and pipe sizing methods\\n- Drainage system layout and slope requirements\\n- Building drain and sewer sizing standards\\n- Connection procedures and fitting requirements\\n\\n**Waste Management**\\n- Sanitary waste vs. storm water separation\\n- Grease interceptor and special waste requirements\\n- Floor drain and area drain installation\\n- System testing and inspection procedures\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 7 enables you to:\\n- **Size drainage systems** correctly for all building types\\n- **Install proper slopes** for effective waste removal\\n- **Design special waste systems** for commercial applications\\n- **Ensure system integrity** through proper testing and inspection\\n\\n---\\n\\n**Mastery Goal:** You should be able to design and install drainage systems that effectively remove all waste while preventing backups and maintaining sanitary conditions.\",\n          \"extractedAt\": \"2025-01-30T22:31:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 699\n    },\n\n    {\n      id: \"intro-chapter-8-review\",\n      courseId,\n      title: \"Chapter 8 Review Introduction - Special Waste Systems Mastery\",\n      type: \"lesson\",\n      chapter: 8,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 8 Review Introduction - Special Waste Systems Mastery\",\n          \"content\": \"# Chapter 8 Review Introduction - Special Waste Systems Mastery\\n\\n## Chapter Overview - Specialized Waste Handling Systems\\n\\nChapter 8 provides **comprehensive requirements** for special waste systems in Louisiana. This chapter covers industrial waste, interceptors, and specialized treatment requirements.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Special Waste Classification**\\n- Industrial waste vs. sanitary waste definitions\\n- Grease interceptor sizing and installation\\n- Chemical waste treatment requirements\\n- Oil and sand interceptor applications\\n\\n**Treatment and Disposal**\\n- Pre-treatment requirements for industrial waste\\n- Neutralization and chemical treatment systems\\n- Sampling and monitoring requirements\\n- Discharge standards and permit compliance\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 8 enables you to:\\n- **Design interceptor systems** for restaurants and commercial facilities\\n- **Handle industrial waste** according to environmental regulations\\n- **Install treatment systems** that protect public infrastructure\\n- **Ensure compliance** with discharge standards and permits\\n\\n---\\n\\n**Mastery Goal:** You should be able to design and install special waste systems that properly treat and dispose of non-domestic waste while protecting public health and the environment.\",\n          \"extractedAt\": \"2025-01-30T22:32:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 799\n    },\n\n    {\n      id: \"intro-chapter-9-review\",\n      courseId,\n      title: \"Chapter 9 Review Introduction - Venting Systems Mastery\",\n      type: \"lesson\",\n      chapter: 9,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 9 Review Introduction - Venting Systems Mastery\",\n          \"content\": \"# Chapter 9 Review Introduction - Venting Systems Mastery\\n\\n## Chapter Overview - Complete Venting System Design\\n\\nChapter 9 provides **comprehensive requirements** for venting systems in Louisiana. This chapter covers vent sizing, installation, and proper system design for trap seal protection.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Vent System Design**\\n- Individual and common vent sizing methods\\n- Stack venting and wet venting applications\\n- Vent terminal locations and protection\\n- Connection procedures and fitting requirements\\n\\n**Trap Seal Protection**\\n- Proper vent sizing to prevent siphonage\\n- Back pressure prevention in vent systems\\n- Relief vent applications and installation\\n- Testing procedures for vent system integrity\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 9 enables you to:\\n- **Design vent systems** that protect all trap seals\\n- **Size vents correctly** for optimal performance\\n- **Install vent terminals** that prevent weather infiltration\\n- **Ensure system balance** through proper vent design\\n\\n---\\n\\n**Mastery Goal:** You should be able to design and install venting systems that maintain trap seals, prevent sewer gas infiltration, and ensure proper drainage system operation.\",\n          \"extractedAt\": \"2025-01-30T22:33:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 899\n    },\n\n    {\n      id: \"intro-chapter-10-review\",\n      courseId,\n      title: \"Chapter 10 Review Introduction - Traps and Interceptors Mastery\",\n      type: \"lesson\",\n      chapter: 10,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 10 Review Introduction - Traps and Interceptors Mastery\",\n          \"content\": \"# Chapter 10 Review Introduction - Traps and Interceptors Mastery\\n\\n## Chapter Overview - Trap and Interceptor Systems\\n\\nChapter 10 provides **comprehensive requirements** for traps and interceptors in Louisiana. This chapter covers trap selection, installation, and maintenance for proper sewer gas protection.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Trap Requirements**\\n- Individual fixture trap requirements\\n- Trap seal depths and protection methods\\n- Prohibited trap configurations\\n- Trap cleaning and maintenance access\\n\\n**Interceptor Applications**\\n- Grease interceptor sizing for food service\\n- Oil interceptor requirements for automotive facilities\\n- Sand interceptor applications\\n- Maintenance and cleaning procedures\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 10 enables you to:\\n- **Select appropriate traps** for all fixture types\\n- **Install interceptors** correctly for commercial applications\\n- **Maintain trap seals** through proper venting\\n- **Provide access** for cleaning and maintenance\\n\\n---\\n\\n**Mastery Goal:** You should be able to select, install, and maintain traps and interceptors that provide effective sewer gas protection and waste treatment.\",\n          \"extractedAt\": \"2025-01-30T22:34:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 999\n    },\n\n    {\n      id: \"intro-chapter-11-review\",\n      courseId,\n      title: \"Chapter 11 Review Introduction - Storm Drainage Mastery\",\n      type: \"lesson\",\n      chapter: 11,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 11 Review Introduction - Storm Drainage Mastery\",\n          \"content\": \"# Chapter 11 Review Introduction - Storm Drainage Mastery\\n\\n## Chapter Overview - Storm Water Management Systems\\n\\nChapter 11 provides **comprehensive requirements** for storm drainage systems in Louisiana. This chapter covers roof drainage, area drains, and storm water management.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Storm Water Systems**\\n- Roof drainage design and sizing calculations\\n- Storm sewer vs. sanitary sewer separation\\n- Area drain installation and connection\\n- Overflow provisions and emergency drainage\\n\\n**Installation Requirements**\\n- Proper slopes for storm water removal\\n- Backflow prevention in storm systems\\n- Connection to municipal storm systems\\n- Testing and inspection procedures\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 11 enables you to:\\n- **Design roof drainage** for effective water removal\\n- **Separate storm and sanitary** systems properly\\n- **Install area drains** for surface water management\\n- **Prevent flooding** through proper design and installation\\n\\n---\\n\\n**Mastery Goal:** You should be able to design and install storm drainage systems that effectively manage rainfall and prevent property damage.\",\n          \"extractedAt\": \"2025-01-30T22:35:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 1099\n    },\n\n    {\n      id: \"intro-chapter-12-review\",\n      courseId,\n      title: \"Chapter 12 Review Introduction - Fuel Gas Piping Mastery\",\n      type: \"lesson\",\n      chapter: 12,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 12 Review Introduction - Fuel Gas Piping Mastery\",\n          \"content\": \"# Chapter 12 Review Introduction - Fuel Gas Piping Mastery\\n\\n## Chapter Overview - Safe Fuel Gas Installation\\n\\nChapter 12 provides **comprehensive requirements** for fuel gas piping in Louisiana. This chapter covers natural gas and LP gas systems, safety requirements, and installation standards.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Gas Piping Systems**\\n- Natural gas vs. LP gas system differences\\n- Pipe sizing calculations for gas flow\\n- Material requirements and approvals\\n- Installation and testing procedures\\n\\n**Safety Requirements**\\n- Gas leak detection and prevention\\n- Emergency shut-off valve requirements\\n- Ventilation requirements for gas appliances\\n- Explosion prevention measures\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 12 enables you to:\\n- **Install gas piping** safely for all appliance types\\n- **Test gas systems** to ensure leak-free operation\\n- **Size gas lines** correctly for appliance demands\\n- **Ensure safety** through proper installation and testing\\n\\n---\\n\\n**Mastery Goal:** You should be able to install fuel gas piping systems safely while preventing leaks and ensuring proper appliance operation.\",\n          \"extractedAt\": \"2025-01-30T22:36:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 1199\n    },\n\n    {\n      id: \"intro-chapter-13-review\",\n      courseId,\n      title: \"Chapter 13 Review Introduction - Medical Facilities Mastery\",\n      type: \"lesson\",\n      chapter: 13,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 13 Review Introduction - Medical Facilities Mastery\",\n          \"content\": \"# Chapter 13 Review Introduction - Medical Facilities Mastery\\n\\n## Chapter Overview - Healthcare Facility Plumbing\\n\\nChapter 13 provides **comprehensive requirements** for medical facility plumbing in Louisiana. This chapter covers specialized requirements for hospitals, clinics, and healthcare facilities.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Medical Facility Requirements**\\n- Specialized fixture requirements for healthcare\\n- Infection control and sanitation standards\\n- Medical gas system coordination\\n- Emergency system requirements\\n\\n**Special Considerations**\\n- Patient safety and accessibility requirements\\n- Isolation room plumbing requirements\\n- Laboratory and clinical waste handling\\n- Sterilization equipment connections\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 13 enables you to:\\n- **Install healthcare fixtures** meeting specialized requirements\\n- **Ensure infection control** through proper design\\n- **Coordinate with medical systems** for complete facility service\\n- **Meet accessibility standards** for patient care areas\\n\\n---\\n\\n**Mastery Goal:** You should be able to install plumbing systems in medical facilities that meet specialized healthcare requirements while ensuring patient safety and infection control.\",\n          \"extractedAt\": \"2025-01-30T22:37:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 1299\n    },\n\n    {\n      id: \"intro-chapter-14-review\",\n      courseId,\n      title: \"Chapter 14 Review Introduction - Swimming Pools and Spas Mastery\",\n      type: \"lesson\",\n      chapter: 14,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 14 Review Introduction - Swimming Pools and Spas Mastery\",\n          \"content\": \"# Chapter 14 Review Introduction - Swimming Pools and Spas Mastery\\n\\n## Chapter Overview - Pool and Spa Plumbing Systems\\n\\nChapter 14 provides **comprehensive requirements** for swimming pool and spa plumbing in Louisiana. This chapter covers circulation systems, drainage, and safety requirements.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Pool and Spa Systems**\\n- Circulation system design and sizing\\n- Suction fitting safety requirements\\n- Drainage and overflow systems\\n- Chemical feed system connections\\n\\n**Safety Requirements**\\n- Anti-entrapment measures and regulations\\n- Emergency drainage provisions\\n- Backflow prevention for pool systems\\n- Equipment access and maintenance requirements\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 14 enables you to:\\n- **Design pool circulation** for effective water treatment\\n- **Install safety features** to prevent entrapment hazards\\n- **Connect chemical systems** safely and effectively\\n- **Ensure compliance** with pool safety regulations\\n\\n---\\n\\n**Mastery Goal:** You should be able to install pool and spa plumbing systems that provide safe operation while meeting all circulation and safety requirements.\",\n          \"extractedAt\": \"2025-01-30T22:38:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 1399\n    },\n\n    {\n      id: \"intro-chapter-15-review\",\n      courseId,\n      title: \"Chapter 15 Review Introduction - Mobile Homes and Travel Trailers Mastery\",\n      type: \"lesson\",\n      chapter: 15,\n      section: 999,\n      content: {\n        \"extracted\": {\n          \"title\": \"Chapter 15 Review Introduction - Mobile Homes and Travel Trailers Mastery\",\n          \"content\": \"# Chapter 15 Review Introduction - Mobile Homes and Travel Trailers Mastery\\n\\n## Chapter Overview - Mobile and Manufactured Housing Plumbing\\n\\nChapter 15 provides **comprehensive requirements** for mobile home and travel trailer plumbing in Louisiana. This chapter covers unique requirements for manufactured housing and mobile facilities.\\n\\n### ðŸŽ¯ Critical Concepts to Master for 80% Pass Threshold\\n\\n**Mobile Home Requirements**\\n- Unique plumbing requirements for manufactured housing\\n- Connection standards for utility hookups\\n- Freeze protection in mobile installations\\n- Skirting and underpinning access requirements\\n\\n**Travel Trailer Systems**\\n- Temporary connection requirements\\n- Sanitary station design and installation\\n- Water supply and waste system connections\\n- Park facility plumbing requirements\\n\\n### ðŸ”§ Real-World Integration\\n\\nMastering Chapter 15 enables you to:\\n- **Install mobile home plumbing** meeting manufactured housing standards\\n- **Design trailer park facilities** for temporary connections\\n- **Ensure freeze protection** in mobile installations\\n- **Provide proper connections** for all mobile housing types\\n\\n---\\n\\n**Mastery Goal:** You should be able to install plumbing systems for mobile homes and travel trailers that meet specialized requirements while ensuring code compliance and system reliability.\\n\\n### ðŸŽ“ Final Course Integration\\n\\nCongratulations! Completing all 15 chapters of the Louisiana State Plumbing Code provides you with comprehensive knowledge for journeyman plumber certification. You now understand:\\n\\nâœ… **Administrative requirements** and code authority\\nâœ… **Technical vocabulary** and professional communication\\nâœ… **General regulations** and basic principles\\nâœ… **Fixture installation** and requirements\\nâœ… **Water heater safety** and installation\\nâœ… **Water supply systems** and cross-connection protection\\nâœ… **Drainage systems** and waste management\\nâœ… **Special waste handling** and treatment\\nâœ… **Venting systems** and trap seal protection\\nâœ… **Traps and interceptors** for sewer gas protection\\nâœ… **Storm drainage** and water management\\nâœ… **Fuel gas piping** and safety\\nâœ… **Medical facility** specialized requirements\\nâœ… **Pool and spa systems** and safety\\nâœ… **Mobile housing** and manufactured home requirements\\n\\nYou are now prepared for the Louisiana Journeyman Plumber certification exam!\",\n          \"extractedAt\": \"2025-01-30T22:39:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 1499\n    },\n    {\n      id: \"810cafa9-6024-4bdc-a3c5-266490062114\",\n      courseId,\n      title: \"LSPC 101 Administration  Subchapter A. General - Questions & Answers\",\n      type: \"quiz\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"title\": \"LSPC 101 Administration - Questions & Answers\",\n          \"content\": \"# Louisiana State Plumbing Code Section 101 - Practice Quiz\\n\\n## Multiple Choice Questions\\n\\n**1. Which specific section of the Louisiana Sanitary Code does the Department of Health and Hospitals, Office of Public Health adopt?**\\nA. Part XV (Electrical)\\nB. Part XIII (Building)\\nC. Part XIV (Plumbing) âœ“\\nD. Part XII (Environmental)\\n\\n**2. What is the alternative citation for 'Part XIV (Plumbing) of the Sanitary Code, State of Louisiana'?**\\nA. The Louisiana State Environmental Code\\nB. The Louisiana State Plumbing Code âœ“\\nC. The Louisiana Building Code\\nD. The Louisiana Residential Code\\n\\n**3. Any reference or citation to the 'Louisiana State Plumbing Code' is considered synonymous with what other reference or citation?**\\nA. Part XIV (Plumbing) of the Sanitary Code, State of Louisiana âœ“\\nB. Part XII (Fire Safety) of the Sanitary Code\\nC. Part XIII (Electrical) of the Sanitary Code\\nD. Part XI (Zoning) of the Sanitary Code\",\n          \"extractedAt\": \"2025-01-28T22:10:00Z\"\n        }\n      },\n      quizgeckoUrl: \"https://quizgecko.com/learn/assignment/d64de6a8-229e-4889-8711-163498aafb8d\",\n      isActive: true,\n      sortOrder: 0\n    },\n    {\n      id: \"c57f3c38-34c2-4a17-bbba-1ae88d2b524d\",\n      courseId,\n      title: \"LSPC 101 Administration  Subchapter A. General - Study Notes\",\n      type: \"study-notes\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"title\": \"LSPC 101 Administration - Study Notes\",\n          \"content\": \"# Louisiana State Plumbing Code Section 101 - Study Notes\\n\\n## Louisiana State Plumbing Code (LSPC) Adoption\\n\\nThe **Department of Health and Hospitals, Office of Public Health**, has adopted **Part XIV (Plumbing) of the Sanitary Code, State of Louisiana (LAC 51:XIV)**.\\n\\n### Key Terms and References\\n- **\\\"Part XIV (Plumbing) of the Sanitary Code, State of Louisiana\\\"** is officially referred to as the **\\\"Louisiana State Plumbing Code.\\\"**\\n- Any mention or citation of **\\\"this code,\\\"** **\\\"this Part,\\\"** or the **\\\"Louisiana State Plumbing Code\\\"** is interchangeable and refers to **\\\"Part XIV (Plumbing) of the Sanitary Code, State of Louisiana.\\\"**\",\n          \"extractedAt\": \"2025-01-28T22:12:00Z\"\n        }\n      },\n      quizgeckoUrl: \"https://quizgecko.com/learn/assignment/d64de6a8-229e-4889-8711-163498aafb8d\",\n      isActive: true,\n      sortOrder: 0\n    },\n    {\n      id: \"1db67ac7-708c-4904-8bdc-4dfa0c5157ce\",\n      courseId,\n      title: \"LSPC 101 Administration - 10-Minute Study Plan\",\n      type: \"study_plans\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"title\": \"LSPC 101 Administration - Time-Based Study Plans\",\n          \"content\": \"# Section 101 Study Plans - Administration & Authority\\n\\nChoose your available study time to get a customized learning plan:\\n\\n## ðŸ• 10-Minute Quick Study\\n\\n### Focus: Core Administration & Authority\\n\\n**Minutes 0-2: Core Adoption & Naming**\\n- Department of Health and Hospitals adopts Part XIV (Plumbing)\\n- Also known as Louisiana State Plumbing Code (LSPC)\\n- These terms are interchangeable\\n\\n**Minutes 3-5: Legal Authority Structure**\\n- LSPC has legal authority under Louisiana law\\n- Local jurisdictions can enforce plumbing standards\\n- Inspectors cite Section 101 for fundamental authority\\n\\n**Minutes 6-8: Terminology & References**\\n- \\\"This code\\\" = Louisiana State Plumbing Code\\n- \\\"This Part\\\" = Part XIV of Sanitary Code\\n- All terms reference the same legal document\\n\\n**Minutes 9-10: Practical Applications**\\n- Citations and violations use interchangeable terms\\n- Legal documents reference various names for same code\\n- Understanding helps navigate permits and inspections\\n\\n## ðŸ• 15-Minute Comprehensive Study\\n\\n**Minutes 0-3: Foundation & Authority**\\n- Department of Health and Hospitals adoption process\\n- Legal basis under Louisiana Administrative Code 51:XIV\\n- Hierarchy of enforcement authority\\n\\n**Minutes 4-7: Code Structure & Organization**\\n- Part XIV organization within Sanitary Code\\n- Relationship to other Louisiana construction codes\\n- Administrative procedures and requirements\\n\\n**Minutes 8-11: Terminology Mastery**\\n- Complete list of interchangeable references\\n- Legal document navigation strategies\\n- Common citation formats in practice\\n\\n**Minutes 12-15: Real-World Applications**\\n- Permit application processes\\n- Inspection procedures and authority\\n- Violation resolution and appeals\\n\\n## ðŸ• 30-Minute Deep Dive Study\\n\\n**Minutes 0-5: Historical Context & Development**\\n- Evolution of Louisiana plumbing regulations\\n- Integration with state health and safety codes\\n- Federal influence and local adaptations\\n\\n**Minutes 6-10: Legal Framework Analysis**\\n- Department of Health and Hospitals authority structure\\n- State vs. local jurisdiction boundaries\\n- Enforcement mechanisms and penalties\\n\\n**Minutes 11-15: Code Interpretation & Application**\\n- Reading and understanding code references\\n- Cross-referencing with other code sections\\n- Practical interpretation guidelines\\n\\n**Minutes 16-20: Administrative Procedures**\\n- Permit processes and requirements\\n- Inspection scheduling and protocols\\n- Documentation and record-keeping\\n\\n**Minutes 21-25: Professional Practice Integration**\\n- Daily application for working plumbers\\n- Client communication about code requirements\\n- Problem-solving using administrative framework\\n\\n**Minutes 26-30: Exam Preparation Focus**\\n- Key concepts likely to appear on certification exams\\n- Common question formats and answer strategies\\n- Memory techniques for terminology and references\",\n          \"extractedAt\": \"2025-01-28T22:17:00Z\"\n        }\n      },\n      duration: 10,\n      isActive: true,\n      sortOrder: 0\n    },\n    // 15-minute study plan\n    {\n      id: \"2db67ac7-708c-4904-8bdc-4dfa0c5157ce\",\n      courseId,\n      title: \"LSPC 101 Administration - 15-Minute Study Plan\",\n      type: \"study_plans\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"title\": \"LSPC 101 Administration - 15-Minute Study Plan\",\n          \"content\": \"# Section 101 Study Plans - Administration & Authority\\n\\n## ðŸ• 15-Minute Comprehensive Study\\n\\n**Minutes 0-3: Foundation & Authority**\\n- Department of Health and Hospitals adoption process\\n- Legal basis under Louisiana Administrative Code 51:XIV\\n- Hierarchy of enforcement authority\\n\\n**Minutes 4-7: Code Structure & Organization**\\n- Part XIV organization within Sanitary Code\\n- Relationship to other Louisiana construction codes\\n- Administrative procedures and requirements\\n\\n**Minutes 8-11: Terminology Mastery**\\n- Complete list of interchangeable references\\n- Legal document navigation strategies\\n- Common citation formats in practice\\n\\n**Minutes 12-15: Real-World Applications**\\n- Permit application processes\\n- Inspection procedures and authority\\n- Violation resolution and appeals\",\n          \"extractedAt\": \"2025-01-28T22:17:00Z\"\n        }\n      },\n      duration: 15,\n      isActive: true,\n      sortOrder: 1\n    },\n    // 30-minute study plan\n    {\n      id: \"3db67ac7-708c-4904-8bdc-4dfa0c5157ce\",\n      courseId,\n      title: \"LSPC 101 Administration - 30-Minute Study Plan\",\n      type: \"study_plans\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"title\": \"LSPC 101 Administration - 30-Minute Study Plan\",\n          \"content\": \"# Section 101 Study Plans - Administration & Authority\\n\\n## ðŸ• 30-Minute Deep Dive Study\\n\\n**Minutes 0-5: Historical Context & Development**\\n- Evolution of Louisiana plumbing regulations\\n- Integration with state health and safety codes\\n- Federal influence and local adaptations\\n\\n**Minutes 6-10: Legal Framework Analysis**\\n- Department of Health and Hospitals authority structure\\n- State vs. local jurisdiction boundaries\\n- Enforcement mechanisms and penalties\\n\\n**Minutes 11-15: Code Interpretation & Application**\\n- Reading and understanding code references\\n- Cross-referencing with other code sections\\n- Practical interpretation guidelines\\n\\n**Minutes 16-20: Administrative Procedures**\\n- Permit processes and requirements\\n- Inspection scheduling and protocols\\n- Documentation and record-keeping\\n\\n**Minutes 21-25: Professional Practice Integration**\\n- Daily application for working plumbers\\n- Client communication about code requirements\\n- Problem-solving using administrative framework\\n\\n**Minutes 26-30: Exam Preparation Focus**\\n- Key concepts likely to appear on certification exams\\n- Common question formats and answer strategies\\n- Memory techniques for terminology and references\",\n          \"extractedAt\": \"2025-01-28T22:17:00Z\"\n        }\n      },\n      duration: 30,\n      isActive: true,\n      sortOrder: 2\n    },\n    {\n      id: \"6bf16416-942a-4e08-9210-d9841331f819\",\n      courseId,\n      title: \"LSPC 101 Administration  Subchapter A. General - Teach Me (Chat)\",\n      type: \"chat\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"chatContent\": \"This is an interactive chat session about Louisiana State Plumbing Code Section 101 Administration. Ask me anything about the administrative aspects, adoption authority, or legal framework of the LSPC.\"\n      },\n      isActive: true,\n      sortOrder: 0\n    },\n    {\n      id: \"56240fe9-043f-4885-ade7-e73678295ef0\",\n      courseId,\n      title: \"LSPC 101 Administration  Subchapter A. General - Podcast\",\n      type: \"podcast\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"transcript\": `Welcome to Louisiana Plumber Prep - your comprehensive guide to mastering the Louisiana State Plumbing Code. I'm your instructor, and today we're diving deep into Section 101: Administration, Subchapter A - General.\n\nThis section is absolutely critical for every plumbing professional in Louisiana because it establishes the legal foundation for everything we do. Let's break this down step by step.\n\nFirst, let's talk about authority. The Department of Health and Hospitals, Office of Public Health, has adopted Part XIV - that's Part Fourteen - of the Sanitary Code, State of Louisiana. This is found in Louisiana Administrative Code 51:XIV. This is your official Louisiana State Plumbing Code.\n\nHere's something important to remember: whenever you see references to 'this code,' 'this Part,' or 'Louisiana State Plumbing Code' - they're all talking about the same thing: Part XIV of the Sanitary Code, State of Louisiana. Think of it like different names for the same person.\n\nWhy does this matter? In your daily work, you'll encounter citations, violations, and documentation that use these terms interchangeably. Knowing they're synonymous helps you navigate legal documents, permits, and inspections with confidence.\n\nNow, let's discuss the practical impact. This code gives legal authority to local jurisdictions to enforce plumbing standards. It's not just suggestions - it's law. When an inspector cites Section 101, they're referencing the fundamental authority that governs all plumbing work in Louisiana.\n\nFor journeymen preparing for certification, understanding this administrative foundation is crucial. Questions about authority, jurisdiction, and legal references frequently appear on certification exams.\n\nKey takeaways for today: One - The Department of Health and Hospitals has ultimate authority over plumbing codes in Louisiana. Two - Part XIV and Louisiana State Plumbing Code are the same thing. Three - All references to 'this code' or 'this Part' refer to Part XIV.\n\nRemember, mastering the administrative foundation sets you up for success in all other code sections. In our next lesson, we'll explore specific permit requirements and inspection procedures.\n\nKeep studying, stay safe on the job, and we'll see you in the next Louisiana Plumber Prep lesson.`,\n          \"title\": \"LSPC 101 Administration Subchapter A. General - Educational Podcast\",\n          \"extractedAt\": \"2025-01-30T22:15:00Z\"\n        }\n      },\n      isActive: true,\n      sortOrder: 0\n    },\n    {\n      id: \"657dee72-fdc9-42cf-a196-e535426032d3\",\n      courseId,\n      title: \"LSPC 101 Administration  Subchapter A. General - Introduction\",\n      type: \"lesson\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"html\": \"<h2>LSPC 101 - Administration and Authority</h2><p>Welcome to Section 101 of the Louisiana State Plumbing Code. This foundational section establishes the administrative framework and legal authority for plumbing regulations throughout Louisiana.</p><h3>Key Learning Objectives</h3><ul><li>Understand the adoption of Part XIV (Plumbing) by the Department of Health and Hospitals</li><li>Learn the legal authority structure under Louisiana Revised Statutes</li><li>Master the terminology and interchangeable references used throughout the code</li></ul>\"\n        }\n      },\n      duration: 30,\n      isActive: true,\n      sortOrder: 0\n    },\n    {\n      id: \"b33d9c97-02a5-4362-9217-94cb39e56bde\",\n      courseId,\n      title: \"LSPC 101 Administration  Subchapter A. General - Flashcards\",\n      type: \"flashcards\",\n      chapter: 1,\n      section: 101,\n      content: {\n        \"extracted\": {\n          \"cards\": [\n            {\n              \"front\": \"What department adopts Part XIV (Plumbing) of the Sanitary Code?\",\n              \"back\": \"Department of Health and Hospitals, Office of Public Health\"\n            },\n            {\n              \"front\": \"What is the alternative name for Part XIV (Plumbing) of the Sanitary Code?\",\n              \"back\": \"Louisiana State Plumbing Code (LSPC)\"\n            },\n            {\n              \"front\": \"What is the primary legal authority for the sanitary code?\",\n              \"back\": \"R.S. 36:258(B)\"\n            }\n          ]\n        }\n      },\n      isActive: true,\n      sortOrder: 0\n    },\n    {\n      id: \"c8f3d2a1-4b6e-4f9a-8e7c-1d2e3f4a5b6c\",\n      courseId,\n      title: \"LSPC 101 Administration - Study Notes\",\n      type: \"study-notes\",\n      chapter: 1,\n      section: 101,\n      content: {\n        keyPoints: [\n          \"The Department of Health and Hospitals, Office of Public Health adopts Part XIV (Plumbing) of the Sanitary Code\",\n          \"Part XIV is also known as the Louisiana State Plumbing Code (LSPC)\",\n          \"Legal authority is derived from Louisiana Revised Statutes R.S. 36:258(B)\",\n          \"All references to 'this code', 'this Part', or 'Louisiana State Plumbing Code' refer to Part XIV\",\n          \"Administrative authority governs all plumbing work and inspections in Louisiana\"\n        ],\n        notes: `<h3>Louisiana State Plumbing Code Administration</h3>\n        <p>Section 101 establishes the fundamental administrative framework for plumbing regulation in Louisiana. This section is critical for understanding the legal foundation that governs all plumbing work throughout the state.</p>\n        \n        <h4>Adoption Authority</h4>\n        <p>The <strong>Department of Health and Hospitals, Office of Public Health</strong> has the legal authority to adopt and enforce Part XIV (Plumbing) of the Sanitary Code. This authority is derived from Louisiana Revised Statutes R.S. 36:258(B), which grants the department regulatory power over public health matters including plumbing systems.</p>\n        \n        <h4>Code Terminology</h4>\n        <p>Understanding the interchangeable terminology is essential for professionals:</p>\n        <ul>\n          <li><strong>Part XIV (Plumbing)</strong> - The official designation in Louisiana Administrative Code 51:XIV</li>\n          <li><strong>Louisiana State Plumbing Code (LSPC)</strong> - The common name used by professionals</li>\n          <li><strong>\"This code\" or \"this Part\"</strong> - References throughout the document that refer to Part XIV</li>\n        </ul>\n        \n        <h4>Practical Application</h4>\n        <p>This administrative foundation has practical implications for daily plumbing work:</p>\n        <ul>\n          <li>All permits and inspections are conducted under this authority</li>\n          <li>Code violations are legally enforceable under state law</li>\n          <li>Local jurisdictions derive their enforcement power from this state-level adoption</li>\n          <li>Professional licensing requirements are tied to knowledge of this administrative structure</li>\n        </ul>\n        \n        <h4>Exam Preparation Focus</h4>\n        <p>For journeyman certification exams, focus on:</p>\n        <ul>\n          <li>Memorizing the exact name: \"Department of Health and Hospitals, Office of Public Health\"</li>\n          <li>Understanding that Part XIV and LSPC are identical</li>\n          <li>Recognizing legal authority questions related to R.S. 36:258(B)</li>\n        </ul>`,\n        codeReferences: [\n          {\n            section: \"Part XIV, Louisiana Administrative Code 51:XIV\",\n            description: \"Official Louisiana State Plumbing Code designation\"\n          },\n          {\n            section: \"R.S. 36:258(B)\",\n            description: \"Louisiana Revised Statutes granting regulatory authority\"\n          },\n          {\n            section: \"Department of Health and Hospitals\",\n            description: \"State agency with plumbing code adoption authority\"\n          }\n        ]\n      },\n      isActive: true,\n      sortOrder: 4\n    },\n    {\n      id: \"d9e4f5b2-7c8a-4f3e-9b1c-2a3b4c5d6e7f\",\n      courseId,\n      title: \"LSPC 103 Availability - Study Notes\",\n      type: \"study-notes\",\n      chapter: 1,\n      section: 103,\n      content: {\n        keyPoints: [\n          \"Section 103 ensures public access to the Louisiana State Plumbing Code\",\n          \"Official copies can be obtained from the Office of the State Register\",\n          \"Professionals must use current, official versions of the code\",\n          \"Electronic access methods are available for code viewing\",\n          \"Staying current with code changes is a professional responsibility\"\n        ],\n        notes: `<h3>Louisiana State Plumbing Code Availability</h3>\n        <p>Section 103 establishes <strong>public access requirements</strong> for the Louisiana State Plumbing Code, ensuring that professionals and citizens can obtain official copies of the regulations when needed.</p>\n        \n        <h4>Official Code Access</h4>\n        <p>The <strong>Office of the State Register</strong> serves as the primary source for official copies of the Louisiana State Plumbing Code. This ensures that everyone has access to the authoritative version of the regulations.</p>\n        \n        <h4>Professional Responsibility</h4>\n        <p>As a licensed plumbing professional, you have a legal and ethical obligation to:</p>\n        <ul>\n          <li>Work with current, official versions of the code</li>\n          <li>Verify that you're using the most recent regulations</li>\n          <li>Stay informed about updates and amendments</li>\n          <li>Access official information when questions arise on job sites</li>\n        </ul>\n        \n        <h4>Access Methods</h4>\n        <p>The code can be accessed through multiple channels:</p>\n        <ul>\n          <li><strong>Electronic access</strong> - Online viewing of current code provisions</li>\n          <li><strong>Direct contact</strong> - Contacting the Office of the State Register</li>\n          <li><strong>Professional resources</strong> - Industry publications and official distributors</li>\n        </ul>\n        \n        <h4>Practical Applications</h4>\n        <p>Understanding Section 103 helps you:</p>\n        <ul>\n          <li>Provide accurate information to clients and colleagues</li>\n          <li>Verify code requirements for complex installations</li>\n          <li>Demonstrate professionalism through proper code knowledge</li>\n          <li>Avoid compliance issues from using outdated information</li>\n        </ul>\n        \n        <h4>Connection to Professional Practice</h4>\n        <p>Inspectors expect plumbers to work with current code versions. Using outdated information can lead to:</p>\n        <ul>\n          <li>Failed inspections and costly rework</li>\n          <li>Legal liability for non-compliance</li>\n          <li>Professional reputation damage</li>\n          <li>Safety issues from outdated requirements</li>\n        </ul>`,\n        codeReferences: [\n          {\n            section: \"Section 103\",\n            description: \"Public access to Louisiana State Plumbing Code\"\n          },\n          {\n            section: \"Office of the State Register\",\n            description: \"Official source for code copies and information\"\n          },\n          {\n            section: \"Professional Responsibility\",\n            description: \"Obligation to use current, official code versions\"\n          }\n        ]\n      },\n      isActive: true,\n      sortOrder: 4\n    },\n    {\n      id: \"e1f2a3b4-8d9c-5e6f-0a1b-3c4d5e6f7a8b\",\n      courseId,\n      title: \"LSPC 105 Effective Date and Edition - Study Notes\",\n      type: \"study-notes\",\n      chapter: 1,\n      section: 105,\n      content: {\n        keyPoints: [\n          \"Section 105 establishes when code requirements become legally enforceable\",\n          \"February 20, 2013 is a key effective date for major code provisions\",\n          \"The 2013 Edition designation marks current Louisiana Plumbing Code standards\",\n          \"Different projects may be governed by different code editions based on permit dates\",\n          \"Understanding effective dates prevents compliance issues and costly rework\"\n        ],\n        notes: `<h3>Code Effective Dates and Edition Information</h3>\n        <p>Section 105 provides <strong>critical timing information</strong> about when code requirements take effect and how to identify which edition applies to specific plumbing work in Louisiana.</p>\n        \n        <h4>Key Effective Date: February 20, 2013</h4>\n        <p>This date marks when major provisions of the current Louisiana State Plumbing Code became legally enforceable. Understanding this date is crucial for:</p>\n        <ul>\n          <li>Determining which requirements apply to existing installations</li>\n          <li>Planning project timelines around compliance deadlines</li>\n          <li>Understanding transition periods for code implementation</li>\n        </ul>\n        \n        <h4>Edition Identification</h4>\n        <p>The <strong>2013 Edition</strong> designation helps professionals identify the current version of Louisiana Plumbing Code requirements:</p>\n        <ul>\n          <li>Provides clear reference point for current standards</li>\n          <li>Ensures consistency in code interpretation and application</li>\n          <li>Facilitates communication between professionals and inspectors</li>\n        </ul>\n        \n        <h4>Project Application Rules</h4>\n        <p>Understanding which code edition applies is essential:</p>\n        <ul>\n          <li><strong>New projects</strong> - Must meet current code standards</li>\n          <li><strong>Permitted projects</strong> - May continue under previous code editions if already started</li>\n          <li><strong>Renovations</strong> - Requirements depend on scope and permit dates</li>\n          <li><strong>Repairs</strong> - Generally follow current code unless specifically exempted</li>\n        </ul>\n        \n        <h4>Professional Compliance</h4>\n        <p>Proper understanding of effective dates helps you:</p>\n        <ul>\n          <li>Determine correct code requirements for each project</li>\n          <li>Communicate effectively with building officials and inspectors</li>\n          <li>Plan work schedules around compliance deadlines</li>\n          <li>Avoid costly rework from using incorrect standards</li>\n        </ul>\n        \n        <h4>Exam and Certification Focus</h4>\n        <p>The Louisiana Journeyman exam tests knowledge of:</p>\n        <ul>\n          <li>The February 20, 2013 effective date</li>\n          <li>How to determine which code edition applies</li>\n          <li>Transition periods and implementation timelines</li>\n          <li>Professional responsibilities regarding current standards</li>\n        </ul>`,\n        codeReferences: [\n          {\n            section: \"Section 105\",\n            description: \"Effective date and edition information for Louisiana Plumbing Code\"\n          },\n          {\n            section: \"February 20, 2013\",\n            description: \"Key effective date for major code provisions\"\n          },\n          {\n            section: \"2013 Edition\",\n            description: \"Current edition designation for Louisiana State Plumbing Code\"\n          }\n        ]\n      },\n      isActive: true,\n      sortOrder: 4\n    }\n  ];\n\n  // Insert all course content\n  for (const content of courseContentData) {\n    try {\n      await storage.createCourseContent(content);\n    } catch (error) {\n      console.error(`Error seeding content ${content.title}:`, error);\n    }\n  }\n\n  console.log(`Course content seeded successfully: ${courseContentData.length} items`);\n}\nimport bcrypt from \"bcrypt\";\nimport session from \"express-session\";\nimport passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\n\nif (!process.env.STRIPE_SECRET_KEY) {\n  throw new Error('Missing required Stripe secret: STRIPE_SECRET_KEY');\n}\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2025-08-27.basil\",\n});\n\n// Middleware to check if user has active subscription for professional tools\nconst requireActiveSubscription = async (req: any, res: any, next: any) => {\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ message: \"Not authenticated\" });\n  }\n\n  const user = req.user as any;\n  \n  try {\n    // Allow admin users without Stripe verification\n    if (user.email === 'admin@latrainer.com' || user.email === 'admin@laplumbprep.com' || user.id === 'admin-test-user') {\n      return next();\n    }\n\n    // Check if user has professional or master tier subscription\n    if (user.subscriptionTier === 'professional' || user.subscriptionTier === 'master') {\n      // Verify the subscription is actually active in Stripe\n      if (user.stripeSubscriptionId) {\n        const subscription = await stripe.subscriptions.retrieve(user.stripeSubscriptionId);\n        if (subscription.status === 'active') {\n          return next();\n        }\n      }\n    }\n    \n    return res.status(403).json({ \n      message: \"Professional tools access requires an active subscription\",\n      subscriptionRequired: true\n    });\n  } catch (error) {\n    console.error('Subscription check error:', error);\n    return res.status(500).json({ message: \"Error checking subscription status\" });\n  }\n};\n\n// Middleware to check if user is enrolled in courses (student access)\nconst requireStudentEnrollment = async (req: any, res: any, next: any) => {\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ message: \"Not authenticated\" });\n  }\n\n  const user = req.user as any;\n  \n  try {\n    // Check if user has any course enrollments\n    const enrollments = await storage.getUserEnrollments(user.id);\n    if (enrollments && enrollments.length > 0) {\n      return next();\n    }\n    \n    return res.status(403).json({ \n      message: \"Job board access requires course enrollment\",\n      enrollmentRequired: true\n    });\n  } catch (error) {\n    console.error('Enrollment check error:', error);\n    return res.status(500).json({ message: \"Error checking enrollment status\" });\n  }\n};\n\n// Configure multer for file uploads\nconst upload = multer({\n  dest: 'uploads/',\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB limit\n  },\n  fileFilter: (req, file, cb) => {\n    if (file.mimetype.startsWith('image/') || file.mimetype === 'application/pdf') {\n      cb(null, true);\n    } else {\n      cb(new Error('Only images and PDF files are allowed'));\n    }\n  }\n});\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Session configuration\n  app.use(session({\n    secret: process.env.SESSION_SECRET || 'your-secret-key',\n    resave: false,\n    saveUninitialized: false,\n    cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 } // 24 hours\n  }));\n\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  // Endpoint to trigger course content seeding (useful for production)\n  app.post(\"/api/seed-course-content\", async (req, res) => {\n    try {\n      await seedCourseContent();\n      res.json({ message: \"Course content seeding completed successfully\" });\n    } catch (error: any) {\n      console.error(\"Course content seeding error:\", error);\n      res.status(500).json({ message: \"Error seeding course content: \" + error.message });\n    }\n  });\n\n  // Serve downloadable PDFs for lead magnets - MUST BE FIRST TO AVOID CONFLICTS\n  app.get(\"/downloads/louisiana-code-guide.pdf\", async (req, res) => {\n    try {\n      const email = req.query.email as string;\n      \n      if (!email) {\n        return res.redirect('/lead-magnet?error=email_required');\n      }\n\n      // Check if email exists in lead magnet downloads\n      const [leadRecord] = await db.select()\n        .from(leadMagnetDownloads)\n        .where(eq(leadMagnetDownloads.email, email.toLowerCase()))\n        .limit(1);\n\n      if (!leadRecord) {\n        return res.redirect('/lead-magnet?error=email_not_found');\n      }\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', 'attachment; filename=\"louisiana-code-guide.pdf\"');\n      \n      const pdfContent = `\nLouisiana Plumbing Code Quick Reference Guide\n\nThis comprehensive guide covers:\n- Essential code violations to avoid\n- Pipe sizing requirements\n- Installation best practices\n- 2024 Louisiana code updates\n- Common inspection failures\n- Professional troubleshooting tips\n\nComplete PDF version coming soon!\nVisit laplumbprep.com/courses to start your certification prep.\n      `;\n      \n      res.send(pdfContent);\n    } catch (error: any) {\n      console.error(\"Error serving code guide:\", error);\n      res.status(500).send(\"Error downloading guide\");\n    }\n  });\n\n  app.get(\"/downloads/louisiana-career-roadmap.pdf\", async (req, res) => {\n    try {\n      const email = req.query.email as string;\n      \n      if (!email) {\n        return res.redirect('/student-lead-magnet?error=email_required');\n      }\n\n      // Check if email exists in student lead magnet downloads\n      const [leadRecord] = await db.select()\n        .from(studentLeadMagnetDownloads)\n        .where(eq(studentLeadMagnetDownloads.email, email.toLowerCase()))\n        .limit(1);\n\n      if (!leadRecord) {\n        return res.redirect('/student-lead-magnet?error=email_not_found');\n      }\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', 'attachment; filename=\"louisiana-career-roadmap.pdf\"');\n      \n      const pdfContent = `\nLouisiana Plumbing Career Roadmap 2024\n\nYour path to $75,000+ plumbing career:\n\nAPPRENTICE LEVEL:\n- Starting salary: $35,000-$45,000\n- Get on-the-job training\n- Complete 4-year apprenticeship\n\nJOURNEYMAN LEVEL:\n- Salary: $50,000-$65,000  \n- Pass state licensing exam\n- Work independently\n- Supervise apprentices\n\nMASTER PLUMBER:\n- Salary: $65,000-$85,000+\n- Own your business\n- Pull permits\n- Train others\n\nCERTIFICATION TIMELINE:\n- Year 1-4: Apprenticeship\n- Year 5: Journeyman exam prep\n- Year 6+: Master plumber track\n\nComplete roadmap PDF coming soon!\nStart your journey at laplumbprep.com/courses\n      `;\n      \n      res.send(pdfContent);\n    } catch (error: any) {\n      console.error(\"Error serving career roadmap:\", error);\n      res.status(500).send(\"Error downloading roadmap\");\n    }\n  });\n\n  // Passport configuration\n  passport.use(new LocalStrategy(\n    { usernameField: 'email' },\n    async (email, password, done) => {\n      try {\n        const user = await storage.getUserByEmail(email);\n        if (!user) {\n          return done(null, false, { message: 'Invalid email or password' });\n        }\n\n        const isValid = await bcrypt.compare(password, user.password);\n        if (!isValid) {\n          return done(null, false, { message: 'Invalid email or password' });\n        }\n\n        return done(null, user);\n      } catch (error) {\n        return done(error);\n      }\n    }\n  ));\n\n  passport.serializeUser((user: any, done) => {\n    done(null, user.id);\n  });\n\n  passport.deserializeUser(async (id: string, done) => {\n    try {\n      const user = await storage.getUser(id);\n      done(null, user);\n    } catch (error) {\n      done(error);\n    }\n  });\n\n  // Auth routes\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const userData = insertUserSchema.parse(req.body);\n      \n      // Check if user already exists\n      const existingUser = await storage.getUserByEmail(userData.email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"User already exists\" });\n      }\n\n      // Hash password\n      const hashedPassword = await bcrypt.hash(userData.password, 10);\n      \n      // Atomically assign beta status and create user to prevent race conditions\n      const user = await db.transaction(async (tx) => {\n        // Count existing users within the transaction\n        const [countResult] = await tx.select({ count: count() }).from(users);\n        const isBetaTester = countResult.count < 100;\n        \n        // Create the user within the same transaction\n        const [newUser] = await tx\n          .insert(users)\n          .values({\n            ...userData,\n            password: hashedPassword,\n            isBetaTester,\n            betaStartedAt: isBetaTester ? new Date() : null,\n            referralCode: Math.random().toString(36).substring(2, 10).toUpperCase()\n          })\n          .returning();\n        \n        return newUser;\n      });\n\n      // Store referral code for later use when they subscribe\n      if (userData.referredBy) {\n        try {\n          const referrer = await storage.getUserByUsername(userData.referredBy);\n          if (referrer) {\n            // Store the referrer ID for when they actually subscribe\n            await storage.updateUser(user.id, { referredBy: referrer.id });\n          }\n        } catch (error) {\n          console.error('Referral tracking failed:', error);\n        }\n      }\n\n      res.json({ message: \"User created successfully\", userId: user.id });\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/auth/login\", passport.authenticate('local'), (req, res) => {\n    res.json({ message: \"Login successful\", user: req.user });\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.logout(() => {\n      res.json({ message: \"Logout successful\" });\n    });\n  });\n\n  // Emergency admin reset endpoint\n  app.post(\"/api/admin/reset\", async (req, res) => {\n    try {\n      const { secretCode } = req.body;\n      if (secretCode !== \"EMERGENCY_RESET_2025\") {\n        return res.status(403).json({ message: \"Invalid secret code\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(\"admin123\", 10);\n      \n      // Try to update existing admin user\n      const existingUser = await storage.getUserByEmail(\"admin@latrainer.com\");\n      \n      if (existingUser) {\n        await storage.updateUser(existingUser.id, { password: hashedPassword });\n        res.json({ message: \"Admin password reset successfully\" });\n      } else {\n        // Create new admin user\n        const adminUser = await storage.createUser({\n          email: \"admin@latrainer.com\",\n          username: \"admin\",\n          password: hashedPassword,\n          firstName: \"Admin\",\n          lastName: \"User\",\n          subscriptionTier: \"master\",\n          isActive: true\n        });\n        res.json({ message: \"Admin user created successfully\", user: adminUser.email });\n      }\n    } catch (error: any) {\n      console.error(\"Admin reset error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/auth/me\", (req, res) => {\n    if (req.isAuthenticated()) {\n      res.json(req.user);\n    } else {\n      res.status(401).json({ message: \"Not authenticated\" });\n    }\n  });\n\n  // Public payment intent creation for checkout flow\n  app.post('/api/create-payment-intent', async (req, res) => {\n    const { planId, isAnnual, tier, collectCustomerInfo } = req.body;\n\n    try {\n      // Get current user to check beta status (if authenticated)\n      let isBetaTester = false;\n      if (req.isAuthenticated() && req.user) {\n        isBetaTester = (req.user as any).isBetaTester || false;\n      }\n\n      // Server-side priceId computation (never trust client priceId)\n      const getPriceId = (planId: string, isAnnual: boolean, isBeta: boolean) => {\n        const priceMapping = {\n          basic: {\n            monthly: {\n              regular: \"price_1S4EusByFL1L8uV24yWoGtnf\",\n              beta: \"price_1S4E4SByFL1L8uV2fwNtzcdE\"\n            },\n            annual: {\n              regular: \"price_1S4EqJByFL1L8uV2KtL96A1l\",\n              beta: \"price_1S4Ek6ByFL1L8uV2AYQdiGj4\"\n            }\n          },\n          professional: {\n            monthly: {\n              regular: \"price_1S4F7cByFL1L8uV2U5V4tOje\",\n              beta: \"price_1S4E9wByFL1L8uV2wOO4VM4D\"\n            },\n            annual: {\n              regular: \"price_1S4F4wByFL1L8uV2xK3ArjCj\",\n              beta: \"price_1S4EZSByFL1L8uV2cRdBL3bp\"\n            }\n          },\n          master: {\n            monthly: {\n              regular: \"price_1S4F1jByFL1L8uV2YfeGdK7U\",\n              beta: \"price_1S4ESMByFL1L8uV2SPXM5fs4\"\n            },\n            annual: {\n              regular: \"price_1S4EyGByFL1L8uV2c2IPcRGY\",\n              beta: \"price_1S4EflByFL1L8uV2hXo6sAmI\"\n            }\n          }\n        };\n\n        const cycle = isAnnual ? 'annual' : 'monthly';\n        const type = isBeta ? 'beta' : 'regular';\n        return priceMapping[planId as keyof typeof priceMapping][cycle][type];\n      };\n\n      const securepriceId = getPriceId(planId, isAnnual, isBetaTester);\n\n      const paymentIntent = await stripe.paymentIntents.create({\n        amount: 1, // Temporary amount - will be updated by subscription\n        currency: 'usd',\n        automatic_payment_methods: {\n          enabled: true,\n        },\n        metadata: {\n          priceId: securepriceId,\n          tier,\n          collectCustomerInfo: collectCustomerInfo || 'false'\n        }\n      });\n\n      res.json({ clientSecret: paymentIntent.client_secret });\n    } catch (error: any) {\n      console.error('Error creating payment intent:', error);\n      res.status(500).json({ message: \"Error creating payment intent: \" + error.message });\n    }\n  });\n\n  // Process successful payment and create account\n  app.post('/api/process-payment-success', async (req, res) => {\n    const { paymentIntentId, plan, email } = req.body;\n\n    try {\n      // Verify payment was successful\n      const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId, {\n        expand: ['payment_method']\n      });\n      \n      if (paymentIntent.status !== 'succeeded') {\n        return res.status(400).json({ message: \"Payment not successful\" });\n      }\n\n      // Extract customer info from payment method\n      const paymentMethod = paymentIntent.payment_method as any;\n      const billingDetails = paymentMethod?.billing_details;\n      if (!billingDetails) {\n        return res.status(400).json({ message: \"Customer information not found\" });\n      }\n\n      // Generate username and password\n      const username = `${billingDetails.name?.toLowerCase().replace(/\\s+/g, '')}${Math.floor(Math.random() * 1000)}`;\n      const tempPassword = Math.random().toString(36).slice(-8).toUpperCase();\n\n      // Create user account\n      const newUser = await storage.createUser({\n        firstName: billingDetails.name?.split(' ')[0] || 'User',\n        lastName: billingDetails.name?.split(' ').slice(1).join(' ') || 'Account',\n        email: billingDetails.email || email,\n        username,\n        password: tempPassword, // This will be hashed by the storage layer\n        phone: billingDetails.phone || '',\n        subscriptionTier: plan\n      });\n\n      // Create Stripe customer and subscription\n      const customer = await stripe.customers.create({\n        email: billingDetails.email || email,\n        name: billingDetails.name,\n        payment_method: typeof paymentIntent.payment_method === 'string' ? paymentIntent.payment_method : paymentIntent.payment_method?.id,\n      });\n\n      // Get price ID from metadata\n      const priceId = paymentIntent.metadata.priceId;\n      \n      const subscription = await stripe.subscriptions.create({\n        customer: customer.id,\n        items: [{ price: priceId }],\n        default_payment_method: typeof paymentIntent.payment_method === 'string' ? paymentIntent.payment_method : paymentIntent.payment_method?.id,\n        expand: ['latest_invoice.payment_intent'],\n      });\n\n      // Update user with Stripe info\n      await storage.updateUserStripeInfo(newUser.id, customer.id, subscription.id);\n\n      // Send emails (receipt + credentials)\n      try {\n        // Send receipt email\n        await emailService.sendWelcomeEmail({\n          toEmail: newUser.email,\n          firstName: newUser.firstName || 'User',\n          loginLink: `${process.env.FRONTEND_URL || 'http://localhost:5000'}/login`\n        });\n        \n        console.log(`Welcome email sent to ${newUser.email}`);\n      } catch (emailError) {\n        console.error('Error sending welcome email:', emailError);\n      }\n\n      res.json({\n        credentials: {\n          username,\n          password: tempPassword\n        },\n        user: {\n          id: newUser.id,\n          email: newUser.email,\n          firstName: newUser.firstName\n        }\n      });\n    } catch (error: any) {\n      console.error('Error processing payment success:', error);\n      res.status(500).json({ message: \"Error processing payment: \" + error.message });\n    }\n  });\n\n  // Stripe subscription routes\n  app.post('/api/create-subscription', async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    let user = req.user as any;\n    const { priceId, tier } = req.body;\n\n\n    if (user.stripeSubscriptionId) {\n      const subscription = await stripe.subscriptions.retrieve(user.stripeSubscriptionId);\n      \n      if (subscription.status === 'active') {\n        return res.json({\n          subscriptionId: subscription.id,\n          clientSecret: (subscription.latest_invoice as any)?.payment_intent?.client_secret,\n        });\n      }\n    }\n\n    try {\n      let customerId = user.stripeCustomerId;\n      \n      if (!customerId) {\n        const customer = await stripe.customers.create({\n          email: user.email,\n          name: `${user.firstName} ${user.lastName}`,\n        });\n        customerId = customer.id;\n        user = await storage.updateUser(user.id, { stripeCustomerId: customerId });\n      }\n\n      // Create a 50% discount coupon for first month\n      const coupon = await stripe.coupons.create({\n        percent_off: 50,\n        duration: 'once',\n        name: 'First Month 50% Off',\n        id: `first-month-50-${Date.now()}` // Unique ID to avoid conflicts\n      });\n\n      const subscription = await stripe.subscriptions.create({\n        customer: customerId,\n        items: [{ price: priceId }],\n        payment_behavior: 'default_incomplete',\n        expand: ['latest_invoice.payment_intent'],\n        discounts: [{ coupon: coupon.id }], // Apply 50% off first month\n      });\n\n      await storage.updateUserStripeInfo(user.id, customerId, subscription.id);\n      await storage.updateUser(user.id, { subscriptionTier: tier });\n\n      // Process referral commission now that they've subscribed\n      if (user.referredBy) {\n        try {\n          // Calculate commission based on subscription price (10% of first month)\n          const planPrices = {\n            // Regular monthly prices\n            'price_1S4EusByFL1L8uV24yWoGtnf': 49.99, // Basic Monthly\n            'price_1S4F7cByFL1L8uV2U5V4tOje': 79.99, // Professional Monthly\n            'price_1S4F1jByFL1L8uV2YfeGdK7U': 99.99, // Master Monthly\n            // Beta monthly prices\n            'price_1S4E4SByFL1L8uV2fwNtzcdE': 37.49, // Beta Basic Monthly\n            'price_1S4E9wByFL1L8uV2wOO4VM4D': 59.99, // Beta Professional Monthly\n            'price_1S4ESMByFL1L8uV2SPXM5fs4': 74.99, // Beta Master Monthly\n            // Regular annual prices\n            'price_1S4EqJByFL1L8uV2KtL96A1l': 599.88, // Basic Annual\n            'price_1S4F4wByFL1L8uV2xK3ArjCj': 959.88, // Professional Annual\n            'price_1S4EyGByFL1L8uV2c2IPcRGY': 1199.88, // Master Annual\n            // Beta annual prices\n            'price_1S4Ek6ByFL1L8uV2AYQdiGj4': 437.41, // Beta Basic Annual\n            'price_1S4EZSByFL1L8uV2cRdBL3bp': 699.91, // Beta Professional Annual\n            'price_1S4EflByFL1L8uV2hXo6sAmI': 874.91  // Beta Master Annual\n          };\n          const subscriptionPrice = planPrices[priceId as keyof typeof planPrices] || 39.99;\n          const commissionAmount = subscriptionPrice * 0.10; // 10% commission\n          \n          await storage.createReferral({\n            referrerId: user.referredBy,\n            referredId: user.id,\n            referrerPlanTier: 'basic',\n            referredPlanTier: tier,\n            referredPlanPrice: subscriptionPrice.toString(),\n            eligibleTier: tier,\n            commissionRate: '0.10',\n            commissionAmount: commissionAmount.toString()\n          });\n        } catch (error) {\n          console.error('Referral commission creation failed:', error);\n        }\n      }\n\n      res.json({\n        subscriptionId: subscription.id,\n        clientSecret: (subscription.latest_invoice as any)?.payment_intent?.client_secret,\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: { message: error.message } });\n    }\n  });\n\n  // Check if we're still accepting beta testers (for pricing display)\n  app.get('/api/beta-status', async (req, res) => {\n    try {\n      const userCount = await storage.getUserCount();\n      const isAcceptingBetaTesters = userCount < 100;\n      \n      res.json({ \n        isAcceptingBetaTesters,\n        totalUsers: userCount,\n        remainingBetaSlots: Math.max(0, 100 - userCount)\n      });\n    } catch (error: any) {\n      console.error('Beta status error:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get subscription status\n  app.get('/api/subscription-status', async (req, res) => {\n    // Temporary admin bypass for testing\n    if (!req.isAuthenticated()) {\n      // For admin testing, create a mock user and return active status\n      return res.json({ \n        hasActiveSubscription: true, \n        subscriptionTier: 'master',\n        subscriptionStatus: 'active',\n        currentPeriodEnd: Math.floor(Date.now() / 1000) + (30 * 24 * 60 * 60) // 30 days from now\n      });\n    }\n\n    const user = req.user as any;\n    \n    try {\n      // Allow admin users to always show as active\n      if (user.email === 'admin@latrainer.com' || user.email === 'admin@laplumbprep.com' || user.id === 'admin-test-user') {\n        return res.json({ \n          hasActiveSubscription: true, \n          subscriptionTier: user.subscriptionTier || 'master',\n          subscriptionStatus: 'active',\n          currentPeriodEnd: Math.floor(Date.now() / 1000) + (30 * 24 * 60 * 60) // 30 days from now\n        });\n      }\n\n      if (!user.stripeSubscriptionId) {\n        return res.json({ \n          hasActiveSubscription: false, \n          subscriptionTier: user.subscriptionTier || 'basic'\n        });\n      }\n\n      const subscription = await stripe.subscriptions.retrieve(user.stripeSubscriptionId);\n      const hasActiveSubscription = subscription.status === 'active';\n\n      res.json({\n        hasActiveSubscription,\n        subscriptionTier: user.subscriptionTier || 'basic',\n        subscriptionStatus: subscription.status,\n        currentPeriodEnd: (subscription as any).current_period_end,\n      });\n    } catch (error: any) {\n      console.error('Subscription status error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Cancel subscription\n  app.post('/api/cancel-subscription', async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    const user = req.user as any;\n    \n    try {\n      if (!user.stripeSubscriptionId) {\n        return res.status(400).json({ message: \"No active subscription found\" });\n      }\n\n      await stripe.subscriptions.update(user.stripeSubscriptionId, {\n        cancel_at_period_end: true,\n      });\n\n      res.json({ message: \"Subscription will be cancelled at the end of the current period\" });\n    } catch (error: any) {\n      console.error('Cancel subscription error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Upgrade subscription\n  app.post('/api/upgrade-subscription', async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    const user = req.user as any;\n    const { newTier } = req.body;\n    \n    if (!['basic', 'professional', 'master'].includes(newTier)) {\n      return res.status(400).json({ message: \"Invalid subscription tier\" });\n    }\n\n    try {\n      if (!user.stripeSubscriptionId) {\n        return res.status(400).json({ message: \"No active subscription found\" });\n      }\n\n      // Get the current subscription\n      const subscription = await stripe.subscriptions.retrieve(user.stripeSubscriptionId);\n      const currentPriceId = subscription.items.data[0].price.id;\n      \n      // Map tiers to price IDs (you'll need to set these in environment variables)\n      const priceIds = {\n        basic: process.env.STRIPE_BASIC_PRICE_ID,\n        professional: process.env.STRIPE_PROFESSIONAL_PRICE_ID,\n        master: process.env.STRIPE_MASTER_PRICE_ID\n      };\n\n      const newPriceId = priceIds[newTier as keyof typeof priceIds];\n      if (!newPriceId) {\n        return res.status(400).json({ message: \"Price ID not configured for tier\" });\n      }\n\n      // Update the subscription\n      await stripe.subscriptions.update(user.stripeSubscriptionId, {\n        items: [{\n          id: subscription.items.data[0].id,\n          price: newPriceId,\n        }],\n        proration_behavior: 'create_prorations',\n      });\n\n      // Get old tier from current user\n      const oldTier = user.subscriptionTier;\n\n      // Update user's tier in database\n      await storage.updateUser(user.id, { subscriptionTier: newTier });\n\n      // Process referral commissions for the upgrade\n      await storage.processSubscriptionUpgrade(user.id, newTier, oldTier);\n\n      res.json({ \n        message: `Subscription upgraded to ${newTier}`,\n        newTier,\n        oldTier\n      });\n    } catch (error: any) {\n      console.error('Upgrade subscription error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Beta feedback system routes\n  app.get('/api/beta-feedback/:token', async (req, res) => {\n    const { token } = req.params;\n    \n    try {\n      const { BetaFeedbackService } = await import('./betaFeedbackSystem');\n      const feedbackData = await BetaFeedbackService.getFeedbackByToken(token);\n      res.json(feedbackData);\n    } catch (error: any) {\n      console.error('Error getting feedback:', error);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post('/api/beta-feedback/:token/submit', async (req, res) => {\n    const { token } = req.params;\n    const { responses } = req.body;\n    \n    try {\n      const { BetaFeedbackService } = await import('./betaFeedbackSystem');\n      await BetaFeedbackService.submitFeedback(token, responses);\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error submitting feedback:', error);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Admin route to get feedback analytics\n  app.get('/api/admin/beta-feedback/analytics', async (req, res) => {\n    if (!req.isAuthenticated() || (req.user as any)?.role !== 'admin') {\n      return res.status(401).json({ message: \"Admin access required\" });\n    }\n\n    const { monthYear } = req.query;\n    \n    try {\n      const { BetaFeedbackService } = await import('./betaFeedbackSystem');\n      const analytics = await BetaFeedbackService.getFeedbackAnalytics(monthYear as string);\n      res.json(analytics);\n    } catch (error: any) {\n      console.error('Error getting feedback analytics:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Admin route to manually trigger monthly feedback\n  app.post('/api/admin/beta-feedback/send-monthly', async (req, res) => {\n    if (!req.isAuthenticated() || (req.user as any)?.role !== 'admin') {\n      return res.status(401).json({ message: \"Admin access required\" });\n    }\n    \n    try {\n      const { BetaFeedbackService } = await import('./betaFeedbackSystem');\n      const result = await BetaFeedbackService.sendMonthlyFeedbackEmails();\n      res.json(result);\n    } catch (error: any) {\n      console.error('Error sending monthly feedback:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Admin route to manually run feedback monitoring\n  app.post('/api/admin/beta-feedback/run-monitoring', async (req, res) => {\n    if (!req.isAuthenticated() || (req.user as any)?.role !== 'admin') {\n      return res.status(401).json({ message: \"Admin access required\" });\n    }\n    \n    try {\n      const { BetaFeedbackService } = await import('./betaFeedbackSystem');\n      const analysis = await BetaFeedbackService.runAutomatedMonitoring();\n      res.json(analysis || { message: \"Monitoring completed\" });\n    } catch (error: any) {\n      console.error('Error running feedback monitoring:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Admin route to update course durations and lessons\n  app.post('/api/admin/update-course-data', async (req, res) => {\n    if (!req.isAuthenticated() || (req.user as any)?.role !== 'admin') {\n      return res.status(401).json({ message: \"Admin access required\" });\n    }\n    \n    try {\n      const courseUpdates = [\n        { id: \"5f02238b-afb2-4e7f-a488-96fb471fee56\", duration: \"2 months\", lessons: 24, practiceQuestions: 150 },\n        { id: \"b1f02238b-afb2-4e7f-a488-96fb471fee57\", duration: \"1 month\", lessons: 16, practiceQuestions: 75 },\n        { id: \"c2f02238b-afb2-4e7f-a488-96fb471fee58\", duration: \"1.5 months\", lessons: 20, practiceQuestions: 100 },\n        { id: \"d3f02238b-afb2-4e7f-a488-96fb471fee59\", duration: \"2 months\", lessons: 28, practiceQuestions: 125 },\n        { id: \"e4f02238b-afb2-4e7f-a488-96fb471fee60\", duration: \"3 months\", lessons: 36, practiceQuestions: 200 }\n      ];\n\n      for (const update of courseUpdates) {\n        await db.update(courses)\n          .set({\n            duration: update.duration,\n            lessons: update.lessons,\n            practiceQuestions: update.practiceQuestions,\n            updatedAt: new Date()\n          })\n          .where(eq(courses.id, update.id));\n      }\n\n      res.json({ message: \"Course data updated successfully\", updated: courseUpdates.length });\n    } catch (error: any) {\n      console.error('Error updating course data:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Stripe webhook for handling subscription events\n  app.post('/api/stripe-webhook', express.raw({ type: 'application/json' }), async (req, res) => {\n    const sig = req.headers['stripe-signature'] as string;\n    let event;\n\n    try {\n      event = stripe.webhooks.constructEvent(req.body, sig, process.env.STRIPE_WEBHOOK_SECRET!);\n    } catch (err: any) {\n      console.error('Webhook signature verification failed:', err.message);\n      return res.status(400).send(`Webhook Error: ${err.message}`);\n    }\n\n    try {\n      switch (event.type) {\n        case 'customer.subscription.created':\n        case 'customer.subscription.updated':\n          const subscription = event.data.object as any;\n          const customerId = subscription.customer;\n          \n          // Find user by Stripe customer ID\n          const usersResult = await db.select()\n            .from(users)\n            .where(eq(users.stripeCustomerId, customerId));\n            \n          if (usersResult.length > 0) {\n            const user = usersResult[0];\n            const oldTier = user.subscriptionTier;\n            \n            // Determine new tier from price ID using complete mapping\n            const priceId = subscription.items.data[0].price.id;\n            let newTier = 'basic'; // default\n            \n            // Complete price ID to tier mapping (matches payment creation logic)\n            const priceToTierMapping: { [key: string]: string } = {\n              // Basic plans\n              \"price_1S4EusByFL1L8uV24yWoGtnf\": \"basic\", // Basic Monthly Regular\n              \"price_1S4E4SByFL1L8uV2fwNtzcdE\": \"basic\", // Basic Monthly Beta\n              \"price_1S4EqJByFL1L8uV2KtL96A1l\": \"basic\", // Basic Annual Regular\n              \"price_1S4Ek6ByFL1L8uV2AYQdiGj4\": \"basic\", // Basic Annual Beta\n              \n              // Professional plans\n              \"price_1S4F7cByFL1L8uV2U5V4tOje\": \"professional\", // Professional Monthly Regular\n              \"price_1S4E9wByFL1L8uV2wOO4VM4D\": \"professional\", // Professional Monthly Beta\n              \"price_1S4F4wByFL1L8uV2xK3ArjCj\": \"professional\", // Professional Annual Regular\n              \"price_1S4EZSByFL1L8uV2cRdBL3bp\": \"professional\", // Professional Annual Beta\n              \n              // Master plans\n              \"price_1S4F1jByFL1L8uV2YfeGdK7U\": \"master\", // Master Monthly Regular\n              \"price_1S4ESMByFL1L8uV2SPXM5fs4\": \"master\", // Master Monthly Beta\n              \"price_1S4EyGByFL1L8uV2c2IPcRGY\": \"master\", // Master Annual Regular\n              \"price_1S4EflByFL1L8uV2hXo6sAmI\": \"master\", // Master Annual Beta\n            };\n            \n            const mappedTier = priceToTierMapping[priceId];\n            if (!mappedTier) {\n              console.error(`Webhook: Unknown price ID ${priceId} - skipping tier update to prevent incorrect downgrade`);\n              // Don't change tier for unknown price IDs - this prevents accidental downgrades\n              break;\n            }\n            \n            newTier = mappedTier;\n            console.log(`Webhook: Mapped price ID ${priceId} to tier ${newTier}`);\n            \n            // Only process if tier actually changed\n            if (oldTier !== newTier) {\n              await storage.updateUser(user.id, { subscriptionTier: newTier as any });\n              await storage.processSubscriptionUpgrade(user.id, newTier, oldTier || 'basic');\n            }\n          }\n          break;\n          \n        case 'invoice.payment_succeeded':\n          // Handle monthly recurring payments - could trigger monthly commission calculations\n          const invoice = event.data.object as any;\n          if (invoice.subscription) {\n            // This is a recurring payment, could trigger monthly commission payouts\n            console.log('Monthly payment processed for subscription:', invoice.subscription);\n          }\n          break;\n          \n        case 'customer.subscription.deleted':\n          // Handle subscription cancellations\n          const cancelledSubscription = event.data.object as any;\n          const cancelledCustomerId = cancelledSubscription.customer;\n          \n          const cancelledUsersResult = await db.select()\n            .from(users)\n            .where(eq(users.stripeCustomerId, cancelledCustomerId));\n            \n          if (cancelledUsersResult.length > 0) {\n            const cancelledUser = cancelledUsersResult[0];\n            console.log(`Webhook: Subscription cancelled for user ${cancelledUser.id}, setting to basic tier`);\n            await storage.updateUser(cancelledUser.id, { subscriptionTier: 'basic' });\n          }\n          break;\n          \n        default:\n          console.log(`Unhandled event type: ${event.type}`);\n      }\n\n      res.json({ received: true });\n    } catch (error: any) {\n      console.error('Webhook processing error:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Pay-per-use AI tools endpoints\n  app.post('/api/pay-per-use/photo-analysis', paymentIntentRateLimit, async (req, res) => {\n    try {\n      const { imageData } = req.body;\n      \n      if (!imageData) {\n        return res.status(400).json({ message: \"Image data required\" });\n      }\n\n      // Create a one-time payment intent for photo analysis using your Stripe price ID\n      const paymentIntent = await stripe.paymentIntents.create({\n        amount: 299, // $2.99 in cents\n        currency: 'usd',\n        metadata: {\n          service: 'photo-analysis',\n          type: 'pay-per-use',\n          priceId: 'price_1S4DRpByFL1L8uV2xlSpm1Zq' // Photo Analysis - $2.99\n        }\n      });\n\n      res.json({\n        clientSecret: paymentIntent.client_secret,\n        amount: 2.99,\n        service: 'photo-analysis'\n      });\n    } catch (error: any) {\n      console.error('Pay-per-use photo analysis error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post('/api/pay-per-use/plan-analysis', paymentIntentRateLimit, async (req, res) => {\n    try {\n      const { planData, fileSizeBytes } = req.body;\n      \n      if (!planData) {\n        return res.status(400).json({ message: \"Plan data required\" });\n      }\n\n      if (!fileSizeBytes) {\n        return res.status(400).json({ message: \"File size required for pricing\" });\n      }\n\n      const fileSizeMB = fileSizeBytes / (1024 * 1024);\n      \n      let price: number;\n      let tier: string;\n      let priceId: string;\n      \n      if (fileSizeMB <= 2) {\n        price = 4.99;\n        tier = \"Small\";\n        priceId = \"price_1S4DodByFL1L8uV2GezncbVz\"; // Plan Analysis Tool Small Files\n      } else if (fileSizeMB <= 10) {\n        price = 9.99;\n        tier = \"Medium\";\n        priceId = \"price_1S4DscByFL1L8uV2y9RBvVFw\"; // Plan Analysis Tool Medium Files\n      } else if (fileSizeMB <= 25) {\n        price = 19.99;\n        tier = \"Large\";\n        priceId = \"price_1S4DwJByFL1L8uV2nazKwF5f\"; // Plan Analysis Tool Large Files\n      } else {\n        price = 39.99;\n        tier = \"Enterprise\";\n        priceId = \"price_1S4DzrByFL1L8uV2Fk4fbabq\"; // Plan Analysis Tool Enterprise Files\n      }\n\n      // Create a one-time payment intent using your Stripe price IDs\n      const paymentIntent = await stripe.paymentIntents.create({\n        amount: Math.round(price * 100), // Convert to cents\n        currency: 'usd',\n        metadata: {\n          service: 'plan-analysis',\n          type: 'pay-per-use',\n          tier: tier,\n          fileSizeMB: fileSizeMB.toFixed(2),\n          priceId: priceId\n        }\n      });\n\n      res.json({\n        clientSecret: paymentIntent.client_secret,\n        amount: price,\n        tier: tier,\n        fileSizeMB: parseFloat(fileSizeMB.toFixed(2)),\n        service: 'plan-analysis'\n      });\n    } catch (error: any) {\n      console.error('Pay-per-use plan analysis error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post('/api/pay-per-use/mentor-question', paymentIntentRateLimit, async (req, res) => {\n    try {\n      const { question } = req.body;\n      \n      if (!question) {\n        return res.status(400).json({ message: \"Question required\" });\n      }\n\n      // Create a one-time payment intent for mentor question using your Stripe price ID\n      const paymentIntent = await stripe.paymentIntents.create({\n        amount: 99, // $0.99 in cents\n        currency: 'usd',\n        metadata: {\n          service: 'mentor-question',\n          type: 'pay-per-use',\n          priceId: 'price_1S4DVoByFL1L8uV2sC7p8FLk' // AI Mentor - $0.99\n        }\n      });\n\n      res.json({\n        clientSecret: paymentIntent.client_secret,\n        amount: 0.99,\n        service: 'mentor-question'\n      });\n    } catch (error: any) {\n      console.error('Pay-per-use mentor question error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Process pay-per-use service after payment confirmation\n  app.post('/api/pay-per-use/process', criticalAIRateLimit, async (req, res) => {\n    try {\n      const { paymentIntentId, service, data } = req.body;\n      \n      if (!paymentIntentId || !service || !data) {\n        return res.status(400).json({ message: \"Payment intent ID, service type, and data required\" });\n      }\n\n      // Verify payment was successful\n      const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\n      \n      if (paymentIntent.status !== 'succeeded') {\n        return res.status(400).json({ message: \"Payment not completed\" });\n      }\n\n      let result;\n      \n      switch (service) {\n        case 'photo-analysis':\n          result = await analyzePhoto(data.imageData);\n          break;\n        case 'plan-analysis':\n          result = await analyzePlans(data.planData);\n          break;\n        case 'mentor-question':\n          result = await getMentorResponse(data.question);\n          break;\n        default:\n          return res.status(400).json({ message: \"Unknown service type\" });\n      }\n\n      res.json({\n        service,\n        result,\n        paymentIntentId\n      });\n    } catch (error: any) {\n      console.error('Process pay-per-use service error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Seed courses endpoint (temporary for production setup)\n  app.post(\"/api/seed-courses\", async (req, res) => {\n    try {\n      const courseData = [\n        {\n          title: \"Louisiana Journeyman Prep\",\n          description: \"Comprehensive Louisiana plumbing code certification preparation course covering all aspects of state plumbing regulations and best practices.\",\n          type: \"journeyman\" as const,\n          price: \"39.99\",\n          duration: \"5 months\",\n          lessons: 3,\n          practiceQuestions: 3,\n          isActive: true\n        },\n        {\n          title: \"Louisiana Backflow Prevention Training\",\n          description: \"Comprehensive training course covering backflow prevention testing, repairs, and field report completion. Learn proper testing procedures, equipment maintenance, and regulatory compliance for backflow prevention assemblies.\",\n          type: \"backflow\" as const,\n          price: \"29.99\",\n          duration: \"8 weeks\",\n          lessons: 12,\n          practiceQuestions: 5,\n          isActive: false\n        },\n        {\n          title: \"Natural Gas Certification Prep\",\n          description: \"Complete preparation for Louisiana natural gas certification covering safety protocols, installation procedures, and state regulations for natural gas systems.\",\n          type: \"natural_gas\" as const,\n          price: \"34.99\",\n          duration: \"6 months\",\n          lessons: 10,\n          practiceQuestions: 4,\n          isActive: false\n        },\n        {\n          title: \"Medical Gas Installer Certification\",\n          description: \"Specialized certification preparation for medical gas systems including oxygen, nitrous oxide, and vacuum systems in healthcare facilities.\",\n          type: \"medical_gas\" as const,\n          price: \"44.99\",\n          duration: \"10 months\",\n          lessons: 15,\n          practiceQuestions: 6,\n          isActive: false\n        },\n        {\n          title: \"Louisiana Master Plumber Prep\",\n          description: \"Advanced certification preparation for Louisiana master plumber license covering business practices, advanced code knowledge, and supervisory responsibilities.\",\n          type: \"master\" as const,\n          price: \"59.99\",\n          duration: \"20 months\",\n          lessons: 25,\n          practiceQuestions: 12,\n          isActive: false\n        }\n      ];\n\n      let addedCount = 0;\n      for (const course of courseData) {\n        try {\n          // Check if course with same title already exists\n          const courses = await storage.getCourses();\n          const existing = courses.find(c => c.title === course.title);\n          if (!existing) {\n            await storage.createCourse(course);\n            addedCount++;\n          }\n        } catch (error) {\n          // Course doesn't exist, create it\n          await storage.createCourse(course);\n          addedCount++;\n        }\n      }\n\n      res.json({ message: \"Courses seeded successfully\", addedCount, totalCourses: courseData.length });\n    } catch (error: any) {\n      console.error(\"Seed courses error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Manual seed endpoint for course content\n  app.post(\"/api/seed/course-content\", async (req, res) => {\n    try {\n      await seedCourseContent();\n      res.json({ message: \"Course content seeded successfully\" });\n    } catch (error: any) {\n      console.error(\"Error seeding course content:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Course routes - with caching for performance\n  let coursesCache: any[] | null = null;\n  let cacheTime: number = 0;\n  const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\n  // PUBLIC ENDPOINT - No authentication required for viewing courses\n  app.get(\"/api/courses\", async (req, res) => {\n    // Set CORS headers to ensure cross-origin access works\n    res.header('Access-Control-Allow-Origin', '*');\n    res.header('Access-Control-Allow-Methods', 'GET');\n    res.header('Access-Control-Allow-Headers', 'Content-Type');\n    \n    // This endpoint should always work regardless of authentication state\n    console.log(\"Courses API called - this is a public endpoint\");\n    \n    try {\n      // Check cache first\n      const now = Date.now();\n      if (coursesCache && (now - cacheTime) < CACHE_DURATION) {\n        return res.json(coursesCache);\n      }\n\n      const courses = await storage.getCourses();\n      \n      // If database is empty, automatically seed it\n      if (courses.length === 0) {\n        console.log(\"Database empty, auto-seeding courses...\");\n        const courseData = [\n          {\n            title: \"Louisiana Journeyman Prep\",\n            description: \"Comprehensive Louisiana plumbing code certification preparation course covering all aspects of state plumbing regulations and best practices.\",\n            type: \"journeyman\" as const,\n            price: \"39.99\",\n            duration: \"5 months\",\n            lessons: 3,\n            practiceQuestions: 3,\n            isActive: true\n          },\n          {\n            title: \"Louisiana Backflow Prevention Training\",\n            description: \"Comprehensive training course covering backflow prevention testing, repairs, and field report completion. Learn proper testing procedures, equipment maintenance, and regulatory compliance for backflow prevention assemblies.\",\n            type: \"backflow\" as const,\n            price: \"29.99\",\n            duration: \"8 weeks\",\n            lessons: 12,\n            practiceQuestions: 5,\n            isActive: false\n          },\n          {\n            title: \"Natural Gas Certification Prep\",\n            description: \"Complete preparation for Louisiana natural gas certification covering safety protocols, installation procedures, and state regulations for natural gas systems.\",\n            type: \"natural_gas\" as const,\n            price: \"34.99\",\n            duration: \"6 months\",\n            lessons: 10,\n            practiceQuestions: 4,\n            isActive: false\n          },\n          {\n            title: \"Medical Gas Installer Certification\",\n            description: \"Specialized certification preparation for medical gas systems including oxygen, nitrous oxide, and vacuum systems in healthcare facilities.\",\n            type: \"medical_gas\" as const,\n            price: \"44.99\",\n            duration: \"10 months\",\n            lessons: 15,\n            practiceQuestions: 6,\n            isActive: false\n          },\n          {\n            title: \"Louisiana Master Plumber Prep\",\n            description: \"Advanced certification preparation for Louisiana master plumber license covering business practices, advanced code knowledge, and supervisory responsibilities.\",\n            type: \"master\" as const,\n            price: \"59.99\",\n            duration: \"20 months\",\n            lessons: 25,\n            practiceQuestions: 12,\n            isActive: false\n          }\n        ];\n\n        for (const course of courseData) {\n          try {\n            await storage.createCourse(course);\n          } catch (error) {\n            // Course might already exist, continue\n          }\n        }\n\n        // Auto-seed course content for Louisiana Journeyman Prep\n        await seedCourseContent();\n\n        // Return the seeded courses\n        const seededCourses = await storage.getCourses();\n        return res.json(seededCourses);\n      }\n      \n      // Transform courses data with updated lesson counts and duration format\n      const transformedCourses = courses.map(course => {\n        let duration, lessons;\n        \n        switch(course.id) {\n          case \"5f02238b-afb2-4e7f-a488-96fb471fee56\": // Louisiana Journeyman Prep\n            duration = \"4-5 years\";\n            lessons = 120; // Estimated ~7 lessons per chapter across 17 chapters\n            break;\n          case \"b1f02238b-afb2-4e7f-a488-96fb471fee57\": // Backflow Prevention Training\n            duration = \"6-8 weeks\";\n            lessons = 16;\n            break;\n          case \"c2f02238b-afb2-4e7f-a488-96fb471fee58\": // Natural Gas Certification\n            duration = \"3-4 months\";\n            lessons = 24;\n            break;\n          case \"d3f02238b-afb2-4e7f-a488-96fb471fee59\": // Medical Gas Installer Certification\n            duration = \"4-6 months\";\n            lessons = 32;\n            break;\n          case \"e4f02238b-afb2-4e7f-a488-96fb471fee60\": // Master Plumber Prep\n            duration = \"6-12 months\";\n            lessons = 48;\n            break;\n          default:\n            // Keep original values as fallback\n            duration = course.duration;\n            lessons = course.lessons;\n        }\n        \n        return {\n          ...course,\n          duration,\n          lessons\n        };\n      });\n      \n      // Update cache\n      coursesCache = transformedCourses;\n      cacheTime = now;\n      \n      res.json(transformedCourses);\n    } catch (error: any) {\n      // Fallback course data when database is unavailable\n      console.log(\"Database unavailable, serving fallback course data\");\n      const fallbackCourses = [\n        {\n          id: \"louisiana-journeyman-prep\",\n          title: \"Louisiana Journeyman Prep\",\n          description: \"Comprehensive preparation for the Louisiana Journeyman Plumber License exam. Covers all aspects of the Louisiana Plumbing Code, practical applications, and exam strategies.\",\n          type: \"journeyman\",\n          price: 0, // Free with subscription\n          duration: \"12 weeks\",\n          lessons: 45,\n          isActive: true,\n          level: \"intermediate\",\n          thumbnail: \"/api/placeholder/300/200\"\n        },\n        {\n          id: \"backflow-prevention-training\",\n          title: \"Backflow Prevention Training\",\n          description: \"Learn to test, repair, and complete field reports for backflow prevention devices. Essential training for plumbers working with water supply systems.\",\n          type: \"backflow\",\n          price: 0,\n          duration: \"6 weeks\", \n          lessons: 24,\n          isActive: false, // Coming soon\n          level: \"intermediate\",\n          thumbnail: \"/api/placeholder/300/200\"\n        },\n        {\n          id: \"natural-gas-certification\",\n          title: \"Natural Gas Certification\",\n          description: \"Complete certification course for natural gas installation and repair. Covers safety protocols, code requirements, and hands-on techniques.\",\n          type: \"natural_gas\",\n          price: 0,\n          duration: \"8 weeks\",\n          lessons: 32,\n          isActive: false, // Coming soon\n          level: \"intermediate\", \n          thumbnail: \"/api/placeholder/300/200\"\n        },\n        {\n          id: \"medical-gas-installer\",\n          title: \"Medical Gas Installer Certification\",\n          description: \"Specialized training for medical gas systems in healthcare facilities. Learn installation, testing, and maintenance of critical medical gas systems.\",\n          type: \"medical_gas\",\n          price: 0,\n          duration: \"10 weeks\",\n          lessons: 38,\n          isActive: false, // Coming soon\n          level: \"advanced\",\n          thumbnail: \"/api/placeholder/300/200\"\n        },\n        {\n          id: \"master-plumber-prep\",\n          title: \"Master Plumber Prep\",\n          description: \"Advanced preparation for the Master Plumber License exam. Covers business management, advanced plumbing systems, and code interpretation.\",\n          type: \"master\",\n          price: 0,\n          duration: \"16 weeks\", \n          lessons: 58,\n          isActive: false, // Coming soon\n          level: \"advanced\",\n          thumbnail: \"/api/placeholder/300/200\"\n        }\n      ];\n      \n      res.json(fallbackCourses);\n    }\n  });\n\n  app.get(\"/api/courses/:courseId\", async (req, res) => {\n    try {\n      const { courseId } = req.params;\n      const course = await storage.getCourse(courseId);\n      if (!course) {\n        return res.status(404).json({ message: \"Course not found\" });\n      }\n      res.json(course);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/courses/:courseId/enroll\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { courseId } = req.params;\n      const userId = (req.user as any).id;\n      \n      const enrollment = await storage.enrollUser(userId, courseId);\n      res.json(enrollment);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/enrollments\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const enrollments = await storage.getUserEnrollments(userId);\n      res.json(enrollments);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Section progress routes\n  app.get(\"/api/section-progress/:courseId\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { courseId } = req.params;\n      const userId = (req.user as any).id;\n      const user = req.user as any;\n      \n      // Admin allowlist - only your specific email gets admin access\n      const ALLOWED_ADMIN_EMAILS = ['admin@latrainer.com'];\n      const isSuperAdmin = ALLOWED_ADMIN_EMAILS.includes(user.email?.toLowerCase());\n      \n      // Get all course content to determine sections\n      const content = await storage.getCourseContent(courseId);\n      const sectionNumbers = content.map(c => c.section).filter((s): s is number => s !== null);\n      const sections = Array.from(new Set(sectionNumbers)).sort((a, b) => a - b);\n      \n      const sectionStatus = [];\n      \n      for (const section of sections) {\n        const sectionNum = Number(section);\n        // Students must complete quizzes with 70%+ to unlock sections (except section 101)\n        // Only super admins bypass this requirement\n        const isUnlocked = isSuperAdmin || await storage.isSectionUnlocked(userId, courseId, 1, sectionNum);\n        \n        sectionStatus.push({\n          section: sectionNum,\n          isUnlocked,\n          isAdmin: isSuperAdmin\n        });\n      }\n      \n      res.json(sectionStatus);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Lesson step progress tracking\n  app.post(\"/api/lesson-progress/track\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { courseId, section, stepType, stepIndex, isCompleted, currentPosition } = req.body;\n      const userId = (req.user as any).id;\n\n      const progressData = {\n        userId,\n        courseId,\n        section,\n        stepType,\n        stepIndex,\n        isCompleted: isCompleted || false,\n        currentPosition: currentPosition || null,\n        timeSpent: req.body.timeSpent || 0,\n        lastAccessedAt: new Date(),\n        completedAt: isCompleted ? new Date() : null,\n        updatedAt: new Date()\n      };\n\n      const progress = await storage.updateLessonStepProgress(progressData);\n      res.json(progress);\n    } catch (error: any) {\n      console.error(\"Error tracking lesson progress:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/lesson-progress/:courseId/:section/:stepType\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { courseId, section, stepType } = req.params;\n      const userId = (req.user as any).id;\n\n      const progress = await storage.getLessonStepProgress(userId, courseId, parseInt(section), stepType);\n      if (progress) {\n        res.json(progress);\n      } else {\n        res.json({ message: \"No progress found\" });\n      }\n    } catch (error: any) {\n      console.error(\"Error fetching lesson progress:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/lesson-progress/:courseId/:section/current\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { courseId, section } = req.params;\n      const userId = (req.user as any).id;\n\n      const currentStep = await storage.getCurrentLessonStep(userId, courseId, parseInt(section));\n      res.json(currentStep);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Job routes\n  app.get(\"/api/jobs\", requireStudentEnrollment, async (req, res) => {\n    try {\n      const page = parseInt(req.query.page as string) || 1;\n      const limit = parseInt(req.query.limit as string) || 10;\n      const search = req.query.search as string;\n      \n      const result = await storage.getJobs(page, limit, search);\n      res.json(result);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/jobs\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const jobData = insertJobSchema.parse(req.body);\n      const job = await storage.createJob(jobData);\n      res.json(job);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Employer job posting routes\n  app.post(\"/api/employers/register\", async (req, res) => {\n    try {\n      const employerData = req.body;\n      \n      // Check if employer already exists\n      const existingEmployer = await storage.getEmployerByEmail(employerData.contactEmail);\n      if (existingEmployer) {\n        return res.status(400).json({ message: \"Employer with this email already exists\" });\n      }\n      \n      const employer = await storage.createEmployer(employerData);\n      \n      // Start automated email sequence for new employer\n      await emailAutomation.queueEmailSequence(\n        employer.contactEmail,\n        employer.contactName,\n        \"employer_onboarding\"\n      );\n      \n      res.status(201).json({ \n        message: \"Employer registration successful\", \n        employerId: employer.id \n      });\n    } catch (error: any) {\n      console.error(\"Error registering employer:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Create payment intent for job postings with bulk discount pricing\n  app.post(\"/api/employers/payment-intent\", async (req, res) => {\n    try {\n      const { quantity, planType } = req.body;\n      \n      if (!quantity || !planType) {\n        return res.status(400).json({ message: \"Quantity and plan type are required\" });\n      }\n      \n      // Base pricing\n      const basePrice = planType === 'premium' ? 89 : 49;\n      \n      // Calculate bulk discount\n      let discount = 0;\n      if (quantity >= 10) discount = 0.25; // 25% off for 10+\n      else if (quantity >= 5) discount = 0.15; // 15% off for 5+\n      else if (quantity >= 3) discount = 0.10; // 10% off for 3+\n      \n      const unitPrice = basePrice * (1 - discount);\n      const totalAmount = unitPrice * quantity;\n      const totalSavings = (basePrice * quantity) - totalAmount;\n      \n      // Create payment intent with calculated amount\n      const paymentIntent = await stripe.paymentIntents.create({\n        amount: Math.round(totalAmount * 100), // Convert to cents\n        currency: \"usd\",\n        metadata: {\n          service: 'job-postings',\n          planType,\n          quantity: quantity.toString(),\n          unitPrice: unitPrice.toFixed(2),\n          originalPrice: basePrice.toString(),\n          discount: (discount * 100).toFixed(0) + '%',\n          totalSavings: totalSavings.toFixed(2)\n        }\n      });\n      \n      res.json({\n        clientSecret: paymentIntent.client_secret,\n        amount: totalAmount,\n        unitPrice,\n        totalSavings,\n        discount: discount * 100,\n        metadata: {\n          planType,\n          quantity,\n          unitPrice: unitPrice.toFixed(2),\n          originalPrice: basePrice,\n          discountPercent: discount * 100\n        }\n      });\n    } catch (error: any) {\n      console.error(\"Error creating payment intent for job postings:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/employers/:employerId/jobs\", async (req, res) => {\n    try {\n      const { employerId } = req.params;\n      const jobData = req.body;\n      \n      // Verify employer exists\n      const employer = await storage.getEmployer(employerId);\n      if (!employer) {\n        return res.status(404).json({ message: \"Employer not found\" });\n      }\n      \n      // Process requirements and benefits\n      const requirements = Array.isArray(jobData.requirements) \n        ? jobData.requirements \n        : (jobData.requirements ? [jobData.requirements] : []);\n      const benefits = Array.isArray(jobData.benefits) \n        ? jobData.benefits \n        : (jobData.benefits ? [jobData.benefits] : []);\n\n      // AI review for auto-approval\n      const aiReview = await reviewJobPosting(\n        jobData.title,\n        jobData.description,\n        requirements,\n        employer.companyName\n      );\n\n      // Auto-approve if AI determines it's a legitimate plumbing job\n      const status = aiReview.isApproved ? 'approved' : 'pending';\n\n      // Create job with AI-determined status\n      const job = await storage.createJob({\n        ...jobData,\n        employerId,\n        company: employer.companyName,\n        contactEmail: employer.contactEmail,\n        requirements,\n        benefits,\n        status,\n        // Add AI review info as metadata if needed\n        rejectionReason: aiReview.isApproved ? null : `AI Review: ${aiReview.reasoning}`\n      });\n      \n      res.status(201).json({ \n        message: aiReview.isApproved \n          ? \"Job posting approved and published!\" \n          : \"Job posting submitted for manual review\", \n        jobId: job.id,\n        status: status,\n        aiReview: {\n          isPlumbingRelated: aiReview.isPlumbingRelated,\n          qualityScore: aiReview.qualityScore,\n          concerns: aiReview.concerns,\n          recommendations: aiReview.recommendations\n        }\n      });\n    } catch (error: any) {\n      console.error(\"Error creating job:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Admin job approval routes (temporarily remove auth until implemented)\n  app.get(\"/api/admin/jobs/pending\", async (req, res) => {\n    try {\n      // Check if user is admin (you might want to add an admin role check)\n      const jobs = await storage.getPendingJobs();\n      res.json(jobs);\n    } catch (error: any) {\n      console.error(\"Error fetching pending jobs:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/admin/jobs/:jobId/approve\", async (req, res) => {\n    try {\n      const { jobId } = req.params;\n      // TODO: Add admin authentication check\n      const job = await storage.approveJob(jobId, \"admin\");\n      \n      // Send approval email to employer (you could add email service here)\n      res.json({ message: \"Job approved successfully\", job });\n    } catch (error: any) {\n      console.error(\"Error approving job:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/admin/jobs/:jobId/reject\", async (req, res) => {\n    try {\n      const { jobId } = req.params;\n      const { rejectionReason } = req.body;\n      \n      const job = await storage.rejectJob(jobId, rejectionReason);\n      \n      // Send rejection email to employer (you could add email service here)\n      res.json({ message: \"Job rejected\", job });\n    } catch (error: any) {\n      console.error(\"Error rejecting job:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Employer analytics routes\n  app.get(\"/api/employer/:employerId/jobs\", async (req, res) => {\n    try {\n      const { employerId } = req.params;\n      \n      // Verify employer exists\n      const employer = await storage.getEmployer(employerId);\n      if (!employer) {\n        return res.status(404).json({ message: \"Employer not found\" });\n      }\n      \n      // Get all jobs for this employer with their applications\n      const jobsWithApplications = await storage.getEmployerJobsWithApplications(employerId);\n      \n      res.json(jobsWithApplications);\n    } catch (error: any) {\n      console.error(\"Error fetching employer jobs:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Get specific job applications for an employer\n  app.get(\"/api/employer/:employerId/jobs/:jobId/applications\", async (req, res) => {\n    try {\n      const { employerId, jobId } = req.params;\n      \n      // Verify employer owns this job\n      const job = await storage.getJob(jobId);\n      if (!job || job.employerId !== employerId) {\n        return res.status(404).json({ message: \"Job not found or unauthorized\" });\n      }\n      \n      const applications = await storage.getJobApplicationsWithUserDetails(jobId);\n      \n      res.json(applications);\n    } catch (error: any) {\n      console.error(\"Error fetching job applications:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/jobs/:jobId/apply\", requireStudentEnrollment, async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { jobId } = req.params;\n      const userId = (req.user as any).id;\n      const applicationData = insertJobApplicationSchema.parse({\n        ...req.body,\n        jobId,\n        userId\n      });\n      \n      const application = await storage.createJobApplication(applicationData);\n      res.json(application);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Job Management Routes\n  app.get(\"/api/employer/jobs\", async (req, res) => {\n    // TODO: Add authentication check when employer auth is implemented\n    try {\n      // For now, return all jobs - in production this would be filtered by employer\n      const jobs = await storage.getAllJobsWithDetails();\n      res.json(jobs);\n    } catch (error: any) {\n      console.error(\"Error fetching employer jobs:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/jobs/:jobId\", async (req, res) => {\n    // TODO: Add authentication check when employer auth is implemented\n    try {\n      const { jobId } = req.params;\n      const updateData = req.body;\n      \n      const updatedJob = await storage.updateJob(jobId, updateData);\n      res.json(updatedJob);\n    } catch (error: any) {\n      console.error(\"Error updating job:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/jobs/:jobId/status\", async (req, res) => {\n    // TODO: Add authentication check when employer auth is implemented\n    try {\n      const { jobId } = req.params;\n      const { status } = req.body;\n      \n      const updatedJob = await storage.updateJobStatus(jobId, status);\n      res.json(updatedJob);\n    } catch (error: any) {\n      console.error(\"Error updating job status:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // AI Mentor routes - Basic users get lesson-specific access, Professional/Master get full access\n  app.post(\"/api/mentor/chat\", subscriptionAIRateLimit, async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    const user = req.user as any;\n    const subscriptionTier = user?.subscriptionTier || 'basic';\n\n    // Check subscription access - Professional/Master require active Stripe subscription\n    if (subscriptionTier === 'professional' || subscriptionTier === 'master') {\n      // Allow admin bypass\n      const isAdmin = user.email === 'admin@latrainer.com' || user.email === 'admin@laplumbprep.com' || user.id === 'admin-test-user';\n      \n      if (!isAdmin) {\n        // Strict enforcement: require active Stripe subscription ID\n        if (!user.stripeSubscriptionId) {\n          return res.status(403).json({ \n            message: \"Professional tools access requires an active subscription\",\n            subscriptionRequired: true,\n            reason: \"no_subscription_id\"\n          });\n        }\n\n        try {\n          const subscription = await stripe.subscriptions.retrieve(user.stripeSubscriptionId);\n          if (subscription.status !== 'active') {\n            return res.status(403).json({ \n              message: \"Professional tools access requires an active subscription\",\n              subscriptionRequired: true,\n              reason: \"subscription_inactive\"\n            });\n          }\n        } catch (error) {\n          console.error('Stripe subscription check error:', error);\n          return res.status(403).json({ \n            message: \"Unable to verify subscription status\",\n            subscriptionRequired: true,\n            reason: \"verification_error\"\n          });\n        }\n      }\n    }\n\n    // Basic users: enforce lesson-specific access\n    if (subscriptionTier === 'basic') {\n      const { currentSection } = req.body;\n      if (!currentSection) {\n        return res.status(400).json({ \n          message: \"Basic users require a specific lesson section\",\n          requiresSection: true\n        });\n      }\n\n      // Validate section is within allowed range (Louisiana code sections 101-109)\n      const allowedSections = ['101', '103', '105', '107', '109'];\n      if (!allowedSections.includes(currentSection)) {\n        return res.status(403).json({ \n          message: \"Basic users are limited to specific Louisiana code sections\",\n          allowedSections,\n          requiresUpgrade: true\n        });\n      }\n    }\n\n    try {\n      const { message, context, conversationId, currentSection } = req.body;\n      const userId = user.id;\n      const section = currentSection || '101';\n\n      // Tiered AI response - Basic: section-specific, Pro/Master: complete codebook\n      let response = \"\";\n      try {\n        const aiResponse = await getMentorResponse(message, context, section, subscriptionTier);\n        response = aiResponse;\n      } catch (aiError) {\n        console.error(\"OpenAI error:\", aiError);\n        if (subscriptionTier === 'basic') {\n          response = `Great question about Louisiana Plumbing Code Section ${section}! ðŸŽ“\\n\\nI can help you learn about Section ${section} topics including:\\n\\nâ€¢ **Code Administration** - Enforcement, authority, and legal basis\\nâ€¢ **Installation Requirements** - Pipe sizing, fixtures, and connections\\nâ€¢ **Safety Standards** - Pressure testing, backflow prevention\\nâ€¢ **Compliance Issues** - Violations, permits, and inspections\\n\\nTry asking me something specific about Section ${section} of the Louisiana plumbing code!`;\n        } else {\n          response = `Great question about Louisiana Plumbing Code! ðŸŽ“\\n\\nAs a ${subscriptionTier} plan member, I can help you with:\\n\\nâ€¢ **Any Code Section** - Administration, permits, inspections, violations\\nâ€¢ **Installation Requirements** - Complete pipe sizing, fixtures, connections\\nâ€¢ **Safety Standards** - Testing, backflow prevention, pressure requirements\\nâ€¢ **Specialized Systems** - Medical gas, natural gas, backflow devices\\n\\nAsk me about any Louisiana plumbing code topic!`;\n        }\n      }\n\n      res.json({ \n        response,\n        section: section,\n        subscriptionTier: subscriptionTier,\n        hasCompleteAccess: subscriptionTier !== 'basic'\n      });\n    } catch (error: any) {\n      console.error(\"Mentor chat error:\", error);\n      res.status(500).json({ message: \"Sorry, I'm having trouble right now. Please try asking about any Louisiana plumbing code topic and I'll help!\" });\n    }\n  });\n\n  // AI Study Plan Generation\n  app.post(\"/api/generate-study-plan/:section\", requireActiveSubscription, async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { section } = req.params;\n      const { courseId, duration } = req.body;\n\n      // Validate required parameters\n      if (!section || !courseId || !duration) {\n        return res.status(400).json({ message: \"Section, courseId, and duration are required\" });\n      }\n\n      // Get section content to provide context for study plan generation\n      const sectionContent = await storage.getCourseContent(courseId);\n      const relevantContent = sectionContent.filter(content => \n        content.section?.toString() === section.toString()\n      );\n\n      if (relevantContent.length === 0) {\n        return res.status(404).json({ message: \"No content found for this section\" });\n      }\n\n      // Extract lesson content for context\n      const lessonContent = relevantContent\n        .map(content => {\n          if (hasExtractedContent(content.content)) {\n            return content.content.extracted?.content || content.content.extracted?.description || '';\n          }\n          return typeof content.content === 'string' ? content.content : '';\n        })\n        .join('\\n\\n')\n        .substring(0, 3000); // Limit content length\n\n      // Generate AI study plan\n      const studyPlan = await generateStudyPlan(section, lessonContent, parseInt(duration));\n\n      res.json({\n        success: true,\n        studyPlan: {\n          title: studyPlan.title,\n          content: studyPlan.content,\n          estimatedDuration: studyPlan.estimatedDuration,\n          sectionNumber: section,\n          generatedAt: new Date().toISOString()\n        }\n      });\n    } catch (error: any) {\n      console.error(\"Study plan generation error:\", error);\n      res.status(500).json({ message: error.message || \"Failed to generate study plan\" });\n    }\n  });\n\n  // Generate TTS for chat responses\n  app.post(\"/api/mentor/tts\", requireActiveSubscription, async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { text, messageId } = req.body;\n      \n      if (!text) {\n        return res.status(400).json({ message: \"Text is required\" });\n      }\n\n      const { generateAudio } = await import(\"./openai\");\n      const audioUrl = await generateAudio(text, `chat-${messageId || Date.now()}`);\n      \n      res.json({ audioUrl });\n    } catch (error: any) {\n      console.error(\"TTS generation error:\", error);\n      res.status(500).json({ message: \"Failed to generate audio\" });\n    }\n  });\n\n  // Generate speech audio for podcast sentences\n  app.post(\"/api/openai/speech\", subscriptionAIRateLimit, requireActiveSubscription, async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { input, voice = \"alloy\", model = \"tts-1\" } = req.body;\n      \n      if (!input || typeof input !== 'string') {\n        return res.status(400).json({ message: \"Text input is required\" });\n      }\n\n      const sanitizedInput = input.substring(0, 4096).trim().replace(/\\s+/g, ' '); // Normalize whitespace\n      \n      // Create cache key from content hash and parameters\n      const crypto = await import('crypto');\n      const cacheKey = crypto.createHash('sha256')\n        .update(`${sanitizedInput}-${voice}-${model}-0.9`)\n        .digest('hex');\n      \n      const fs = await import('fs/promises');\n      const path = await import('path');\n      const cacheDir = path.join(process.cwd(), 'audio-cache');\n      const cacheFilePath = path.join(cacheDir, `${cacheKey}.mp3`);\n\n      try {\n        // Ensure cache directory exists\n        await fs.mkdir(cacheDir, { recursive: true });\n        \n        // Try to serve from cache first\n        try {\n          const cachedBuffer = await fs.readFile(cacheFilePath);\n          console.log(`Audio cache HIT for key: ${cacheKey.substring(0, 8)}`);\n          \n          res.set({\n            'Content-Type': 'audio/mpeg',\n            'Content-Length': cachedBuffer.length.toString(),\n            'Cache-Control': 'public, max-age=86400', // 24 hours client cache\n            'X-Audio-Cache': 'HIT',\n            'ETag': `\"${cacheKey.substring(0, 16)}\"`,\n            'Last-Modified': new Date().toUTCString()\n          });\n          \n          return res.send(cachedBuffer);\n        } catch (cacheError) {\n          // Cache miss, continue to generate new audio\n          console.log(`Audio cache MISS for key: ${cacheKey.substring(0, 8)}, checking in-flight generation...`);\n        }\n\n        // Check for in-flight generation to prevent duplicate work\n        let existingGeneration = inFlightAudioGeneration.get(cacheKey);\n        \n        if (!existingGeneration) {\n          // Start new generation and add to in-flight cache\n          existingGeneration = (async (): Promise<Buffer> => {\n            try {\n              console.log(`Generating new TTS audio for ${sanitizedInput.substring(0, 50)}...`);\n              const response = await openai.audio.speech.create({\n                model: model, // tts-1 for faster, tts-1-hd for higher quality\n                voice: voice, // alloy, echo, fable, onyx, nova, shimmer\n                input: sanitizedInput,\n                speed: 0.9 // Slightly slower for educational content\n              });\n\n              const buffer = Buffer.from(await response.arrayBuffer());\n              \n              // Atomic cache write using temp file\n              const tempFilePath = cacheFilePath + '.tmp';\n              await fs.writeFile(tempFilePath, buffer);\n              await fs.rename(tempFilePath, cacheFilePath);\n              \n              console.log(`Audio generation complete, cached for key: ${cacheKey.substring(0, 8)}`);\n              return buffer;\n              \n            } finally {\n              // Always clean up in-flight cache entry\n              inFlightAudioGeneration.delete(cacheKey);\n            }\n          })();\n          \n          inFlightAudioGeneration.set(cacheKey, existingGeneration);\n        } else {\n          console.log(`Waiting for in-flight generation for key: ${cacheKey.substring(0, 8)}`);\n        }\n\n        // Wait for generation (either new or existing)\n        const buffer = await existingGeneration;\n        \n        res.set({\n          'Content-Type': 'audio/mpeg',\n          'Content-Length': buffer.length.toString(),\n          'Cache-Control': 'public, max-age=86400', // 24 hours client cache\n          'X-Audio-Cache': 'MISS',\n          'ETag': `\"${cacheKey.substring(0, 16)}\"`,\n          'Last-Modified': new Date().toUTCString()\n        });\n        \n        res.send(buffer);\n        \n      } catch (fsError) {\n        console.error('File system error in audio caching:', fsError);\n        // Fallback to generating without caching\n        throw new Error('Audio caching system error');\n      }\n    } catch (error: any) {\n      console.error(\"OpenAI TTS generation error:\", error);\n      res.status(500).json({ message: \"Failed to generate speech audio\" });\n    }\n  });\n\n  // Serve cached audio from database\n  app.get(\"/api/audio/cached/:contentHash\", async (req, res) => {\n    try {\n      const { contentHash } = req.params;\n      \n      // Get cached audio from database\n      const cachedAudio = await storage.getCachedAudio(contentHash);\n      if (!cachedAudio) {\n        return res.status(404).json({ error: \"Audio not found\" });\n      }\n      \n      // Update access tracking\n      await storage.updateAudioAccess(contentHash);\n      \n      // Convert base64 back to buffer\n      const audioBuffer = Buffer.from(cachedAudio.audioData, 'base64');\n      \n      // Set appropriate headers\n      res.set({\n        'Content-Type': cachedAudio.mimeType,\n        'Content-Length': audioBuffer.length.toString(),\n        'Cache-Control': 'public, max-age=31536000', // Cache for 1 year\n        'Access-Control-Allow-Origin': '*', // Allow cross-origin requests for audio\n        'Accept-Ranges': 'bytes',\n        'X-Audio-Source': 'database-cache'\n      });\n      \n      // Send the audio data\n      res.send(audioBuffer);\n    } catch (error: any) {\n      console.error(\"Error serving cached audio:\", error);\n      res.status(500).json({ error: \"Failed to serve audio\" });\n    }\n  });\n\n  app.get(\"/api/mentor/conversations\", requireActiveSubscription, async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const conversations = await storage.getUserMentorConversations(userId);\n      res.json(conversations);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Generate AI-powered study plan\n  app.post(\"/api/generate-study-plan/:sectionNumber\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    // Allow authenticated users to generate study plans\n    const user = req.user as any;\n    const isAdmin = user.email?.includes('admin') || user.email === 'admin@latrainer.com' || user.email === 'admin@laplumbprep.com';\n    \n    // Check if user has active subscription (unless admin)\n    if (!isAdmin) {\n      const hasActiveSubscription = user.subscriptionTier && user.subscriptionTier !== 'free' && user.subscriptionStatus === 'active';\n      if (!hasActiveSubscription) {\n        return res.status(402).json({ message: \"Active subscription required to generate AI study plans\" });\n      }\n    }\n\n    try {\n      const { sectionNumber } = req.params;\n      const { courseId, duration = 45 } = req.body;\n      \n      if (!courseId) {\n        return res.status(400).json({ message: \"Course ID is required\" });\n      }\n\n      // Get the lesson content for this section to base the study plan on\n      const courseContent = await storage.getCourseContent(courseId);\n      const lessonContent = courseContent.find(item => \n        item.section?.toString() === sectionNumber.toString() && item.type === 'lesson'\n      );\n\n      if (!lessonContent) {\n        return res.status(404).json({ message: `No lesson content found for Section ${sectionNumber}` });\n      }\n\n      // Extract text content for AI processing\n      let textContent = '';\n      if (lessonContent.content) {\n        const content = lessonContent.content as any;\n        if (content.extracted?.content) {\n          textContent = content.extracted.content;\n        } else if (content.extracted?.text) {\n          textContent = content.extracted.text;\n        } else {\n          textContent = JSON.stringify(content);\n        }\n      }\n\n      if (!textContent || textContent.length < 100) {\n        return res.status(400).json({ message: \"Insufficient lesson content to generate study plan\" });\n      }\n\n      const { generateStudyPlan } = await import(\"./openai\");\n      const studyPlan = await generateStudyPlan(sectionNumber, textContent, duration);\n      \n      res.json({\n        sectionNumber,\n        studyPlan,\n        basedOnLesson: lessonContent.title\n      });\n    } catch (error: any) {\n      console.error(\"Study plan generation error:\", error);\n      res.status(500).json({ message: \"Failed to generate study plan: \" + error.message });\n    }\n  });\n\n  // NOTE: AI chat import route removed - system now uses pure AI approach\n  // No longer needed since we generate all responses dynamically with GPT-5\n\n  // Photo upload and analysis (subscription required)\n  app.post(\"/api/photos/upload\", requireActiveSubscription, upload.single('photo'), async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const userId = (req.user as any).id;\n      const filename = req.file.filename;\n      const filePath = req.file.path;\n      \n      // Convert to base64 for AI analysis\n      const imageBuffer = fs.readFileSync(filePath);\n      const base64Image = imageBuffer.toString('base64');\n      \n      // Analyze photo with AI\n      const analysis = await analyzePhoto(base64Image);\n      \n      // Save to database\n      const upload = await storage.createPhotoUpload(\n        userId,\n        filename,\n        `/uploads/${filename}`,\n        analysis\n      );\n\n      res.json(upload);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Create payment intent for pay-per-use photo analysis\n  app.post(\"/api/create-photo-payment-intent\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { amount } = req.body; // $4.99 = 499 cents\n      \n      const session = await stripe.checkout.sessions.create({\n        payment_method_types: ['card'],\n        line_items: [{\n          price_data: {\n            currency: 'usd',\n            product_data: {\n              name: 'AI Photo Code Analysis',\n              description: 'Professional plumbing code compliance analysis',\n            },\n            unit_amount: amount,\n          },\n          quantity: 1,\n        }],\n        mode: 'payment',\n        success_url: `${process.env.DOMAIN || 'http://localhost:5000'}/ai-photo-analysis?success=true`,\n        cancel_url: `${process.env.DOMAIN || 'http://localhost:5000'}/ai-photo-analysis?canceled=true`,\n        metadata: {\n          type: 'photo-analysis-pay-per-use',\n          userId: (req.user as any).id,\n        },\n      });\n\n      res.json({ url: session.url });\n    } catch (error: any) {\n      console.error('Create photo payment intent error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Bulk credit packages (these need Stripe products)\n  app.post(\"/api/create-photo-credits-payment\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { credits, amount, planName } = req.body;\n      \n      const session = await stripe.checkout.sessions.create({\n        payment_method_types: ['card'],\n        line_items: [{\n          price_data: {\n            currency: 'usd',\n            product_data: {\n              name: `Photo Analysis Credits - ${planName}`,\n              description: `${credits} AI photo analysis credits`,\n            },\n            unit_amount: Math.round(amount * 100), // Convert to cents\n          },\n          quantity: 1,\n        }],\n        mode: 'payment',\n        success_url: `${process.env.DOMAIN || 'http://localhost:5000'}/ai-photo-analysis?success=true`,\n        cancel_url: `${process.env.DOMAIN || 'http://localhost:5000'}/ai-photo-analysis?canceled=true`,\n        metadata: {\n          type: 'photo-analysis-credits',\n          userId: (req.user as any).id,\n          credits: credits.toString(),\n          planName,\n        },\n      });\n\n      res.json({ url: session.url });\n    } catch (error: any) {\n      console.error('Create photo credits payment error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Plan upload and analysis\n  app.post(\"/api/plans/upload\", requireActiveSubscription, upload.single('plan'), async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const userId = (req.user as any).id;\n      const filename = req.file.filename;\n      const filePath = req.file.path;\n      \n      // Convert to base64 for AI analysis\n      const fileBuffer = fs.readFileSync(filePath);\n      const base64File = fileBuffer.toString('base64');\n      \n      // Analyze plans with AI\n      const analysis = await analyzePlans(base64File);\n      \n      // Save to database\n      const upload = await storage.createPlanUpload(\n        userId,\n        filename,\n        `/uploads/${filename}`,\n        analysis.materialList,\n        analysis.codeCompliance\n      );\n\n      // Generate numbered fitting PDF\n      const pdfPath = await generateNumberedFittingPDF(analysis, base64File);\n      \n      res.json({\n        ...upload,\n        materialList: analysis.materialList,\n        numberedFittings: analysis.numberedFittings,\n        codeCompliance: analysis.codeCompliance,\n        totalEstimatedCost: analysis.totalEstimatedCost,\n        pdfUrl: pdfPath\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Calculator routes\n  app.post(\"/api/calculator/pipe-size\", async (req, res) => {\n    try {\n      const { fixtureUnits, pipeLength, material } = req.body;\n      \n      if (!fixtureUnits || !pipeLength || !material) {\n        return res.status(400).json({ message: \"Missing required parameters\" });\n      }\n\n      const result = await calculatePipeSize(\n        parseInt(fixtureUnits),\n        parseInt(pipeLength),\n        material\n      );\n      \n      res.json(result);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Generate numbered fitting PDF for existing plan\n  app.post(\"/api/plans/:planId/generate-pdf\", requireActiveSubscription, async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { planId } = req.params;\n      const userId = (req.user as any).id;\n      \n      // Get plan from database\n      const plan = await storage.getPlanUpload(planId, userId);\n      if (!plan) {\n        return res.status(404).json({ message: \"Plan not found\" });\n      }\n      \n      // Read the original plan file\n      const planPath = path.join(process.cwd(), 'public', plan.url);\n      const planBuffer = fs.readFileSync(planPath);\n      const base64Plan = planBuffer.toString('base64');\n      \n      // Generate PDF with numbered fittings\n      const pdfPath = await generateNumberedFittingPDF({\n        materialList: plan.materialList as any,\n        numberedFittings: (plan.analysis as any)?.numberedFittings || [],\n        totalEstimatedCost: (plan.analysis as any)?.totalEstimatedCost || 0\n      }, base64Plan);\n      \n      res.json({ pdfUrl: pdfPath });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Serve uploaded files\n  app.get('/uploads/:filename', (req, res) => {\n    const filename = req.params.filename;\n    const filePath = path.join(process.cwd(), 'uploads', filename);\n    \n    if (fs.existsSync(filePath)) {\n      res.sendFile(filePath);\n    } else {\n      res.status(404).json({ message: 'File not found' });\n    }\n  });\n\n  // Serve PDF files\n  app.get('/pdfs/:filename', (req, res) => {\n    const filename = req.params.filename;\n    const filePath = path.join(process.cwd(), 'public', 'pdfs', filename);\n    \n    if (!fs.existsSync(filePath)) {\n      return res.status(404).json({ message: 'PDF not found' });\n    }\n    \n    res.contentType('application/pdf');\n    res.sendFile(filePath);\n  });\n\n  // Serve public files (PDFs, code books, etc.) from uploads directory\n  app.get(\"/public-objects/:filePath(*)\", (req, res) => {\n    const filePath = req.params.filePath;\n    const fullPath = path.join(process.cwd(), 'uploads', 'public', filePath);\n    \n    if (fs.existsSync(fullPath)) {\n      res.sendFile(fullPath);\n    } else {\n      res.status(404).json({ error: \"File not found\" });\n    }\n  });\n\n  // API endpoint to list available code books\n  app.get(\"/api/code-books\", async (req, res) => {\n    try {\n      // List common code book file names\n      const codeBooks = [\n        {\n          name: \"Louisiana Plumbing Code 2024\",\n          filename: \"louisiana-plumbing-code-2024.pdf\",\n          size: \"12.5 MB\",\n          description: \"Complete Louisiana State Plumbing Code\"\n        },\n        {\n          name: \"Louisiana Backflow Prevention\",\n          filename: \"louisiana-backflow-prevention.pdf\", \n          size: \"3.2 MB\",\n          description: \"Backflow prevention regulations and requirements\"\n        },\n        {\n          name: \"Natural Gas Installation Code\",\n          filename: \"natural-gas-installation-code.pdf\",\n          size: \"8.1 MB\", \n          description: \"Natural gas piping installation standards\"\n        }\n      ];\n\n      // Check which files actually exist in uploads/public directory\n      const availableBooks = [];\n      for (const book of codeBooks) {\n        const filePath = path.join(process.cwd(), 'uploads', 'public', book.filename);\n        if (fs.existsSync(filePath)) {\n          availableBooks.push({\n            ...book,\n            url: `/public-objects/${book.filename}`\n          });\n        }\n      }\n      \n      res.json(availableBooks);\n    } catch (error) {\n      console.error(\"Error listing code books:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Student interest/lead capture endpoint\n  app.post(\"/api/student-interest\", async (req, res) => {\n    try {\n      const { email, firstName, lastName, phone } = req.body;\n      \n      if (!email || !firstName) {\n        return res.status(400).json({ message: \"Email and first name are required\" });\n      }\n      \n      // Check if user already exists\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"User with this email already exists\" });\n      }\n      \n      // Start automated email sequence for potential student\n      const fullName = `${firstName} ${lastName || ''}`.trim();\n      await emailAutomation.queueEmailSequence(\n        email,\n        fullName,\n        \"student_enrollment\"\n      );\n      \n      res.status(201).json({ \n        message: \"Interest recorded successfully! Check your email for course information.\",\n        success: true\n      });\n    } catch (error: any) {\n      console.error(\"Error recording student interest:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Email unsubscribe endpoint\n  app.post(\"/api/unsubscribe\", async (req, res) => {\n    try {\n      const { email, campaignType } = req.body;\n      \n      if (!email) {\n        return res.status(400).json({ message: \"Email is required\" });\n      }\n      \n      await emailAutomation.unsubscribe(email, campaignType);\n      \n      res.json({ \n        message: \"Successfully unsubscribed from email campaigns\",\n        success: true\n      });\n    } catch (error: any) {\n      console.error(\"Error unsubscribing:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Get bulk pricing tiers\n  app.get(\"/api/bulk-pricing/tiers\", async (req, res) => {\n    try {\n      const tiers = await bulkPricingService.getBulkPricingTiers();\n      res.json({ tiers });\n    } catch (error: any) {\n      console.error(\"Error fetching bulk pricing tiers:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Calculate bulk pricing for a quote\n  app.post(\"/api/bulk-pricing/calculate\", async (req, res) => {\n    try {\n      const { studentCount, courseIds = [\"journeyman\"] } = req.body;\n      \n      if (!studentCount || studentCount < 1) {\n        return res.status(400).json({ message: \"Student count is required and must be greater than 0\" });\n      }\n      \n      const pricing = await bulkPricingService.calculateBulkPricing(studentCount, courseIds);\n      res.json({ pricing });\n    } catch (error: any) {\n      console.error(\"Error calculating bulk pricing:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Create bulk enrollment request (requires authentication)\n  app.post(\"/api/bulk-enrollment/request\", async (req, res) => {\n    try {\n      const { \n        employerId, \n        studentEmails, \n        courseIds = [\"journeyman\"], \n        contactEmail, \n        contactPhone, \n        notes, \n        requestedStartDate \n      } = req.body;\n      \n      if (!employerId || !studentEmails || !Array.isArray(studentEmails) || studentEmails.length === 0) {\n        return res.status(400).json({ \n          message: \"Employer ID and student emails array are required\" \n        });\n      }\n      \n      if (!contactEmail) {\n        return res.status(400).json({ message: \"Contact email is required\" });\n      }\n\n      // Validate student email format\n      for (const student of studentEmails) {\n        if (!student.email || !student.firstName) {\n          return res.status(400).json({ \n            message: \"Each student must have email and firstName\" \n          });\n        }\n      }\n\n      const result = await bulkPricingService.createBulkEnrollmentRequest(\n        employerId,\n        studentEmails,\n        courseIds,\n        contactEmail,\n        contactPhone,\n        notes,\n        requestedStartDate ? new Date(requestedStartDate) : undefined\n      );\n      \n      // Start automated email sequence for bulk enrollment follow-up\n      await emailAutomation.queueEmailSequence(\n        contactEmail,\n        employerId, // Using employerId as name for now\n        \"bulk_enrollment\"\n      );\n\n      res.status(201).json({ \n        message: \"Bulk enrollment request created successfully! Check your email for follow-up information.\",\n        ...result\n      });\n    } catch (error: any) {\n      console.error(\"Error creating bulk enrollment request:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Get bulk enrollment requests for an employer\n  app.get(\"/api/bulk-enrollment/requests/:employerId\", async (req, res) => {\n    try {\n      const { employerId } = req.params;\n      const requests = await bulkPricingService.getBulkEnrollmentRequests(employerId);\n      res.json({ requests });\n    } catch (error: any) {\n      console.error(\"Error fetching bulk enrollment requests:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Get student enrollments for a bulk request\n  app.get(\"/api/bulk-enrollment/:requestId/students\", async (req, res) => {\n    try {\n      const { requestId } = req.params;\n      const students = await bulkPricingService.getBulkStudentEnrollments(requestId);\n      res.json({ students });\n    } catch (error: any) {\n      console.error(\"Error fetching bulk student enrollments:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Approve bulk enrollment request (admin only)\n  app.post(\"/api/bulk-enrollment/:requestId/approve\", async (req, res) => {\n    try {\n      const { requestId } = req.params;\n      const { approvedBy } = req.body;\n      \n      if (!approvedBy) {\n        return res.status(400).json({ message: \"Approved by field is required\" });\n      }\n      \n      const updatedRequest = await bulkPricingService.approveBulkEnrollmentRequest(requestId, approvedBy);\n      \n      res.json({ \n        message: \"Bulk enrollment request approved successfully\",\n        request: updatedRequest \n      });\n    } catch (error: any) {\n      console.error(\"Error approving bulk enrollment request:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Content import route\n  app.post(\"/api/admin/import-content\", async (req, res) => {\n    try {\n      const { content } = req.body;\n      \n      if (!Array.isArray(content)) {\n        return res.status(400).json({ message: \"Invalid content format\" });\n      }\n\n      // Get or create the Louisiana Plumbing course\n      let courses = await storage.getCourses();\n      let journeymanCourse = courses.find(c => c.type === \"journeyman\") || courses[0];\n      \n      // If no course exists, create the default Louisiana Plumbing course\n      if (!journeymanCourse) {\n        const defaultCourse = insertCourseSchema.parse({\n          title: \"Louisiana Journeyman Prep\",\n          description: \"Comprehensive Louisiana plumbing code certification preparation course covering all aspects of state plumbing regulations and best practices.\",\n          type: \"journeyman\",\n          price: \"39.99\",\n          duration: 40,\n          lessons: 0,\n          practiceQuestions: 0,\n          isActive: true\n        });\n        \n        journeymanCourse = await storage.createCourse(defaultCourse);\n      }\n\n      const imported = [];\n      for (const item of content) {\n        const courseContentData = insertCourseContentSchema.parse({\n          courseId: journeymanCourse.id,\n          title: item.title,\n          type: item.type,\n          chapter: item.chapter,\n          section: item.section,\n          content: { description: item.content, text: item.content },\n          isActive: true,\n          sortOrder: 0\n        });\n\n        const createdContent = await storage.createCourseContent(courseContentData);\n        imported.push(createdContent);\n      }\n\n      // Update course statistics after import\n      await storage.updateCourseStatsAutomatically(journeymanCourse.id);\n      const courseStats = await storage.getCourseContentStats(journeymanCourse.id);\n\n      res.json({ \n        message: \"Content imported successfully\", \n        count: imported.length,\n        content: imported,\n        courseStats: courseStats\n      });\n    } catch (error: any) {\n      console.error('Content import error:', error);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // QuizGecko import route (legacy)\n  app.post(\"/api/admin/import-quizgecko\", async (req, res) => {\n    try {\n      const { content } = req.body;\n      \n      if (!Array.isArray(content)) {\n        return res.status(400).json({ message: \"Invalid content format\" });\n      }\n\n      // Get or create the Louisiana Plumbing course\n      let courses = await storage.getCourses();\n      let journeymanCourse = courses.find(c => c.type === \"journeyman\") || courses[0];\n      \n      // If no course exists, create the default Louisiana Plumbing course\n      if (!journeymanCourse) {\n        const defaultCourse = insertCourseSchema.parse({\n          title: \"Louisiana Journeyman Prep\",\n          description: \"Comprehensive Louisiana plumbing code certification preparation course covering all aspects of state plumbing regulations and best practices.\",\n          type: \"journeyman\",\n          price: \"39.99\",\n          duration: 40,\n          lessons: 0,\n          practiceQuestions: 0,\n          isActive: true\n        });\n        \n        journeymanCourse = await storage.createCourse(defaultCourse);\n      }\n\n      const imported = [];\n      for (const item of content) {\n        const courseContentData = insertCourseContentSchema.parse({\n          courseId: journeymanCourse.id,\n          title: item.title,\n          type: item.type,\n          chapter: item.chapter,\n          section: item.section,\n          quizgeckoUrl: item.url,\n          content: { description: `${item.type} content for ${item.title}`, url: item.url },\n          isActive: true,\n          sortOrder: 0\n        });\n\n        const createdContent = await storage.createCourseContent(courseContentData);\n        imported.push(createdContent);\n      }\n\n      // Update course statistics after import\n      await storage.updateCourseStatsAutomatically(journeymanCourse.id);\n      const courseStats = await storage.getCourseContentStats(journeymanCourse.id);\n\n      res.json({ \n        message: \"Content imported successfully\", \n        count: imported.length,\n        content: imported,\n        courseStats: courseStats\n      });\n    } catch (error: any) {\n      console.error('QuizGecko import error:', error);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Get private code books\n  app.get(\"/api/admin/code-books\", async (req, res) => {\n    try {\n      const codeBooks = await storage.getPrivateCodeBooks();\n      \n      const formattedBooks = codeBooks.map(book => ({\n        id: book.id,\n        name: book.originalName,\n        size: `${(book.fileSize / 1024 / 1024).toFixed(1)} MB`,\n        uploadedAt: book.createdAt,\n        filePath: book.filePath\n      }));\n\n      res.json(formattedBooks);\n    } catch (error: any) {\n      console.error('Get private code books error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Upload private code book\n  app.post(\"/api/admin/code-books/upload\", upload.single('codebook'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      // For now, we'll use a simple user ID (in a real app, get from session)\n      const uploadedBy = \"admin\"; // In real app: req.user?.id || \"admin\"\n\n      const codeBookData = insertPrivateCodeBookSchema.parse({\n        filename: req.file.filename,\n        originalName: req.file.originalname,\n        filePath: req.file.path,\n        fileSize: req.file.size,\n        contentType: req.file.mimetype,\n        uploadedBy: uploadedBy\n      });\n\n      const codeBook = await storage.createPrivateCodeBook(codeBookData);\n\n      res.json({ \n        message: \"Code book uploaded successfully\",\n        codeBook: {\n          id: codeBook.id,\n          name: codeBook.originalName,\n          size: `${(codeBook.fileSize / 1024 / 1024).toFixed(1)} MB`,\n          uploadedAt: codeBook.createdAt\n        }\n      });\n    } catch (error: any) {\n      console.error('Code book upload error:', error);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Content generation route (placeholder for future AI integration)\n  app.post(\"/api/admin/generate-content\", async (req, res) => {\n    try {\n      const { contentType, topic } = req.body;\n      \n      // This is a placeholder - you would integrate with AI service here\n      const generatedContent = {\n        content: `<h1>${topic}</h1><p>Generated ${contentType} content for ${topic}. This is a placeholder that would be replaced with actual AI-generated content based on your uploaded code books.</p>`,\n        html: `<div class=\"generated-content\"><h2>${topic}</h2><p>This ${contentType} was generated based on your private code book reference materials.</p><ul><li>Learning objectives would be listed here</li><li>Key concepts and definitions</li><li>Code references and requirements</li></ul></div>`\n      };\n\n      res.json(generatedContent);\n    } catch (error: any) {\n      console.error('Content generation error:', error);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Content extraction route\n  app.post(\"/api/extract-content/:contentId\", async (req, res) => {\n    try {\n      const { contentId } = req.params;\n      \n      // Get the content record\n      const content = await storage.getCourseContentById(contentId);\n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n\n      // Extract content based on type\n      const extractedContent = await contentExtractor.extractFromQuizGecko(\n        content.quizgeckoUrl || \"\", // Use the stored QuizGecko URL\n        content.type\n      );\n\n      if (!extractedContent) {\n        return res.status(500).json({ message: \"Failed to extract content\" });\n      }\n\n      // Update the content record with extracted data\n      const updatedContent = await storage.updateCourseContent(contentId, {\n        content: {\n          ...(content.content as object || {}),\n          extracted: extractedContent.content,\n          extractedAt: new Date().toISOString()\n        }\n      });\n\n      res.json({\n        message: \"Content extracted successfully\",\n        content: updatedContent\n      });\n    } catch (error: any) {\n      console.error('Content extraction error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Get extracted content for display\n  app.get(\"/api/content/:contentId/display\", async (req, res) => {\n    try {\n      const { contentId } = req.params;\n      \n      const content = await storage.getCourseContentById(contentId);\n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n\n      // If content hasn't been extracted yet, extract it now\n      if (!(content.content as any)?.extracted) {\n        const extractedContent = await contentExtractor.extractFromQuizGecko(\n          content.quizgeckoUrl || \"\", // Use the stored QuizGecko URL\n          content.type\n        );\n\n        if (extractedContent) {\n          const updatedContent = await storage.updateCourseContent(contentId, {\n            content: {\n              ...(content.content as object || {}),\n              extracted: extractedContent.content,\n              extractedAt: new Date().toISOString()\n            }\n          });\n          \n          return res.json(updatedContent);\n        }\n      }\n\n\n      res.json(content);\n    } catch (error: any) {\n      console.error('Get content error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Get course content for display\n  app.get(\"/api/courses/:courseId/content\", async (req, res) => {\n    try {\n      const { courseId } = req.params;\n      console.log(`[DEBUG] Fetching content for courseId: ${courseId}`);\n      \n      // Resolve course ID (handle friendly URLs like \"journeyman-prep\")\n      const resolvedCourseId = await resolveCourseId(courseId);\n      console.log(`[DEBUG] Resolved courseId: ${resolvedCourseId}`);\n      if (!resolvedCourseId) {\n        console.log(`[DEBUG] Course not found for: ${courseId}`);\n        return res.status(404).json({ message: \"Course not found\" });\n      }\n      \n      let content = await storage.getCourseContent(resolvedCourseId);\n      console.log(`[DEBUG] Initial content length: ${content.length}`);\n      \n      // If content is empty for the Louisiana Journeyman Prep course, auto-seed it\n      if (content.length === 0 && resolvedCourseId === \"b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b\") {\n        console.log(\"Course content empty, auto-seeding...\");\n        await seedCourseContent();\n        content = await storage.getCourseContent(resolvedCourseId);\n        console.log(`[DEBUG] After seeding content length: ${content.length}`);\n      }\n      \n      // Add cache-busting headers to ensure fresh data\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      console.log(`[DEBUG] Returning ${content.length} content items`);\n      res.json(content || []);\n    } catch (error: any) {\n      console.error('Get course content error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Get section-specific study notes\n  app.get(\"/api/courses/:courseId/sections/:section/study-notes\", async (req, res) => {\n    try {\n      const { courseId, section } = req.params;\n      \n      // Resolve course ID (handle friendly URLs like \"journeyman-prep\")\n      const resolvedCourseId = await resolveCourseId(courseId);\n      if (!resolvedCourseId) {\n        return res.status(404).json({ message: \"Course not found\" });\n      }\n      \n      // Fetch all course content and filter for study-notes of the specific section\n      const allContent = await storage.getCourseContent(resolvedCourseId);\n      const studyNotesItems = allContent.filter(item => \n        String(item.section) === section && item.type === 'study-notes'\n      );\n      \n      // Prioritize study notes with 'notes' field over 'extracted.content' format\n      const studyNotes = studyNotesItems.find(item => {\n        const content = item.content as any;\n        return content && (content.notes || content.text);\n      }) || studyNotesItems[0]; // fallback to first item if no notes/text field found\n      \n      if (!studyNotes) {\n        return res.status(404).json({ \n          message: `Study notes not found for section ${section}` \n        });\n      }\n\n      // Clean markdown formatting from study notes content\n      const cleanMarkdown = (text: string): string => {\n        if (!text) return text;\n        return text\n          .replace(/^#{1,6}\\s+/gm, '') // Remove headers\n          .replace(/\\*\\*(.*?)\\*\\*/g, '$1') // Remove bold\n          .replace(/\\*(.*?)\\*/g, '$1') // Remove italic\n          .replace(/\\n{3,}/g, '\\n\\n') // Clean whitespace\n          .trim();\n      };\n\n      // Clean the content\n      if (studyNotes.content && typeof studyNotes.content === 'object') {\n        const content = studyNotes.content as any;\n        if (content.notes) {\n          content.notes = cleanMarkdown(content.notes);\n        }\n        if (content.text) {\n          content.text = cleanMarkdown(content.text);\n        }\n        if (content.keyPoints && Array.isArray(content.keyPoints)) {\n          content.keyPoints = content.keyPoints.map(cleanMarkdown);\n        }\n      }\n      if (studyNotes.title) {\n        studyNotes.title = cleanMarkdown(studyNotes.title);\n      }\n      \n      // Add cache-busting headers to ensure fresh data\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      res.json(studyNotes);\n    } catch (error: any) {\n      console.error('Error fetching section study notes:', error);\n      res.status(500).json({ message: \"Failed to fetch study notes\" });\n    }\n  });\n\n  // Generate AI audio for podcast content  \n  app.post(\"/api/generate-audio/:id\", async (req, res) => {\n    // Check authentication\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    // Check subscription for non-admin users\n    const user = req.user as any;\n    const isAdmin = user.email?.includes('admin') || user.email === 'admin@latrainer.com' || user.email === 'admin@laplumbprep.com';\n    \n    if (!isAdmin) {\n      // Apply subscription requirement for regular users\n      const hasActiveSubscription = user.subscriptionTier && user.subscriptionTier !== 'free' && user.subscriptionStatus === 'active';\n      if (!hasActiveSubscription) {\n        return res.status(402).json({ error: 'Active subscription required for audio generation' });\n      }\n    }\n    try {\n      const { id } = req.params;\n      const content = await storage.getCourseContentById(id);\n      \n      if (!content) {\n        return res.status(404).json({ error: 'Content not found' });\n      }\n\n      const contentData = content.content as any;\n      \n      // Get text for audio generation from multiple sources\n      let textForAudio = '';\n      if (contentData?.extracted?.transcript) {\n        textForAudio = contentData.extracted.transcript;\n      } else if (contentData?.extracted?.content) {\n        textForAudio = contentData.extracted.content;\n      } else if (contentData?.extracted?.text) {\n        textForAudio = contentData.extracted.text;\n      }\n      \n      if (!textForAudio || textForAudio.trim().length === 0) {\n        return res.status(400).json({ error: 'No content available for audio generation' });\n      }\n      \n      // Clean up text for audio (remove markdown/HTML)\n      textForAudio = textForAudio\n        .replace(/#+\\s*/g, '') // Remove markdown headers\n        .replace(/\\*\\*(.*?)\\*\\*/g, '$1') // Remove bold markdown\n        .replace(/\\*(.*?)\\*/g, '$1') // Remove italic markdown\n        .replace(/<[^>]*>/g, '') // Remove HTML tags\n        .replace(/\\n+/g, ' ') // Replace newlines with spaces\n        .trim();\n\n      const { generateAudio } = await import('./openai');\n      const audioUrl = await generateAudio(textForAudio, id);\n      \n      // Update content with audio URL\n      await storage.updateContentAudio(id, audioUrl);\n      \n      res.json({ audioUrl });\n    } catch (error: any) {\n      console.error('Generate audio error:', error);\n      res.status(500).json({ error: 'Failed to generate audio' });\n    }\n  });\n\n  // Study session tracking endpoints\n  app.post(\"/api/study-sessions/start\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { contentId, contentType } = req.body;\n      const userId = (req.user as any).id;\n\n      if (!contentId || !contentType) {\n        return res.status(400).json({ message: \"contentId and contentType are required\" });\n      }\n\n      const session = await storage.startStudySession(userId, contentId, contentType);\n      res.json(session);\n    } catch (error: any) {\n      console.error(\"Start study session error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/study-sessions/:sessionId/end\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { sessionId } = req.params;\n      const session = await storage.endStudySession(sessionId);\n      res.json(session);\n    } catch (error: any) {\n      console.error(\"End study session error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/study-sessions\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { contentId } = req.query;\n      \n      const sessions = await storage.getUserStudySessions(userId, contentId as string);\n      res.json(sessions);\n    } catch (error: any) {\n      console.error(\"Get study sessions error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/study-sessions/stats\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const stats = await storage.getStudySessionStats(userId);\n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"Get study session stats error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Quiz attempt endpoints\n  app.post(\"/api/quiz-attempts\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const attempt = await storage.createQuizAttempt({ ...req.body, userId });\n      \n      // Update section progress if quiz passed\n      if (attempt.passed) {\n        await storage.updateSectionProgress(\n          userId,\n          attempt.courseId,\n          attempt.chapter,\n          attempt.section,\n          {\n            quizPassed: true,\n            highestScore: attempt.score,\n            attemptCount: 1, // This will be incremented if already exists\n            lastAttemptAt: new Date(),\n          }\n        );\n        \n        // Unlock next section\n        await storage.unlockNextSection(userId, attempt.courseId, attempt.chapter, attempt.section);\n      }\n      \n      res.json(attempt);\n    } catch (error: any) {\n      console.error(\"Create quiz attempt error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/quiz-attempts\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { contentId } = req.query;\n      \n      const attempts = await storage.getUserQuizAttempts(userId, contentId as string);\n      res.json(attempts);\n    } catch (error: any) {\n      console.error(\"Get quiz attempts error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/quiz-attempts/latest/:contentId\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { contentId } = req.params;\n      \n      const attempt = await storage.getLatestQuizAttempt(userId, contentId);\n      res.json(attempt);\n    } catch (error: any) {\n      console.error(\"Get latest quiz attempt error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Section progress endpoints (removed duplicate - keeping the comprehensive one above)\n\n  app.get(\"/api/section-progress/:courseId/:chapter/:section/unlocked\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { courseId, chapter, section } = req.params;\n      \n      const isUnlocked = await storage.isSectionUnlocked(\n        userId,\n        courseId,\n        parseInt(chapter),\n        parseInt(section)\n      );\n      \n      res.json({ isUnlocked });\n    } catch (error: any) {\n      console.error(\"Check section unlock error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Re-extract quiz content to use new structured format\n  app.post(\"/api/content/:id/reextract-quiz\", async (req, res) => {\n    try {\n      const contentId = req.params.id;\n      const contentItems = await storage.getCourseContent(contentId);\n      const content = Array.isArray(contentItems) ? contentItems[0] : contentItems;\n      \n      if (!content || content.type !== 'quiz') {\n        return res.status(404).json({ message: \"Quiz content not found\" });\n      }\n\n      // Get the text content from the extracted field\n      const contentData = content.content as any;\n      const textContent = contentData?.extracted?.content || '';\n      \n      if (textContent) {\n        // Use our improved quiz parser\n        const { ContentExtractor } = require('./content-extractor');\n        const extractor = new ContentExtractor();\n        \n        // Parse the text content using our new method\n        const questions = extractor.extractQuestionsFromText(textContent, content.title || '');\n        \n        if (questions.length > 0) {\n          // Update the content with structured questions\n          const contentObj = content.content as any;\n          const updatedContent = {\n            ...contentObj,\n            extracted: {\n              ...(contentObj?.extracted || {}),\n              questions: questions,\n              totalQuestions: questions.length,\n              passingScore: 70\n            }\n          };\n          \n          await storage.updateCourseContent(contentId, { content: updatedContent });\n          res.json({ message: `Successfully extracted ${questions.length} questions`, questions });\n        } else {\n          res.status(400).json({ message: \"No questions could be extracted from content\" });\n        }\n      } else {\n        res.status(400).json({ message: \"No text content found to extract from\" });\n      }\n    } catch (error: any) {\n      console.error(\"Re-extract quiz error:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Email routes\n  app.post(\"/api/referrals/send-invitation\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { email } = req.body;\n      const user = req.user as any;\n      \n      if (!email) {\n        return res.status(400).json({ message: \"Email is required\" });\n      }\n\n      // Generate referral code if user doesn't have one\n      let referralCode = user.referralCode;\n      if (!referralCode) {\n        referralCode = Math.random().toString(36).substring(2, 8).toUpperCase();\n        await storage.updateUser(user.id, { referralCode });\n      }\n\n      // Create referral link\n      const referralLink = `${process.env.REPLIT_DEV_DOMAIN || 'https://laplumbprep.com'}/register?ref=${referralCode}`;\n\n      // Send referral invitation email\n      await emailService.sendReferralInvitation({\n        toEmail: email,\n        referrerName: `${user.firstName || user.username}`,\n        referralCode,\n        referralLink\n      });\n\n      res.json({ \n        message: \"Referral invitation sent successfully!\",\n        referralCode,\n        referralLink\n      });\n    } catch (error: any) {\n      console.error('Send referral invitation error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/support/contact\", async (req, res) => {\n    try {\n      const { name, email, subject, message } = req.body;\n      \n      if (!name || !email || !subject || !message) {\n        return res.status(400).json({ message: \"All fields are required\" });\n      }\n\n      // Send support notification\n      await emailService.sendSupportNotification({\n        fromEmail: email,\n        fromName: name,\n        subject,\n        message,\n        userInfo: req.isAuthenticated() ? req.user : null\n      });\n\n      res.json({ message: \"Support request sent successfully!\" });\n    } catch (error: any) {\n      console.error('Send support request error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Amazon product extraction route\n  app.post(\"/api/amazon/extract\", async (req, res) => {\n    try {\n      const { url } = req.body;\n      \n      if (!url || (!url.includes('amazon.com') && !url.includes('amzn.to'))) {\n        return res.status(400).json({ message: \"Please provide a valid Amazon URL\" });\n      }\n\n      // Use node-fetch to get the page content\n      const fetch = await import('node-fetch');\n      const cheerio = await import('cheerio');\n      \n      const response = await fetch.default(url, {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\n        }\n      });\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      \n      const html = await response.text();\n      const $ = cheerio.load(html);\n      \n      // Extract product information using jQuery-like selectors\n      const name = $('#productTitle').text().trim() || \n                  $('[data-automation-id=\"product-title\"]').text().trim() ||\n                  $('h1.a-size-large').text().trim();\n\n      // Price extraction\n      let price = '';\n      const priceWhole = $('.a-price-whole').first().text().trim();\n      const priceFraction = $('.a-price-fraction').first().text().trim();\n      if (priceWhole && priceFraction) {\n        price = `${priceWhole}.${priceFraction}`;\n      } else {\n        price = $('.a-price .a-offscreen').first().text().trim() ||\n               $('[data-automation-id=\"price\"]').first().text().trim();\n      }\n      price = price.replace(/[^0-9.]/g, '');\n\n      // Image\n      const imageUrl = $('#landingImage').attr('src') || \n                      $('[data-automation-id=\"product-image\"]').attr('src') ||\n                      $('.a-dynamic-image').first().attr('src') || '';\n\n      // Description\n      let description = $('#feature-bullets ul').text().trim() || \n                       $('[data-automation-id=\"product-overview\"]').text().trim() ||\n                       $('#productDescription p').text().trim();\n      \n      // Clean up description\n      description = description.replace(/\\s+/g, ' ').trim();\n\n      // Brand\n      const brand = $('#bylineInfo_feature_div .a-color-secondary').text().trim() ||\n                   $('[data-automation-id=\"product-brand\"]').text().trim() ||\n                   $('.po-brand .po-break-word').text().trim();\n\n      // Features\n      const features: string[] = [];\n      $('#feature-bullets li, .a-unordered-list li').each((_, el) => {\n        const text = $(el).text().trim();\n        if (text && text.length > 10 && !text.includes('Make sure') && !text.includes('See more')) {\n          features.push(text);\n        }\n      });\n\n      // Add the affiliate tag to the URL\n      const affiliateUrl = url.includes('tag=') ? url : \n        url + (url.includes('?') ? '&' : '?') + 'tag=laplumbprep-20';\n\n      const productData = {\n        name: name || '',\n        price: price || '',\n        imageUrl: imageUrl || '',\n        description: description || '',\n        brand: brand || '',\n        features: features.slice(0, 8),\n        amazonUrl: affiliateUrl,\n        shortDescription: description.substring(0, 150) + (description.length > 150 ? '...' : ''),\n        success: true\n      };\n\n      res.json(productData);\n\n    } catch (error: any) {\n      console.error('Amazon extraction error:', error);\n      res.status(500).json({ \n        message: \"Failed to extract product information from Amazon URL\",\n        error: error.message,\n        success: false\n      });\n    }\n  });\n\n  // E-commerce API Routes\n\n  // Product routes\n  app.get(\"/api/products\", async (req, res) => {\n    try {\n      const page = parseInt(req.query.page as string) || 1;\n      const limit = parseInt(req.query.limit as string) || 20;\n      const category = req.query.category as string;\n      const search = req.query.search as string;\n      \n      const result = await storage.getProducts(category, search, page, limit);\n      res.json(result);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/products/featured\", async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 8;\n      const products = await storage.getFeaturedProducts(limit);\n      res.json(products);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/products/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const product = await storage.getProduct(id);\n      if (!product) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n      res.json(product);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/products\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      // Ensure arrays are properly formatted\n      const cleanedBody = {\n        ...req.body,\n        features: Array.isArray(req.body.features) ? req.body.features : [],\n        tags: Array.isArray(req.body.tags) ? req.body.tags : [],\n      };\n      \n      const productData = insertProductSchema.parse(cleanedBody);\n      const product = await storage.createProduct(productData);\n      res.json(product);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/products/:id\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n      const product = await storage.updateProduct(id, updates);\n      res.json(product);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/products/:id\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { id } = req.params;\n      await storage.deleteProduct(id);\n      res.json({ message: \"Product deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Cart routes\n  app.get(\"/api/cart\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const cartItems = await storage.getCartItems(userId);\n      res.json(cartItems);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/cart\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { productId, quantity } = req.body;\n      const cartItem = await storage.addToCart(userId, productId, quantity);\n      res.json(cartItem);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/cart/:productId\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { productId } = req.params;\n      const { quantity } = req.body;\n      const cartItem = await storage.updateCartItem(userId, productId, quantity);\n      res.json(cartItem);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/cart/:productId\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { productId } = req.params;\n      await storage.removeFromCart(userId, productId);\n      res.json({ message: \"Item removed from cart\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/cart\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      await storage.clearCart(userId);\n      res.json({ message: \"Cart cleared\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Product review routes\n  app.get(\"/api/products/:productId/reviews\", async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const reviews = await storage.getProductReviews(productId);\n      res.json(reviews);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/products/:productId/reviews\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { productId } = req.params;\n      const userId = (req.user as any).id;\n      const reviewData = insertProductReviewSchema.parse({\n        ...req.body,\n        productId,\n        userId\n      });\n      const review = await storage.createProductReview(reviewData);\n      res.json(review);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // ========================\n  // REFERRAL ROUTES\n  // ========================\n\n  // Get user's referral statistics and earnings\n  app.get(\"/api/referrals/stats\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      let user = (req.user as any);\n      \n      // Generate referral code if user doesn't have one\n      let referralCode = user.referralCode;\n      if (!referralCode) {\n        referralCode = Math.random().toString(36).substring(2, 8).toUpperCase();\n        await storage.updateUser(userId, { referralCode });\n        // Update the user object in the session\n        user.referralCode = referralCode;\n      }\n      \n      const [referrals, earnings] = await Promise.all([\n        storage.getUserReferrals(userId),\n        storage.getUserReferralEarnings(userId)\n      ]);\n\n      res.json({\n        referralCode,\n        planTier: user.subscriptionTier,\n        totalReferrals: referrals.length,\n        earnings,\n        recentReferrals: referrals.slice(0, 10) // Last 10 referrals\n      });\n    } catch (error: any) {\n      console.error('Error fetching referral stats:', error);\n      res.status(500).json({ message: \"Error fetching referral statistics\" });\n    }\n  });\n\n  // Process a new referral signup\n  app.post(\"/api/referrals/process\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { referredUserId, referredPlanTier, referredPlanPrice } = req.body;\n      const referrerId = (req.user as any).id;\n      const referrerUser = await storage.getUser(referrerId);\n      \n      if (!referrerUser) {\n        return res.status(404).json({ message: \"Referrer not found\" });\n      }\n\n      if (!isValidSubscriptionTier(referredPlanTier)) {\n        return res.status(400).json({ message: \"Invalid subscription tier\" });\n      }\n\n      // Calculate commission based on referrer's tier cap\n      const commission = calculateReferralCommission(\n        referrerUser.subscriptionTier || 'basic',\n        referredPlanTier\n      );\n\n      const referralData = insertReferralSchema.parse({\n        referrerId,\n        referredId: referredUserId,\n        referrerPlanTier: referrerUser.subscriptionTier,\n        referredPlanTier,\n        referredPlanPrice: referredPlanPrice.toString(),\n        commissionAmount: commission.commissionAmount.toString(),\n        eligibleTier: commission.eligibleTier\n      });\n\n      const referral = await storage.createReferral(referralData);\n      \n      res.json({\n        success: true,\n        referral,\n        commission: {\n          amount: commission.commissionAmount,\n          eligibleTier: commission.eligibleTier,\n          originalPrice: commission.eligiblePrice\n        }\n      });\n    } catch (error: any) {\n      console.error('Error processing referral:', error);\n      res.status(500).json({ message: \"Error processing referral\" });\n    }\n  });\n\n  // Get referral commission preview (what user would earn for different tiers)\n  app.get(\"/api/referrals/commission-preview\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const user = (req.user as any);\n      const referrerTier = user.subscriptionTier;\n\n      // Show actual commission rates for each tier (not capped by referrer tier)\n      const previews = {\n        basic: calculateReferralCommission(\"basic\", \"basic\"),\n        professional: calculateReferralCommission(\"professional\", \"professional\"),\n        master: calculateReferralCommission(\"master\", \"master\")\n      };\n\n      res.json({\n        referrerTier,\n        commissionPreviews: previews,\n        note: \"Commission is capped at your current plan tier or lower\"\n      });\n    } catch (error: any) {\n      console.error('Error generating commission preview:', error);\n      res.status(500).json({ message: \"Error generating commission preview\" });\n    }\n  });\n\n  // Monthly commission tracking endpoints\n  app.get(\"/api/referrals/monthly-commissions\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { month } = req.query;\n      \n      const commissions = await storage.getMonthlyCommissions(userId, month as string);\n      \n      res.json({\n        commissions,\n        total: commissions.reduce((sum, c) => sum + Number(c.commissionAmount), 0),\n        unpaid: commissions.filter(c => !c.isPaid).reduce((sum, c) => sum + Number(c.commissionAmount), 0)\n      });\n    } catch (error: any) {\n      console.error('Error fetching monthly commissions:', error);\n      res.status(500).json({ message: \"Error fetching monthly commissions\" });\n    }\n  });\n\n  app.get(\"/api/referrals/monthly-earnings-summary\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      \n      // Get all monthly commissions\n      const allCommissions = await storage.getMonthlyCommissions(userId);\n      \n      // Group by month and calculate totals\n      const monthlyBreakdown = allCommissions.reduce((acc, commission) => {\n        const month = commission.commissionMonth;\n        if (!acc[month]) {\n          acc[month] = {\n            month,\n            total: 0,\n            paid: 0,\n            unpaid: 0,\n            count: 0\n          };\n        }\n        \n        const amount = Number(commission.commissionAmount);\n        acc[month].total += amount;\n        acc[month].count += 1;\n        \n        if (commission.isPaid) {\n          acc[month].paid += amount;\n        } else {\n          acc[month].unpaid += amount;\n        }\n        \n        return acc;\n      }, {} as Record<string, any>);\n      \n      const summary = {\n        totalMonthlyEarnings: Object.values(monthlyBreakdown).reduce((sum: number, month: any) => sum + month.total, 0),\n        unpaidMonthlyEarnings: Object.values(monthlyBreakdown).reduce((sum: number, month: any) => sum + month.unpaid, 0),\n        monthlyBreakdown: Object.values(monthlyBreakdown).sort((a: any, b: any) => b.month.localeCompare(a.month))\n      };\n      \n      res.json(summary);\n    } catch (error: any) {\n      console.error('Error fetching monthly earnings summary:', error);\n      res.status(500).json({ message: \"Error fetching monthly earnings summary\" });\n    }\n  });\n\n  // Lead Magnet Download API\n  app.post(\"/api/lead-magnet/download\", async (req, res) => {\n    try {\n      const { email, firstName, lastName, companyName, position } = req.body;\n      \n      if (!email || !firstName || !lastName || !companyName) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      // Store lead magnet download record\n      const [leadRecord] = await db.insert(leadMagnetDownloads).values({\n        email,\n        firstName,\n        lastName,\n        companyName,\n        position: position || null,\n        leadSource: \"website\",\n        emailSent: true\n      }).returning();\n\n      // Start lead nurture email sequence\n      await emailAutomation.queueEmailSequence(\n        email,\n        `${firstName} ${lastName}`,\n        \"employer_onboarding\"\n      );\n\n      // Send immediate download email with lead magnet\n      await emailService.sendEmail({\n        to: email,\n        subject: \"ðŸ“‹ Your FREE Louisiana Plumbing Code Guide + Bonus Tools\",\n        html: `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <div style=\"background: linear-gradient(135deg, #1e40af 0%, #059669 100%); color: white; padding: 30px; text-align: center;\">\n              <h1 style=\"margin: 0; font-size: 24px;\">ðŸŽ‰ Your Louisiana Code Guide is Ready!</h1>\n            </div>\n            \n            <div style=\"padding: 30px; background: #f9fafb;\">\n              <p style=\"font-size: 18px; color: #374151;\">Hi ${firstName},</p>\n              \n              <p style=\"color: #6b7280; line-height: 1.6;\">\n                Thank you for downloading our Louisiana Plumbing Code Quick Reference Guide! \n                This comprehensive resource will help you avoid costly code violations and stay compliant on every job.\n              </p>\n              \n              <div style=\"background: white; border: 2px solid #10b981; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n                <h2 style=\"color: #059669; margin-top: 0;\">ðŸ“¥ Download Your Resources:</h2>\n                <ul style=\"color: #374151; line-height: 1.8;\">\n                  <li><strong>Louisiana Plumbing Code Guide (15 pages)</strong> - Essential violations to avoid</li>\n                  <li><strong>BONUS: Pipe Sizing Calculator Tool</strong> - Professional calculations made easy</li>\n                  <li><strong>BONUS: Code Update Checklist</strong> - Stay current with 2024 changes</li>\n                </ul>\n                \n                <div style=\"text-align: center; margin: 25px 0;\">\n                  <a href=\"${process.env.WEBSITE_URL || 'https://laplumbprep.com'}/downloads/louisiana-code-guide.pdf?email=${encodeURIComponent(email)}\" \n                     style=\"background: #059669; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;\">\n                    ðŸ“¥ Download Guide & Tools\n                  </a>\n                </div>\n              </div>\n              \n              <div style=\"background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0;\">\n                <h3 style=\"color: #92400e; margin-top: 0;\">ðŸ’¡ Pro Tip:</h3>\n                <p style=\"color: #92400e; margin-bottom: 0;\">\n                  Print the guide and keep it on every job site. Many contractors save $1,000+ \n                  per project by catching code issues before inspections!\n                </p>\n              </div>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <p style=\"color: #6b7280;\">Want to take your skills to the next level?</p>\n                <a href=\"${process.env.WEBSITE_URL || 'https://laplumbprep.com'}/courses\" \n                   style=\"background: #1e40af; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px;\">\n                  View Our Certification Courses\n                </a>\n              </div>\n              \n              <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n              \n              <p style=\"color: #9ca3af; font-size: 14px; text-align: center;\">\n                Questions? Reply to this email or contact us at support@laplumbprep.com<br>\n                Louisiana Plumbing Prep | Your Path to Certification Success\n              </p>\n            </div>\n          </div>\n        `\n      });\n\n      res.status(200).json({ \n        message: \"Download link sent successfully\",\n        leadId: leadRecord.id\n      });\n    } catch (error: any) {\n      console.error(\"Error processing lead magnet download:\", error);\n      res.status(500).json({ message: \"Failed to send download link\" });\n    }\n  });\n\n  // Student Lead Magnet Download API\n  app.post(\"/api/student-lead-magnet/download\", async (req, res) => {\n    try {\n      const { email, firstName, lastName, currentLevel, goals } = req.body;\n      \n      if (!email || !firstName || !lastName || !currentLevel) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      // Store student lead magnet download record\n      const [leadRecord] = await db.insert(studentLeadMagnetDownloads).values({\n        email,\n        firstName,\n        lastName,\n        currentLevel,\n        goals: goals || null,\n        leadSource: \"website\",\n        emailSent: true\n      }).returning();\n\n      // Start student enrollment email sequence  \n      await emailAutomation.queueEmailSequence(\n        email,\n        `${firstName} ${lastName}`,\n        \"student_enrollment\"\n      );\n\n      // Send immediate download email with student career guide\n      await emailService.sendEmail({\n        to: email,\n        subject: \"ðŸš€ Your FREE Louisiana Plumbing Career Roadmap + Study Materials\",\n        html: `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <div style=\"background: linear-gradient(135deg, #7c3aed 0%, #2563eb 100%); color: white; padding: 30px; text-align: center;\">\n              <h1 style=\"margin: 0; font-size: 24px;\">ðŸŽ‰ Your Career Roadmap is Ready!</h1>\n            </div>\n            \n            <div style=\"padding: 30px; background: #f9fafb;\">\n              <p style=\"font-size: 18px; color: #374151;\">Hi ${firstName},</p>\n              \n              <p style=\"color: #6b7280; line-height: 1.6;\">\n                Congratulations on taking the first step toward building a successful $75,000+ plumbing career in Louisiana! \n                Your complete career roadmap and bonus study materials are ready for download.\n              </p>\n              \n              <div style=\"background: white; border: 2px solid #7c3aed; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n                <h2 style=\"color: #7c3aed; margin-top: 0;\">ðŸ“¥ Download Your Career Resources:</h2>\n                <ul style=\"color: #374151; line-height: 1.8;\">\n                  <li><strong>Louisiana Plumbing Career Roadmap (20 pages)</strong> - Complete path from apprentice to master</li>\n                  <li><strong>Salary Progression Guide</strong> - Real Louisiana wages from $35K to $85K+</li>\n                  <li><strong>BONUS: Practice Test Pack</strong> - Journeyman prep questions (Value: $67)</li>\n                  <li><strong>BONUS: Study Flashcards</strong> - 200+ code questions (Value: $37)</li>\n                  <li><strong>BONUS: Certification Timeline</strong> - When to get each license (Value: $23)</li>\n                </ul>\n                \n                <div style=\"text-align: center; margin: 25px 0;\">\n                  <a href=\"${process.env.WEBSITE_URL || 'https://laplumbprep.com'}/downloads/louisiana-career-roadmap.pdf?email=${encodeURIComponent(email)}\" \n                     style=\"background: #7c3aed; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;\">\n                    ðŸ“¥ Download Career Roadmap & Bonuses\n                  </a>\n                </div>\n              </div>\n              \n              <div style=\"background: #ddd6fe; border-left: 4px solid #7c3aed; padding: 15px; margin: 20px 0;\">\n                <h3 style=\"color: #5b21b6; margin-top: 0;\">ðŸ’¡ Your Next Steps:</h3>\n                <p style=\"color: #5b21b6; margin-bottom: 0;\">\n                  Based on your current level (${currentLevel}), we recommend starting with our Louisiana Journeyman Prep course. \n                  Students typically see a $15,000-$25,000 salary increase within 12 months of certification!\n                </p>\n              </div>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <p style=\"color: #6b7280;\">Ready to start your certification journey?</p>\n                <a href=\"${process.env.WEBSITE_URL || 'https://laplumbprep.com'}/courses\" \n                   style=\"background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px;\">\n                  ðŸŽ¯ View Certification Courses\n                </a>\n              </div>\n              \n              <div style=\"background: #ecfdf5; border-radius: 8px; padding: 20px; margin: 20px 0; text-align: center;\">\n                <h3 style=\"color: #059669; margin-top: 0;\">ðŸ”¥ Early Bird Special</h3>\n                <p style=\"color: #065f46; margin-bottom: 10px;\">\n                  As a career roadmap download, you get exclusive access to:\n                </p>\n                <ul style=\"color: #065f46; text-align: left; max-width: 400px; margin: 0 auto;\">\n                  <li>25% off your first certification course</li>\n                  <li>Free 1-on-1 career planning session</li>\n                  <li>Priority access to new courses</li>\n                  <li>Weekly tips from Louisiana master plumbers</li>\n                </ul>\n              </div>\n              \n              <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n              \n              <p style=\"color: #9ca3af; font-size: 14px; text-align: center;\">\n                Questions about your career path? Reply to this email or contact us at support@laplumbprep.com<br>\n                Louisiana Plumbing Prep | Your Path to $75K+ Career Success\n              </p>\n            </div>\n          </div>\n        `\n      });\n\n      res.status(200).json({ \n        message: \"Career roadmap sent successfully\",\n        leadId: leadRecord.id\n      });\n    } catch (error: any) {\n      console.error(\"Error processing student lead magnet download:\", error);\n      res.status(500).json({ message: \"Failed to send career roadmap\" });\n    }\n  });\n\n  // PDF routes moved to beginning of file for priority\n\n  // Test endpoint to check email credentials\n  app.get(\"/api/check-email-config\", async (req, res) => {\n    try {\n      const config = {\n        noreply_user: process.env.NOREPLY_USER ? `${process.env.NOREPLY_USER.substring(0, 3)}***` : 'NOT SET',\n        noreply_pass: process.env.NOREPLY_PASS ? 'SET (hidden)' : 'NOT SET',\n        support_user: process.env.SUPPORT_USER ? `${process.env.SUPPORT_USER.substring(0, 3)}***` : 'NOT SET',\n        support_pass: process.env.SUPPORT_PASS ? 'SET (hidden)' : 'NOT SET',\n        referrals_user: process.env.REFERRALS_USER ? `${process.env.REFERRALS_USER.substring(0, 3)}***` : 'NOT SET',\n        referrals_pass: process.env.REFERRALS_PASS ? 'SET (hidden)' : 'NOT SET'\n      };\n      res.json(config);\n    } catch (error: any) {\n      res.status(500).json({ error: \"Failed to check config\" });\n    }\n  });\n\n  // Test endpoint to send actual emails\n  app.post(\"/api/test-email-delivery\", async (req, res) => {\n    const { type = \"contractor\", email = \"laplumbprep@gmail.com\" } = req.body;\n    \n    try {\n      console.log(`Testing email delivery for ${type} to ${email}`);\n      \n      if (type === \"contractor\") {\n        const emailHtml = `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <div style=\"background: linear-gradient(135deg, #1e40af 0%, #059669 100%); color: white; padding: 30px; text-align: center;\">\n              <h1 style=\"margin: 0; font-size: 24px;\">ðŸŽ‰ Your Louisiana Code Guide is Ready!</h1>\n            </div>\n            <div style=\"padding: 30px; background: #f9fafb;\">\n              <p style=\"font-size: 18px; color: #374151;\">Hi Louisiana Plumber,</p>\n              <p style=\"color: #6b7280; line-height: 1.6;\">\n                Thank you for downloading our Louisiana Plumbing Code Quick Reference Guide! \n                This comprehensive resource will help you avoid costly code violations and stay compliant on every job.\n              </p>\n              <div style=\"background: white; border: 2px solid #10b981; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n                <h2 style=\"color: #059669; margin-top: 0;\">ðŸ“¥ Download Your Resources:</h2>\n                <div style=\"text-align: center; margin: 25px 0;\">\n                  <a href=\"https://laplumbprep.com/downloads/louisiana-code-guide.pdf\" \n                     style=\"background: #059669; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;\">\n                    ðŸ“¥ Download Guide & Tools\n                  </a>\n                </div>\n              </div>\n            </div>\n          </div>\n        `;\n        \n        await emailService.sendEmail({\n          to: email,\n          subject: \"ðŸŽ‰ Your Louisiana Code Guide is Ready for Download!\",\n          html: emailHtml\n        });\n        \n      } else if (type === \"student\") {\n        const emailHtml = `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <div style=\"background: linear-gradient(135deg, #7c3aed 0%, #2563eb 100%); color: white; padding: 30px; text-align: center;\">\n              <h1 style=\"margin: 0; font-size: 24px;\">ðŸŽ‰ Your Career Roadmap is Ready!</h1>\n            </div>\n            <div style=\"padding: 30px; background: #f9fafb;\">\n              <p style=\"font-size: 18px; color: #374151;\">Hi Future Plumber,</p>\n              <p style=\"color: #6b7280; line-height: 1.6;\">\n                Congratulations on taking the first step toward building a successful $75,000+ plumbing career in Louisiana! \n                Your complete career roadmap and bonus study materials are ready for download.\n              </p>\n              <div style=\"background: white; border: 2px solid #7c3aed; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n                <h2 style=\"color: #7c3aed; margin-top: 0;\">ðŸ“¥ Download Your Career Resources:</h2>\n                <div style=\"text-align: center; margin: 25px 0;\">\n                  <a href=\"https://laplumbprep.com/downloads/louisiana-career-roadmap.pdf\" \n                     style=\"background: #7c3aed; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;\">\n                    ðŸ“¥ Download Career Roadmap & Bonuses\n                  </a>\n                </div>\n              </div>\n            </div>\n          </div>\n        `;\n        \n        await emailService.sendEmail({\n          to: email,\n          subject: \"ðŸŽ‰ Your Louisiana Plumbing Career Roadmap is Ready!\",\n          html: emailHtml\n        });\n      }\n      \n      console.log(`Email sent successfully to ${email}`);\n      res.json({ \n        success: true, \n        message: `Test ${type} email sent successfully to ${email}`,\n        type: type\n      });\n      \n    } catch (error: any) {\n      console.error(\"Email delivery test failed:\", error);\n      res.status(500).json({ \n        success: false, \n        error: \"Email delivery failed\", \n        details: error.message,\n        type: type\n      });\n    }\n  });\n\n  // Test endpoint to preview lead magnet emails\n  app.get(\"/api/preview-emails/:type\", async (req, res) => {\n    const { type } = req.params;\n    const firstName = \"Louisiana\";\n    const lastName = \"Plumbing Prep\";\n    const currentLevel = \"Apprentice\";\n    \n    try {\n      if (type === \"contractor\") {\n        const emailHtml = `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <div style=\"background: linear-gradient(135deg, #1e40af 0%, #059669 100%); color: white; padding: 30px; text-align: center;\">\n              <h1 style=\"margin: 0; font-size: 24px;\">ðŸŽ‰ Your Louisiana Code Guide is Ready!</h1>\n            </div>\n            \n            <div style=\"padding: 30px; background: #f9fafb;\">\n              <p style=\"font-size: 18px; color: #374151;\">Hi ${firstName},</p>\n              \n              <p style=\"color: #6b7280; line-height: 1.6;\">\n                Thank you for downloading our Louisiana Plumbing Code Quick Reference Guide! \n                This comprehensive resource will help you avoid costly code violations and stay compliant on every job.\n              </p>\n              \n              <div style=\"background: white; border: 2px solid #10b981; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n                <h2 style=\"color: #059669; margin-top: 0;\">ðŸ“¥ Download Your Resources:</h2>\n                <ul style=\"color: #374151; line-height: 1.8;\">\n                  <li><strong>Louisiana Plumbing Code Guide (15 pages)</strong> - Essential violations to avoid</li>\n                  <li><strong>BONUS: Pipe Sizing Calculator Tool</strong> - Professional calculations made easy</li>\n                  <li><strong>BONUS: Code Update Checklist</strong> - Stay current with 2024 changes</li>\n                </ul>\n                \n                <div style=\"text-align: center; margin: 25px 0;\">\n                  <a href=\"https://laplumbprep.com/downloads/louisiana-code-guide.pdf\" \n                     style=\"background: #059669; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;\">\n                    ðŸ“¥ Download Guide & Tools\n                  </a>\n                </div>\n              </div>\n              \n              <div style=\"background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0;\">\n                <h3 style=\"color: #92400e; margin-top: 0;\">ðŸ’¡ Pro Tip:</h3>\n                <p style=\"color: #92400e; margin-bottom: 0;\">\n                  Print the guide and keep it on every job site. Many contractors save $1,000+ \n                  per project by catching code issues before inspections!\n                </p>\n              </div>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <p style=\"color: #6b7280;\">Want to take your skills to the next level?</p>\n                <a href=\"https://laplumbprep.com/courses\" \n                   style=\"background: #1e40af; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px;\">\n                  View Our Certification Courses\n                </a>\n              </div>\n              \n              <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n              \n              <p style=\"color: #9ca3af; font-size: 14px; text-align: center;\">\n                Questions? Reply to this email or contact us at support@laplumbprep.com<br>\n                Louisiana Plumbing Prep | Your Path to Certification Success\n              </p>\n            </div>\n          </div>\n        `;\n        \n        res.setHeader('Content-Type', 'text/html');\n        res.send(emailHtml);\n        \n      } else if (type === \"student\") {\n        const emailHtml = `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <div style=\"background: linear-gradient(135deg, #7c3aed 0%, #2563eb 100%); color: white; padding: 30px; text-align: center;\">\n              <h1 style=\"margin: 0; font-size: 24px;\">ðŸŽ‰ Your Career Roadmap is Ready!</h1>\n            </div>\n            \n            <div style=\"padding: 30px; background: #f9fafb;\">\n              <p style=\"font-size: 18px; color: #374151;\">Hi ${firstName},</p>\n              \n              <p style=\"color: #6b7280; line-height: 1.6;\">\n                Congratulations on taking the first step toward building a successful $75,000+ plumbing career in Louisiana! \n                Your complete career roadmap and bonus study materials are ready for download.\n              </p>\n              \n              <div style=\"background: white; border: 2px solid #7c3aed; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n                <h2 style=\"color: #7c3aed; margin-top: 0;\">ðŸ“¥ Download Your Career Resources:</h2>\n                <ul style=\"color: #374151; line-height: 1.8;\">\n                  <li><strong>Louisiana Plumbing Career Roadmap (20 pages)</strong> - Complete path from apprentice to master</li>\n                  <li><strong>Salary Progression Guide</strong> - Real Louisiana wages from $35K to $85K+</li>\n                  <li><strong>BONUS: Practice Test Pack</strong> - Journeyman prep questions (Value: $67)</li>\n                  <li><strong>BONUS: Study Flashcards</strong> - 200+ code questions (Value: $37)</li>\n                  <li><strong>BONUS: Certification Timeline</strong> - When to get each license (Value: $23)</li>\n                </ul>\n                \n                <div style=\"text-align: center; margin: 25px 0;\">\n                  <a href=\"https://laplumbprep.com/downloads/louisiana-career-roadmap.pdf\" \n                     style=\"background: #7c3aed; color: white; padding: 15px 30px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block;\">\n                    ðŸ“¥ Download Career Roadmap & Bonuses\n                  </a>\n                </div>\n              </div>\n              \n              <div style=\"background: #ddd6fe; border-left: 4px solid #7c3aed; padding: 15px; margin: 20px 0;\">\n                <h3 style=\"color: #5b21b6; margin-top: 0;\">ðŸ’¡ Your Next Steps:</h3>\n                <p style=\"color: #5b21b6; margin-bottom: 0;\">\n                  Based on your current level (${currentLevel}), we recommend starting with our Louisiana Journeyman Prep course. \n                  Students typically see a $15,000-$25,000 salary increase within 12 months of certification!\n                </p>\n              </div>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <p style=\"color: #6b7280;\">Ready to start your certification journey?</p>\n                <a href=\"https://laplumbprep.com/courses\" \n                   style=\"background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px;\">\n                  ðŸŽ¯ View Certification Courses\n                </a>\n              </div>\n              \n              <div style=\"background: #ecfdf5; border-radius: 8px; padding: 20px; margin: 20px 0; text-align: center;\">\n                <h3 style=\"color: #059669; margin-top: 0;\">ðŸ”¥ Early Bird Special</h3>\n                <p style=\"color: #065f46; margin-bottom: 10px;\">\n                  As a career roadmap download, you get exclusive access to:\n                </p>\n                <ul style=\"color: #065f46; text-align: left; max-width: 400px; margin: 0 auto;\">\n                  <li>25% off your first certification course</li>\n                  <li>Free 1-on-1 career planning session</li>\n                  <li>Priority access to new courses</li>\n                  <li>Weekly tips from Louisiana master plumbers</li>\n                </ul>\n              </div>\n              \n              <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n              \n              <p style=\"color: #9ca3af; font-size: 14px; text-align: center;\">\n                Questions about your career path? Reply to this email or contact us at support@laplumbprep.com<br>\n                Louisiana Plumbing Prep | Your Path to $75K+ Career Success\n              </p>\n            </div>\n          </div>\n        `;\n        \n        res.setHeader('Content-Type', 'text/html');\n        res.send(emailHtml);\n        \n      } else {\n        res.status(400).json({ error: \"Invalid email type. Use 'contractor' or 'student'\" });\n      }\n    } catch (error: any) {\n      console.error(\"Error generating email preview:\", error);\n      res.status(500).json({ error: \"Failed to generate email preview\" });\n    }\n  });\n\n  // ===== ADMIN ANALYTICS API ROUTES =====\n\n  // Get system analytics data\n  app.get(\"/api/admin/analytics\", async (req, res) => {\n    try {\n      const timeRange = parseInt(req.query.timeRange as string) || 30;\n      const startDate = new Date();\n      startDate.setDate(startDate.getDate() - timeRange);\n\n      // Total Users Count\n      const [totalUsersResult] = await db.select({ count: count() }).from(users);\n      const totalUsers = totalUsersResult.count;\n\n      // New Signups in time range\n      const [newSignupsResult] = await db\n        .select({ count: count() })\n        .from(users)\n        .where(gte(users.createdAt, startDate));\n      const newSignups = newSignupsResult.count;\n\n      // Active Students (users with any subscription tier - enrolled users)\n      const [activeStudentsResult] = await db\n        .select({ count: count() })\n        .from(users)\n        .where(and(\n          eq(users.isActive, true),\n          or(\n            eq(users.subscriptionTier, 'basic'),\n            eq(users.subscriptionTier, 'professional'),\n            eq(users.subscriptionTier, 'master')\n          )\n        ));\n      const activeStudents = activeStudentsResult.count;\n\n      // Course Completions (lesson steps completed)\n      const [courseCompletionsResult] = await db\n        .select({ count: count() })\n        .from(lessonStepProgress)\n        .where(and(\n          eq(lessonStepProgress.isCompleted, true),\n          gte(lessonStepProgress.completedAt, startDate)\n        ));\n      const courseCompletions = courseCompletionsResult.count;\n\n      // Revenue calculation based on active paid subscriptions\n      const [professionalUsersResult] = await db\n        .select({ count: count() })\n        .from(users)\n        .where(and(\n          eq(users.subscriptionTier, 'professional'),\n          eq(users.isActive, true)\n        ));\n      \n      const [masterUsersResult] = await db\n        .select({ count: count() })\n        .from(users)\n        .where(and(\n          eq(users.subscriptionTier, 'master'),\n          eq(users.isActive, true)\n        ));\n\n      // Estimate revenue (professional: $29.99, master: $49.99 - using beta pricing)\n      const estimatedRevenue = (professionalUsersResult.count * 29.99) + (masterUsersResult.count * 49.99);\n\n      // Job Applications count\n      const [jobApplicationsCountResult] = await db\n        .select({ count: count() })\n        .from(jobApplications)\n        .where(gte(jobApplications.appliedAt, startDate));\n      const jobApplicationsCount = jobApplicationsCountResult.count;\n\n      // Beta Feedback Score (basic score - would need proper response parsing)\n      const [feedbackCountResult] = await db\n        .select({ count: count() })\n        .from(betaFeedbackResponses)\n        .where(gte(betaFeedbackResponses.completedAt, startDate));\n      \n      // Simplified feedback score (just count responses for now)\n      const betaFeedbackScore = feedbackCountResult.count > 0 ? 4.2 : 0;\n      \n\n      // Subscription conversion rate (paid vs total)\n      const paidUsers = professionalUsersResult.count + masterUsersResult.count;\n      const subscriptionConversions = totalUsers > 0 ? Math.round((paidUsers / totalUsers) * 100) : 0;\n\n      // Calculate additional business metrics\n      // Average Revenue per User (ARPU)\n      const arpu = activeStudents > 0 ? Math.round(estimatedRevenue / activeStudents) : 0;\n      \n      // Referral commissions paid (would be calculated from actual referral data)\n      const referralCommissionsPaid = Math.round(estimatedRevenue * 0.08); // Estimate 8% commission rate\n      \n      // AI Tool Usage (count from mentor conversations or other AI interactions)\n      const [aiToolUsageResult] = await db\n        .select({ count: count() })\n        .from(mentorConversations)\n        .where(gte(mentorConversations.createdAt, startDate));\n      const aiToolUsage = aiToolUsageResult.count;\n      \n      // Average session duration (placeholder - would need session tracking)\n      const avgSessionDuration = 24; // minutes - would be calculated from real session data\n      \n      // Course progress rate (percentage of enrolled students with progress)\n      const [studentsWithProgressResult] = await db\n        .select({ count: count() })\n        .from(lessonStepProgress)\n        .innerJoin(users, eq(lessonStepProgress.userId, users.id))\n        .where(eq(users.isActive, true));\n      \n      const courseProgressRate = activeStudents > 0 \n        ? Math.round((studentsWithProgressResult.count / activeStudents) * 100)\n        : 0;\n\n      const analytics = {\n        totalUsers,\n        activeStudents,\n        totalRevenue: Math.round(estimatedRevenue),\n        courseCompletions,\n        newSignups,\n        subscriptionConversions,\n        jobApplications: jobApplicationsCount,\n        betaFeedbackScore,\n        arpu,\n        referralCommissionsPaid,\n        aiToolUsage,\n        avgSessionDuration,\n        courseProgressRate\n      };\n\n      res.json(analytics);\n    } catch (error: any) {\n      console.error(\"Error fetching analytics:\", error);\n      res.status(500).json({ error: \"Failed to fetch analytics\" });\n    }\n  });\n\n  // Get course-specific analytics\n  app.get(\"/api/admin/course-analytics\", async (req, res) => {\n    try {\n      // Count enrolled students for Journeyman course (users with any subscription)\n      const [journeymanEnrolledResult] = await db\n        .select({ count: count() })\n        .from(users)\n        .where(and(\n          eq(users.isActive, true),\n          or(\n            eq(users.subscriptionTier, 'basic'),\n            eq(users.subscriptionTier, 'professional'),\n            eq(users.subscriptionTier, 'master')\n          )\n        ));\n      const journeymanEnrolled = journeymanEnrolledResult.count;\n\n      // Calculate average progress for Journeyman course (percentage of completed steps)\n      const [totalStepsResult] = await db\n        .select({ count: count() })\n        .from(lessonStepProgress)\n        .innerJoin(users, eq(lessonStepProgress.userId, users.id))\n        .where(eq(users.isActive, true));\n      \n      const [completedStepsResult] = await db\n        .select({ count: count() })\n        .from(lessonStepProgress)\n        .innerJoin(users, eq(lessonStepProgress.userId, users.id))\n        .where(and(\n          eq(users.isActive, true),\n          eq(lessonStepProgress.isCompleted, true)\n        ));\n      \n      const journeymanProgress = totalStepsResult.count > 0 \n        ? Math.round((completedStepsResult.count / totalStepsResult.count) * 100) \n        : 0;\n\n      // Calculate completion rate (unique students who completed any lessons vs total enrolled)\n      const uniqueCompletedStudentsResult = await db\n        .selectDistinct({ userId: lessonStepProgress.userId })\n        .from(lessonStepProgress)\n        .innerJoin(users, eq(lessonStepProgress.userId, users.id))\n        .where(and(\n          eq(lessonStepProgress.isCompleted, true),\n          eq(users.isActive, true)\n        ));\n      \n      const uniqueCompletedStudents = uniqueCompletedStudentsResult.length;\n      const journeymanCompletion = journeymanEnrolled > 0 \n        ? Math.round((uniqueCompletedStudents / journeymanEnrolled) * 100) \n        : 0;\n\n      // For backflow waitlist, count users interested\n      // Since we don't have a waitlist table yet, count inactive courses or use 0\n      const backflowWaitlist = 0; // No active waitlist system implemented yet\n\n      const courseStats = {\n        journeymanEnrolled,\n        journeymanProgress,\n        journeymanCompletion,\n        backflowWaitlist\n      };\n\n      res.json(courseStats);\n    } catch (error: any) {\n      console.error(\"Error fetching course analytics:\", error);\n      res.status(500).json({ error: \"Failed to fetch course analytics\" });\n    }\n  });\n\n  // Delete all non-admin users (cleanup operation)\n  app.delete(\"/api/admin/cleanup-users\", async (req, res) => {\n    try {\n      // Safety check - only proceed if explicitly confirmed\n      const { confirmDelete } = req.body;\n      if (!confirmDelete) {\n        return res.status(400).json({ error: \"Deletion must be explicitly confirmed\" });\n      }\n\n      // Get admin user email to preserve\n      const adminEmail = \"admin@latrainer.com\";\n      \n      // Get all non-admin users\n      const usersToDelete = await db\n        .select({ id: users.id, email: users.email })\n        .from(users)\n        .where(ne(users.email, adminEmail));\n\n      if (usersToDelete.length === 0) {\n        return res.json({ message: \"No non-admin users to delete\", deletedCount: 0 });\n      }\n\n      const userIds = usersToDelete.map(u => u.id);\n\n      // Delete related data first (to avoid foreign key constraints)\n      // Delete user progress data\n      await db.delete(lessonStepProgress).where(inArray(lessonStepProgress.userId, userIds));\n      await db.delete(sectionProgress).where(inArray(sectionProgress.userId, userIds));\n      \n      // Delete user content\n      await db.delete(mentorConversations).where(inArray(mentorConversations.userId, userIds));\n      await db.delete(studyCompanionMessages).where(inArray(studyCompanionMessages.userId, userIds));\n      await db.delete(cartItems).where(inArray(cartItems.userId, userIds));\n      await db.delete(jobApplications).where(inArray(jobApplications.userId, userIds));\n      await db.delete(betaFeedbackResponses).where(inArray(betaFeedbackResponses.userId, userIds));\n      \n      // Finally delete the users themselves\n      const deletedUsers = await db.delete(users).where(inArray(users.id, userIds)).returning();\n\n      console.log(`Deleted ${deletedUsers.length} non-admin users`);\n      \n      res.json({ \n        message: `Successfully deleted ${deletedUsers.length} non-admin users`,\n        deletedCount: deletedUsers.length,\n        deletedUsers: usersToDelete.map(u => ({ id: u.id, email: u.email }))\n      });\n    } catch (error: any) {\n      console.error(\"Error during user cleanup:\", error);\n      res.status(500).json({ error: \"Failed to cleanup users\" });\n    }\n  });\n\n  // Get list of enrolled students\n  app.get(\"/api/admin/students\", async (req, res) => {\n    try {\n      const page = parseInt(req.query.page as string) || 1;\n      const limit = parseInt(req.query.limit as string) || 50;\n      const offset = (page - 1) * limit;\n\n      // Get enrolled students (users with any subscription tier)\n      const students = await db\n        .select({\n          id: users.id,\n          email: users.email,\n          firstName: users.firstName,\n          lastName: users.lastName,\n          subscriptionTier: users.subscriptionTier,\n          isActive: users.isActive,\n          isBetaTester: users.isBetaTester,\n          createdAt: users.createdAt,\n          lastLoginDate: users.lastLoginDate\n        })\n        .from(users)\n        .where(and(\n          eq(users.isActive, true),\n          or(\n            eq(users.subscriptionTier, 'basic'),\n            eq(users.subscriptionTier, 'professional'),\n            eq(users.subscriptionTier, 'master')\n          )\n        ))\n        .orderBy(desc(users.createdAt))\n        .limit(limit)\n        .offset(offset);\n\n      // Get total count for pagination\n      const [totalResult] = await db\n        .select({ count: count() })\n        .from(users)\n        .where(and(\n          eq(users.isActive, true),\n          or(\n            eq(users.subscriptionTier, 'basic'),\n            eq(users.subscriptionTier, 'professional'),\n            eq(users.subscriptionTier, 'master')\n          )\n        ));\n\n      const total = totalResult.count;\n      const totalPages = Math.ceil(total / limit);\n\n      res.json({\n        students,\n        pagination: {\n          page,\n          limit,\n          total,\n          totalPages,\n          hasNext: page < totalPages,\n          hasPrev: page > 1\n        }\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching students:\", error);\n      res.status(500).json({ error: \"Failed to fetch students\" });\n    }\n  });\n\n  // ===== GAMIFICATION API ROUTES =====\n\n  // Get current monthly competition\n  app.get(\"/api/competitions/current\", async (req, res) => {\n    try {\n      const now = new Date();\n      const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n      \n      const competition = await storage.getCurrentCompetition(currentMonth);\n      res.json(competition);\n    } catch (error: any) {\n      console.error(\"Error fetching current competition:\", error);\n      res.status(500).json({ error: \"Failed to fetch competition\" });\n    }\n  });\n\n  // Get user's achievements\n  app.get(\"/api/achievements/user\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      const userId = req.user.id;\n      const achievements = await storage.getUserAchievements(userId);\n      res.json(achievements);\n    } catch (error: any) {\n      console.error(\"Error fetching user achievements:\", error);\n      res.status(500).json({ error: \"Failed to fetch achievements\" });\n    }\n  });\n\n  // Get leaderboard\n  app.get(\"/api/leaderboard\", async (req, res) => {\n    try {\n      const period = req.query.period as string || 'all_time'; // 'monthly', 'weekly', 'all_time'\n      const leaderboard = await storage.getLeaderboard(period);\n      res.json(leaderboard);\n    } catch (error: any) {\n      console.error(\"Error fetching leaderboard:\", error);\n      res.status(500).json({ error: \"Failed to fetch leaderboard\" });\n    }\n  });\n\n  // Start competition attempt\n  app.post(\"/api/competitions/:competitionId/start\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      const { competitionId } = req.params;\n      const userId = req.user.id;\n      \n      const attempt = await storage.startCompetitionAttempt(competitionId, userId);\n      res.json(attempt);\n    } catch (error: any) {\n      console.error(\"Error starting competition attempt:\", error);\n      res.status(500).json({ error: \"Failed to start competition\" });\n    }\n  });\n\n  // Submit competition attempt\n  app.post(\"/api/competitions/:competitionId/submit\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      const { competitionId } = req.params;\n      const userId = req.user.id;\n      const { answers, timeSpent } = req.body;\n      \n      const result = await storage.submitCompetitionAttempt(competitionId, userId, answers, timeSpent);\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"Error submitting competition attempt:\", error);\n      res.status(500).json({ error: \"Failed to submit competition\" });\n    }\n  });\n\n  // Get user's competition history\n  app.get(\"/api/competitions/history\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      const userId = req.user.id;\n      const history = await storage.getUserCompetitionHistory(userId);\n      res.json(history);\n    } catch (error: any) {\n      console.error(\"Error fetching competition history:\", error);\n      res.status(500).json({ error: \"Failed to fetch competition history\" });\n    }\n  });\n\n  // Award achievement (admin only)\n  app.post(\"/api/achievements/award\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      // Check if user is admin\n      if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n        return res.status(403).json({ error: \"Admin access required\" });\n      }\n\n      const { userId, achievementId } = req.body;\n      const achievement = await storage.awardAchievement(userId, achievementId);\n      res.json(achievement);\n    } catch (error: any) {\n      console.error(\"Error awarding achievement:\", error);\n      res.status(500).json({ error: \"Failed to award achievement\" });\n    }\n  });\n\n  // Get user points summary\n  app.get(\"/api/points/summary\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      const userId = req.user.id;\n      const summary = await storage.getUserPointsSummary(userId);\n      res.json(summary);\n    } catch (error: any) {\n      console.error(\"Error fetching points summary:\", error);\n      res.status(500).json({ error: \"Failed to fetch points summary\" });\n    }\n  });\n\n  // Get user notifications\n  app.get(\"/api/notifications\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      const userId = req.user.id;\n      const notifications = await competitionNotificationService.getUserNotifications(userId);\n      res.json(notifications);\n    } catch (error: any) {\n      console.error(\"Error fetching notifications:\", error);\n      res.status(500).json({ error: \"Failed to fetch notifications\" });\n    }\n  });\n\n  // Mark notification as read\n  app.post(\"/api/notifications/:notificationId/read\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    try {\n      const { notificationId } = req.params;\n      await competitionNotificationService.markNotificationRead(notificationId);\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error marking notification as read:\", error);\n      res.status(500).json({ error: \"Failed to mark notification as read\" });\n    }\n  });\n\n  // Admin Content Management Routes\n  // Get course content for management\n  app.get(\"/api/admin/course-content/:courseId\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    // Check if user is admin (simple check for now)\n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId } = req.params;\n      \n      // Get all course content for this course\n      const allContent = await storage.getCourseContent(courseId);\n      \n      // Separate content by type\n      const lessons = allContent.filter(content => content.type === 'lesson');\n      const chapters = allContent.filter(content => content.type === 'chapter');\n      const questions = allContent.filter(content => content.type === 'question');\n      \n      res.json({\n        lessons,\n        chapters,\n        questions\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching course content:\", error);\n      res.status(500).json({ error: \"Failed to fetch course content\" });\n    }\n  });\n\n  // Add new stats endpoint for overview counts\n  app.get(\"/api/admin/course-content/:courseId/stats\", async (req: any, res) => {\n    console.log('ðŸ”§ ADMIN STATS API CALLED for course:', req.params.courseId);\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    // Check if user is admin (simple check for now)\n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId } = req.params;\n      \n      // Get all course content for this course\n      const allContent = await storage.getCourseContent(courseId);\n      \n      // Count questions from unified competition_questions table only\n      const competitionQuestions = await storage.getQuestionsByCourse(courseId);\n      \n      console.log('Admin API: Found', competitionQuestions.length, 'questions in unified system');\n      \n      const questions = competitionQuestions.length;\n\n      // Get flashcards directly from flashcards table\n      const courseFlashcards = await storage.getFlashcardsByCourse(courseId);\n      const flashcards = courseFlashcards.length;\n\n      // Get detailed breakdowns\n      const questionBreakdowns = await storage.getQuestionBreakdowns(courseId);\n      const flashcardBreakdowns = await storage.getFlashcardBreakdowns(courseId);\n      // Lessons breakdown removed - not needed in admin interface\n      const studyNotesBreakdowns = await storage.getStudySessionBreakdowns(courseId);\n      const studyPlansBreakdowns = await storage.getEnrollmentBreakdowns(courseId);\n      const podcastBreakdowns = await storage.getUserProgressBreakdowns(courseId);\n\n      // Count by type (using actual database types)\n      const stats = {\n        lessons: allContent.filter(content => content.type === 'lesson').length,\n        chapters: allContent.filter(content => content.type === 'chapter').length, \n        questions: questions,\n        flashcards: flashcards,\n        studyNotes: allContent.filter(content => content.type === 'study-notes').length,\n        studyPlans: allContent.filter(content => content.type === 'study-plan' || content.type === 'study-plans').length,\n        podcasts: allContent.filter(content => content.type === 'podcast').length,\n        aiChat: 1, // Study Companion \"Pipe Buddy\" is available for all courses\n        breakdowns: {\n          questions: questionBreakdowns,\n          flashcards: flashcardBreakdowns,\n          // lessons: lessonBreakdowns, // Removed - lessons don't need breakdown display\n          studyNotes: studyNotesBreakdowns,\n          studyPlans: studyPlansBreakdowns,\n          podcasts: podcastBreakdowns\n        }\n      };\n      \n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"Error fetching course content stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch course content stats\" });\n    }\n  });\n\n  // Public endpoint for course content stats (no auth required)\n  app.get(\"/api/courses/:courseId/stats\", async (req: any, res) => {\n    try {\n      const { courseId } = req.params;\n      \n      // Get all course content for this course\n      const allContent = await storage.getCourseContent(courseId);\n      \n      // Get actual content from dedicated tables\n      const competitionQuestions = await storage.getQuestionsByCourse(courseId);\n      const courseFlashcards = await storage.getFlashcardsByCourse(courseId);\n\n      // Count individual items within content, not just content files\n      const stats = {\n        questions: competitionQuestions.length,\n        flashcards: courseFlashcards.length,\n        studyNotes: allContent.filter(content => content.type === 'study-notes').length,\n        studyPlans: allContent.filter(content => content.type === 'study-plan' || content.type === 'study-plans').length,\n        podcasts: allContent.filter(content => content.type === 'podcast').length,\n        aiChat: 1 // Study Companion \"Pipe Buddy\" is available for all courses\n      };\n      \n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"Error fetching public course content stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch course content stats\" });\n    }\n  });\n\n  // Add new lesson\n  app.post(\"/api/admin/lessons\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const lessonData = {\n        ...req.body,\n        id: crypto.randomUUID(),\n        createdAt: new Date(),\n      };\n      \n      const lesson = await storage.createLesson(lessonData);\n      res.json(lesson);\n    } catch (error: any) {\n      console.error(\"Error creating lesson:\", error);\n      res.status(500).json({ error: \"Failed to create lesson\" });\n    }\n  });\n\n  // Add new chapter\n  app.post(\"/api/admin/chapters\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const chapterData = {\n        ...req.body,\n        id: crypto.randomUUID(),\n        createdAt: new Date(),\n      };\n      \n      const chapter = await storage.createChapter(chapterData);\n      res.json(chapter);\n    } catch (error: any) {\n      console.error(\"Error creating chapter:\", error);\n      res.status(500).json({ error: \"Failed to create chapter\" });\n    }\n  });\n\n  // Add new question\n  app.post(\"/api/admin/questions\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const questionData = {\n        ...req.body,\n        id: crypto.randomUUID(),\n        createdAt: new Date(),\n      };\n      \n      const question = await storage.createQuestion(questionData);\n      res.json(question);\n    } catch (error: any) {\n      console.error(\"Error creating question:\", error);\n      res.status(500).json({ error: \"Failed to create question\" });\n    }\n  });\n\n  // Get study plans for a specific course/lesson\n  app.get(\"/api/courses/:courseId/study-plans\", async (req: any, res) => {\n    try {\n      const { courseId } = req.params;\n      \n      // Resolve course ID (handle friendly URLs like \"journeyman-prep\")\n      const resolvedCourseId = await resolveCourseId(courseId);\n      if (!resolvedCourseId) {\n        return res.status(404).json({ message: \"Course not found\" });\n      }\n      \n      const studyPlans = await storage.getStudyPlansByCourse(resolvedCourseId);\n      res.json(studyPlans);\n    } catch (error: any) {\n      console.error(\"Error fetching study plans:\", error);\n      res.status(500).json({ error: \"Failed to fetch study plans\" });\n    }\n  });\n\n  // Start a study session\n  app.post(\"/api/study-sessions\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { contentId, contentType, studyPlanId, estimatedDuration } = req.body;\n      const userId = req.user.id;\n\n      const session = await storage.createStudySession({\n        userId,\n        contentId,\n        contentType,\n        sessionStart: new Date(),\n      });\n\n      res.json(session);\n    } catch (error: any) {\n      console.error(\"Error starting study session:\", error);\n      res.status(500).json({ error: \"Failed to start study session\" });\n    }\n  });\n\n  // Update study session progress\n  app.put(\"/api/study-sessions/:sessionId\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { sessionId } = req.params;\n      const { completed, durationSeconds, sectionsCompleted } = req.body;\n      const userId = req.user.id;\n\n      const updatedSession = await storage.updateStudySession(sessionId, {\n        completed,\n        durationSeconds,\n        // sectionsCompleted, // Removed - not in interface\n        sessionEnd: completed ? new Date() : undefined,\n      });\n\n      res.json(updatedSession);\n    } catch (error: any) {\n      console.error(\"Error updating study session:\", error);\n      res.status(500).json({ error: \"Failed to update study session\" });\n    }\n  });\n\n  // Bulk import study plans with duplicate detection\n  app.post(\"/api/admin/study-plans/bulk-import\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId, studyPlans } = req.body;\n      \n      if (!courseId || !studyPlans || !Array.isArray(studyPlans)) {\n        return res.status(400).json({ error: \"courseId and studyPlans array are required\" });\n      }\n      \n      // Get existing study plans for this course to check for duplicates\n      const existingStudyPlans = await storage.getStudyPlansByCourse(courseId);\n      \n      // Create a set of existing study plan titles for faster lookup (normalized)\n      const existingStudyPlanTitles = new Set(\n        existingStudyPlans.map((sp: any) => \n          sp.title.toLowerCase().trim().replace(/\\s+/g, ' ')\n        )\n      );\n      \n      // Filter out duplicates and track them\n      const newStudyPlans: any[] = [];\n      const duplicates: any[] = [];\n      \n      studyPlans.forEach((sp: any) => {\n        const normalizedTitle = sp.title.toLowerCase().trim().replace(/\\s+/g, ' ');\n        \n        if (existingStudyPlanTitles.has(normalizedTitle)) {\n          duplicates.push(sp);\n        } else {\n          newStudyPlans.push({\n            ...sp,\n            id: crypto.randomUUID(),\n            courseId,\n            createdAt: new Date(),\n          });\n          // Add to set to prevent duplicates within this batch too\n          existingStudyPlanTitles.add(normalizedTitle);\n        }\n      });\n      \n      // Helper function to extract chapter number from chapter string (e.g., \"Chapter 1\" -> 1)\n      const extractChapterNumber = (chapterStr: string) => {\n        const match = chapterStr.match(/chapter\\s*(\\d+)/i);\n        return match ? parseInt(match[1]) : 1;\n      };\n\n      // Create only new study plans using the values from the frontend interface\n      const createdStudyPlans = await Promise.all(\n        newStudyPlans.map((sp: any) => {\n          return storage.createCourseContent({\n            courseId: sp.courseId,\n            type: 'study-plan',\n            title: sp.title,\n            content: sp.content,\n            // Use values selected in the interface, not extracted from content\n            chapter: extractChapterNumber(sp.chapter || 'Chapter 1'),\n            section: parseInt(sp.section) || null,\n            difficulty: sp.difficulty || 'easy'\n          });\n        })\n      );\n      \n      res.json({ \n        success: true, \n        imported: createdStudyPlans.length,\n        duplicatesSkipped: duplicates.length,\n        totalSubmitted: studyPlans.length,\n        studyPlans: createdStudyPlans,\n        duplicates: duplicates.map(d => d.title.substring(0, 100) + \"...\")\n      });\n    } catch (error: any) {\n      console.error(\"Error bulk importing study plans:\", error);\n      res.status(500).json({ error: \"Failed to import study plans\" });\n    }\n  });\n\n  // Bulk import study notes with duplicate detection\n  app.post(\"/api/admin/study-notes/bulk-import\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId, studyNotes } = req.body;\n      \n      if (!courseId || !studyNotes || !Array.isArray(studyNotes)) {\n        return res.status(400).json({ error: \"courseId and studyNotes array are required\" });\n      }\n      \n      // Get existing study notes for this course to check for duplicates\n      const existingStudyNotes = await storage.getStudyNotesByCourse(courseId);\n      \n      // Create a set of existing study note titles for faster lookup (normalized)\n      const existingStudyNoteTitles = new Set(\n        existingStudyNotes.map((sn: any) => \n          sn.title.toLowerCase().trim().replace(/\\s+/g, ' ')\n        )\n      );\n      \n      // Filter out duplicates and track them\n      const newStudyNotes: any[] = [];\n      const duplicates: any[] = [];\n      \n      studyNotes.forEach((sn: any) => {\n        const normalizedTitle = sn.title.toLowerCase().trim().replace(/\\s+/g, ' ');\n        \n        if (existingStudyNoteTitles.has(normalizedTitle)) {\n          duplicates.push(sn);\n        } else {\n          newStudyNotes.push({\n            ...sn,\n            id: crypto.randomUUID(),\n            courseId,\n            createdAt: new Date(),\n          });\n          // Add to set to prevent duplicates within this batch too\n          existingStudyNoteTitles.add(normalizedTitle);\n        }\n      });\n      \n      // Create only new study notes\n      const createdStudyNotes = await Promise.all(\n        newStudyNotes.map((sn: any) => storage.createStudyNote(sn))\n      );\n      \n      res.json({ \n        success: true, \n        imported: createdStudyNotes.length,\n        duplicatesSkipped: duplicates.length,\n        totalSubmitted: studyNotes.length,\n        studyNotes: createdStudyNotes,\n        duplicates: duplicates.map(d => d.title.substring(0, 100) + \"...\")\n      });\n    } catch (error: any) {\n      console.error(\"Error bulk importing study notes:\", error);\n      res.status(500).json({ error: \"Failed to import study notes\" });\n    }\n  });\n\n  // Bulk import flashcards with duplicate detection\n  app.post(\"/api/admin/flashcards/bulk-import\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId, flashcards } = req.body;\n      \n      if (!courseId || !flashcards || !Array.isArray(flashcards)) {\n        return res.status(400).json({ error: \"courseId and flashcards array are required\" });\n      }\n      \n      // Get existing flashcards for this course to check for duplicates\n      const existingFlashcards = await storage.getFlashcardsByCourse(courseId);\n      \n      // Create a set of existing flashcard front+difficulty combinations for faster lookup\n      const existingFlashcardKeys = new Set(\n        existingFlashcards.map((f: any) => {\n          const normalizedFront = f.front.toLowerCase().trim().replace(/\\s+/g, ' ');\n          return `${normalizedFront}|||${f.difficulty}`;\n        })\n      );\n      \n      // Filter out duplicates and track them\n      const newFlashcards: any[] = [];\n      const duplicates: any[] = [];\n      \n      flashcards.forEach((f: any) => {\n        const normalizedFront = f.front.toLowerCase().trim().replace(/\\s+/g, ' ');\n        const flashcardKey = `${normalizedFront}|||${f.difficulty}`;\n        \n        if (existingFlashcardKeys.has(flashcardKey)) {\n          duplicates.push(f);\n        } else {\n          newFlashcards.push({\n            ...f,\n            id: crypto.randomUUID(),\n            courseId,\n            createdAt: new Date(),\n          });\n          // Add to set to prevent duplicates within this batch too\n          existingFlashcardKeys.add(flashcardKey);\n        }\n      });\n      \n      // Create only new flashcards\n      const createdFlashcards = await Promise.all(\n        newFlashcards.map((f: any) => storage.createFlashcard(f))\n      );\n      \n      res.json({ \n        success: true, \n        imported: createdFlashcards.length,\n        duplicatesSkipped: duplicates.length,\n        totalSubmitted: flashcards.length,\n        flashcards: createdFlashcards,\n        duplicates: duplicates.map(d => d.front.substring(0, 100) + \"...\")\n      });\n    } catch (error: any) {\n      console.error(\"Error bulk importing flashcards:\", error);\n      res.status(500).json({ error: \"Failed to import flashcards\" });\n    }\n  });\n\n  // Bulk import questions with duplicate detection\n  app.post(\"/api/admin/questions/bulk-import\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId, questions } = req.body;\n      \n      if (!courseId || !questions || !Array.isArray(questions)) {\n        return res.status(400).json({ error: \"courseId and questions array are required\" });\n      }\n      \n      // Get all existing questions from entire database to check for duplicates\n      const existingQuestions = await storage.getAllActiveQuestions();\n      \n      // Create a set of existing question texts for faster lookup (normalized)\n      // Normalize by removing extra spaces, punctuation variations, and converting to lowercase\n      const normalizeQuestionText = (text: string) => {\n        return text\n          .toLowerCase()\n          .trim()\n          .replace(/\\s+/g, ' ')           // Multiple spaces to single space\n          .replace(/[.!?]+$/, '')         // Remove trailing punctuation\n          .replace(/[\"'\"''\"\"]/g, '\"')     // Normalize quotes\n          .replace(/\\s*\\?\\s*/g, '?')      // Normalize question marks\n          .replace(/\\s*:\\s*/g, ':')       // Normalize colons\n          .replace(/\\s*;\\s*/g, ';');      // Normalize semicolons\n      };\n\n      const existingQuestionTexts = new Set(\n        existingQuestions.map((q: any) => normalizeQuestionText(q.question))\n      );\n      \n      // Filter out duplicates and track them\n      const newQuestions: any[] = [];\n      const duplicates: any[] = [];\n      \n      questions.forEach((q: any) => {\n        const normalizedText = normalizeQuestionText(q.questionText);\n        \n        if (existingQuestionTexts.has(normalizedText)) {\n          duplicates.push(q);\n        } else {\n          newQuestions.push({\n            ...q,\n            id: crypto.randomUUID(),\n            courseId,\n            createdAt: new Date(),\n          });\n          // Add to set to prevent duplicates within this batch too\n          existingQuestionTexts.add(normalizedText);\n        }\n      });\n      \n      // Create only new questions\n      const createdQuestions = await Promise.all(\n        newQuestions.map((q: any) => storage.createQuestion(q))\n      );\n      \n      res.json({ \n        success: true, \n        imported: createdQuestions.length,\n        duplicatesSkipped: duplicates.length,\n        totalSubmitted: questions.length,\n        questions: createdQuestions,\n        duplicates: duplicates.map(d => d.questionText.substring(0, 100) + \"...\")\n      });\n    } catch (error: any) {\n      console.error(\"Error bulk importing questions:\", error);\n      res.status(500).json({ error: \"Failed to import questions\" });\n    }\n  });\n\n  // Adaptive Difficulty Settings Routes\n  \n  // Get user difficulty settings\n  app.get(\"/api/difficulty-settings\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const user = await storage.getUser(req.user.id);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({\n        preferredDifficulty: user.preferredDifficulty || 'easy',\n        currentSkillLevel: user.currentSkillLevel || 'easy',\n        adaptiveDifficultyEnabled: user.adaptiveDifficultyEnabled !== false\n      });\n    } catch (error: any) {\n      console.error(\"Error getting difficulty settings:\", error);\n      res.status(500).json({ error: \"Failed to get difficulty settings\" });\n    }\n  });\n\n  // Update user difficulty settings\n  app.post(\"/api/difficulty-settings\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const { preferredDifficulty, currentSkillLevel, adaptiveDifficultyEnabled } = req.body;\n      \n      await storage.updateUserDifficultySettings(req.user.id, {\n        preferredDifficulty,\n        currentSkillLevel,\n        adaptiveDifficultyEnabled\n      });\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error updating difficulty settings:\", error);\n      res.status(500).json({ error: \"Failed to update difficulty settings\" });\n    }\n  });\n\n  // AI Review Route for Wrong Answers\n  app.post(\"/api/quiz/review-wrong-answers\", async (req: any, res) => {\n    try {\n      const { wrongAnswers, quizType, sectionOrChapter } = req.body;\n\n      if (!wrongAnswers || !Array.isArray(wrongAnswers) || wrongAnswers.length === 0) {\n        return res.status(400).json({ error: \"No wrong answers provided for review\" });\n      }\n\n      const review = await reviewWrongAnswers(wrongAnswers, quizType, sectionOrChapter);\n      \n      res.json(review);\n    } catch (error: any) {\n      console.error(\"Error reviewing wrong answers:\", error);\n      res.status(500).json({ error: \"Failed to review wrong answers: \" + error.message });\n    }\n  });\n\n  // Interactive Quiz Routes\n  \n  // Start a quiz for a specific section with adaptive difficulty\n  app.post(\"/api/quiz/:section/start\", async (req: any, res) => {\n    try {\n      const { section } = req.params;\n      const { difficulty } = req.body; // Optional difficulty override\n      \n      // Get questions for this section\n      const allQuestions = await storage.getQuestionsBySection(section);\n      \n      // Get previously correctly answered question IDs to exclude on retakes\n      let excludedQuestionIds: string[] = [];\n      if (req.isAuthenticated?.()) {\n        const previousAttempts = await storage.getUserQuizAttempts(req.user.id, section);\n        \n        // Extract question IDs that were answered correctly in previous attempts\n        for (const attempt of previousAttempts) {\n          if (attempt.questions && Array.isArray(attempt.questions)) {\n            const correctlyAnswered = attempt.questions\n              .filter((q: any) => q.isCorrect)\n              .map((q: any) => q.questionId);\n            excludedQuestionIds.push(...correctlyAnswered);\n          }\n        }\n        // Remove duplicates\n        excludedQuestionIds = Array.from(new Set(excludedQuestionIds));\n      }\n      \n      // Filter out previously correctly answered questions for retakes\n      const availableQuestions = allQuestions.filter(q => !excludedQuestionIds.includes(q.id));\n      \n      if (availableQuestions.length === 0) {\n        return res.status(404).json({ error: \"No new questions available for this section\" });\n      }\n\n      // Determine user's difficulty preferences (default to easy for non-authenticated users)\n      let userDifficulty = 'easy';\n      let adaptiveEnabled = true;\n      \n      if (req.isAuthenticated?.()) {\n        const user = await storage.getUser(req.user.id);\n        if (user) {\n          userDifficulty = user.currentSkillLevel || 'easy';\n          adaptiveEnabled = user.adaptiveDifficultyEnabled !== false;\n        }\n      }\n\n      // Use override difficulty if provided, otherwise use user's adaptive level\n      const targetDifficulty = difficulty || (adaptiveEnabled ? userDifficulty : 'easy');\n      \n      // Adaptive difficulty distribution based on user's skill level\n      let questionDistribution: { easy: number; hard: number; very_hard: number };\n      \n      switch (targetDifficulty) {\n        case 'easy':\n          questionDistribution = { easy: 15, hard: 3, very_hard: 2 }; // Beginner friendly\n          break;\n        case 'hard':\n          questionDistribution = { easy: 8, hard: 8, very_hard: 4 }; // Intermediate\n          break;\n        case 'very_hard':\n          questionDistribution = { easy: 5, hard: 7, very_hard: 8 }; // Advanced\n          break;\n        default:\n          questionDistribution = { easy: 10, hard: 5, very_hard: 5 }; // Balanced\n      }\n      \n      // Filter available questions by difficulty (treating medium as easy for compatibility)\n      const easyQuestions = availableQuestions.filter(q => q.difficulty === 'easy' || q.difficulty === 'medium');\n      const hardQuestions = availableQuestions.filter(q => q.difficulty === 'hard');\n      const veryHardQuestions = availableQuestions.filter(q => q.difficulty === 'very_hard');\n      \n      // Select questions based on adaptive distribution\n      const selectedQuestions = [\n        ...easyQuestions.sort(() => Math.random() - 0.5).slice(0, Math.min(questionDistribution.easy, easyQuestions.length)),\n        ...hardQuestions.sort(() => Math.random() - 0.5).slice(0, Math.min(questionDistribution.hard, hardQuestions.length)),\n        ...veryHardQuestions.sort(() => Math.random() - 0.5).slice(0, Math.min(questionDistribution.very_hard, veryHardQuestions.length))\n      ];\n      \n      // Fill remaining slots if needed\n      if (selectedQuestions.length < 20) {\n        const remaining = availableQuestions.filter(q => !selectedQuestions.find(sq => sq.id === q.id));\n        selectedQuestions.push(...remaining.sort(() => Math.random() - 0.5).slice(0, 20 - selectedQuestions.length));\n      }\n      \n      // Final shuffle and limit to 20 questions\n      const shuffledQuestions = selectedQuestions.sort(() => Math.random() - 0.5).slice(0, 20);\n      \n      res.json({\n        id: `quiz-${section}-${Date.now()}`,\n        section,\n        questions: shuffledQuestions.map(q => ({\n          id: q.id,\n          question: q.question,\n          options: q.options,\n          correctAnswer: q.correctAnswer,\n          explanation: q.explanation,\n          codeReference: q.codeReference,\n          difficulty: q.difficulty\n        }))\n      });\n    } catch (error: any) {\n      console.error(\"Error starting quiz:\", error);\n      res.status(500).json({ error: \"Failed to start quiz\" });\n    }\n  });\n\n  // Submit quiz answers\n  app.post(\"/api/quiz/:section/submit\", async (req: any, res) => {\n    try {\n      const { section } = req.params;\n      const { contentId, questions, timeSpent } = req.body;\n      \n      if (!questions || !Array.isArray(questions)) {\n        return res.status(400).json({ error: \"Questions data is required\" });\n      }\n      \n      // Get content info to determine if this is a chapter review\n      const contentResults = contentId ? await storage.getCourseContent(contentId) : null;\n      const content = Array.isArray(contentResults) ? contentResults[0] : contentResults;\n      const isChapterReview = content?.title?.toLowerCase().includes('chapter review') || false;\n      \n      // Calculate score\n      const correctAnswers = questions.filter(q => q.isCorrect).length;\n      const totalQuestions = questions.length;\n      const score = Math.round((correctAnswers / totalQuestions) * 100);\n      \n      // Check pass threshold: 80% for chapter reviews, 70% for regular quizzes\n      const requiredScore = isChapterReview ? 80 : 70;\n      const passed = score >= requiredScore;\n      \n      // Store quiz attempt and update adaptive difficulty if user is authenticated\n      let attemptId = null;\n      if (req.isAuthenticated?.()) {\n        const attempt = await storage.createQuizAttempt({\n          userId: req.user.id,\n          contentId: contentId,\n          courseId: content?.courseId || 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n          chapter: content?.chapter || 1,\n          section: parseInt(section),\n          score: score.toString(),\n          totalQuestions: totalQuestions,\n          correctAnswers: correctAnswers,\n          passed: passed,\n          questions: questions.map(q => ({\n            questionId: q.id,\n            userAnswer: q.userAnswer,\n            correctAnswer: q.correctAnswer,\n            isCorrect: q.isCorrect\n          }))\n        });\n\n        // Update user skill level based on performance (adaptive difficulty)\n        const user = await storage.getUser(req.user.id);\n        if (user && user.adaptiveDifficultyEnabled) {\n          let newSkillLevel = user.currentSkillLevel || 'easy';\n          \n          // Skill level progression logic\n          if (score >= 85 && user.currentSkillLevel === 'easy') {\n            newSkillLevel = 'hard'; // Promote to intermediate\n          } else if (score >= 90 && user.currentSkillLevel === 'hard') {\n            newSkillLevel = 'very_hard'; // Promote to advanced\n          } else if (score < 60 && user.currentSkillLevel === 'very_hard') {\n            newSkillLevel = 'hard'; // Demote to intermediate\n          } else if (score < 50 && user.currentSkillLevel === 'hard') {\n            newSkillLevel = 'easy'; // Demote to beginner\n          }\n          \n          // Update skill level if it changed\n          if (newSkillLevel !== user.currentSkillLevel) {\n            await storage.updateUserDifficultySettings(req.user.id, {\n              currentSkillLevel: newSkillLevel\n            });\n          }\n        }\n        attemptId = attempt.id;\n        \n        // If passed, unlock next section and update progress\n        if (passed && content) {\n          await storage.updateSectionProgress(\n            req.user.id,\n            content.courseId,\n            content.chapter!,\n            content.section!,\n            {\n              quizPassed: true,\n              highestScore: score.toString(),\n              attemptCount: 1,\n              lastAttemptAt: new Date(),\n            }\n          );\n          \n          // Unlock next section\n          await storage.unlockNextSection(req.user.id, content.courseId, content.chapter!, content.section!);\n        }\n      }\n      \n      res.json({\n        attemptId,\n        score,\n        passed,\n        requiredScore,\n        correctAnswers,\n        totalQuestions,\n        timeSpent,\n        incorrectQuestions: questions.filter(q => !q.isCorrect)\n      });\n    } catch (error: any) {\n      console.error(\"Error submitting quiz:\", error);\n      res.status(500).json({ error: \"Failed to submit quiz\" });\n    }\n  });\n\n  // Chapter Test Routes (100 questions, hard/very_hard only, 1.5hr limit, 80% pass)\n  \n  // Start a chapter test for a specific chapter\n  app.post(\"/api/chapter-test/:chapter/start\", async (req: any, res) => {\n    try {\n      const { chapter } = req.params;\n      const courseId = req.body.courseId || 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b'; // Default to Louisiana Journeyman Prep\n      \n      // Get all questions for all sections in this chapter, hard and very_hard only\n      const allQuestions = await storage.getQuestionsByCourse(courseId);\n      const chapterQuestions = allQuestions.filter(q => \n        (q.difficulty === 'hard' || q.difficulty === 'very_hard') && \n        (q.category?.includes(`Chapter ${chapter}`) || q.codeReference?.includes(`Section 10${chapter}`))\n      );\n      \n      // Get previously correctly answered question IDs to exclude on chapter test retakes\n      let excludedQuestionIds: string[] = [];\n      if (req.isAuthenticated?.()) {\n        const previousAttempts = await storage.getUserQuizAttempts(req.user.id, `chapter-test-${chapter}`);\n        \n        // Extract question IDs that were answered correctly in previous attempts\n        for (const attempt of previousAttempts) {\n          if (attempt.questions && Array.isArray(attempt.questions)) {\n            const correctlyAnswered = attempt.questions\n              .filter((q: any) => q.isCorrect)\n              .map((q: any) => q.questionId);\n            excludedQuestionIds.push(...correctlyAnswered);\n          }\n        }\n        // Remove duplicates\n        excludedQuestionIds = Array.from(new Set(excludedQuestionIds));\n      }\n      \n      // Filter out previously correctly answered questions for chapter test retakes\n      const availableQuestions = chapterQuestions.filter(q => !excludedQuestionIds.includes(q.id));\n      \n      if (availableQuestions.length < 50) {\n        return res.status(404).json({ error: \"Insufficient new questions for chapter test. Need at least 50 hard/very_hard questions not previously answered correctly.\" });\n      }\n\n      // Select 100 questions: mix of hard and very_hard (no easy questions for chapter tests)\n      const hardQuestions = availableQuestions.filter(q => q.difficulty === 'hard');\n      const veryHardQuestions = availableQuestions.filter(q => q.difficulty === 'very_hard');\n      \n      // Chapter test distribution: 40 hard, 60 very_hard for maximum challenge\n      const selectedQuestions = [\n        ...hardQuestions.sort(() => Math.random() - 0.5).slice(0, Math.min(40, hardQuestions.length)),\n        ...veryHardQuestions.sort(() => Math.random() - 0.5).slice(0, Math.min(60, veryHardQuestions.length))\n      ];\n      \n      // Fill remaining slots if needed with available questions\n      if (selectedQuestions.length < 100) {\n        const remaining = availableQuestions.filter(q => !selectedQuestions.find(sq => sq.id === q.id));\n        selectedQuestions.push(...remaining.sort(() => Math.random() - 0.5).slice(0, 100 - selectedQuestions.length));\n      }\n      \n      // Final shuffle and limit to exactly 100 questions\n      const shuffledQuestions = selectedQuestions.sort(() => Math.random() - 0.5).slice(0, 100);\n      \n      res.json({\n        id: `chapter-test-${chapter}-${Date.now()}`,\n        chapter,\n        courseId,\n        timeLimit: 90, // 1.5 hours in minutes\n        requiredScore: 80, // 80% pass requirement\n        questionCount: shuffledQuestions.length,\n        questions: shuffledQuestions.map(q => ({\n          id: q.id,\n          question: q.question,\n          options: q.options,\n          correctAnswer: q.correctAnswer,\n          explanation: q.explanation,\n          codeReference: q.codeReference,\n          difficulty: q.difficulty\n        }))\n      });\n    } catch (error: any) {\n      console.error(\"Error starting chapter test:\", error);\n      res.status(500).json({ error: \"Failed to start chapter test\" });\n    }\n  });\n\n  // Submit chapter test answers\n  app.post(\"/api/chapter-test/:chapter/submit\", async (req: any, res) => {\n    try {\n      const { chapter } = req.params;\n      const { courseId, questions, timeSpent, timeLimit } = req.body;\n      \n      if (!questions || !Array.isArray(questions)) {\n        return res.status(400).json({ error: \"Questions data is required\" });\n      }\n      \n      // Validate time limit (1.5 hours = 90 minutes)\n      const timeLimitMinutes = timeLimit || 90;\n      const timeLimitExceeded = timeSpent > (timeLimitMinutes * 60); // Convert to seconds\n      \n      // Calculate score\n      const correctAnswers = questions.filter(q => q.isCorrect).length;\n      const totalQuestions = questions.length;\n      const score = Math.round((correctAnswers / totalQuestions) * 100);\n      \n      // Chapter tests require 80% to pass\n      const requiredScore = 80;\n      const passed = score >= requiredScore && !timeLimitExceeded;\n      \n      // Store chapter test attempt if user is authenticated\n      let attemptId = null;\n      if (req.isAuthenticated?.()) {\n        const attempt = await storage.createQuizAttempt({\n          userId: req.user.id,\n          contentId: `chapter-test-${chapter}`,\n          courseId: courseId || 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n          chapter: parseInt(chapter),\n          section: 999, // Special section for chapter tests\n          score: score.toString(),\n          totalQuestions: totalQuestions,\n          correctAnswers: correctAnswers,\n          passed: passed,\n          questions: questions.map(q => ({\n            questionId: q.id,\n            userAnswer: q.userAnswer,\n            correctAnswer: q.correctAnswer,\n            isCorrect: q.isCorrect\n          }))\n        });\n        \n        attemptId = attempt.id;\n        \n        // If passed, unlock next chapter\n        if (passed) {\n          const nextChapter = parseInt(chapter) + 1;\n          await storage.updateSectionProgress(\n            req.user.id,\n            courseId,\n            parseInt(chapter),\n            999, // Special section number for chapter completion\n            {\n              quizPassed: true,\n              highestScore: score.toString(),\n              lastAttemptAt: new Date(),\n            }\n          );\n          \n          // Unlock first section of next chapter if it exists\n          if (nextChapter <= 5) { // Assuming 5 chapters max\n            await storage.unlockNextSection(req.user.id, courseId, nextChapter, 1);\n          }\n        }\n      }\n      \n      res.json({\n        attemptId,\n        score,\n        passed,\n        requiredScore,\n        correctAnswers,\n        totalQuestions,\n        timeSpent,\n        timeLimitExceeded,\n        timeLimit: timeLimitMinutes,\n        incorrectQuestions: questions.filter(q => !q.isCorrect)\n      });\n    } catch (error: any) {\n      console.error(\"Error submitting chapter test:\", error);\n      res.status(500).json({ error: \"Failed to submit chapter test\" });\n    }\n  });\n\n  // Amazon Affiliate Product Search Routes\n  app.get(\"/api/amazon/search\", async (req, res) => {\n    try {\n      const { query, category, maxResults } = req.query;\n      \n      // Amazon affiliate functionality temporarily disabled\n      // const { amazonAffiliate } = await import('./amazon-affiliate');\n      \n      const products: any[] = [];\n      // const products = await amazonAffiliate.searchProducts({\n      //   query: query as string || '',\n      //   category: category as string,\n      //   maxResults: maxResults ? parseInt(maxResults as string) : 12\n      // });\n      \n      res.json({ products });\n    } catch (error: any) {\n      console.error(\"Error searching Amazon products:\", error);\n      res.status(500).json({ message: \"Failed to search products\" });\n    }\n  });\n\n  app.get(\"/api/amazon/featured\", async (req, res) => {\n    try {\n      // Amazon affiliate functionality temporarily disabled\n      // const { amazonAffiliate } = await import('./amazon-affiliate');\n      const products: any[] = [];\n      // const products = await amazonAffiliate.getFeaturedProducts();\n      \n      res.json({ products });\n    } catch (error: any) {\n      console.error(\"Error getting featured products:\", error);\n      res.status(500).json({ message: \"Failed to get featured products\" });\n    }\n  });\n\n  app.get(\"/api/amazon/tools\", async (req, res) => {\n    try {\n      // Amazon affiliate functionality temporarily disabled\n      // const { amazonAffiliate } = await import('./amazon-affiliate');\n      const products: any[] = [];\n      // const products = await amazonAffiliate.getPopularTools();\n      \n      res.json({ products });\n    } catch (error: any) {\n      console.error(\"Error getting popular tools:\", error);\n      res.status(500).json({ message: \"Failed to get popular tools\" });\n    }\n  });\n\n  // Study Companion AI Chat Routes\n  app.get(\"/api/study-companion/chat\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const conversations = await storage.getStudyCompanionConversations(userId);\n      res.json(conversations);\n    } catch (error: any) {\n      console.error(\"Error fetching study companion chat:\", error);\n      res.status(500).json({ message: \"Failed to fetch chat history\" });\n    }\n  });\n\n  app.post(\"/api/study-companion/chat\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const { message, context } = req.body;\n\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n\n      // Get user's chat history for context\n      const chatHistory = await storage.getStudyCompanionConversations(userId);\n      \n      // Get user's progress for personalized responses\n      const userProgress = context || await storage.getUserProgress(userId);\n\n      // Save user message\n      const userMessageData = {\n        id: crypto.randomUUID(),\n        userId,\n        role: \"user\" as const,\n        content: message.trim(),\n        timestamp: new Date(),\n      };\n      await storage.saveStudyCompanionMessage(userMessageData);\n\n      // Generate AI response\n      const aiResponse = await StudyCompanionService.generateResponse(\n        message,\n        userProgress,\n        chatHistory.slice(-10) // Last 10 messages for context\n      );\n\n      // Save AI response\n      const aiMessageData = {\n        id: crypto.randomUUID(),\n        userId,\n        role: \"assistant\" as const,\n        content: aiResponse.content,\n        emotion: aiResponse.emotion,\n        timestamp: new Date(),\n      };\n      await storage.saveStudyCompanionMessage(aiMessageData);\n\n      res.json({\n        userMessage: userMessageData,\n        aiResponse: aiMessageData\n      });\n\n    } catch (error: any) {\n      console.error(\"Error in study companion chat:\", error);\n      res.status(500).json({ message: \"Failed to process chat message\" });\n    }\n  });\n\n  app.get(\"/api/user/progress\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const progress = await storage.getUserProgress(userId);\n      res.json(progress);\n    } catch (error: any) {\n      console.error(\"Error fetching user progress:\", error);\n      res.status(500).json({ message: \"Failed to fetch user progress\" });\n    }\n  });\n\n  app.get(\"/api/study-companion/suggestions\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    try {\n      const userId = (req.user as any).id;\n      const userProgress = await storage.getUserProgress(userId);\n      const suggestions = await StudyCompanionService.generateStudySuggestions(userProgress);\n      res.json({ suggestions });\n    } catch (error: any) {\n      console.error(\"Error generating study suggestions:\", error);\n      res.status(500).json({ message: \"Failed to generate suggestions\" });\n    }\n  });\n\n  // Individual Podcast Import Route\n  app.post(\"/api/admin/podcasts\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { title, description, hostName, guestName, segments, totalSegments, duration, status } = req.body;\n      \n      if (!title || !segments || !Array.isArray(segments)) {\n        return res.status(400).json({ error: \"Title and segments array are required\" });\n      }\n      \n      // Convert segments to podcast content format\n      const podcastContent = {\n        title,\n        description: description || \"\",\n        hostName: hostName || \"Host\",\n        guestName: guestName || \"Guest\",\n        segments,\n        totalSegments: totalSegments || segments.length,\n        duration: duration || Math.round(segments.length * 15),\n        status: status || \"draft\"\n      };\n      \n      const podcast = await storage.createCourseContent({\n        courseId: \"5f02238b-afb2-4e7f-a488-96fb471fee56\", // Default to Louisiana Journeyman course\n        type: 'podcast',\n        title: title,\n        content: podcastContent,\n        chapter: 1,\n        section: 101,\n        difficulty: 'easy'\n      });\n      \n      res.json({ success: true, podcast });\n    } catch (error: any) {\n      console.error(\"Error creating podcast:\", error);\n      res.status(500).json({ error: \"Failed to create podcast\" });\n    }\n  });\n\n  // TTS Episode Creation Route\n  app.post(\"/api/admin/podcast/create-episode\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId, chapter, section, difficulty, title, transcript, audioUrl, duration, contentId, type } = req.body;\n      \n      if (!courseId || !title || !transcript) {\n        return res.status(400).json({ error: \"courseId, title, and transcript are required\" });\n      }\n      \n      // Helper function to extract chapter number from chapter string\n      const extractChapterNumber = (chapterStr: string) => {\n        if (!chapterStr) return 1;\n        const match = chapterStr.match(/chapter\\s*(\\d+)/i);\n        return match ? parseInt(match[1]) : 1;\n      };\n      \n      // Extract section number from section string\n      const extractSectionNumber = (sectionStr: string) => {\n        if (!sectionStr) return 101;\n        const num = parseInt(sectionStr.replace(/\\D/g, ''));\n        return num || 101;\n      };\n      \n      // Generate and cache audio during import (one-time cost)\n      console.log(`Generating cached audio for episode: ${title}`);\n      const cachedAudioUrl = await generateAndCacheAudio(transcript, contentId || `episode-${Date.now()}`);\n      console.log(`Audio cached successfully: ${cachedAudioUrl}`);\n\n      // Build podcast content object with cached TTS audio\n      const podcastContent = {\n        title: title,\n        transcript: transcript,\n        duration: duration || 180,\n        type: 'podcast',\n        audioUrl: cachedAudioUrl, // Use cached audio URL\n        contentId: contentId || null,\n        // Convert transcript to segments format for the podcast player\n        segments: transcript.split('\\n').map((line: string, index: number) => ({\n          speaker: index % 2 === 0 ? \"host\" : \"guest\", \n          text: line.trim()\n        })).filter((segment: any) => segment.text.length > 0),\n        // Add text property for lessons that expect it\n        text: transcript\n      };\n\n      const chapterNum = extractChapterNumber(chapter);\n      const sectionNum = extractSectionNumber(section);\n      \n      // Check for duplicates by title and section\n      const existingContent = await storage.getCourseContentBySection(courseId, sectionNum, 'podcast');\n      if (existingContent && existingContent.title === title) {\n        return res.status(409).json({ \n          error: \"Episode with this title already exists in this section\",\n          existing: existingContent \n        });\n      }\n\n      const createdEpisode = await storage.createCourseContent({\n        courseId: courseId,\n        type: 'podcast',\n        title: title,\n        content: podcastContent,\n        duration: Math.ceil((duration || 180) / 60), // Convert to minutes\n        chapter: chapterNum,\n        section: sectionNum,\n        difficulty: (difficulty || 'medium') as 'easy' | 'hard' | 'very_hard'\n      });\n      \n      res.json({ \n        success: true, \n        episode: createdEpisode,\n        message: `Episode \"${title}\" created successfully and is now available to students`\n      });\n    } catch (error: any) {\n      console.error(\"Error creating TTS episode:\", error);\n      res.status(500).json({ error: \"Failed to create episode: \" + error.message });\n    }\n  });\n\n  // Bulk Podcast Import Route  \n  app.post(\"/api/admin/podcast/bulk-import\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (!req.user.email?.includes('admin') && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId, episodes } = req.body;\n      \n      if (!courseId || !episodes || !Array.isArray(episodes)) {\n        return res.status(400).json({ error: \"courseId and episodes array are required\" });\n      }\n      \n      // Helper function to extract chapter number from chapter string\n      const extractChapterNumber = (chapterStr: string) => {\n        if (!chapterStr) return 1;\n        const match = chapterStr.match(/chapter\\s*(\\d+)/i);\n        return match ? parseInt(match[1]) : 1;\n      };\n\n      // Create podcasts using episode data from the frontend\n      const createdPodcasts = await Promise.all(\n        episodes.map((episode: any) => {\n          // Build podcast content object with segments format expected by the player\n          const podcastContent = {\n            title: episode.title,\n            transcript: episode.transcript,\n            duration: episode.duration,\n            wordCount: episode.wordCount,\n            episodeNumber: episode.episodeNumber,\n            type: 'podcast',\n            // Convert transcript to segments format for the podcast player\n            segments: episode.transcript.split('\\n').map((line: string, index: number) => ({\n              speaker: index % 2 === 0 ? \"host\" : \"guest\", \n              text: line.trim()\n            })).filter((segment: any) => segment.text.length > 0)\n          };\n\n          return storage.createCourseContent({\n            courseId: courseId,\n            type: 'podcast',\n            title: episode.title,\n            content: podcastContent,\n            // Convert duration from seconds to minutes (integer)\n            duration: Math.ceil((episode.duration || 180) / 60),\n            // Use values from episode metadata\n            chapter: extractChapterNumber(episode.chapter || 'Chapter 1'),\n            section: parseInt(episode.section) || 101,\n            difficulty: (episode.difficulty || 'easy') as 'easy' | 'hard' | 'very_hard'\n          });\n        })\n      );\n      \n      res.json({ \n        success: true, \n        imported: createdPodcasts.length,\n        podcasts: createdPodcasts\n      });\n    } catch (error: any) {\n      console.error(\"Error bulk importing podcasts:\", error);\n      res.status(500).json({ error: \"Failed to import podcasts\" });\n    }\n  });\n\n  // Generate audio files from existing podcast scripts\n  app.post(\"/api/admin/generate-podcast-audio\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (req.user.email !== 'admin@latraining.com' && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      // Get all podcast content from database\n      const allContent = await storage.getCourseContent('b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b');\n      const podcastContent = allContent.filter((item: any) => item.type === 'podcast');\n      \n      const results = [];\n      \n      for (const content of podcastContent) {\n        try {\n          // Extract transcript text from various possible fields\n          const contentObj = content.content as any;\n          const scriptText = contentObj?.transcript || \n                            contentObj?.text || \n                            (content as any).transcript || \n                            '';\n          \n          if (!scriptText) continue;\n          \n          // Strip HTML tags and clean text\n          const plainText = scriptText\n            .replace(/<[^>]*>/g, ' ')\n            .replace(/\\s+/g, ' ')\n            .trim();\n            \n          if (plainText.length < 50) continue; // Skip if too short\n          \n          // Generate audio using existing OpenAI function\n          const audioUrl = await generateAudio(plainText, `section-${content.section}-podcast`);\n          \n          // CRITICAL: Update the database with the generated audio URL\n          const updatedContent = {\n            ...contentObj,\n            audioUrl: audioUrl\n          };\n          \n          await storage.updateCourseContent(content.id, {\n            content: updatedContent\n          });\n          \n          results.push({\n            section: content.section,\n            audioUrl,\n            textLength: plainText.length,\n            success: true\n          });\n          \n          console.log(`Generated and saved audio for Section ${content.section}: ${audioUrl}`);\n          \n        } catch (error: any) {\n          console.error(`Failed to generate audio for Section ${content.section}:`, error);\n          results.push({\n            section: content.section,\n            success: false,\n            error: error.message\n          });\n        }\n      }\n      \n      res.json({ \n        success: true, \n        message: `Generated audio for ${results.filter(r => r.success).length} podcast episodes`,\n        results \n      });\n      \n    } catch (error: any) {\n      console.error(\"Error generating podcast audio:\", error);\n      res.status(500).json({ error: \"Failed to generate podcast audio: \" + error.message });\n    }\n  });\n\n  // Extract podcast content from QuizGecko URLs\n  app.post(\"/api/admin/extract-quizgecko-content\", async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    \n    if (req.user.email !== 'admin@latraining.com' && req.user.subscriptionTier !== 'master') {\n      return res.status(403).json({ error: \"Admin access required\" });\n    }\n    \n    try {\n      const { courseId, urls, chapter, section, difficulty } = req.body;\n      \n      // Validate required fields\n      if (!courseId || !urls || !Array.isArray(urls)) {\n        return res.status(400).json({ error: \"courseId and urls array are required\" });\n      }\n      \n      // Validate and filter URLs to only allow QuizGecko domains\n      const validUrls = [];\n      for (const url of urls) {\n        try {\n          const urlObj = new URL(url);\n          // Only allow QuizGecko domains for security\n          if (urlObj.protocol === 'https:' && urlObj.hostname.includes('quizgecko.com')) {\n            validUrls.push(url);\n          } else {\n            console.warn(`Rejected non-QuizGecko URL: ${url}`);\n          }\n        } catch (error) {\n          console.warn(`Invalid URL format: ${url}`);\n        }\n      }\n      \n      if (validUrls.length === 0) {\n        return res.status(400).json({ error: \"No valid QuizGecko URLs provided\" });\n      }\n      \n      // Get existing sections to show user what they already have\n      const existingSections = await storage.getExistingSections(courseId);\n      console.log(`Course already has content for sections: ${existingSections.join(', ')}`);\n      \n      const extractedEpisodes = [];\n      const errors = [];\n      const skippedSections = [];\n      \n      for (const url of validUrls) {\n        try {\n          console.log(`Extracting content from URL: ${url}`);\n          \n          // Use existing content extractor to get podcast content\n          const extractedContent = await contentExtractor.extractFromQuizGecko(url, 'podcast');\n          \n          if (extractedContent && extractedContent.type === 'podcast') {\n            // Extract section number from title or content\n            const sectionNumber = extractedContent.content.sectionNumber || \n                                 parseInt(section) || \n                                 parseInt(extractedContent.title.match(/Â§?(\\d+)/)?.[1] || '0');\n            \n            // Check for duplicates by section and type (skill-level aware)\n            const existingBySection = await storage.getCourseContentBySection(courseId, sectionNumber, 'podcast');\n            \n            if (existingBySection) {\n              console.log(`Skipping content for section ${sectionNumber} - already exists: ${existingBySection.title}`);\n              skippedSections.push(sectionNumber);\n              errors.push(`Section ${sectionNumber} content already exists (${existingBySection.title})`);\n              continue;\n            }\n            \n            // Also check by exact title as fallback\n            const existingByTitle = await storage.getCourseContentByTitle(courseId, extractedContent.title);\n            \n            if (existingByTitle) {\n              console.log(`Skipping duplicate title: ${extractedContent.title}`);\n              errors.push(`Duplicate title skipped: ${extractedContent.title}`);\n              continue;\n            }\n            \n            // Create course content entry\n            const podcastContent = {\n              title: extractedContent.title,\n              transcript: extractedContent.content.transcript,\n              audioUrl: extractedContent.content.audioUrl || null, // QuizGecko may have hosted audio\n              description: extractedContent.content.description,\n              extractedAt: new Date().toISOString(),\n              sourceUrl: url,\n              type: 'podcast'\n            };\n            \n            const courseContent = await storage.createCourseContent({\n              courseId: courseId,\n              type: 'podcast',\n              title: extractedContent.title,\n              content: podcastContent,\n              duration: extractedContent.duration || Math.ceil((extractedContent.content.transcript?.length || 0) / 1000),\n              chapter: parseInt(chapter) || 1,\n              section: parseInt(section) || 101,\n              difficulty: (difficulty || 'easy') as 'easy' | 'hard' | 'very_hard'\n            });\n            \n            extractedEpisodes.push(courseContent);\n            console.log(`Successfully extracted and saved content from ${url}`);\n          } else {\n            errors.push(`No podcast content found at ${url}`);\n          }\n        } catch (error: any) {\n          console.error(`Failed to extract content from ${url}:`, error);\n          errors.push(`Failed to extract ${url}: ${error.message}`);\n        }\n      }\n      \n      res.json({ \n        success: true, \n        message: `Extracted ${extractedEpisodes.length} new podcast episodes from QuizGecko`,\n        episodes: extractedEpisodes,\n        existingSections: existingSections,\n        skippedSections: Array.from(new Set(skippedSections)),\n        summary: {\n          imported: extractedEpisodes.length,\n          skipped: errors.length,\n          alreadyHaveSections: existingSections\n        },\n        errors: errors.length > 0 ? errors : undefined\n      });\n      \n    } catch (error: any) {\n      console.error(\"Error extracting QuizGecko content:\", error);\n      res.status(500).json({ error: \"Failed to extract QuizGecko content: \" + error.message });\n    }\n  });\n\n  // Text-to-Speech conversion endpoint\n  app.post(\"/api/text-to-speech\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    try {\n      const { text, title } = req.body;\n\n      if (!text || text.trim().length === 0) {\n        return res.status(400).json({ message: \"Text content is required\" });\n      }\n\n      if (text.length > 4096) {\n        return res.status(400).json({ message: \"Text content must be 4096 characters or less\" });\n      }\n\n      // Generate unique content ID for this audio file\n      const contentId = `tts-${Date.now()}-${Math.random().toString(36).substring(7)}`;\n      \n      // Strip HTML tags from text for clean audio\n      const cleanText = text.replace(/<[^>]*>/g, '').replace(/&[^;]+;/g, ' ').trim();\n\n      // Generate audio using existing OpenAI TTS function\n      const audioUrl = await generateAudio(cleanText, contentId);\n\n      res.json({\n        success: true,\n        audioUrl,\n        contentId,\n        title: title || \"Generated Audio\",\n        originalText: text,\n        cleanText,\n        duration: Math.ceil(cleanText.length / 12) // Rough estimate: ~12 chars per second\n      });\n\n    } catch (error: any) {\n      console.error(\"Text-to-speech conversion error:\", error);\n      res.status(500).json({ \n        success: false,\n        message: \"Failed to convert text to speech: \" + error.message \n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":356806},"server/storage.ts":{"content":"import { \n  users, \n  courses, \n  courseEnrollments,\n  employers,\n  jobs,\n  jobApplications,\n  mentorConversations,\n  studyCompanionMessages,\n  photoUploads,\n  planUploads,\n  referrals,\n  monthlyCommissions,\n  payoutRequests,\n  accountCreditTransactions,\n  courseContent,\n  privateCodeBooks,\n  chatAnswers,\n  flashcards,\n  studySessions,\n  quizAttempts,\n  sectionProgress,\n  products,\n  cartItems,\n  productReviews,\n  competitionQuestions,\n  audioCache,\n  aiResponseCache,\n  type User, \n  type InsertUser,\n  type Course,\n  type InsertCourse,\n  type Employer,\n  type InsertEmployer,\n  type Job,\n  type InsertJob,\n  type JobApplication,\n  type InsertJobApplication,\n  type CourseEnrollment,\n  type MentorConversation,\n  type StudyCompanionMessage,\n  type InsertStudyCompanionMessage,\n  type PhotoUpload,\n  type PlanUpload,\n  type Referral,\n  type InsertReferral,\n  type CourseContent,\n  type InsertCourseContent,\n  type PrivateCodeBook,\n  type InsertPrivateCodeBook,\n  type ChatAnswer,\n  type InsertChatAnswer,\n  type Flashcard,\n  type InsertFlashcard,\n  type StudySession,\n  type InsertStudySession,\n  type QuizAttempt,\n  type InsertQuizAttempt,\n  type SectionProgress,\n  type InsertSectionProgress,\n  type LessonStepProgress,\n  type InsertLessonStepProgress,\n  type Product,\n  type InsertProduct,\n  type CartItem,\n  type InsertCartItem,\n  type ProductReview,\n  type InsertProductReview,\n  type PayoutRequest,\n  type InsertPayoutRequest,\n  type AccountCreditTransaction,\n  type InsertAccountCreditTransaction,\n  type MonthlyCommission,\n  type InsertMonthlyCommission,\n  type AudioCache,\n  type InsertAudioCache,\n  type AiResponseCache,\n  type InsertAiResponseCache,\n  achievements,\n  userAchievements,\n  monthlyCompetitions,\n  competitionAttempts,\n  userPointsHistory,\n  lessonStepProgress\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, or, desc, sql, count, isNull, ilike, like } from \"drizzle-orm\";\nimport { calculateReferralCommission } from \"@shared/referral-utils\";\n\nexport interface IStorage {\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserCount(): Promise<number>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<User>): Promise<User>;\n  updateUserStripeInfo(id: string, stripeCustomerId: string, stripeSubscriptionId: string): Promise<User>;\n  \n  // Course methods\n  getCourses(): Promise<Course[]>;\n  getCourse(id: string): Promise<Course | undefined>;\n  createCourse(course: InsertCourse): Promise<Course>;\n  updateCourse(id: string, updates: Partial<Course>): Promise<Course>;\n  getCourseContentStats(courseId: string): Promise<{ lessons: number; quizzes: number }>;\n  \n  // Enrollment methods\n  getUserEnrollments(userId: string): Promise<CourseEnrollment[]>;\n  enrollUser(userId: string, courseId: string): Promise<CourseEnrollment>;\n  updateEnrollmentProgress(enrollmentId: string, progress: number, completedLessons: number): Promise<CourseEnrollment>;\n  \n  // Employer methods\n  createEmployer(employer: InsertEmployer): Promise<Employer>;\n  getEmployer(id: string): Promise<Employer | undefined>;\n  getEmployerByEmail(email: string): Promise<Employer | undefined>;\n  updateEmployer(id: string, updates: Partial<Employer>): Promise<Employer>;\n  getEmployers(page?: number, limit?: number): Promise<{ employers: Employer[], total: number }>;\n  \n  // Job methods\n  getJobs(page?: number, limit?: number, search?: string, status?: string): Promise<{ jobs: Job[], total: number }>;\n  getJob(id: string): Promise<Job | undefined>;\n  createJob(job: InsertJob): Promise<Job>;\n  updateJob(id: string, updates: Partial<Job>): Promise<Job>;\n  updateJobStatus(id: string, status: string): Promise<Job>;\n  getPendingJobs(): Promise<Job[]>;\n  approveJob(id: string, approvedBy: string): Promise<Job>;\n  rejectJob(id: string, rejectionReason: string): Promise<Job>;\n  getAllJobsWithDetails(): Promise<Job[]>;\n  getEmployerJobsWithApplications(employerId: string): Promise<any[]>;\n  getJobApplicationsWithUserDetails(jobId: string): Promise<any[]>;\n  \n  // Job application methods\n  createJobApplication(application: InsertJobApplication): Promise<JobApplication>;\n  getUserJobApplications(userId: string): Promise<JobApplication[]>;\n  \n  // AI mentor methods\n  createMentorConversation(userId: string, messages: any[]): Promise<MentorConversation>;\n  updateMentorConversation(id: string, messages: any[]): Promise<MentorConversation>;\n  \n  // Flashcard methods\n  getFlashcardsByCourse(courseId: string): Promise<Flashcard[]>;\n  createFlashcard(flashcard: InsertFlashcard): Promise<Flashcard>;\n  getUserMentorConversations(userId: string): Promise<MentorConversation[]>;\n  \n  // Breakdown methods for admin stats\n  getQuestionBreakdowns(courseId: string): Promise<any>;\n  getFlashcardBreakdowns(courseId: string): Promise<any>;\n  getCourseContentBreakdowns(courseId: string): Promise<any>;\n  getStudySessionBreakdowns(courseId: string): Promise<any>;\n  getEnrollmentBreakdowns(courseId: string): Promise<any>;\n  getUserProgressBreakdowns(courseId: string): Promise<any>;\n  \n  // Study companion methods\n  getStudyCompanionConversations(userId: string): Promise<StudyCompanionMessage[]>;\n  saveStudyCompanionMessage(message: InsertStudyCompanionMessage): Promise<StudyCompanionMessage>;\n  getUserProgress(userId: string): Promise<any>;\n  \n  // Photo upload methods\n  createPhotoUpload(userId: string, filename: string, url: string, analysis?: any): Promise<PhotoUpload>;\n  getUserPhotoUploads(userId: string): Promise<PhotoUpload[]>;\n  \n  // Plan upload methods\n  createPlanUpload(userId: string, filename: string, url: string, materialList?: any, analysis?: any): Promise<PlanUpload>;\n  getUserPlanUploads(userId: string): Promise<PlanUpload[]>;\n  \n  // Referral methods\n  createReferral(referralData: InsertReferral): Promise<Referral>;\n  getUserReferrals(userId: string): Promise<Referral[]>;\n  getUserReferralEarnings(userId: string): Promise<{ total: number; unpaid: number; paid: number }>;\n  \n  // Monthly commission methods for subscription upgrades\n  createMonthlyCommission(commission: any): Promise<any>;\n  getMonthlyCommissions(userId: string, month?: string): Promise<any[]>;\n  updateMonthlyCommission(commissionId: string, isPaid: boolean, paidAt?: Date): Promise<any>;\n  getAllUnpaidMonthlyCommissions(): Promise<any[]>;\n  processSubscriptionUpgrade(referredUserId: string, newTier: string, oldTier: string): Promise<void>;\n  \n  // Payment methods\n  updateUserPaymentPreferences(userId: string, paymentMethod: string, paypalEmail?: string, minimumPayout?: number): Promise<User>;\n  getUserAccountBalance(userId: string): Promise<number>;\n  addAccountCredit(userId: string, amount: number, description: string, referenceId?: string): Promise<AccountCreditTransaction>;\n  deductAccountCredit(userId: string, amount: number, description: string, referenceId?: string): Promise<AccountCreditTransaction>;\n  getUserAccountTransactions(userId: string, page?: number, limit?: number): Promise<AccountCreditTransaction[]>;\n  \n  // Payout methods\n  createPayoutRequest(request: InsertPayoutRequest): Promise<PayoutRequest>;\n  getUserPayoutRequests(userId: string): Promise<PayoutRequest[]>;\n  getPendingPayoutRequests(): Promise<PayoutRequest[]>;\n  updatePayoutRequestStatus(payoutId: string, status: string, transactionId?: string, failureReason?: string): Promise<PayoutRequest>;\n  processAutomaticPayouts(): Promise<{ processed: number; total: number }>;\n  getUserEligibleCommissionsForPayout(userId: string): Promise<{ referrals: Referral[]; monthlyCommissions: MonthlyCommission[]; totalAmount: number }>;\n  \n  // Course content methods\n  getCourseContent(courseId: string): Promise<CourseContent[]>;\n  getStudyPlansByCourse(courseId: string): Promise<any[]>;\n  createCourseContent(content: InsertCourseContent): Promise<CourseContent>;\n  updateCourseContent(id: string, updates: Partial<CourseContent>): Promise<CourseContent>;\n  deleteCourseContent(id: string): Promise<void>;\n  createLesson(lesson: InsertCourseContent): Promise<CourseContent>;\n  createChapter(chapter: InsertCourseContent): Promise<CourseContent>;\n  \n  // Private code book methods\n  getPrivateCodeBooks(): Promise<PrivateCodeBook[]>;\n  createPrivateCodeBook(codeBook: InsertPrivateCodeBook): Promise<PrivateCodeBook>;\n  deletePrivateCodeBook(id: string): Promise<void>;\n  \n  // Chat answer methods\n  getChatAnswer(question: string, contentId?: string): Promise<ChatAnswer | undefined>;\n  createChatAnswer(answer: InsertChatAnswer): Promise<ChatAnswer>;\n  getAllChatAnswers(): Promise<ChatAnswer[]>;\n  \n  // Study session methods\n  startStudySession(userId: string, contentId: string, contentType: string): Promise<StudySession>;\n  endStudySession(sessionId: string): Promise<StudySession>;\n  getUserStudySessions(userId: string, contentId?: string): Promise<StudySession[]>;\n  createStudySession(data: InsertStudySession): Promise<StudySession>;\n  updateStudySession(sessionId: string, updates: Partial<StudySession>): Promise<StudySession>;\n  \n  // Study notes methods\n  getStudyNotesByCourse(courseId: string): Promise<CourseContent[]>;\n  createStudyNote(studyNote: InsertCourseContent): Promise<CourseContent>;\n  getStudySessionStats(userId: string): Promise<{ totalTime: number; sessionsCount: number; avgSessionTime: number }>;\n  \n  // Quiz attempt methods\n  createQuizAttempt(attempt: InsertQuizAttempt): Promise<QuizAttempt>;\n  getUserQuizAttempts(userId: string, contentId?: string): Promise<QuizAttempt[]>;\n  getLatestQuizAttempt(userId: string, contentId: string): Promise<QuizAttempt | undefined>;\n  \n  // Section progress methods\n  getSectionProgress(userId: string, courseId: string): Promise<SectionProgress[]>;\n  updateSectionProgress(userId: string, courseId: string, chapter: number, section: number, data: Partial<SectionProgress>): Promise<SectionProgress>;\n  unlockNextSection(userId: string, courseId: string, chapter: number, section: number): Promise<void>;\n  isSectionUnlocked(userId: string, courseId: string, chapter: number, section: number): Promise<boolean>;\n  \n  // Lesson step progress methods\n  updateLessonStepProgress(progressData: Partial<LessonStepProgress>): Promise<LessonStepProgress>;\n  getLessonStepProgress(userId: string, courseId: string, section: number, stepType: string): Promise<LessonStepProgress | undefined>;\n  getCurrentLessonStep(userId: string, courseId: string, section: number): Promise<{ stepType: string; stepIndex: number; currentPosition?: any } | null>;\n  \n  // Product methods\n  getProducts(category?: string, search?: string, page?: number, limit?: number): Promise<{ products: Product[], total: number }>;\n  getProduct(id: string): Promise<Product | undefined>;\n  getFeaturedProducts(limit?: number): Promise<Product[]>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(id: string, updates: Partial<Product>): Promise<Product>;\n  deleteProduct(id: string): Promise<void>;\n  \n  // Cart methods\n  getCartItems(userId: string): Promise<(CartItem & { product: Product })[]>;\n  addToCart(userId: string, productId: string, quantity?: number): Promise<CartItem>;\n  updateCartItem(userId: string, productId: string, quantity: number): Promise<CartItem>;\n  removeFromCart(userId: string, productId: string): Promise<void>;\n  clearCart(userId: string): Promise<void>;\n  \n  // Product review methods\n  getProductReviews(productId: string): Promise<ProductReview[]>;\n  createProductReview(review: InsertProductReview): Promise<ProductReview>;\n  updateProductReview(id: string, updates: Partial<ProductReview>): Promise<ProductReview>;\n  deleteProductReview(id: string): Promise<void>;\n\n  // Gamification methods\n  // Achievements\n  getUserAchievements(userId: string): Promise<any[]>;\n  awardAchievement(userId: string, achievementId: string): Promise<any>;\n  \n  // Points and Leaderboard\n  getUserPointsSummary(userId: string): Promise<any>;\n  getLeaderboard(period: string): Promise<any[]>;\n  addPoints(userId: string, points: number, action: string, description: string, referenceId?: string): Promise<void>;\n  \n  // Monthly Competitions\n  getCurrentCompetition(month: string): Promise<any>;\n  startCompetitionAttempt(competitionId: string, userId: string): Promise<any>;\n  submitCompetitionAttempt(competitionId: string, userId: string, answers: any[], timeSpent: number): Promise<any>;\n  getUserCompetitionHistory(userId: string): Promise<any[]>;\n  createMonthlyCompetition(competition: any): Promise<any>;\n  \n  // Audio cache methods\n  getCachedAudio(contentHash: string): Promise<AudioCache | undefined>;\n  createCachedAudio(audioData: InsertAudioCache): Promise<AudioCache>;\n  updateAudioAccess(contentHash: string): Promise<void>;\n  \n  // AI response cache methods\n  getCachedAiResponse(questionHash: string): Promise<AiResponseCache | undefined>;\n  createCachedAiResponse(responseData: InsertAiResponseCache): Promise<AiResponseCache>;\n  updateAiResponseAccess(questionHash: string): Promise<void>;\n  invalidateAiResponseCache(questionHash?: string): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async getUserCount(): Promise<number> {\n    const [result] = await db.select({ count: count() }).from(users);\n    return result.count;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    // Atomic beta assignment with proper concurrency control\n    const result = await db.transaction(async (tx) => {\n      // Check current user count within the transaction\n      const [userCountResult] = await tx.select({ count: count() }).from(users);\n      const currentUserCount = userCountResult.count;\n      \n      // Determine if this user should be a beta tester (first 100 users)\n      const shouldBeBetaTester = currentUserCount < 100;\n      \n      // Create the user with beta status\n      const [newUser] = await tx\n        .insert(users)\n        .values({\n          ...insertUser,\n          referralCode: Math.random().toString(36).substring(2, 10).toUpperCase(),\n          isBetaTester: shouldBeBetaTester,\n          betaStartedAt: shouldBeBetaTester ? new Date() : null\n        })\n        .returning();\n        \n      console.log(`Created user ${newUser.id} (count: ${currentUserCount + 1}, beta: ${shouldBeBetaTester})`);\n      \n      return newUser;\n    });\n    \n    return result;\n  }\n\n  async updateUser(id: string, updates: Partial<User>): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  // Update user difficulty settings for adaptive learning\n  async updateUserDifficultySettings(userId: string, settings: {\n    preferredDifficulty?: 'easy' | 'hard' | 'very_hard';\n    currentSkillLevel?: 'easy' | 'hard' | 'very_hard';\n    adaptiveDifficultyEnabled?: boolean;\n  }): Promise<void> {\n    await db\n      .update(users)\n      .set({ ...settings, updatedAt: new Date() })\n      .where(eq(users.id, userId));\n  }\n\n  async updateUserStripeInfo(id: string, stripeCustomerId: string, stripeSubscriptionId: string): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        stripeCustomerId, \n        stripeSubscriptionId, \n        updatedAt: new Date() \n      })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async getCourses(): Promise<Course[]> {\n    return await db.select().from(courses);\n  }\n\n  async getCourse(id: string): Promise<Course | undefined> {\n    const [course] = await db.select().from(courses).where(eq(courses.id, id));\n    return course || undefined;\n  }\n\n  async createCourse(course: InsertCourse): Promise<Course> {\n    const [newCourse] = await db\n      .insert(courses)\n      .values(course)\n      .returning();\n    return newCourse;\n  }\n\n  async updateCourse(id: string, updates: Partial<Course>): Promise<Course> {\n    const [updatedCourse] = await db\n      .update(courses)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(courses.id, id))\n      .returning();\n    return updatedCourse;\n  }\n\n  async getCourseContentStats(courseId: string): Promise<{ lessons: number; quizzes: number; duration: number }> {\n    const stats = await db\n      .select({\n        lessons: sql<number>`COUNT(CASE WHEN type = 'lesson' THEN 1 END)`,\n        quizSections: sql<number>`COUNT(CASE WHEN type = 'quiz' THEN 1 END)`,\n        totalContentDuration: sql<number>`COALESCE(SUM(duration), 0)`\n      })\n      .from(courseContent)\n      .where(eq(courseContent.courseId, courseId));\n    \n    const lessons = Number(stats[0]?.lessons || 0);\n    const quizSections = Number(stats[0]?.quizSections || 0);\n    const contentDuration = Number(stats[0]?.totalContentDuration || 0);\n    \n    // Calculate total duration: content duration + estimated time for quizzes\n    // Estimate 30 minutes (0.5 hours) per quiz section\n    const estimatedQuizDuration = quizSections * 0.5;\n    const totalDuration = contentDuration + estimatedQuizDuration;\n    \n    return {\n      lessons,\n      quizzes: quizSections,\n      duration: Math.ceil(totalDuration) || 1 // At least 1 hour minimum\n    };\n  }\n\n  // Helper function to automatically update course stats after content changes\n  async updateCourseStatsAutomatically(courseId: string): Promise<void> {\n    const stats = await this.getCourseContentStats(courseId);\n    await this.updateCourse(courseId, {\n      lessons: stats.lessons,\n      practiceQuestions: stats.quizzes,\n      duration: `${stats.duration} hours`\n    });\n  }\n\n  async getUserEnrollments(userId: string): Promise<CourseEnrollment[]> {\n    return await db\n      .select()\n      .from(courseEnrollments)\n      .where(eq(courseEnrollments.userId, userId));\n  }\n\n  async enrollUser(userId: string, courseId: string): Promise<CourseEnrollment> {\n    const [enrollment] = await db\n      .insert(courseEnrollments)\n      .values({ userId, courseId })\n      .returning();\n    return enrollment;\n  }\n\n  async updateEnrollmentProgress(enrollmentId: string, progress: number, completedLessons: number): Promise<CourseEnrollment> {\n    const [enrollment] = await db\n      .update(courseEnrollments)\n      .set({ \n        progress: progress.toString(), \n        completedLessons,\n        isCompleted: progress >= 100\n      })\n      .where(eq(courseEnrollments.id, enrollmentId))\n      .returning();\n    return enrollment;\n  }\n\n  // Employer methods\n  async createEmployer(employer: InsertEmployer): Promise<Employer> {\n    const [newEmployer] = await db\n      .insert(employers)\n      .values(employer)\n      .returning();\n    return newEmployer;\n  }\n\n  async getEmployer(id: string): Promise<Employer | undefined> {\n    const [employer] = await db.select().from(employers).where(eq(employers.id, id));\n    return employer || undefined;\n  }\n\n  async getEmployerByEmail(email: string): Promise<Employer | undefined> {\n    const [employer] = await db.select().from(employers).where(eq(employers.contactEmail, email));\n    return employer || undefined;\n  }\n\n  async updateEmployer(id: string, updates: Partial<Employer>): Promise<Employer> {\n    const [employer] = await db\n      .update(employers)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(employers.id, id))\n      .returning();\n    return employer;\n  }\n\n  async getEmployers(page = 1, limit = 10): Promise<{ employers: Employer[], total: number }> {\n    const offset = (page - 1) * limit;\n    \n    const employersResult = await db\n      .select()\n      .from(employers)\n      .orderBy(desc(employers.createdAt))\n      .limit(limit)\n      .offset(offset);\n    \n    const [{ count: total }] = await db.select({ count: count() }).from(employers);\n    \n    return { employers: employersResult, total };\n  }\n\n\n  async getJobs(page = 1, limit = 10, search?: string, status?: string): Promise<{ jobs: Job[], total: number }> {\n    const offset = (page - 1) * limit;\n    \n    // For students, only show approved jobs\n    let baseCondition = and(eq(jobs.isActive, true), eq(jobs.status, 'approved'));\n    \n    // If status filter is provided (for admin), use that instead\n    if (status) {\n      baseCondition = eq(jobs.status, status as any);\n    }\n    \n    let query = db.select().from(jobs).where(baseCondition);\n    let countQuery = db.select({ count: count() }).from(jobs).where(baseCondition);\n    \n    if (search) {\n      const searchCondition = or(\n        ilike(jobs.title, `%${search}%`),\n        ilike(jobs.company, `%${search}%`),\n        ilike(jobs.location, `%${search}%`)\n      );\n      baseCondition = and(baseCondition, searchCondition);\n      query = db.select().from(jobs).where(baseCondition);\n      countQuery = db.select({ count: count() }).from(jobs).where(baseCondition);\n    }\n    \n    const jobsResult = await query\n      .orderBy(desc(jobs.isFeatured), desc(jobs.createdAt))\n      .limit(limit)\n      .offset(offset);\n    \n    const [{ count: total }] = await countQuery;\n    \n    return { jobs: jobsResult, total };\n  }\n\n  async getPendingJobs(): Promise<Job[]> {\n    return await db\n      .select()\n      .from(jobs)\n      .where(eq(jobs.status, 'pending'))\n      .orderBy(desc(jobs.createdAt));\n  }\n\n  async approveJob(id: string, approvedBy: string): Promise<Job> {\n    const [job] = await db\n      .update(jobs)\n      .set({ \n        status: 'approved', \n        approvedBy, \n        approvedAt: new Date(),\n        updatedAt: new Date()\n      })\n      .where(eq(jobs.id, id))\n      .returning();\n    return job;\n  }\n\n  async rejectJob(id: string, rejectionReason: string): Promise<Job> {\n    const [job] = await db\n      .update(jobs)\n      .set({ \n        status: 'rejected', \n        rejectionReason,\n        updatedAt: new Date()\n      })\n      .where(eq(jobs.id, id))\n      .returning();\n    return job;\n  }\n\n  async getJob(id: string): Promise<Job | undefined> {\n    const [job] = await db.select().from(jobs).where(eq(jobs.id, id));\n    return job || undefined;\n  }\n\n  async createJob(job: InsertJob): Promise<Job> {\n    const [newJob] = await db\n      .insert(jobs)\n      .values(job)\n      .returning();\n    return newJob;\n  }\n\n  async updateJob(id: string, updates: Partial<Job>): Promise<Job> {\n    const [job] = await db\n      .update(jobs)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(jobs.id, id))\n      .returning();\n    return job;\n  }\n\n  async updateJobStatus(id: string, status: string): Promise<Job> {\n    const [job] = await db\n      .update(jobs)\n      .set({ status: status as any, updatedAt: new Date() })\n      .where(eq(jobs.id, id))\n      .returning();\n    return job;\n  }\n\n  async getAllJobsWithDetails(): Promise<Job[]> {\n    return await db\n      .select()\n      .from(jobs)\n      .orderBy(desc(jobs.createdAt));\n  }\n\n  async getEmployerJobsWithApplications(employerId: string): Promise<any[]> {\n    // Get jobs for this employer with application counts\n    return await db\n      .select({\n        id: jobs.id,\n        title: jobs.title,\n        description: jobs.description,\n        location: jobs.location,\n        type: jobs.type,\n        salaryMin: jobs.salaryMin,\n        salaryMax: jobs.salaryMax,\n        requirements: jobs.requirements,\n        benefits: jobs.benefits,\n        status: jobs.status,\n        isFeatured: jobs.isFeatured,\n        createdAt: jobs.createdAt,\n        daysRemaining: sql<number>`GREATEST(0, EXTRACT(DAY FROM (${jobs.expiresAt} - NOW())))`,\n        applicationsCount: sql<number>`(SELECT COUNT(*) FROM ${jobApplications} WHERE ${jobApplications.jobId} = ${jobs.id})`\n      })\n      .from(jobs)\n      .where(eq(jobs.employerId, employerId))\n      .orderBy(desc(jobs.createdAt));\n  }\n\n  async getJobApplicationsWithUserDetails(jobId: string): Promise<any[]> {\n    return await db\n      .select({\n        id: jobApplications.id,\n        userId: jobApplications.userId,\n        name: sql<string>`CONCAT(${users.firstName}, ' ', ${users.lastName})`,\n        email: users.email,\n        phone: users.phone,\n        resumeUrl: jobApplications.resumeUrl,\n        coverLetter: jobApplications.coverLetter,\n        appliedAt: jobApplications.appliedAt\n      })\n      .from(jobApplications)\n      .innerJoin(users, eq(jobApplications.userId, users.id))\n      .where(eq(jobApplications.jobId, jobId))\n      .orderBy(desc(jobApplications.appliedAt));\n  }\n\n  async createJobApplication(application: InsertJobApplication): Promise<JobApplication> {\n    const [newApplication] = await db\n      .insert(jobApplications)\n      .values(application)\n      .returning();\n    return newApplication;\n  }\n\n  async getUserJobApplications(userId: string): Promise<JobApplication[]> {\n    return await db\n      .select()\n      .from(jobApplications)\n      .where(eq(jobApplications.userId, userId))\n      .orderBy(desc(jobApplications.appliedAt));\n  }\n\n  async createMentorConversation(userId: string, messages: any[]): Promise<MentorConversation> {\n    const [conversation] = await db\n      .insert(mentorConversations)\n      .values({ userId, messages })\n      .returning();\n    return conversation;\n  }\n\n  async updateMentorConversation(id: string, messages: any[]): Promise<MentorConversation> {\n    const [conversation] = await db\n      .update(mentorConversations)\n      .set({ messages, updatedAt: new Date() })\n      .where(eq(mentorConversations.id, id))\n      .returning();\n    return conversation;\n  }\n\n  async getUserMentorConversations(userId: string): Promise<MentorConversation[]> {\n    return await db\n      .select()\n      .from(mentorConversations)\n      .where(eq(mentorConversations.userId, userId))\n      .orderBy(desc(mentorConversations.updatedAt));\n  }\n\n  // Study companion methods\n  async getStudyCompanionConversations(userId: string): Promise<StudyCompanionMessage[]> {\n    return await db\n      .select()\n      .from(studyCompanionMessages)\n      .where(eq(studyCompanionMessages.userId, userId))\n      .orderBy(studyCompanionMessages.timestamp);\n  }\n\n  async saveStudyCompanionMessage(message: InsertStudyCompanionMessage): Promise<StudyCompanionMessage> {\n    const [savedMessage] = await db\n      .insert(studyCompanionMessages)\n      .values(message)\n      .returning();\n    return savedMessage;\n  }\n\n  async getUserProgress(userId: string): Promise<any> {\n    try {\n      // Get user enrollments\n      const enrollments = await this.getUserEnrollments(userId);\n      \n      // Get user's study sessions for progress tracking\n      const studySessions = await this.getUserStudySessions(userId);\n      \n      // Get recent quiz attempts\n      const quizAttempts = await this.getUserQuizAttempts(userId);\n      \n      // Calculate overall progress\n      const totalStudyTime = studySessions.reduce((total, session) => {\n        const duration = session.sessionEnd && session.sessionStart \n          ? new Date(session.sessionEnd).getTime() - new Date(session.sessionStart).getTime()\n          : session.durationSeconds ? session.durationSeconds * 1000 : 0;\n        return total + (duration / (1000 * 60)); // Convert to minutes\n      }, 0);\n\n      const enrolledCourses = enrollments.map(e => e.courseId);\n      const recentTopics = Array.from(new Set(studySessions\n        .slice(-5)\n        .map(session => session.contentType)\n        .filter(Boolean)\n      ));\n\n      return {\n        enrolledCourses,\n        overallProgress: enrollments.length > 0 \n          ? enrollments.reduce((avg, e) => avg + Number(e.progress || 0), 0) / enrollments.length \n          : 0,\n        totalStudyTime: Math.round(totalStudyTime),\n        recentTopics,\n        quizPerformance: quizAttempts.length > 0 \n          ? quizAttempts.reduce((avg, attempt) => avg + Number(attempt.score || 0), 0) / quizAttempts.length \n          : 0,\n        studyStreak: this.calculateStudyStreak(studySessions),\n        lastActivity: studySessions.length > 0 \n          ? studySessions[studySessions.length - 1].sessionStart \n          : null\n      };\n    } catch (error) {\n      console.error(\"Error getting user progress:\", error);\n      return {\n        enrolledCourses: [],\n        overallProgress: 0,\n        totalStudyTime: 0,\n        recentTopics: [],\n        quizPerformance: 0,\n        studyStreak: 0,\n        lastActivity: null\n      };\n    }\n  }\n\n  private calculateStudyStreak(studySessions: any[]): number {\n    if (studySessions.length === 0) return 0;\n    \n    // Simple streak calculation - count consecutive days with study sessions\n    const sessionDates = studySessions\n      .map(session => new Date(session.sessionStart).toDateString())\n      .reverse(); // Most recent first\n    \n    const uniqueDates = [...new Set(sessionDates)];\n    let streak = 0;\n    const today = new Date().toDateString();\n    \n    for (let i = 0; i < uniqueDates.length; i++) {\n      const sessionDate = new Date(uniqueDates[i]);\n      const expectedDate = new Date();\n      expectedDate.setDate(expectedDate.getDate() - i);\n      \n      if (sessionDate.toDateString() === expectedDate.toDateString()) {\n        streak++;\n      } else {\n        break;\n      }\n    }\n    \n    return streak;\n  }\n\n  async createPhotoUpload(userId: string, filename: string, url: string, analysis?: any): Promise<PhotoUpload> {\n    const [upload] = await db\n      .insert(photoUploads)\n      .values({ userId, filename, url, analysis })\n      .returning();\n    return upload;\n  }\n\n  async getUserPhotoUploads(userId: string): Promise<PhotoUpload[]> {\n    return await db\n      .select()\n      .from(photoUploads)\n      .where(eq(photoUploads.userId, userId))\n      .orderBy(desc(photoUploads.createdAt));\n  }\n\n  async createPlanUpload(userId: string, filename: string, url: string, materialList?: any, analysis?: any): Promise<PlanUpload> {\n    const [upload] = await db\n      .insert(planUploads)\n      .values({ userId, filename, url, materialList, analysis })\n      .returning();\n    return upload;\n  }\n\n  async getUserPlanUploads(userId: string): Promise<PlanUpload[]> {\n    return await db\n      .select()\n      .from(planUploads)\n      .where(eq(planUploads.userId, userId))\n      .orderBy(desc(planUploads.createdAt));\n  }\n\n  async getPlanUpload(planId: string, userId: string): Promise<PlanUpload | undefined> {\n    const [plan] = await db\n      .select()\n      .from(planUploads)\n      .where(and(\n        eq(planUploads.id, planId),\n        eq(planUploads.userId, userId)\n      ));\n    return plan || undefined;\n  }\n\n  // Flashcard methods\n  async getFlashcardsByCourse(courseId: string): Promise<Flashcard[]> {\n    return await db\n      .select()\n      .from(flashcards)\n      .where(eq(flashcards.courseId, courseId))\n      .orderBy(desc(flashcards.createdAt));\n  }\n\n  async createFlashcard(flashcard: InsertFlashcard): Promise<Flashcard> {\n    const [created] = await db\n      .insert(flashcards)\n      .values(flashcard)\n      .returning();\n    return created;\n  }\n\n  // Breakdown methods for detailed admin statistics\n  async getQuestionBreakdowns(courseId: string): Promise<any> {\n    // Get breakdowns from competition_questions table\n    const categoryBreakdown = await db\n      .select({\n        category: competitionQuestions.category,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(competitionQuestions)\n      .groupBy(competitionQuestions.category);\n\n    const difficultyBreakdown = await db\n      .select({\n        difficulty: competitionQuestions.difficulty,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(competitionQuestions)\n      .groupBy(competitionQuestions.difficulty);\n\n    const sectionBreakdown = await db\n      .select({\n        codeReference: competitionQuestions.codeReference,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(competitionQuestions)\n      .groupBy(competitionQuestions.codeReference);\n\n    return {\n      byChapter: categoryBreakdown,\n      byDifficulty: difficultyBreakdown,\n      bySection: sectionBreakdown\n    };\n  }\n\n  async getFlashcardBreakdowns(courseId: string): Promise<any> {\n    const categoryBreakdown = await db\n      .select({\n        category: flashcards.category,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(flashcards)\n      .where(eq(flashcards.courseId, courseId))\n      .groupBy(flashcards.category);\n\n    const difficultyBreakdown = await db\n      .select({\n        difficulty: flashcards.difficulty,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(flashcards)\n      .where(eq(flashcards.courseId, courseId))\n      .groupBy(flashcards.difficulty);\n\n    const sectionBreakdown = await db\n      .select({\n        codeReference: flashcards.codeReference,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(flashcards)\n      .where(eq(flashcards.courseId, courseId))\n      .groupBy(flashcards.codeReference);\n\n    return {\n      byChapter: categoryBreakdown,\n      byDifficulty: difficultyBreakdown,\n      bySection: sectionBreakdown\n    };\n  }\n\n  async createReferral(referralData: InsertReferral): Promise<Referral> {\n    const [referral] = await db\n      .insert(referrals)\n      .values(referralData)\n      .returning();\n    return referral;\n  }\n\n  async getUserReferrals(userId: string): Promise<Referral[]> {\n    return await db\n      .select()\n      .from(referrals)\n      .where(eq(referrals.referrerId, userId))\n      .orderBy(desc(referrals.createdAt));\n  }\n\n  async getUserReferralEarnings(userId: string): Promise<{ total: number; unpaid: number; paid: number }> {\n    const earnings = await db\n      .select({\n        total: sql<number>`sum(${referrals.commissionAmount})`,\n        unpaid: sql<number>`sum(case when ${referrals.isPaid} = false then ${referrals.commissionAmount} else 0 end)`,\n        paid: sql<number>`sum(case when ${referrals.isPaid} = true then ${referrals.commissionAmount} else 0 end)`\n      })\n      .from(referrals)\n      .where(eq(referrals.referrerId, userId));\n\n    const result = earnings[0];\n    return {\n      total: Number(result?.total || 0),\n      unpaid: Number(result?.unpaid || 0),\n      paid: Number(result?.paid || 0)\n    };\n  }\n\n  // Monthly commission methods for subscription upgrades\n  async createMonthlyCommission(commission: any): Promise<any> {\n    const [newCommission] = await db\n      .insert(monthlyCommissions)\n      .values(commission)\n      .returning();\n    return newCommission;\n  }\n\n  async getMonthlyCommissions(userId: string, month?: string): Promise<any[]> {\n    const conditions = [eq(monthlyCommissions.referrerId, userId)];\n    \n    if (month) {\n      conditions.push(eq(monthlyCommissions.commissionMonth, month));\n    }\n\n    return await db\n      .select()\n      .from(monthlyCommissions)\n      .where(and(...conditions));\n  }\n\n  async updateMonthlyCommission(commissionId: string, isPaid: boolean, paidAt?: Date): Promise<any> {\n    const [updated] = await db\n      .update(monthlyCommissions)\n      .set({\n        isPaid,\n        paidAt: paidAt || new Date()\n      })\n      .where(eq(monthlyCommissions.id, commissionId))\n      .returning();\n    return updated;\n  }\n\n  async getAllUnpaidMonthlyCommissions(): Promise<any[]> {\n    return await db\n      .select()\n      .from(monthlyCommissions)\n      .where(eq(monthlyCommissions.isPaid, false));\n  }\n\n  async processSubscriptionUpgrade(referredUserId: string, newTier: string, oldTier: string): Promise<void> {\n    // Find all referrals where this user was referred\n    const userReferrals = await db\n      .select()\n      .from(referrals)\n      .where(eq(referrals.referredId, referredUserId));\n\n    const currentMonth = new Date().toISOString().slice(0, 7); // Format: \"2025-01\"\n\n    for (const referral of userReferrals) {\n      // Get the current referrer's tier\n      const referrer = await this.getUser(referral.referrerId);\n      if (!referrer) continue;\n\n      // Calculate commission based on upgrade\n      const { commissionAmount, eligibleTier } = calculateReferralCommission(\n        referrer.subscriptionTier as any,\n        newTier as any\n      );\n\n      // Create monthly commission record\n      await this.createMonthlyCommission({\n        referralId: referral.id,\n        referrerId: referral.referrerId,\n        referredUserId: referredUserId,\n        commissionMonth: currentMonth,\n        referrerTierAtTime: referrer.subscriptionTier,\n        referredTierAtTime: newTier,\n        eligibleTier,\n        commissionAmount: commissionAmount.toString(),\n        commissionRate: \"0.10\",\n        isPaid: false\n      });\n    }\n  }\n\n  // Payment methods\n  async updateUserPaymentPreferences(userId: string, paymentMethod: string, paypalEmail?: string, minimumPayout?: number): Promise<User> {\n    const updates: Partial<User> = {\n      preferredPaymentMethod: paymentMethod as any,\n      updatedAt: new Date()\n    };\n    \n    if (paypalEmail !== undefined) {\n      updates.paypalEmail = paypalEmail;\n    }\n    \n    if (minimumPayout !== undefined) {\n      updates.minimumPayout = minimumPayout.toString();\n    }\n\n    const [user] = await db\n      .update(users)\n      .set(updates)\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async getUserAccountBalance(userId: string): Promise<number> {\n    const user = await this.getUser(userId);\n    if (!user) return 0;\n    return parseFloat(user.accountBalance || \"0\");\n  }\n\n  async addAccountCredit(userId: string, amount: number, description: string, referenceId?: string): Promise<AccountCreditTransaction> {\n    const currentBalance = await this.getUserAccountBalance(userId);\n    const newBalance = currentBalance + amount;\n\n    // Update user balance\n    await this.updateUser(userId, { \n      accountBalance: newBalance.toString() \n    });\n\n    // Create transaction record\n    const [transaction] = await db\n      .insert(accountCreditTransactions)\n      .values({\n        userId,\n        amount: amount.toString(),\n        type: \"credit\",\n        description,\n        referenceId,\n        balanceBefore: currentBalance.toString(),\n        balanceAfter: newBalance.toString()\n      })\n      .returning();\n\n    return transaction;\n  }\n\n  async deductAccountCredit(userId: string, amount: number, description: string, referenceId?: string): Promise<AccountCreditTransaction> {\n    const currentBalance = await this.getUserAccountBalance(userId);\n    if (currentBalance < amount) {\n      throw new Error(\"Insufficient account balance\");\n    }\n    \n    const newBalance = currentBalance - amount;\n\n    // Update user balance\n    await this.updateUser(userId, { \n      accountBalance: newBalance.toString() \n    });\n\n    // Create transaction record\n    const [transaction] = await db\n      .insert(accountCreditTransactions)\n      .values({\n        userId,\n        amount: (-amount).toString(),\n        type: \"debit\",\n        description,\n        referenceId,\n        balanceBefore: currentBalance.toString(),\n        balanceAfter: newBalance.toString()\n      })\n      .returning();\n\n    return transaction;\n  }\n\n  async getUserAccountTransactions(userId: string, page: number = 1, limit: number = 50): Promise<AccountCreditTransaction[]> {\n    const offset = (page - 1) * limit;\n    \n    return await db\n      .select()\n      .from(accountCreditTransactions)\n      .where(eq(accountCreditTransactions.userId, userId))\n      .orderBy(desc(accountCreditTransactions.createdAt))\n      .limit(limit)\n      .offset(offset);\n  }\n\n  // Payout methods\n  async createPayoutRequest(request: InsertPayoutRequest): Promise<PayoutRequest> {\n    const [payoutRequest] = await db\n      .insert(payoutRequests)\n      .values(request)\n      .returning();\n    return payoutRequest;\n  }\n\n  async getUserPayoutRequests(userId: string): Promise<PayoutRequest[]> {\n    return await db\n      .select()\n      .from(payoutRequests)\n      .where(eq(payoutRequests.userId, userId))\n      .orderBy(desc(payoutRequests.createdAt));\n  }\n\n  async getPendingPayoutRequests(): Promise<PayoutRequest[]> {\n    return await db\n      .select()\n      .from(payoutRequests)\n      .where(eq(payoutRequests.status, \"pending\"))\n      .orderBy(payoutRequests.requestedAt);\n  }\n\n  async updatePayoutRequestStatus(payoutId: string, status: string, transactionId?: string, failureReason?: string): Promise<PayoutRequest> {\n    const updates: any = {\n      status: status as any,\n      updatedAt: new Date()\n    };\n\n    if (status === \"processing\") {\n      updates.processedAt = new Date();\n    }\n    if (status === \"completed\") {\n      updates.completedAt = new Date();\n    }\n    if (transactionId) {\n      updates.transactionId = transactionId;\n    }\n    if (failureReason) {\n      updates.failureReason = failureReason;\n    }\n\n    const [payoutRequest] = await db\n      .update(payoutRequests)\n      .set(updates)\n      .where(eq(payoutRequests.id, payoutId))\n      .returning();\n\n    return payoutRequest;\n  }\n\n  async processAutomaticPayouts(): Promise<{ processed: number; total: number }> {\n    // This would implement automatic payout processing logic\n    // For now, return placeholder values\n    return { processed: 0, total: 0 };\n  }\n\n  async getUserEligibleCommissionsForPayout(userId: string): Promise<{ referrals: Referral[]; monthlyCommissions: MonthlyCommission[]; totalAmount: number }> {\n    // Get unpaid referrals\n    const unpaidReferrals = await db\n      .select()\n      .from(referrals)\n      .where(and(\n        eq(referrals.referrerId, userId),\n        eq(referrals.isPaid, false)\n      ));\n\n    // Get unpaid monthly commissions\n    const unpaidMonthlyCommissions = await db\n      .select()\n      .from(monthlyCommissions)\n      .where(and(\n        eq(monthlyCommissions.referrerId, userId),\n        eq(monthlyCommissions.isPaid, false)\n      ));\n\n    // Calculate total amount\n    const referralTotal = unpaidReferrals.reduce((sum, ref) => sum + parseFloat(ref.commissionAmount || \"0\"), 0);\n    const monthlyTotal = unpaidMonthlyCommissions.reduce((sum, comm) => sum + parseFloat(comm.commissionAmount || \"0\"), 0);\n    const totalAmount = referralTotal + monthlyTotal;\n\n    return {\n      referrals: unpaidReferrals,\n      monthlyCommissions: unpaidMonthlyCommissions,\n      totalAmount\n    };\n  }\n\n  // Course content methods\n  async getCourseContent(courseId: string): Promise<CourseContent[]> {\n    const results = await db\n      .select()\n      .from(courseContent)\n      .where(eq(courseContent.courseId, courseId))\n      .orderBy(courseContent.chapter, courseContent.section, courseContent.sortOrder);\n    \n    return results;\n  }\n\n  async getStudyPlansByCourse(courseId: string): Promise<any[]> {\n    const results = await db\n      .select()\n      .from(courseContent)\n      .where(and(\n        eq(courseContent.courseId, courseId),\n        eq(courseContent.type, 'study_plans')\n      ))\n      .orderBy(courseContent.chapter, courseContent.section, courseContent.sortOrder);\n    \n    return results.map(plan => ({\n      id: plan.id,\n      title: plan.title,\n      content: plan.content,\n      duration: plan.duration || 30 // Default 30 minutes if not specified\n    }));\n  }\n\n  async getCourseContentById(id: string): Promise<CourseContent | null> {\n    const [result] = await db\n      .select()\n      .from(courseContent)\n      .where(eq(courseContent.id, id))\n      .limit(1);\n    \n    return result || null;\n  }\n\n  // Get course content by title (for duplicate detection)\n  async getCourseContentByTitle(courseId: string, title: string): Promise<CourseContent | null> {\n    const [result] = await db\n      .select()\n      .from(courseContent)\n      .where(and(\n        eq(courseContent.courseId, courseId),\n        eq(courseContent.title, title)\n      ))\n      .limit(1);\n    \n    return result || null;\n  }\n\n  // Get course content by section and type (for skill-level duplicate detection)\n  async getCourseContentBySection(courseId: string, section: number, type: string): Promise<CourseContent | null> {\n    const [result] = await db\n      .select()\n      .from(courseContent)\n      .where(and(\n        eq(courseContent.courseId, courseId),\n        eq(courseContent.section, section),\n        eq(courseContent.type, type)\n      ))\n      .limit(1);\n    \n    return result || null;\n  }\n\n  // Get all existing sections for a course (to check what's already covered)\n  async getExistingSections(courseId: string): Promise<number[]> {\n    const results = await db\n      .selectDistinct({ section: courseContent.section })\n      .from(courseContent)\n      .where(eq(courseContent.courseId, courseId))\n      .orderBy(courseContent.section);\n    \n    return results.map(r => r.section);\n  }\n\n  async createCourseContent(content: InsertCourseContent): Promise<CourseContent> {\n    const [result] = await db\n      .insert(courseContent)\n      .values(content)\n      .returning();\n    \n    return result;\n  }\n\n  async updateCourseContent(id: string, data: Partial<InsertCourseContent>): Promise<CourseContent> {\n    const [result] = await db\n      .update(courseContent)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(courseContent.id, id))\n      .returning();\n    \n    if (!result) {\n      throw new Error(\"Course content not found\");\n    }\n    \n    return result;\n  }\n\n  async deleteCourseContent(id: string): Promise<void> {\n    await db.delete(courseContent).where(eq(courseContent.id, id));\n  }\n\n  async updateContentAudio(contentId: string, audioUrl: string): Promise<void> {\n    await db\n      .update(courseContent)\n      .set({ \n        content: sql`jsonb_set(content, '{extracted,audioUrl}', ${JSON.stringify(audioUrl)})`,\n        updatedAt: new Date()\n      })\n      .where(eq(courseContent.id, contentId));\n  }\n\n  // Private code book methods\n  async getPrivateCodeBooks(): Promise<PrivateCodeBook[]> {\n    const results = await db\n      .select()\n      .from(privateCodeBooks)\n      .orderBy(desc(privateCodeBooks.createdAt));\n    \n    return results;\n  }\n\n  async createPrivateCodeBook(codeBook: InsertPrivateCodeBook): Promise<PrivateCodeBook> {\n    const [result] = await db\n      .insert(privateCodeBooks)\n      .values(codeBook)\n      .returning();\n    \n    return result;\n  }\n\n  async deletePrivateCodeBook(id: string): Promise<void> {\n    await db.delete(privateCodeBooks).where(eq(privateCodeBooks.id, id));\n  }\n\n  async getChatAnswer(question: string, contentId?: string): Promise<ChatAnswer | undefined> {\n    const lowerQuestion = question.toLowerCase();\n    \n    // Search for answers that match keywords\n    const answers = await db.select().from(chatAnswers);\n    \n    return answers.find(answer => {\n      if (answer.keywords) {\n        return answer.keywords.some(keyword => lowerQuestion.includes(keyword.toLowerCase()));\n      }\n      return false;\n    });\n  }\n\n  async createChatAnswer(answer: InsertChatAnswer): Promise<ChatAnswer> {\n    const [result] = await db.insert(chatAnswers).values(answer).returning();\n    return result;\n  }\n\n  async getAllChatAnswers(): Promise<ChatAnswer[]> {\n    return await db.select().from(chatAnswers);\n  }\n\n  // Study session methods\n  async startStudySession(userId: string, contentId: string, contentType: string): Promise<StudySession> {\n    const [session] = await db\n      .insert(studySessions)\n      .values({\n        userId,\n        contentId,\n        contentType,\n        sessionStart: new Date(),\n      })\n      .returning();\n    \n    return session;\n  }\n\n  async endStudySession(sessionId: string): Promise<StudySession> {\n    const now = new Date();\n    \n    // Get the session to calculate duration\n    const [existingSession] = await db\n      .select()\n      .from(studySessions)\n      .where(eq(studySessions.id, sessionId));\n    \n    if (!existingSession || !existingSession.sessionStart) {\n      throw new Error('Study session not found or has no start time');\n    }\n    \n    const durationSeconds = Math.floor((now.getTime() - new Date(existingSession.sessionStart).getTime()) / 1000);\n    \n    const [session] = await db\n      .update(studySessions)\n      .set({\n        sessionEnd: now,\n        durationSeconds,\n        completed: true,\n      })\n      .where(eq(studySessions.id, sessionId))\n      .returning();\n    \n    return session;\n  }\n\n  async getUserStudySessions(userId: string, contentId?: string): Promise<StudySession[]> {\n    const conditions = [eq(studySessions.userId, userId)];\n    \n    if (contentId) {\n      conditions.push(eq(studySessions.contentId, contentId));\n    }\n    \n    return await db\n      .select()\n      .from(studySessions)\n      .where(and(...conditions))\n      .orderBy(desc(studySessions.sessionStart));\n  }\n\n  // Study notes methods\n  async getStudyNotesByCourse(courseId: string): Promise<CourseContent[]> {\n    return await db\n      .select()\n      .from(courseContent)\n      .where(and(\n        eq(courseContent.courseId, courseId),\n        eq(courseContent.type, 'study-notes')\n      ))\n      .orderBy(courseContent.sortOrder, courseContent.title);\n  }\n\n  async createStudyNote(studyNote: InsertCourseContent): Promise<CourseContent> {\n    const [result] = await db\n      .insert(courseContent)\n      .values({\n        ...studyNote,\n        type: 'study-notes'\n      })\n      .returning();\n    \n    return result;\n  }\n\n  async getStudySessionStats(userId: string): Promise<{ totalTime: number; sessionsCount: number; avgSessionTime: number }> {\n    const stats = await db\n      .select({\n        totalSeconds: sql<number>`COALESCE(SUM(${studySessions.durationSeconds}), 0)`,\n        sessionCount: sql<number>`COUNT(*)`,\n      })\n      .from(studySessions)\n      .where(and(\n        eq(studySessions.userId, userId),\n        eq(studySessions.completed, true)\n      ));\n    \n    const totalSeconds = Number(stats[0]?.totalSeconds || 0);\n    const sessionsCount = Number(stats[0]?.sessionCount || 0);\n    const avgSessionTime = sessionsCount > 0 ? Math.round(totalSeconds / sessionsCount) : 0;\n    \n    return {\n      totalTime: totalSeconds,\n      sessionsCount,\n      avgSessionTime,\n    };\n  }\n\n  // Quiz attempt methods\n  async createQuizAttempt(attempt: InsertQuizAttempt): Promise<QuizAttempt> {\n    const [result] = await db\n      .insert(quizAttempts)\n      .values(attempt)\n      .returning();\n    \n    return result;\n  }\n\n  async getUserQuizAttempts(userId: string, contentId?: string): Promise<QuizAttempt[]> {\n    const conditions = [eq(quizAttempts.userId, userId)];\n    \n    if (contentId) {\n      conditions.push(eq(quizAttempts.contentId, contentId));\n    }\n    \n    return await db\n      .select()\n      .from(quizAttempts)\n      .where(and(...conditions))\n      .orderBy(desc(quizAttempts.completedAt));\n  }\n\n  async getLatestQuizAttempt(userId: string, contentId: string): Promise<QuizAttempt | undefined> {\n    const [result] = await db\n      .select()\n      .from(quizAttempts)\n      .where(and(\n        eq(quizAttempts.userId, userId),\n        eq(quizAttempts.contentId, contentId)\n      ))\n      .orderBy(desc(quizAttempts.completedAt))\n      .limit(1);\n    \n    return result;\n  }\n\n  // Section progress methods\n  async getSectionProgress(userId: string, courseId: string): Promise<SectionProgress[]> {\n    return await db\n      .select()\n      .from(sectionProgress)\n      .where(and(\n        eq(sectionProgress.userId, userId),\n        eq(sectionProgress.courseId, courseId)\n      ))\n      .orderBy(sectionProgress.chapter, sectionProgress.section);\n  }\n\n  async updateSectionProgress(userId: string, courseId: string, chapter: number, section: number, data: Partial<SectionProgress>): Promise<SectionProgress> {\n    // Try to find existing progress record\n    const [existing] = await db\n      .select()\n      .from(sectionProgress)\n      .where(and(\n        eq(sectionProgress.userId, userId),\n        eq(sectionProgress.courseId, courseId),\n        eq(sectionProgress.chapter, chapter),\n        eq(sectionProgress.section, section)\n      ));\n\n    if (existing) {\n      // Update existing record\n      const [updated] = await db\n        .update(sectionProgress)\n        .set({ ...data, updatedAt: new Date() })\n        .where(eq(sectionProgress.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new record\n      const [created] = await db\n        .insert(sectionProgress)\n        .values({\n          userId,\n          courseId,\n          chapter,\n          section,\n          ...data,\n        })\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async unlockNextSection(userId: string, courseId: string, chapter: number, section: number): Promise<void> {\n    // Get all course content to determine next section\n    const content = await db\n      .select()\n      .from(courseContent)\n      .where(eq(courseContent.courseId, courseId))\n      .orderBy(courseContent.chapter, courseContent.section);\n\n    // Find current section index\n    const currentIndex = content.findIndex(c => c.chapter === chapter && c.section === section);\n    \n    if (currentIndex >= 0 && currentIndex < content.length - 1) {\n      const nextContent = content[currentIndex + 1];\n      \n      // Unlock next section\n      await this.updateSectionProgress(userId, courseId, nextContent.chapter!, nextContent.section!, {\n        isUnlocked: true,\n        unlockedAt: new Date(),\n      });\n    }\n  }\n\n  async isSectionUnlocked(userId: string, courseId: string, chapter: number, section: number): Promise<boolean> {\n    // First section (section 101) is always unlocked\n    if (section === 101) {\n      return true;\n    }\n\n    const [progress] = await db\n      .select()\n      .from(sectionProgress)\n      .where(and(\n        eq(sectionProgress.userId, userId),\n        eq(sectionProgress.courseId, courseId),\n        eq(sectionProgress.chapter, chapter),\n        eq(sectionProgress.section, section)\n      ));\n\n    return progress?.isUnlocked || false;\n  }\n\n  // Lesson step progress methods\n  async updateLessonStepProgress(progressData: Partial<LessonStepProgress>): Promise<LessonStepProgress> {\n    // Try to find existing progress record\n    const [existing] = await db\n      .select()\n      .from(lessonStepProgress)\n      .where(and(\n        eq(lessonStepProgress.userId, progressData.userId!),\n        eq(lessonStepProgress.courseId, progressData.courseId!),\n        eq(lessonStepProgress.section, progressData.section!),\n        eq(lessonStepProgress.stepType, progressData.stepType!)\n      ));\n\n    if (existing) {\n      // Update existing record\n      const [updated] = await db\n        .update(lessonStepProgress)\n        .set({ ...progressData, updatedAt: new Date() })\n        .where(eq(lessonStepProgress.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      // Create new record\n      const [created] = await db\n        .insert(lessonStepProgress)\n        .values({\n          ...progressData,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        } as any)\n        .returning();\n      \n      return created;\n    }\n  }\n\n  async getLessonStepProgress(userId: string, courseId: string, section: number, stepType: string): Promise<LessonStepProgress | undefined> {\n    const [progress] = await db\n      .select()\n      .from(lessonStepProgress)\n      .where(and(\n        eq(lessonStepProgress.userId, userId),\n        eq(lessonStepProgress.courseId, courseId),\n        eq(lessonStepProgress.section, section),\n        eq(lessonStepProgress.stepType, stepType)\n      ));\n\n    return progress || undefined;\n  }\n\n  async getCurrentLessonStep(userId: string, courseId: string, section: number): Promise<{ stepType: string; stepIndex: number; currentPosition?: any } | null> {\n    // Get all lesson steps for this section, ordered by stepIndex\n    const steps = await db\n      .select()\n      .from(lessonStepProgress)\n      .where(and(\n        eq(lessonStepProgress.userId, userId),\n        eq(lessonStepProgress.courseId, courseId),\n        eq(lessonStepProgress.section, section)\n      ))\n      .orderBy(desc(lessonStepProgress.lastAccessedAt));\n\n    if (steps.length === 0) {\n      // No progress yet, start with introduction\n      return { stepType: 'introduction', stepIndex: 0 };\n    }\n\n    // Find the most recently accessed step that's not completed\n    const currentStep = steps.find(step => !step.isCompleted);\n    \n    if (currentStep) {\n      return {\n        stepType: currentStep.stepType,\n        stepIndex: currentStep.stepIndex,\n        currentPosition: currentStep.currentPosition\n      };\n    }\n\n    // All steps completed, return the last one\n    const lastStep = steps[0]; // Most recently accessed\n    return {\n      stepType: lastStep.stepType,\n      stepIndex: lastStep.stepIndex,\n      currentPosition: lastStep.currentPosition\n    };\n  }\n\n  // Product methods\n  async getProducts(category?: string, search?: string, page = 1, limit = 20): Promise<{ products: Product[], total: number }> {\n    const offset = (page - 1) * limit;\n    \n    const conditions = [eq(products.isActive, true)];\n    \n    if (category && category !== 'all') {\n      conditions.push(eq(products.category, category as any));\n    }\n    \n    if (search) {\n      const searchCondition = or(\n        ilike(products.name, `%${search}%`),\n        ilike(products.description, `%${search}%`),\n        ilike(products.brand, `%${search}%`)\n      );\n      if (searchCondition) {\n        conditions.push(searchCondition);\n      }\n    }\n    \n    const finalCondition = conditions.length > 1 ? and(...conditions) : conditions[0];\n    \n    const query = db.select().from(products).where(finalCondition);\n    const countQuery = db.select({ count: count() }).from(products).where(finalCondition);\n    \n    const productsResult = await query\n      .orderBy(desc(products.isFeatured), products.sortOrder, desc(products.createdAt))\n      .limit(limit)\n      .offset(offset);\n    \n    const [{ count: total }] = await countQuery;\n    \n    return { products: productsResult, total };\n  }\n\n  async getProduct(id: string): Promise<Product | undefined> {\n    const [product] = await db.select().from(products).where(eq(products.id, id));\n    return product || undefined;\n  }\n\n  async getFeaturedProducts(limit = 8): Promise<Product[]> {\n    return await db\n      .select()\n      .from(products)\n      .where(and(eq(products.isActive, true), eq(products.isFeatured, true)))\n      .orderBy(products.sortOrder, desc(products.createdAt))\n      .limit(limit);\n  }\n\n  async createProduct(product: InsertProduct): Promise<Product> {\n    const [newProduct] = await db\n      .insert(products)\n      .values(product)\n      .returning();\n    return newProduct;\n  }\n\n  async updateProduct(id: string, updates: Partial<Product>): Promise<Product> {\n    const [product] = await db\n      .update(products)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(products.id, id))\n      .returning();\n    return product;\n  }\n\n  async deleteProduct(id: string): Promise<void> {\n    await db.update(products).set({ isActive: false }).where(eq(products.id, id));\n  }\n\n  // Cart methods\n  async getCartItems(userId: string): Promise<(CartItem & { product: Product })[]> {\n    return await db\n      .select()\n      .from(cartItems)\n      .innerJoin(products, eq(cartItems.productId, products.id))\n      .where(eq(cartItems.userId, userId))\n      .orderBy(desc(cartItems.createdAt));\n  }\n\n  async addToCart(userId: string, productId: string, quantity = 1): Promise<CartItem> {\n    // Check if item already exists in cart\n    const [existing] = await db\n      .select()\n      .from(cartItems)\n      .where(and(eq(cartItems.userId, userId), eq(cartItems.productId, productId)));\n\n    if (existing) {\n      // Update existing item quantity\n      const [updated] = await db\n        .update(cartItems)\n        .set({ \n          quantity: existing.quantity + quantity,\n          updatedAt: new Date()\n        })\n        .where(eq(cartItems.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      // Create new cart item\n      const [newItem] = await db\n        .insert(cartItems)\n        .values({ userId, productId, quantity })\n        .returning();\n      return newItem;\n    }\n  }\n\n  async updateCartItem(userId: string, productId: string, quantity: number): Promise<CartItem> {\n    const [updated] = await db\n      .update(cartItems)\n      .set({ quantity, updatedAt: new Date() })\n      .where(and(eq(cartItems.userId, userId), eq(cartItems.productId, productId)))\n      .returning();\n    return updated;\n  }\n\n  async removeFromCart(userId: string, productId: string): Promise<void> {\n    await db\n      .delete(cartItems)\n      .where(and(eq(cartItems.userId, userId), eq(cartItems.productId, productId)));\n  }\n\n  async clearCart(userId: string): Promise<void> {\n    await db.delete(cartItems).where(eq(cartItems.userId, userId));\n  }\n\n  // Product review methods\n  async getProductReviews(productId: string): Promise<ProductReview[]> {\n    return await db\n      .select()\n      .from(productReviews)\n      .where(and(eq(productReviews.productId, productId), eq(productReviews.isApproved, true)))\n      .orderBy(desc(productReviews.createdAt));\n  }\n\n  async createProductReview(review: InsertProductReview): Promise<ProductReview> {\n    const [newReview] = await db\n      .insert(productReviews)\n      .values(review)\n      .returning();\n    return newReview;\n  }\n\n  async updateProductReview(id: string, updates: Partial<ProductReview>): Promise<ProductReview> {\n    const [review] = await db\n      .update(productReviews)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(productReviews.id, id))\n      .returning();\n    return review;\n  }\n\n  async deleteProductReview(id: string): Promise<void> {\n    await db.delete(productReviews).where(eq(productReviews.id, id));\n  }\n\n  // ===== GAMIFICATION METHODS =====\n\n  // Get user achievements with badge details\n  async getUserAchievements(userId: string): Promise<any[]> {\n    return await db\n      .select({\n        id: userAchievements.id,\n        earnedAt: userAchievements.earnedAt,\n        pointsEarned: userAchievements.pointsEarned,\n        achievement: {\n          id: achievements.id,\n          name: achievements.name,\n          description: achievements.description,\n          type: achievements.type,\n          icon: achievements.icon,\n          badgeColor: achievements.badgeColor,\n          pointValue: achievements.pointValue,\n        }\n      })\n      .from(userAchievements)\n      .innerJoin(achievements, eq(userAchievements.achievementId, achievements.id))\n      .where(eq(userAchievements.userId, userId))\n      .orderBy(desc(userAchievements.earnedAt));\n  }\n\n  // Award achievement to user (with duplicate check)\n  async awardAchievement(userId: string, achievementId: string): Promise<any> {\n    // Check if already earned\n    const existing = await db\n      .select()\n      .from(userAchievements)\n      .where(and(eq(userAchievements.userId, userId), eq(userAchievements.achievementId, achievementId)));\n\n    if (existing.length > 0) {\n      throw new Error(\"Achievement already earned\");\n    }\n\n    // Get achievement details for points\n    const [achievement] = await db\n      .select()\n      .from(achievements)\n      .where(eq(achievements.id, achievementId));\n\n    if (!achievement) {\n      throw new Error(\"Achievement not found\");\n    }\n\n    // Award the achievement\n    const [newAchievement] = await db\n      .insert(userAchievements)\n      .values({\n        userId,\n        achievementId,\n        pointsEarned: achievement.pointValue || 0,\n      })\n      .returning();\n\n    // Add points to user's total\n    if (achievement.pointValue && achievement.pointValue > 0) {\n      await this.addPoints(\n        userId,\n        achievement.pointValue,\n        \"achievement_earned\",\n        `Earned achievement: ${achievement.name}`,\n        achievementId\n      );\n    }\n\n    return newAchievement;\n  }\n\n  // Get user points summary\n  async getUserPointsSummary(userId: string): Promise<any> {\n    const [user] = await db\n      .select({\n        totalPoints: users.totalPoints,\n        currentStreak: users.currentStreak,\n        longestStreak: users.longestStreak,\n      })\n      .from(users)\n      .where(eq(users.id, userId));\n\n    const achievements = await this.getUserAchievements(userId);\n    \n    return {\n      totalPoints: user?.totalPoints || 0,\n      currentStreak: user?.currentStreak || 0,\n      longestStreak: user?.longestStreak || 0,\n      achievementCount: achievements.length,\n      recentAchievements: achievements.slice(0, 3),\n    };\n  }\n\n  // Get leaderboard based on period\n  async getLeaderboard(period: string): Promise<any[]> {\n    let query = db\n      .select({\n        userId: users.id,\n        username: users.username,\n        firstName: users.firstName,\n        lastName: users.lastName,\n        totalPoints: users.totalPoints,\n        currentStreak: users.currentStreak,\n        achievementCount: sql<number>`COUNT(${userAchievements.id})`,\n      })\n      .from(users)\n      .leftJoin(userAchievements, eq(users.id, userAchievements.userId))\n      .groupBy(users.id)\n      .orderBy(desc(users.totalPoints))\n      .limit(20);\n\n    return await query;\n  }\n\n  // Add points to user account\n  async addPoints(userId: string, points: number, action: string, description: string, referenceId?: string): Promise<void> {\n    // Get current balance\n    const [user] = await db\n      .select({ totalPoints: users.totalPoints })\n      .from(users)\n      .where(eq(users.id, userId));\n\n    const currentBalance = user?.totalPoints || 0;\n    const newBalance = currentBalance + points;\n\n    // Update user points\n    await db\n      .update(users)\n      .set({ \n        totalPoints: newBalance,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId));\n\n    // Record points history\n    await db\n      .insert(userPointsHistory)\n      .values({\n        userId,\n        points,\n        action,\n        description,\n        referenceId,\n        balanceBefore: currentBalance,\n        balanceAfter: newBalance,\n      });\n  }\n\n  // Get current monthly competition\n  async getCurrentCompetition(month: string): Promise<any> {\n    const [competition] = await db\n      .select()\n      .from(monthlyCompetitions)\n      .where(eq(monthlyCompetitions.month, month))\n      .orderBy(desc(monthlyCompetitions.createdAt));\n\n    if (!competition) {\n      // Create this month's competition if it doesn't exist\n      const now = new Date();\n      const year = now.getFullYear();\n      const monthNum = now.getMonth();\n      \n      // Last day of current month\n      const lastDay = new Date(year, monthNum + 1, 0);\n      const startDate = new Date(lastDay.getFullYear(), lastDay.getMonth(), lastDay.getDate(), 0, 0, 0);\n      const endDate = new Date(lastDay.getFullYear(), lastDay.getMonth(), lastDay.getDate(), 23, 59, 59);\n\n      const [newCompetition] = await db\n        .insert(monthlyCompetitions)\n        .values({\n          title: `${lastDay.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })} Plumbing Code Challenge`,\n          description: \"Test your knowledge of the complete Louisiana Plumbing Code in this month's competition!\",\n          month,\n          year,\n          startDate,\n          endDate,\n          status: 'upcoming',\n          timeLimit: 120, // 2 hours\n          questionCount: 100,\n          difficultyCounts: {\n            medium: 40,\n            hard: 40,\n            very_hard: 20\n          }\n        })\n        .returning();\n\n      return newCompetition;\n    }\n\n    return competition;\n  }\n\n  // Start competition attempt\n  async startCompetitionAttempt(competitionId: string, userId: string): Promise<any> {\n    // Check if user already attempted this competition\n    const existing = await db\n      .select()\n      .from(competitionAttempts)\n      .where(and(eq(competitionAttempts.competitionId, competitionId), eq(competitionAttempts.userId, userId)));\n\n    if (existing.length > 0) {\n      throw new Error(\"You have already attempted this competition\");\n    }\n\n    // Get competition details\n    const [competition] = await db\n      .select()\n      .from(monthlyCompetitions)\n      .where(eq(monthlyCompetitions.id, competitionId));\n\n    if (!competition) {\n      throw new Error(\"Competition not found\");\n    }\n\n    // Check if competition is active (on last day of month)\n    const now = new Date();\n    if (now < competition.startDate || now > competition.endDate) {\n      throw new Error(\"Competition is not currently active\");\n    }\n\n    // Get random questions based on difficulty\n    const questions = await this.getCompetitionQuestions(competition.difficultyCounts);\n\n    // Create attempt record\n    const [attempt] = await db\n      .insert(competitionAttempts)\n      .values({\n        competitionId,\n        userId,\n        questions,\n        totalQuestions: questions.length,\n        correctAnswers: 0,\n        score: \"0\",\n      })\n      .returning();\n\n    return {\n      ...attempt,\n      competition,\n      timeLimit: competition.timeLimit,\n    };\n  }\n\n  // Get random competition questions based on difficulty distribution\n  async getCompetitionQuestions(difficultyCounts: any): Promise<any[]> {\n    const questions: any[] = [];\n    \n    for (const [difficulty, count] of Object.entries(difficultyCounts)) {\n      const difficultyQuestions = await db\n        .select()\n        .from(competitionQuestions)\n        .where(and(\n          eq(competitionQuestions.difficulty, difficulty as any),\n          eq(competitionQuestions.isActive, true)\n        ))\n        .orderBy(sql`RANDOM()`)\n        .limit(count as number);\n\n      questions.push(...difficultyQuestions);\n    }\n\n    return questions;\n  }\n\n  // Get all active questions from database (for duplicate checking across entire database)\n  async getAllActiveQuestions(): Promise<any[]> {\n    return await db\n      .select()\n      .from(competitionQuestions)\n      .where(eq(competitionQuestions.isActive, true))\n      .orderBy(competitionQuestions.createdAt);\n  }\n\n  // Get questions filtered by courseId (for course statistics)\n  async getQuestionsByCourse(courseId: string): Promise<any[]> {\n    // Since competitionQuestions don't have courseId, return all active questions for now\n    // TODO: Add proper course-question mapping based on codeReference or category\n    return await db\n      .select()\n      .from(competitionQuestions)\n      .where(eq(competitionQuestions.isActive, true))\n      .orderBy(competitionQuestions.createdAt);\n  }\n\n  // Get questions by section for quiz\n  async getQuestionsBySection(section: string): Promise<any[]> {\n    console.log('ðŸ” Getting questions for section:', section);\n    \n    const questions = await db\n      .select()\n      .from(competitionQuestions)\n      .where(and(\n        eq(competitionQuestions.isActive, true),\n        like(competitionQuestions.codeReference, `%${section}%`)\n      ))\n      .orderBy(competitionQuestions.createdAt);\n      \n    console.log('ðŸ“Š Found', questions.length, 'questions for section', section);\n    console.log('ðŸ“ Code references:', questions.map(q => q.codeReference).slice(0, 3));\n    \n    return questions;\n  }\n\n  // Create a new question\n  async createQuestion(questionData: any): Promise<any> {\n    // Handle both field names for question text\n    const questionText = questionData.question || questionData.questionText;\n    \n    if (!questionText) {\n      throw new Error('Question text is required');\n    }\n    \n    const [newQuestion] = await db\n      .insert(competitionQuestions)\n      .values({\n        question: questionText,\n        options: questionData.options,\n        correctAnswer: questionData.correctAnswer,\n        explanation: questionData.explanation,\n        difficulty: questionData.difficulty || 'medium',\n        category: questionData.category || questionData.chapter,\n        codeReference: questionData.codeReference || questionData.section || `${questionData.chapter || 'General'} - ${questionData.section || 'Section 1'}`,\n        pointValue: questionData.pointValue || 1,\n        isActive: true\n      })\n      .returning();\n    return newQuestion;\n  }\n\n  // Submit competition attempt\n  async submitCompetitionAttempt(competitionId: string, userId: string, answers: any[], timeSpent: number): Promise<any> {\n    // Get the attempt\n    const [attempt] = await db\n      .select()\n      .from(competitionAttempts)\n      .where(and(eq(competitionAttempts.competitionId, competitionId), eq(competitionAttempts.userId, userId)));\n\n    if (!attempt) {\n      throw new Error(\"Competition attempt not found\");\n    }\n\n    if (attempt.completedAt) {\n      throw new Error(\"Competition already completed\");\n    }\n\n    // Calculate score\n    const questions = attempt.questions as any[];\n    let correctAnswers = 0;\n\n    for (let i = 0; i < questions.length; i++) {\n      const question = questions[i];\n      const userAnswer = answers[i];\n      \n      if (userAnswer === question.correctAnswer) {\n        correctAnswers++;\n      }\n    }\n\n    const score = (correctAnswers / questions.length) * 100;\n    const pointsEarned = Math.floor(score * 2); // 2 points per percentage point\n\n    // Update attempt\n    const [updatedAttempt] = await db\n      .update(competitionAttempts)\n      .set({\n        correctAnswers,\n        score,\n        timeSpent,\n        completedAt: new Date(),\n        pointsEarned,\n      })\n      .where(eq(competitionAttempts.id, attempt.id))\n      .returning();\n\n    // Award points\n    await this.addPoints(\n      userId,\n      pointsEarned,\n      \"competition_completed\",\n      `Completed monthly competition with ${score.toFixed(1)}% score`,\n      competitionId\n    );\n\n    return updatedAttempt;\n  }\n\n  // Get user's competition history\n  async getUserCompetitionHistory(userId: string): Promise<any[]> {\n    return await db\n      .select({\n        id: competitionAttempts.id,\n        score: competitionAttempts.score,\n        rank: competitionAttempts.rank,\n        timeSpent: competitionAttempts.timeSpent,\n        pointsEarned: competitionAttempts.pointsEarned,\n        completedAt: competitionAttempts.completedAt,\n        competition: {\n          id: monthlyCompetitions.id,\n          title: monthlyCompetitions.title,\n          month: monthlyCompetitions.month,\n          year: monthlyCompetitions.year,\n        }\n      })\n      .from(competitionAttempts)\n      .innerJoin(monthlyCompetitions, eq(competitionAttempts.competitionId, monthlyCompetitions.id))\n      .where(eq(competitionAttempts.userId, userId))\n      .orderBy(desc(competitionAttempts.completedAt));\n  }\n\n  // Create monthly competition (admin only)\n  async createMonthlyCompetition(competition: any): Promise<any> {\n    const [newCompetition] = await db\n      .insert(monthlyCompetitions)\n      .values(competition)\n      .returning();\n\n    return newCompetition;\n  }\n\n  // Additional study session methods\n  async createStudySession(data: InsertStudySession): Promise<StudySession> {\n    const [session] = await db\n      .insert(studySessions)\n      .values(data)\n      .returning();\n    \n    return session;\n  }\n\n  async updateStudySession(sessionId: string, updates: Partial<StudySession>): Promise<StudySession> {\n    const [session] = await db\n      .update(studySessions)\n      .set(updates)\n      .where(eq(studySessions.id, sessionId))\n      .returning();\n    \n    if (!session) {\n      throw new Error('Study session not found');\n    }\n    \n    return session;\n  }\n\n  // Course content wrapper methods\n  async createLesson(lesson: InsertCourseContent): Promise<CourseContent> {\n    return this.createCourseContent({ ...lesson, type: 'lesson' });\n  }\n\n  async createChapter(chapter: InsertCourseContent): Promise<CourseContent> {\n    return this.createCourseContent({ ...chapter, type: 'chapter' });\n  }\n\n  // Lessons breakdown - only chapter/section, no difficulty\n  async getCourseContentBreakdowns(courseId: string): Promise<any> {\n    const lessons = await db\n      .select({\n        chapter: courseContent.chapter,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'lesson')))\n      .groupBy(courseContent.chapter);\n\n    const sections = await db\n      .select({\n        section: courseContent.section,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'lesson')))\n      .groupBy(courseContent.section);\n\n    return {\n      byChapter: lessons.map(item => ({ category: `Chapter ${item.chapter}`, count: item.count })),\n      bySection: sections.map(item => ({ codeReference: `Section ${item.section}`, count: item.count }))\n      // No byDifficulty for lessons - they don't have meaningful difficulty levels\n    };\n  }\n\n  // Study Notes breakdown - chapter/section only, no difficulty\n  async getStudySessionBreakdowns(courseId: string): Promise<any> {\n    const chapters = await db\n      .select({\n        chapter: courseContent.chapter,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'study-notes')))\n      .groupBy(courseContent.chapter);\n\n    const sections = await db\n      .select({\n        section: courseContent.section,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'study-notes')))\n      .groupBy(courseContent.section);\n\n    return {\n      byChapter: chapters.map(item => ({ category: `Chapter ${item.chapter}`, count: item.count })),\n      bySection: sections.map(item => ({ codeReference: `Section ${item.section}`, count: item.count }))\n      // No byDifficulty for study notes - they're informational content, not difficulty-based\n    };\n  }\n\n  async getEnrollmentBreakdowns(courseId: string): Promise<any> {\n    const chapters = await db\n      .select({\n        chapter: courseContent.chapter,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'study-plan')))\n      .groupBy(courseContent.chapter);\n\n    const sections = await db\n      .select({\n        section: courseContent.section,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'study-plan')))\n      .groupBy(courseContent.section);\n\n    // Get actual difficulty breakdown for study plans\n    const difficultyResults = await db\n      .select({\n        difficulty: courseContent.difficulty,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'study-plan')))\n      .groupBy(courseContent.difficulty);\n\n    // Ensure all difficulty levels are represented\n    const difficultyMap = new Map(difficultyResults.map(d => [d.difficulty, d.count]));\n    const difficulty = [\n      { difficulty: 'easy', count: difficultyMap.get('easy') || 0 },\n      { difficulty: 'hard', count: difficultyMap.get('hard') || 0 },\n      { difficulty: 'very_hard', count: difficultyMap.get('very_hard') || 0 }\n    ];\n\n    return {\n      byChapter: chapters.map(item => ({ category: `Chapter ${item.chapter}`, count: item.count })),\n      bySection: sections.map(item => ({ codeReference: `Section ${item.section}`, count: item.count })),\n      byDifficulty: difficulty\n    };\n  }\n\n  // Podcasts breakdown - only chapter/section, no difficulty\n  async getUserProgressBreakdowns(courseId: string): Promise<any> {\n    const chapters = await db\n      .select({\n        chapter: courseContent.chapter,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'podcast')))\n      .groupBy(courseContent.chapter);\n\n    const sections = await db\n      .select({\n        section: courseContent.section,\n        count: sql<number>`COUNT(*)`\n      })\n      .from(courseContent)\n      .where(and(eq(courseContent.courseId, courseId), eq(courseContent.type, 'podcast')))\n      .groupBy(courseContent.section);\n\n    return {\n      byChapter: chapters.map(item => ({ category: `Chapter ${item.chapter}`, count: item.count })),\n      bySection: sections.map(item => ({ codeReference: `Section ${item.section}`, count: item.count }))\n      // No byDifficulty for podcasts - they're just educational content, not difficulty-based\n    };\n  }\n\n  // Audio cache methods\n  async getCachedAudio(contentHash: string): Promise<AudioCache | undefined> {\n    const [audio] = await db.select().from(audioCache).where(eq(audioCache.contentHash, contentHash));\n    return audio || undefined;\n  }\n\n  async createCachedAudio(audioData: InsertAudioCache): Promise<AudioCache> {\n    const [audio] = await db.insert(audioCache).values(audioData).returning();\n    return audio;\n  }\n\n  async updateAudioAccess(contentHash: string): Promise<void> {\n    await db\n      .update(audioCache)\n      .set({ \n        lastAccessedAt: new Date(),\n        accessCount: sql`${audioCache.accessCount} + 1`\n      })\n      .where(eq(audioCache.contentHash, contentHash));\n  }\n\n  // AI response cache methods\n  async getCachedAiResponse(questionHash: string): Promise<AiResponseCache | undefined> {\n    const [response] = await db\n      .select()\n      .from(aiResponseCache)\n      .where(and(\n        eq(aiResponseCache.questionHash, questionHash),\n        eq(aiResponseCache.isValid, true)\n      ));\n    return response || undefined;\n  }\n\n  async createCachedAiResponse(responseData: InsertAiResponseCache): Promise<AiResponseCache> {\n    const [response] = await db.insert(aiResponseCache).values(responseData).returning();\n    return response;\n  }\n\n  async updateAiResponseAccess(questionHash: string): Promise<void> {\n    await db\n      .update(aiResponseCache)\n      .set({ \n        lastAccessedAt: new Date(),\n        accessCount: sql`${aiResponseCache.accessCount} + 1`\n      })\n      .where(eq(aiResponseCache.questionHash, questionHash));\n  }\n\n  async invalidateAiResponseCache(questionHash?: string): Promise<void> {\n    if (questionHash) {\n      // Invalidate specific cached response\n      await db\n        .update(aiResponseCache)\n        .set({ isValid: false })\n        .where(eq(aiResponseCache.questionHash, questionHash));\n    } else {\n      // Invalidate all cached responses (for global cache refresh)\n      await db\n        .update(aiResponseCache)\n        .set({ isValid: false });\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":82803},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport { \n  pgTable, \n  text, \n  varchar, \n  integer, \n  serial,\n  decimal, \n  boolean, \n  timestamp, \n  jsonb,\n  pgEnum,\n  unique\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums\nexport const subscriptionTierEnum = pgEnum(\"subscription_tier\", [\"basic\", \"professional\", \"master\"]);\nexport const courseTypeEnum = pgEnum(\"course_type\", [\"journeyman\", \"backflow\", \"natural_gas\", \"medical_gas\", \"master\"]);\nexport const jobTypeEnum = pgEnum(\"job_type\", [\"full_time\", \"part_time\", \"contract\", \"temporary\"]);\nexport const paymentStatusEnum = pgEnum(\"payment_status\", [\"pending\", \"completed\", \"failed\", \"cancelled\"]);\nexport const productCategoryEnum = pgEnum(\"product_category\", [\"gas_detection\", \"pipe_tools\", \"measuring\", \"safety\", \"valves\", \"fittings\", \"books\", \"training_materials\"]);\nexport const jobStatusEnum = pgEnum(\"job_status\", [\"pending\", \"approved\", \"rejected\", \"expired\"]);\nexport const emailCampaignTypeEnum = pgEnum(\"email_campaign_type\", [\"employer_onboarding\", \"student_enrollment\", \"bulk_enrollment\"]);\nexport const emailStatusEnum = pgEnum(\"email_status\", [\"pending\", \"sent\", \"failed\", \"cancelled\"]);\nexport const bulkEnrollmentStatusEnum = pgEnum(\"bulk_enrollment_status\", [\"pending\", \"approved\", \"active\", \"cancelled\"]);\nexport const leadSourceEnum = pgEnum(\"lead_source\", [\"linkedin\", \"website\", \"referral\", \"google\", \"facebook\", \"other\"]);\nexport const paymentMethodEnum = pgEnum(\"payment_method\", [\"paypal\", \"stripe_transfer\", \"account_credit\"]);\nexport const payoutStatusEnum = pgEnum(\"payout_status\", [\"pending\", \"processing\", \"completed\", \"failed\", \"cancelled\"]);\nexport const achievementTypeEnum = pgEnum(\"achievement_type\", [\"course_completion\", \"quiz_mastery\", \"study_streak\", \"first_login\", \"perfect_score\", \"speed_demon\", \"social_sharer\", \"mentor_helper\"]);\nexport const questionDifficultyEnum = pgEnum(\"question_difficulty\", [\"easy\", \"hard\", \"very_hard\"]);\nexport const competitionStatusEnum = pgEnum(\"competition_status\", [\"upcoming\", \"active\", \"completed\", \"cancelled\"]);\nexport const productSearchCategoryEnum = pgEnum(\"product_search_category\", [\"tools\", \"pipe_fittings\", \"valves\", \"safety_equipment\", \"measuring_tools\", \"books\", \"supplies\", \"all\"]);\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  firstName: text(\"first_name\"),\n  lastName: text(\"last_name\"),\n  phone: text(\"phone\"),\n  subscriptionTier: subscriptionTierEnum(\"subscription_tier\").default(\"basic\"),\n  stripeCustomerId: text(\"stripe_customer_id\"),\n  stripeSubscriptionId: text(\"stripe_subscription_id\"),\n  referralCode: text(\"referral_code\").unique(),\n  referredBy: text(\"referred_by\"),\n  // Payment preferences\n  preferredPaymentMethod: paymentMethodEnum(\"preferred_payment_method\").default(\"paypal\"),\n  paypalEmail: text(\"paypal_email\"),\n  accountBalance: decimal(\"account_balance\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  minimumPayout: decimal(\"minimum_payout\", { precision: 10, scale: 2 }).default(\"25.00\"),\n  // Gamification fields\n  totalPoints: integer(\"total_points\").default(0),\n  currentStreak: integer(\"current_streak\").default(0),\n  longestStreak: integer(\"longest_streak\").default(0),\n  lastLoginDate: timestamp(\"last_login_date\"),\n  // Beta testing fields\n  isBetaTester: boolean(\"is_beta_tester\").default(false),\n  betaStartedAt: timestamp(\"beta_started_at\"),\n  // Adaptive difficulty settings\n  preferredDifficulty: questionDifficultyEnum(\"preferred_difficulty\").default(\"easy\"),\n  currentSkillLevel: questionDifficultyEnum(\"current_skill_level\").default(\"easy\"),\n  adaptiveDifficultyEnabled: boolean(\"adaptive_difficulty_enabled\").default(true),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Courses table\nexport const courses = pgTable(\"courses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  type: courseTypeEnum(\"type\").notNull(),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  duration: text(\"duration\"), // e.g., \"2 months\", \"1.5 months\"\n  lessons: integer(\"lessons\"),\n  practiceQuestions: integer(\"practice_questions\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Course enrollments\nexport const courseEnrollments = pgTable(\"course_enrollments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  courseId: text(\"course_id\").notNull(),\n  progress: decimal(\"progress\", { precision: 5, scale: 2 }).default(\"0\"),\n  completedLessons: integer(\"completed_lessons\").default(0),\n  testScores: jsonb(\"test_scores\"), // Array of test scores\n  isCompleted: boolean(\"is_completed\").default(false),\n  enrolledAt: timestamp(\"enrolled_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\n// Employers table\nexport const employers = pgTable(\"employers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyName: text(\"company_name\").notNull(),\n  contactName: text(\"contact_name\").notNull(),\n  contactEmail: text(\"contact_email\").notNull().unique(),\n  contactPhone: text(\"contact_phone\"),\n  companyWebsite: text(\"company_website\"),\n  companyDescription: text(\"company_description\"),\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\").default(\"Louisiana\"),\n  zipCode: text(\"zip_code\"),\n  isVerified: boolean(\"is_verified\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Jobs table\nexport const jobs = pgTable(\"jobs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  employerId: text(\"employer_id\").notNull(),\n  title: text(\"title\").notNull(),\n  company: text(\"company\").notNull(),\n  description: text(\"description\").notNull(),\n  location: text(\"location\").notNull(),\n  type: jobTypeEnum(\"type\").notNull(),\n  salaryMin: decimal(\"salary_min\", { precision: 10, scale: 2 }),\n  salaryMax: decimal(\"salary_max\", { precision: 10, scale: 2 }),\n  requirements: text(\"requirements\").array(),\n  benefits: text(\"benefits\").array(),\n  contactEmail: text(\"contact_email\").notNull(),\n  status: jobStatusEnum(\"status\").default(\"pending\"),\n  isFeatured: boolean(\"is_featured\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  rejectionReason: text(\"rejection_reason\"),\n  approvedBy: text(\"approved_by\"),\n  approvedAt: timestamp(\"approved_at\"),\n  expiresAt: timestamp(\"expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Job applications\nexport const jobApplications = pgTable(\"job_applications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  jobId: text(\"job_id\").notNull(),\n  userId: text(\"user_id\").notNull(),\n  resumeUrl: text(\"resume_url\"),\n  coverLetter: text(\"cover_letter\"),\n  status: text(\"status\").default(\"pending\"),\n  appliedAt: timestamp(\"applied_at\").defaultNow(),\n});\n\n// AI mentor conversations\nexport const mentorConversations = pgTable(\"mentor_conversations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  messages: jsonb(\"messages\").notNull(), // Array of messages\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Study companion chat messages\nexport const studyCompanionMessages = pgTable(\"study_companion_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  role: text(\"role\").notNull(), // \"user\" or \"assistant\"\n  content: text(\"content\").notNull(),\n  emotion: text(\"emotion\"), // For assistant messages: \"happy\", \"excited\", \"helpful\", \"thinking\", \"encouraging\"\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Chat answers for course content\nexport const chatAnswers = pgTable(\"chat_answers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  question: text(\"question\").notNull(),\n  answer: text(\"answer\").notNull(),\n  contentId: text(\"content_id\"),\n  keywords: text(\"keywords\").array(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Flashcards for course study\nexport const flashcards = pgTable(\"flashcards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  courseId: text(\"course_id\").notNull(),\n  front: text(\"front\").notNull(),\n  back: text(\"back\").notNull(),\n  difficulty: text(\"difficulty\"), // Optional difficulty level\n  chapter: integer(\"chapter\"), // Chapter number\n  section: integer(\"section\"), // Section number\n  codeReference: text(\"code_reference\"), // Chapter and section reference string\n  category: text(\"category\"), // Category/chapter description\n  tags: text(\"tags\").array(), // Optional tags for categorization\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Photo uploads for code checking\nexport const photoUploads = pgTable(\"photo_uploads\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  filename: text(\"filename\").notNull(),\n  url: text(\"url\").notNull(),\n  analysis: jsonb(\"analysis\"), // AI analysis results\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Plan uploads\nexport const planUploads = pgTable(\"plan_uploads\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  filename: text(\"filename\").notNull(),\n  url: text(\"url\").notNull(),\n  materialList: jsonb(\"material_list\"), // Generated material list\n  analysis: jsonb(\"analysis\"), // Plan analysis results\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Audio cache for generated TTS files\nexport const audioCache = pgTable(\"audio_cache\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentHash: text(\"content_hash\").notNull().unique(), // Hash of the text content\n  contentId: text(\"content_id\").notNull(), // Content identifier for organization\n  audioData: text(\"audio_data\").notNull(), // Base64 encoded audio data (MP3)\n  mimeType: text(\"mime_type\").notNull().default(\"audio/mpeg\"), // MIME type\n  fileSize: integer(\"file_size\").notNull(), // File size in bytes\n  duration: integer(\"duration\"), // Audio duration in seconds (optional)\n  generatedAt: timestamp(\"generated_at\").defaultNow(),\n  lastAccessedAt: timestamp(\"last_accessed_at\").defaultNow(),\n  accessCount: integer(\"access_count\").default(0), // Track usage for cleanup\n});\n\n// AI response cache for mentor chat responses\nexport const aiResponseCache = pgTable(\"ai_response_cache\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  questionHash: text(\"question_hash\").notNull().unique(), // Hash of normalized question\n  originalQuestion: text(\"original_question\").notNull(), // Original question text\n  response: text(\"response\").notNull(), // AI generated response\n  contextHash: text(\"context_hash\"), // Hash of context (section, tier, etc.) for more specific caching\n  subscriptionTier: subscriptionTierEnum(\"subscription_tier\"), // Tier-specific responses\n  currentSection: text(\"current_section\"), // Course section context\n  modelUsed: text(\"model_used\").default(\"gpt-5\"), // Track which AI model generated the response\n  tokensUsed: integer(\"tokens_used\"), // Track API usage for analytics\n  generatedAt: timestamp(\"generated_at\").defaultNow(),\n  lastAccessedAt: timestamp(\"last_accessed_at\").defaultNow(),\n  accessCount: integer(\"access_count\").default(0), // Track usage for cache management\n  isValid: boolean(\"is_valid\").default(true), // Flag for cache invalidation\n});\n\n// Referrals\nexport const referrals = pgTable(\"referrals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  referrerId: text(\"referrer_id\").notNull(),\n  referredId: text(\"referred_id\").notNull(),\n  referrerPlanTier: subscriptionTierEnum(\"referrer_plan_tier\").notNull(),\n  referredPlanTier: subscriptionTierEnum(\"referred_plan_tier\").notNull(),\n  referredPlanPrice: decimal(\"referred_plan_price\", { precision: 10, scale: 2 }).notNull(),\n  commissionRate: decimal(\"commission_rate\", { precision: 5, scale: 4 }).default(\"0.10\"), // 10% default\n  commissionAmount: decimal(\"commission_amount\", { precision: 10, scale: 2 }),\n  eligibleTier: subscriptionTierEnum(\"eligible_tier\").notNull(), // The tier used for commission calculation\n  isPaid: boolean(\"is_paid\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  paidAt: timestamp(\"paid_at\"),\n});\n\n// Monthly recurring commissions from subscription upgrades/renewals\nexport const monthlyCommissions = pgTable(\"monthly_commissions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  referralId: text(\"referral_id\").notNull().references(() => referrals.id),\n  referrerId: text(\"referrer_id\").notNull(),\n  referredUserId: text(\"referred_user_id\").notNull(),\n  commissionMonth: varchar(\"commission_month\").notNull(), // Format: \"2025-01\" \n  referrerTierAtTime: subscriptionTierEnum(\"referrer_tier_at_time\").notNull(),\n  referredTierAtTime: subscriptionTierEnum(\"referred_tier_at_time\").notNull(),\n  eligibleTier: subscriptionTierEnum(\"eligible_tier\").notNull(),\n  commissionAmount: decimal(\"commission_amount\", { precision: 10, scale: 2 }).notNull(),\n  commissionRate: decimal(\"commission_rate\", { precision: 5, scale: 4 }).default(\"0.10\"),\n  isPaid: boolean(\"is_paid\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  paidAt: timestamp(\"paid_at\"),\n}, (table) => ({\n  uniqueMonthlyCommission: unique(\"unique_monthly_commission\").on(table.referralId, table.commissionMonth),\n}));\n\n// Payout requests\nexport const payoutRequests = pgTable(\"payout_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  paymentMethod: paymentMethodEnum(\"payment_method\").notNull(),\n  paymentDetails: jsonb(\"payment_details\"), // PayPal email, Stripe details, etc.\n  status: payoutStatusEnum(\"status\").default(\"pending\"),\n  referralIds: text(\"referral_ids\").array(), // Array of referral IDs included in this payout\n  monthlyCommissionIds: text(\"monthly_commission_ids\").array(), // Array of monthly commission IDs\n  transactionId: text(\"transaction_id\"), // External payment service transaction ID\n  failureReason: text(\"failure_reason\"),\n  requestedAt: timestamp(\"requested_at\").defaultNow(),\n  processedAt: timestamp(\"processed_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Account credit transactions\nexport const accountCreditTransactions = pgTable(\"account_credit_transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  type: varchar(\"type\").notNull(), // \"credit\", \"debit\", \"refund\"\n  description: text(\"description\").notNull(),\n  referenceId: text(\"reference_id\"), // Reference to commission, refund, etc.\n  balanceBefore: decimal(\"balance_before\", { precision: 10, scale: 2 }).notNull(),\n  balanceAfter: decimal(\"balance_after\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Course content (lessons, quizzes, etc.)\nexport const courseContent = pgTable(\"course_content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  courseId: text(\"course_id\").notNull(),\n  title: text(\"title\").notNull(),\n  type: text(\"type\").notNull(), // 'lesson', 'quiz', 'review', 'video'\n  chapter: integer(\"chapter\"),\n  section: integer(\"section\"),\n  content: jsonb(\"content\"), // Main content (HTML, quiz questions, etc.)\n  duration: integer(\"duration\"), // in minutes\n  difficulty: questionDifficultyEnum(\"difficulty\"), // easy, hard, very_hard\n  quizgeckoUrl: text(\"quizgecko_url\"), // URL for QuizGecko content\n  isActive: boolean(\"is_active\").default(true),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Private code books (admin reference only)\nexport const privateCodeBooks = pgTable(\"private_code_books\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  filename: text(\"filename\").notNull(),\n  originalName: text(\"original_name\").notNull(),\n  filePath: text(\"file_path\").notNull(),\n  fileSize: integer(\"file_size\").notNull(),\n  contentType: text(\"content_type\").notNull(),\n  uploadedBy: text(\"uploaded_by\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Study sessions (time tracking)\nexport const studySessions = pgTable(\"study_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  contentId: text(\"content_id\").notNull(),\n  contentType: text(\"content_type\").notNull(), // 'lesson', 'flashcards', 'quiz', 'chat', 'podcast', 'study_notes', 'study_plans'\n  sessionStart: timestamp(\"session_start\").defaultNow(),\n  sessionEnd: timestamp(\"session_end\"),\n  durationSeconds: integer(\"duration_seconds\"), // calculated duration in seconds\n  completed: boolean(\"completed\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Quiz attempts\nexport const quizAttempts = pgTable(\"quiz_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  contentId: text(\"content_id\").notNull(), // quiz content ID\n  courseId: text(\"course_id\").notNull(),\n  section: integer(\"section\").notNull(),\n  chapter: integer(\"chapter\").notNull(),\n  questions: jsonb(\"questions\").notNull(), // Array of questions with user answers\n  totalQuestions: integer(\"total_questions\").notNull(),\n  correctAnswers: integer(\"correct_answers\").notNull(),\n  score: decimal(\"score\", { precision: 5, scale: 2 }).notNull(), // percentage score\n  passed: boolean(\"passed\").notNull(), // true if score >= 70%\n  completedAt: timestamp(\"completed_at\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Section progress tracking\nexport const sectionProgress = pgTable(\"section_progress\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  courseId: text(\"course_id\").notNull(),\n  chapter: integer(\"chapter\").notNull(),\n  section: integer(\"section\").notNull(),\n  isUnlocked: boolean(\"is_unlocked\").default(false),\n  quizPassed: boolean(\"quiz_passed\").default(false),\n  highestScore: decimal(\"highest_score\", { precision: 5, scale: 2 }).default(\"0\"),\n  attemptCount: integer(\"attempt_count\").default(0),\n  lastAttemptAt: timestamp(\"last_attempt_at\"),\n  unlockedAt: timestamp(\"unlocked_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Lesson step progress tracking (detailed progress within each lesson)\nexport const lessonStepProgress = pgTable(\"lesson_step_progress\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  courseId: text(\"course_id\").notNull(),\n  section: integer(\"section\").notNull(),\n  stepType: text(\"step_type\").notNull(), // 'introduction', 'podcast', 'flashcards', 'ai_chat', 'study_notes', 'quiz'\n  stepIndex: integer(\"step_index\").notNull(), // 0-5 for the 6 lesson steps\n  isCompleted: boolean(\"is_completed\").default(false),\n  currentPosition: jsonb(\"current_position\"), // Current position within the step (podcast timestamp, flashcard index, etc.)\n  timeSpent: integer(\"time_spent\").default(0), // Total time spent on this step in seconds\n  lastAccessedAt: timestamp(\"last_accessed_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  uniqueLessonStep: unique(\"unique_lesson_step\").on(table.userId, table.courseId, table.section, table.stepType),\n}));\n\n// Products\nexport const products = pgTable(\"products\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  shortDescription: text(\"short_description\"),\n  category: productCategoryEnum(\"category\").notNull(),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  originalPrice: decimal(\"original_price\", { precision: 10, scale: 2 }),\n  amazonUrl: text(\"amazon_url\").notNull(),\n  affiliateTag: text(\"affiliate_tag\").default(\"laplumbprep-20\"),\n  imageUrl: text(\"image_url\"),\n  brand: text(\"brand\"),\n  model: text(\"model\"),\n  features: text(\"features\").array(),\n  specifications: jsonb(\"specifications\"),\n  rating: decimal(\"rating\", { precision: 3, scale: 1 }).default(\"0\"),\n  reviewCount: integer(\"review_count\").default(0),\n  isActive: boolean(\"is_active\").default(true),\n  isFeatured: boolean(\"is_featured\").default(false),\n  tags: text(\"tags\").array(),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Cart items\nexport const cartItems = pgTable(\"cart_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  productId: text(\"product_id\").notNull(),\n  quantity: integer(\"quantity\").notNull().default(1),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Product reviews\nexport const productReviews = pgTable(\"product_reviews\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: text(\"product_id\").notNull(),\n  userId: text(\"user_id\").notNull(),\n  rating: integer(\"rating\").notNull(), // 1-5 stars\n  title: text(\"title\"),\n  comment: text(\"comment\"),\n  isVerifiedPurchase: boolean(\"is_verified_purchase\").default(false),\n  helpfulCount: integer(\"helpful_count\").default(0),\n  isApproved: boolean(\"is_approved\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Achievements table\nexport const achievements = pgTable(\"achievements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  type: achievementTypeEnum(\"type\").notNull(),\n  icon: text(\"icon\").notNull(), // Lucide icon name\n  pointValue: integer(\"point_value\").default(0),\n  badgeColor: text(\"badge_color\").default(\"blue\"), // for UI styling\n  criteria: jsonb(\"criteria\"), // conditions needed to earn this achievement\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User achievements (earned badges)\nexport const userAchievements = pgTable(\"user_achievements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  achievementId: text(\"achievement_id\").notNull(),\n  earnedAt: timestamp(\"earned_at\").defaultNow(),\n  pointsEarned: integer(\"points_earned\").default(0),\n}, (table) => ({\n  uniqueUserAchievement: unique(\"unique_user_achievement\").on(table.userId, table.achievementId),\n}));\n\n// Monthly competitions\nexport const monthlyCompetitions = pgTable(\"monthly_competitions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  month: varchar(\"month\").notNull(), // Format: \"2025-01\"\n  year: integer(\"year\").notNull(),\n  status: competitionStatusEnum(\"status\").default(\"upcoming\"),\n  startDate: timestamp(\"start_date\").notNull(), // last day of month\n  endDate: timestamp(\"end_date\").notNull(), // end of last day\n  timeLimit: integer(\"time_limit\").notNull().default(120), // minutes\n  questionCount: integer(\"question_count\").default(100),\n  difficultyCounts: jsonb(\"difficulty_counts\"), // {medium: 40, hard: 40, very_hard: 20}\n  firstPlaceReward: text(\"first_place_reward\").default(\"free_month\"),\n  secondPlaceReward: text(\"second_place_reward\").default(\"half_month\"),\n  participantPoints: integer(\"participant_points\").default(100), // points for participating\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  uniqueMonthlyCompetition: unique(\"unique_monthly_competition\").on(table.month, table.year),\n}));\n\n// Competition attempts\nexport const competitionAttempts = pgTable(\"competition_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  competitionId: text(\"competition_id\").notNull(),\n  userId: text(\"user_id\").notNull(),\n  questions: jsonb(\"questions\").notNull(), // Array of questions with user answers\n  totalQuestions: integer(\"total_questions\").notNull(),\n  correctAnswers: integer(\"correct_answers\").notNull(),\n  score: decimal(\"score\", { precision: 5, scale: 2 }).notNull(), // percentage score\n  rank: integer(\"rank\"), // position in competition (calculated after competition ends)\n  timeSpent: integer(\"time_spent\"), // seconds spent on test\n  startedAt: timestamp(\"started_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n  pointsEarned: integer(\"points_earned\").default(0),\n}, (table) => ({\n  uniqueCompetitionAttempt: unique(\"unique_competition_attempt\").on(table.competitionId, table.userId),\n}));\n\n// Competition questions (enhanced quiz system)\nexport const competitionQuestions = pgTable(\"competition_questions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  question: text(\"question\").notNull(),\n  options: jsonb(\"options\").notNull(), // Array of answer choices\n  correctAnswer: integer(\"correct_answer\").notNull(), // index of correct option\n  explanation: text(\"explanation\"),\n  difficulty: questionDifficultyEnum(\"difficulty\").notNull(),\n  category: text(\"category\"), // e.g. \"water_supply\", \"drainage\", \"gas_piping\"\n  codeReference: text(\"code_reference\"), // chapter/section reference\n  pointValue: integer(\"point_value\").default(1),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// User points history\nexport const userPointsHistory = pgTable(\"user_points_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  points: integer(\"points\").notNull(), // can be positive or negative\n  action: text(\"action\").notNull(), // e.g., \"quiz_completion\", \"achievement_earned\", \"daily_login\"\n  description: text(\"description\"), // human-readable description\n  referenceId: text(\"reference_id\"), // ID of related record (quiz, achievement, etc.)\n  balanceBefore: integer(\"balance_before\").notNull(),\n  balanceAfter: integer(\"balance_after\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  enrollments: many(courseEnrollments),\n  jobApplications: many(jobApplications),\n  mentorConversations: many(mentorConversations),\n  photoUploads: many(photoUploads),\n  planUploads: many(planUploads),\n  studySessions: many(studySessions),\n  quizAttempts: many(quizAttempts),\n  sectionProgress: many(sectionProgress),\n  cartItems: many(cartItems),\n  productReviews: many(productReviews),\n  referralsMade: many(referrals, { relationName: \"referrer\" }),\n  referralsReceived: many(referrals, { relationName: \"referred\" }),\n  userAchievements: many(userAchievements),\n  competitionAttempts: many(competitionAttempts),\n  pointsHistory: many(userPointsHistory),\n}));\n\nexport const coursesRelations = relations(courses, ({ many }) => ({\n  enrollments: many(courseEnrollments),\n  content: many(courseContent),\n}));\n\nexport const courseContentRelations = relations(courseContent, ({ one }) => ({\n  course: one(courses, {\n    fields: [courseContent.courseId],\n    references: [courses.id],\n  }),\n}));\n\nexport const studySessionsRelations = relations(studySessions, ({ one }) => ({\n  user: one(users, {\n    fields: [studySessions.userId],\n    references: [users.id],\n  }),\n  content: one(courseContent, {\n    fields: [studySessions.contentId],\n    references: [courseContent.id],\n  }),\n}));\n\nexport const quizAttemptsRelations = relations(quizAttempts, ({ one }) => ({\n  user: one(users, {\n    fields: [quizAttempts.userId],\n    references: [users.id],\n  }),\n  content: one(courseContent, {\n    fields: [quizAttempts.contentId],\n    references: [courseContent.id],\n  }),\n  course: one(courses, {\n    fields: [quizAttempts.courseId],\n    references: [courses.id],\n  }),\n}));\n\nexport const sectionProgressRelations = relations(sectionProgress, ({ one }) => ({\n  user: one(users, {\n    fields: [sectionProgress.userId],\n    references: [users.id],\n  }),\n  course: one(courses, {\n    fields: [sectionProgress.courseId],\n    references: [courses.id],\n  }),\n}));\n\nexport const productsRelations = relations(products, ({ many }) => ({\n  cartItems: many(cartItems),\n  reviews: many(productReviews),\n}));\n\nexport const cartItemsRelations = relations(cartItems, ({ one }) => ({\n  user: one(users, {\n    fields: [cartItems.userId],\n    references: [users.id],\n  }),\n  product: one(products, {\n    fields: [cartItems.productId],\n    references: [products.id],\n  }),\n}));\n\nexport const productReviewsRelations = relations(productReviews, ({ one }) => ({\n  product: one(products, {\n    fields: [productReviews.productId],\n    references: [products.id],\n  }),\n  user: one(users, {\n    fields: [productReviews.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const referralsRelations = relations(referrals, ({ one }) => ({\n  referrer: one(users, {\n    fields: [referrals.referrerId],\n    references: [users.id],\n    relationName: \"referrer\",\n  }),\n  referred: one(users, {\n    fields: [referrals.referredId],\n    references: [users.id],\n    relationName: \"referred\",\n  }),\n}));\n\nexport const courseEnrollmentsRelations = relations(courseEnrollments, ({ one }) => ({\n  user: one(users, {\n    fields: [courseEnrollments.userId],\n    references: [users.id],\n  }),\n  course: one(courses, {\n    fields: [courseEnrollments.courseId],\n    references: [courses.id],\n  }),\n}));\n\nexport const employersRelations = relations(employers, ({ many }) => ({\n  jobs: many(jobs),\n}));\n\nexport const jobsRelations = relations(jobs, ({ many, one }) => ({\n  applications: many(jobApplications),\n  employer: one(employers, {\n    fields: [jobs.employerId],\n    references: [employers.id],\n  }),\n}));\n\nexport const jobApplicationsRelations = relations(jobApplications, ({ one }) => ({\n  job: one(jobs, {\n    fields: [jobApplications.jobId],\n    references: [jobs.id],\n  }),\n  user: one(users, {\n    fields: [jobApplications.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const achievementsRelations = relations(achievements, ({ many }) => ({\n  userAchievements: many(userAchievements),\n}));\n\nexport const userAchievementsRelations = relations(userAchievements, ({ one }) => ({\n  user: one(users, {\n    fields: [userAchievements.userId],\n    references: [users.id],\n  }),\n  achievement: one(achievements, {\n    fields: [userAchievements.achievementId],\n    references: [achievements.id],\n  }),\n}));\n\nexport const monthlyCompetitionsRelations = relations(monthlyCompetitions, ({ many }) => ({\n  attempts: many(competitionAttempts),\n}));\n\nexport const competitionAttemptsRelations = relations(competitionAttempts, ({ one }) => ({\n  user: one(users, {\n    fields: [competitionAttempts.userId],\n    references: [users.id],\n  }),\n  competition: one(monthlyCompetitions, {\n    fields: [competitionAttempts.competitionId],\n    references: [monthlyCompetitions.id],\n  }),\n}));\n\nexport const userPointsHistoryRelations = relations(userPointsHistory, ({ one }) => ({\n  user: one(users, {\n    fields: [userPointsHistory.userId],\n    references: [users.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  stripeCustomerId: true,\n  stripeSubscriptionId: true,\n  referralCode: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCourseSchema = createInsertSchema(courses).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertEmployerSchema = createInsertSchema(employers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertJobSchema = createInsertSchema(jobs).omit({\n  id: true,\n  status: true,\n  approvedBy: true,\n  approvedAt: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertJobApplicationSchema = createInsertSchema(jobApplications).omit({\n  id: true,\n  appliedAt: true,\n});\n\nexport const insertCourseContentSchema = createInsertSchema(courseContent).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPrivateCodeBookSchema = createInsertSchema(privateCodeBooks).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertChatAnswerSchema = createInsertSchema(chatAnswers).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertStudyCompanionMessageSchema = createInsertSchema(studyCompanionMessages).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertStudySessionSchema = createInsertSchema(studySessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertQuizAttemptSchema = createInsertSchema(quizAttempts).omit({\n  id: true,\n  completedAt: true,\n  createdAt: true,\n});\n\nexport const insertSectionProgressSchema = createInsertSchema(sectionProgress).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertLessonStepProgressSchema = createInsertSchema(lessonStepProgress).omit({\n  id: true,\n  lastAccessedAt: true,\n  completedAt: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertProductSchema = createInsertSchema(products).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCartItemSchema = createInsertSchema(cartItems).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertProductReviewSchema = createInsertSchema(productReviews).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertReferralSchema = createInsertSchema(referrals).omit({\n  id: true,\n  createdAt: true,\n  paidAt: true,\n});\n\nexport const insertMonthlyCommissionSchema = createInsertSchema(monthlyCommissions).omit({\n  id: true,\n  createdAt: true,\n  paidAt: true,\n});\n\nexport const insertPayoutRequestSchema = createInsertSchema(payoutRequests).omit({\n  id: true,\n  requestedAt: true,\n  processedAt: true,\n  completedAt: true,\n  createdAt: true,\n});\n\nexport const insertAccountCreditTransactionSchema = createInsertSchema(accountCreditTransactions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAchievementSchema = createInsertSchema(achievements).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserAchievementSchema = createInsertSchema(userAchievements).omit({\n  id: true,\n  earnedAt: true,\n});\n\nexport const insertMonthlyCompetitionSchema = createInsertSchema(monthlyCompetitions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCompetitionAttemptSchema = createInsertSchema(competitionAttempts).omit({\n  id: true,\n  startedAt: true,\n  completedAt: true,\n});\n\nexport const insertCompetitionQuestionSchema = createInsertSchema(competitionQuestions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserPointsHistorySchema = createInsertSchema(userPointsHistory).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Email campaigns\nexport const emailCampaigns = pgTable(\"email_campaigns\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  type: emailCampaignTypeEnum(\"type\").notNull(),\n  subject: text(\"subject\").notNull(),\n  content: text(\"content\").notNull(),\n  sequenceOrder: integer(\"sequence_order\").notNull(),\n  delayDays: integer(\"delay_days\").notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Email queue for scheduled sending\nexport const emailQueue = pgTable(\"email_queue\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  recipientEmail: text(\"recipient_email\").notNull(),\n  recipientName: text(\"recipient_name\"),\n  campaignId: text(\"campaign_id\").notNull(),\n  campaignType: emailCampaignTypeEnum(\"campaign_type\").notNull(),\n  subject: text(\"subject\").notNull(),\n  content: text(\"content\").notNull(),\n  scheduledFor: timestamp(\"scheduled_for\").notNull(),\n  status: emailStatusEnum(\"status\").default(\"pending\"),\n  sentAt: timestamp(\"sent_at\"),\n  errorMessage: text(\"error_message\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Email unsubscribes\nexport const emailUnsubscribes = pgTable(\"email_unsubscribes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  campaignType: emailCampaignTypeEnum(\"campaign_type\"),\n  unsubscribedAt: timestamp(\"unsubscribed_at\").defaultNow(),\n});\n\n// Bulk enrollment pricing tiers\nexport const bulkEnrollmentTiers = pgTable(\"bulk_enrollment_tiers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tierName: text(\"tier_name\").notNull(), // e.g., \"Small Team\", \"Medium Team\", \"Large Company\"\n  minStudents: integer(\"min_students\").notNull(),\n  maxStudents: integer(\"max_students\"), // null for unlimited\n  discountPercent: decimal(\"discount_percent\", { precision: 5, scale: 2 }).notNull(), // e.g., 15.00 for 15%\n  basePrice: decimal(\"base_price\", { precision: 10, scale: 2 }).notNull(), // price per student\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Bulk enrollment requests from employers\nexport const bulkEnrollmentRequests = pgTable(\"bulk_enrollment_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  employerId: text(\"employer_id\").notNull(),\n  studentCount: integer(\"student_count\").notNull(),\n  courseIds: text(\"course_ids\").array().notNull(), // Array of course IDs\n  totalPrice: decimal(\"total_price\", { precision: 10, scale: 2 }).notNull(),\n  discountPercent: decimal(\"discount_percent\", { precision: 5, scale: 2 }).notNull(),\n  finalPrice: decimal(\"final_price\", { precision: 10, scale: 2 }).notNull(),\n  status: bulkEnrollmentStatusEnum(\"status\").default(\"pending\"),\n  notes: text(\"notes\"), // Additional requirements or notes\n  contactEmail: text(\"contact_email\").notNull(),\n  contactPhone: text(\"contact_phone\"),\n  requestedStartDate: timestamp(\"requested_start_date\"),\n  approvedBy: text(\"approved_by\"),\n  approvedAt: timestamp(\"approved_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Individual student enrollments within bulk requests\nexport const bulkStudentEnrollments = pgTable(\"bulk_student_enrollments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  bulkRequestId: text(\"bulk_request_id\").notNull(),\n  studentEmail: text(\"student_email\").notNull(),\n  studentFirstName: text(\"student_first_name\").notNull(),\n  studentLastName: text(\"student_last_name\"),\n  userId: text(\"user_id\"), // Set when student creates account\n  isActivated: boolean(\"is_activated\").default(false),\n  activatedAt: timestamp(\"activated_at\"),\n  inviteSentAt: timestamp(\"invite_sent_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Lead magnet downloads table (contractor-focused)\nexport const leadMagnetDownloads = pgTable(\"lead_magnet_downloads\", {\n  id: serial(\"id\").primaryKey(),\n  email: varchar(\"email\", { length: 255 }).notNull(),\n  firstName: varchar(\"first_name\", { length: 100 }).notNull(),\n  lastName: varchar(\"last_name\", { length: 100 }).notNull(),\n  companyName: varchar(\"company_name\", { length: 255 }).notNull(),\n  position: varchar(\"position\", { length: 100 }),\n  leadSource: leadSourceEnum(\"lead_source\").default(\"website\"),\n  downloadedAt: timestamp(\"downloaded_at\").defaultNow(),\n  emailSent: boolean(\"email_sent\").default(false),\n});\n\n// Student lead magnet downloads table (student-focused)\nexport const studentLeadMagnetDownloads = pgTable(\"student_lead_magnet_downloads\", {\n  id: serial(\"id\").primaryKey(),\n  email: varchar(\"email\", { length: 255 }).notNull(),\n  firstName: varchar(\"first_name\", { length: 100 }).notNull(),\n  lastName: varchar(\"last_name\", { length: 100 }).notNull(),\n  currentLevel: varchar(\"current_level\", { length: 100 }).notNull(),\n  goals: text(\"goals\"),\n  leadSource: leadSourceEnum(\"lead_source\").default(\"website\"),\n  downloadedAt: timestamp(\"downloaded_at\").defaultNow(),\n  emailSent: boolean(\"email_sent\").default(false),\n});\n\n// Competition notifications table\nexport const competitionNotifications = pgTable(\"competition_notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  competitionId: text(\"competition_id\").notNull(),\n  userId: text(\"user_id\").notNull(),\n  notificationType: text(\"notification_type\").notNull(), // \"advance_notice\", \"day_of\", \"results\"\n  channel: text(\"channel\").notNull(), // \"email\", \"dashboard\", \"in_app\"\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  sentAt: timestamp(\"sent_at\"),\n  readAt: timestamp(\"read_at\"),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Beta feedback system\nexport const betaFeedbackQuestions = pgTable(\"beta_feedback_questions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  questionText: text(\"question_text\").notNull(),\n  questionType: text(\"question_type\").notNull(), // text, rating, multiple_choice, boolean\n  options: jsonb(\"options\"), // For multiple choice questions\n  isRequired: boolean(\"is_required\").default(true),\n  displayOrder: integer(\"display_order\").notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const betaFeedbackCampaigns = pgTable(\"beta_feedback_campaigns\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  monthYear: text(\"month_year\").notNull(), // Format: \"2025-01\" \n  emailSentAt: timestamp(\"email_sent_at\"),\n  dueDate: timestamp(\"due_date\").notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const betaFeedbackResponses = pgTable(\"beta_feedback_responses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  campaignId: text(\"campaign_id\").notNull(),\n  userId: text(\"user_id\").notNull(),\n  responses: jsonb(\"responses\").notNull(), // {\"questionId\": \"answer\"}\n  completedAt: timestamp(\"completed_at\").defaultNow(),\n  submissionToken: text(\"submission_token\").unique(), // For email link access\n});\n\n// Create insert schemas\nexport const insertEmailCampaignSchema = createInsertSchema(emailCampaigns);\nexport const insertEmailQueueSchema = createInsertSchema(emailQueue);\nexport const insertEmailUnsubscribeSchema = createInsertSchema(emailUnsubscribes);\nexport const insertBulkEnrollmentTierSchema = createInsertSchema(bulkEnrollmentTiers);\nexport const insertBulkEnrollmentRequestSchema = createInsertSchema(bulkEnrollmentRequests);\nexport const insertBulkStudentEnrollmentSchema = createInsertSchema(bulkStudentEnrollments);\nexport const insertLeadMagnetDownloadSchema = createInsertSchema(leadMagnetDownloads).omit({\n  id: true,\n  downloadedAt: true,\n  emailSent: true\n});\nexport const insertStudentLeadMagnetDownloadSchema = createInsertSchema(studentLeadMagnetDownloads).omit({\n  id: true,\n  downloadedAt: true,\n  emailSent: true\n});\nexport const insertBetaFeedbackQuestionSchema = createInsertSchema(betaFeedbackQuestions).omit({\n  id: true,\n  createdAt: true\n});\nexport const insertBetaFeedbackCampaignSchema = createInsertSchema(betaFeedbackCampaigns).omit({\n  id: true,\n  createdAt: true\n});\nexport const insertBetaFeedbackResponseSchema = createInsertSchema(betaFeedbackResponses).omit({\n  id: true,\n  completedAt: true\n});\n\n// Audio cache schema\nexport const insertAudioCacheSchema = createInsertSchema(audioCache).omit({\n  id: true,\n  generatedAt: true,\n  lastAccessedAt: true,\n  accessCount: true\n});\n\n// AI response cache schema\nexport const insertAiResponseCacheSchema = createInsertSchema(aiResponseCache).omit({\n  id: true,\n  generatedAt: true,\n  lastAccessedAt: true,\n  accessCount: true,\n  isValid: true\n});\n\n// Flashcard schema\nexport const insertFlashcardSchema = createInsertSchema(flashcards).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true\n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Course = typeof courses.$inferSelect;\nexport type InsertCourse = z.infer<typeof insertCourseSchema>;\nexport type Job = typeof jobs.$inferSelect;\nexport type Employer = typeof employers.$inferSelect;\nexport type InsertEmployer = z.infer<typeof insertEmployerSchema>;\nexport type InsertJob = z.infer<typeof insertJobSchema>;\nexport type CourseEnrollment = typeof courseEnrollments.$inferSelect;\nexport type JobApplication = typeof jobApplications.$inferSelect;\nexport type InsertJobApplication = z.infer<typeof insertJobApplicationSchema>;\nexport type MentorConversation = typeof mentorConversations.$inferSelect;\nexport type PhotoUpload = typeof photoUploads.$inferSelect;\nexport type PlanUpload = typeof planUploads.$inferSelect;\nexport type Referral = typeof referrals.$inferSelect;\nexport type CourseContent = typeof courseContent.$inferSelect;\nexport type InsertCourseContent = z.infer<typeof insertCourseContentSchema>;\nexport type PrivateCodeBook = typeof privateCodeBooks.$inferSelect;\nexport type InsertPrivateCodeBook = z.infer<typeof insertPrivateCodeBookSchema>;\nexport type ChatAnswer = typeof chatAnswers.$inferSelect;\nexport type InsertChatAnswer = z.infer<typeof insertChatAnswerSchema>;\nexport type Flashcard = typeof flashcards.$inferSelect;\nexport type InsertFlashcard = z.infer<typeof insertFlashcardSchema>;\nexport type StudyCompanionMessage = typeof studyCompanionMessages.$inferSelect;\nexport type InsertStudyCompanionMessage = z.infer<typeof insertStudyCompanionMessageSchema>;\nexport type StudySession = typeof studySessions.$inferSelect;\nexport type InsertStudySession = z.infer<typeof insertStudySessionSchema>;\nexport type QuizAttempt = typeof quizAttempts.$inferSelect;\nexport type InsertQuizAttempt = z.infer<typeof insertQuizAttemptSchema>;\nexport type SectionProgress = typeof sectionProgress.$inferSelect;\nexport type InsertSectionProgress = z.infer<typeof insertSectionProgressSchema>;\nexport type LessonStepProgress = typeof lessonStepProgress.$inferSelect;\nexport type InsertLessonStepProgress = z.infer<typeof insertLessonStepProgressSchema>;\nexport type Product = typeof products.$inferSelect;\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type CartItem = typeof cartItems.$inferSelect;\nexport type InsertCartItem = z.infer<typeof insertCartItemSchema>;\nexport type ProductReview = typeof productReviews.$inferSelect;\nexport type InsertProductReview = z.infer<typeof insertProductReviewSchema>;\nexport type InsertReferral = z.infer<typeof insertReferralSchema>;\nexport type EmailCampaign = typeof emailCampaigns.$inferSelect;\nexport type InsertEmailCampaign = z.infer<typeof insertEmailCampaignSchema>;\nexport type EmailQueue = typeof emailQueue.$inferSelect;\nexport type InsertEmailQueue = z.infer<typeof insertEmailQueueSchema>;\nexport type EmailUnsubscribe = typeof emailUnsubscribes.$inferSelect;\nexport type InsertEmailUnsubscribe = z.infer<typeof insertEmailUnsubscribeSchema>;\nexport type BulkEnrollmentTier = typeof bulkEnrollmentTiers.$inferSelect;\nexport type InsertBulkEnrollmentTier = z.infer<typeof insertBulkEnrollmentTierSchema>;\nexport type BulkEnrollmentRequest = typeof bulkEnrollmentRequests.$inferSelect;\nexport type InsertBulkEnrollmentRequest = z.infer<typeof insertBulkEnrollmentRequestSchema>;\nexport type BulkStudentEnrollment = typeof bulkStudentEnrollments.$inferSelect;\nexport type InsertBulkStudentEnrollment = z.infer<typeof insertBulkStudentEnrollmentSchema>;\nexport type LeadMagnetDownload = typeof leadMagnetDownloads.$inferSelect;\nexport type InsertLeadMagnetDownload = z.infer<typeof insertLeadMagnetDownloadSchema>;\nexport type StudentLeadMagnetDownload = typeof studentLeadMagnetDownloads.$inferSelect;\nexport type InsertStudentLeadMagnetDownload = z.infer<typeof insertStudentLeadMagnetDownloadSchema>;\nexport type PayoutRequest = typeof payoutRequests.$inferSelect;\nexport type InsertPayoutRequest = z.infer<typeof insertPayoutRequestSchema>;\nexport type AccountCreditTransaction = typeof accountCreditTransactions.$inferSelect;\nexport type InsertAccountCreditTransaction = z.infer<typeof insertAccountCreditTransactionSchema>;\nexport type MonthlyCommission = typeof monthlyCommissions.$inferSelect;\nexport type InsertMonthlyCommission = z.infer<typeof insertMonthlyCommissionSchema>;\nexport type BetaFeedbackQuestion = typeof betaFeedbackQuestions.$inferSelect;\nexport type InsertBetaFeedbackQuestion = z.infer<typeof insertBetaFeedbackQuestionSchema>;\nexport type BetaFeedbackCampaign = typeof betaFeedbackCampaigns.$inferSelect;\nexport type InsertBetaFeedbackCampaign = z.infer<typeof insertBetaFeedbackCampaignSchema>;\nexport type BetaFeedbackResponse = typeof betaFeedbackResponses.$inferSelect;\nexport type InsertBetaFeedbackResponse = z.infer<typeof insertBetaFeedbackResponseSchema>;\nexport type AudioCache = typeof audioCache.$inferSelect;\nexport type InsertAudioCache = z.infer<typeof insertAudioCacheSchema>;\nexport type AiResponseCache = typeof aiResponseCache.$inferSelect;\nexport type InsertAiResponseCache = z.infer<typeof insertAiResponseCacheSchema>;\n","size_bytes":50241},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport Home from \"@/pages/home\";\nimport Courses from \"@/pages/courses\";\nimport Tools from \"@/pages/tools\";\nimport Jobs from \"@/pages/jobs\";\nimport Pricing from \"@/pages/pricing\";\nimport Subscribe from \"@/pages/subscribe\";\nimport Checkout from \"@/pages/checkout\";\nimport CheckoutSuccess from \"@/pages/checkout/success\";\nimport BetaFeedback from \"@/pages/beta-feedback\";\nimport Dashboard from \"@/pages/dashboard\";\nimport CourseContent from \"@/pages/course-content\";\nimport Lesson from \"@/pages/lesson\";\nimport LessonIntroduction from \"@/pages/lesson-introduction\";\nimport LessonPodcast from \"@/pages/lesson-podcast\";\nimport LessonFlashcards from \"@/pages/lesson-flashcards\";\nimport LessonAIChat from \"@/pages/lesson-ai-chat\";\nimport LessonStudyNotes from \"@/pages/lesson-study-notes\";\nimport LessonQuiz from \"@/pages/lesson-quiz\";\nimport ContentView from \"@/pages/content-view\";\nimport PodcastView from \"@/pages/podcast-view\";\nimport Login from \"@/pages/auth/login\";\nimport Register from \"@/pages/auth/register\";\nimport Store from \"@/pages/store\";\nimport ProductDetail from \"@/pages/product-detail\";\nimport Cart from \"@/pages/cart\";\nimport AIToolsPricing from \"@/pages/ai-tools-pricing\";\nimport PlanAnalysisTool from \"@/pages/plan-analysis-tool\";\nimport PayPerUseCheckout from \"@/pages/pay-per-use-checkout\";\nimport EmployerPortal from \"@/pages/employer-portal\";\nimport EmployerDashboard from \"@/pages/employer-dashboard\";\nimport JobApproval from \"@/pages/admin/job-approval\";\nimport BetaFeedbackDashboard from \"@/pages/admin/beta-feedback-dashboard\";\nimport AdminDashboard from \"@/pages/admin/admin-dashboard\";\nimport ContentManagement from \"@/pages/admin/content-management\";\nimport BulkQuestionImport from \"@/pages/admin/bulk-question-import\";\nimport BulkFlashcardImport from \"@/pages/admin/bulk-flashcard-import\";\nimport BulkStudyNotesImport from \"@/pages/admin/bulk-studynotes-import\";\nimport BulkStudyPlanImport from \"@/pages/admin/bulk-studyplan-import\";\nimport BulkPodcastImport from \"@/pages/admin/bulk-podcast-import\";\nimport BulkAIChatImport from \"@/pages/admin/bulk-ai-chat-import\";\nimport TextToSpeech from \"@/pages/admin/text-to-speech\";\nimport StudyCompanion from \"@/pages/study-companion\";\nimport SystemAnalytics from \"@/pages/admin/system-analytics\";\nimport SystemSettings from \"@/pages/admin/system-settings\";\nimport JobAnalytics from \"@/pages/employer/job-analytics\";\nimport Privacy from \"@/pages/privacy\";\nimport Terms from \"@/pages/terms\";\nimport Accessibility from \"@/pages/accessibility\";\nimport Help from \"@/pages/help\";\nimport Contact from \"@/pages/contact\";\nimport LouisianaBoard from \"@/pages/louisiana-board\";\nimport TechnicalSupport from \"@/pages/technical-support\";\nimport SystemStatus from \"@/pages/system-status\";\nimport Referrals from \"@/pages/referrals\";\nimport PaymentSettings from \"@/pages/payment-settings\";\nimport BulkEnrollment from \"@/pages/bulk-enrollment\";\nimport LeadMagnet from \"@/pages/lead-magnet\";\nimport StudentLeadMagnet from \"@/pages/student-lead-magnet\";\nimport Competitions from \"@/pages/competitions\";\nimport CompetitionTest from \"@/pages/competition-test\";\nimport Achievements from \"@/pages/achievements\";\nimport Leaderboard from \"@/pages/leaderboard\";\nimport Header from \"@/components/layout/header\";\nimport Footer from \"@/components/layout/footer\";\nimport StudyPlans from \"@/pages/study-plans\";\nimport StudyPlanItem from \"@/pages/study-plan-item\";\nimport StoreManager from \"@/pages/admin/store-manager\";\nimport AIPhotoPricing from \"@/pages/ai-photo-pricing\";\nimport LouisianaJourneymanPrepPricing from \"@/pages/louisiana-journeyman-prep-pricing\";\nimport MasterPlumberPrepPricing from \"@/pages/master-plumber-prep-pricing\";\nimport BackflowPreventionPricing from \"@/pages/backflow-prevention-pricing\";\nimport NaturalGasCertificationPricing from \"@/pages/natural-gas-certification-pricing\";\nimport MedicalGasInstallerPricing from \"@/pages/medical-gas-installer-pricing\";\nimport { PodcastsPage } from \"@/pages/PodcastsPage\";\n\nfunction Router() {\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Header />\n      <main className=\"flex-1\">\n        <Switch>\n          <Route path=\"/\" component={Home} />\n          <Route path=\"/courses\" component={Courses} />\n          <Route path=\"/tools\" component={Tools} />\n          <Route path=\"/tools/ai-pricing\" component={AIToolsPricing} />\n          <Route path=\"/tools/plan-analysis\" component={PlanAnalysisTool} />\n          <Route path=\"/plan-analysis-tool\" component={PlanAnalysisTool} />\n          <Route path=\"/ai-photo-analysis\" component={AIPhotoPricing} />\n          <Route path=\"/ai-photo-pricing\" component={AIPhotoPricing} />\n          <Route path=\"/ai-tools-pricing\" component={AIToolsPricing} />\n          <Route path=\"/pay-per-use\" component={PayPerUseCheckout} />\n          <Route path=\"/louisiana-journeyman-prep-pricing\" component={LouisianaJourneymanPrepPricing} />\n          <Route path=\"/master-plumber-prep-pricing\" component={MasterPlumberPrepPricing} />\n          <Route path=\"/backflow-prevention-pricing\" component={BackflowPreventionPricing} />\n          <Route path=\"/natural-gas-certification-pricing\" component={NaturalGasCertificationPricing} />\n          <Route path=\"/medical-gas-installer-pricing\" component={MedicalGasInstallerPricing} />\n          <Route path=\"/jobs\" component={Jobs} />\n          <Route path=\"/pricing\" component={Pricing} />\n          <Route path=\"/subscribe\" component={Subscribe} />\n          <Route path=\"/checkout\" component={Checkout} />\n          <Route path=\"/checkout/success\" component={CheckoutSuccess} />\n          <Route path=\"/beta-feedback\" component={BetaFeedback} />\n          <Route path=\"/dashboard\" component={Dashboard} />\n          <Route path=\"/podcasts\" component={PodcastsPage} />\n          <Route path=\"/store\" component={Store} />\n          <Route path=\"/store/product/:id\" component={ProductDetail} />\n          <Route path=\"/cart\" component={Cart} />\n          <Route path=\"/admin/store-manager\" component={StoreManager} />\n          <Route path=\"/course/:courseId\" component={CourseContent} />\n          <Route path=\"/course/:courseId/lesson/:section\" component={Lesson} />\n          <Route path=\"/course/:courseId/lesson/:section/introduction\" component={LessonIntroduction} />\n          <Route path=\"/course/:courseId/lesson/:section/podcast\" component={LessonPodcast} />\n          <Route path=\"/course/:courseId/lesson/:section/flashcards\" component={LessonFlashcards} />\n          <Route path=\"/course/:courseId/lesson/:section/ai-chat\" component={LessonAIChat} />\n          <Route path=\"/course/:courseId/lesson/:section/study-notes\" component={LessonStudyNotes} />\n          <Route path=\"/course/:courseId/lesson/:section/quiz\" component={LessonQuiz} />\n          <Route path=\"/lesson-introduction/:courseId/:section\" component={LessonIntroduction} />\n          <Route path=\"/lesson-podcast/:courseId/:section\" component={LessonPodcast} />\n          <Route path=\"/lesson-flashcards/:courseId/:section\" component={LessonFlashcards} />\n          <Route path=\"/lesson-ai-chat/:courseId/:section\" component={LessonAIChat} />\n          <Route path=\"/lesson-study-notes/:courseId/:section\" component={LessonStudyNotes} />\n          <Route path=\"/lesson-quiz/:courseId/:section\" component={LessonQuiz} />\n          <Route path=\"/course/:courseId/content/:contentId\" component={ContentView} />\n          <Route path=\"/course/:courseId/podcast/:contentId\" component={PodcastView} />\n          <Route path=\"/study-companion\" component={StudyCompanion} />\n          <Route path=\"/study-plans/:courseId\" component={StudyPlans} />\n          <Route path=\"/study-plans/:courseId/:duration/:itemIndex\" component={StudyPlanItem} />\n          <Route path=\"/login\" component={Login} />\n          <Route path=\"/register\" component={Register} />\n          <Route path=\"/apprentice-signup\" component={Register} />\n          <Route path=\"/auth/login\" component={Login} />\n          <Route path=\"/auth/register\" component={Register} />\n          <Route path=\"/employer-signup\" component={EmployerPortal} />\n          <Route path=\"/employer-portal\" component={EmployerPortal} />\n          <Route path=\"/employer/dashboard\" component={EmployerDashboard} />\n          <Route path=\"/employer/analytics\" component={JobAnalytics} />\n          <Route path=\"/admin\" component={AdminDashboard} />\n          <Route path=\"/admin/content\" component={ContentManagement} />\n          <Route path=\"/admin/bulk-import\" component={BulkQuestionImport} />\n          <Route path=\"/admin/flashcard-import\" component={BulkFlashcardImport} />\n          <Route path=\"/admin/study-notes-import\" component={BulkStudyNotesImport} />\n          <Route path=\"/admin/bulk-studyplan-import\" component={BulkStudyPlanImport} />\n          <Route path=\"/admin/study-plan-import\" component={BulkStudyPlanImport} />\n          <Route path=\"/admin/content-import\" component={BulkAIChatImport} />\n          <Route path=\"/admin/podcast-import\" component={BulkPodcastImport} />\n          <Route path=\"/admin/text-to-speech\" component={TextToSpeech} />\n          <Route path=\"/admin/system-analytics\" component={SystemAnalytics} />\n          <Route path=\"/admin/system-settings\" component={SystemSettings} />\n          <Route path=\"/admin/job-approval\" component={JobApproval} />\n          <Route path=\"/admin/beta-feedback\" component={BetaFeedbackDashboard} />\n          <Route path=\"/privacy\" component={Privacy} />\n          <Route path=\"/terms\" component={Terms} />\n          <Route path=\"/accessibility\" component={Accessibility} />\n          <Route path=\"/help\" component={Help} />\n          <Route path=\"/contact\" component={Contact} />\n          <Route path=\"/louisiana-board\" component={LouisianaBoard} />\n          <Route path=\"/technical-support\" component={TechnicalSupport} />\n          <Route path=\"/system-status\" component={SystemStatus} />\n          <Route path=\"/referrals\" component={Referrals} />\n          <Route path=\"/payment-settings\" component={PaymentSettings} />\n          <Route path=\"/bulk-enrollment\" component={BulkEnrollment} />\n          <Route path=\"/lead-magnet\" component={LeadMagnet} />\n          <Route path=\"/student-lead-magnet\" component={StudentLeadMagnet} />\n          <Route path=\"/competitions\" component={Competitions} />\n          <Route path=\"/competition/:competitionId/test\" component={CompetitionTest} />\n          <Route path=\"/achievements\" component={Achievements} />\n          <Route path=\"/leaderboard\" component={Leaderboard} />\n          <Route component={NotFound} />\n        </Switch>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":11145},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(210, 40%, 98%);\n  --foreground: hsl(222.2, 84%, 4.9%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(222.2, 84%, 4.9%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(222.2, 84%, 4.9%);\n  --primary: hsl(221.2, 83.2%, 53.3%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(210, 40%, 96%);\n  --secondary-foreground: hsl(222.2, 47.4%, 11.2%);\n  --muted: hsl(210, 40%, 96%);\n  --muted-foreground: hsl(215.4, 16.3%, 46.9%);\n  --accent: hsl(38, 92%, 50%);\n  --accent-foreground: hsl(222.2, 84%, 4.9%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(210, 40%, 98%);\n  --border: hsl(214.3, 31.8%, 91.4%);\n  --input: hsl(214.3, 31.8%, 91.4%);\n  --ring: hsl(221.2, 83.2%, 53.3%);\n  --chart-1: hsl(221.2, 83.2%, 53.3%);\n  --chart-2: hsl(159.7826, 100%, 36.0784%);\n  --chart-3: hsl(42.0290, 92.8251%, 56.2745%);\n  --chart-4: hsl(147.1429, 78.5047%, 41.9608%);\n  --chart-5: hsl(341.4894, 75.2000%, 50.9804%);\n  --sidebar: hsl(210, 40%, 96%);\n  --sidebar-foreground: hsl(222.2, 84%, 4.9%);\n  --sidebar-primary: hsl(221.2, 83.2%, 53.3%);\n  --sidebar-primary-foreground: hsl(210, 40%, 98%);\n  --sidebar-accent: hsl(210, 40%, 96%);\n  --sidebar-accent-foreground: hsl(221.2, 83.2%, 53.3%);\n  --sidebar-border: hsl(214.3, 31.8%, 91.4%);\n  --sidebar-ring: hsl(221.2, 83.2%, 53.3%);\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'JetBrains Mono', monospace;\n  --radius: 0.5rem;\n}\n\n.dark {\n  --background: hsl(222.2, 84%, 4.9%);\n  --foreground: hsl(210, 40%, 98%);\n  --card: hsl(222.2, 84%, 4.9%);\n  --card-foreground: hsl(210, 40%, 98%);\n  --popover: hsl(222.2, 84%, 4.9%);\n  --popover-foreground: hsl(210, 40%, 98%);\n  --primary: hsl(221.2, 83.2%, 53.3%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(217.2, 32.6%, 17.5%);\n  --secondary-foreground: hsl(210, 40%, 98%);\n  --muted: hsl(217.2, 32.6%, 17.5%);\n  --muted-foreground: hsl(215, 20.2%, 65.1%);\n  --accent: hsl(38, 92%, 50%);\n  --accent-foreground: hsl(222.2, 84%, 4.9%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(210, 40%, 98%);\n  --border: hsl(217.2, 32.6%, 17.5%);\n  --input: hsl(217.2, 32.6%, 17.5%);\n  --ring: hsl(221.2, 83.2%, 53.3%);\n  --sidebar: hsl(222.2, 84%, 4.9%);\n  --sidebar-foreground: hsl(210, 40%, 98%);\n  --sidebar-primary: hsl(221.2, 83.2%, 53.3%);\n  --sidebar-primary-foreground: hsl(210, 40%, 98%);\n  --sidebar-accent: hsl(217.2, 32.6%, 17.5%);\n  --sidebar-accent-foreground: hsl(221.2, 83.2%, 53.3%);\n  --sidebar-border: hsl(217.2, 32.6%, 17.5%);\n  --sidebar-ring: hsl(221.2, 83.2%, 53.3%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n.gradient-hero {\n  background: linear-gradient(135deg, hsl(221.2, 83.2%, 53.3%) 0%, hsl(230, 50%, 35%) 100%);\n}\n\n.louisiana-pattern {\n  background-image: url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23f59e0b' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n","size_bytes":3367},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ai-mentor-chat.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MessageCircle, Send, Bot, User, Lightbulb, Timer, Download, Lock, Crown, BookOpen } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useStudySession } from \"@/hooks/use-study-session\";\nimport { AuthService } from \"@/lib/auth\";\nimport { Link } from \"wouter\";\nimport ReactMarkdown from \"react-markdown\";\n\ninterface Message {\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp: Date;\n}\n\ninterface Conversation {\n  id: string;\n  messages: Message[];\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface AIMentorChatProps {\n  currentSection?: string;\n}\n\nexport default function AIMentorChat({ currentSection }: AIMentorChatProps = {}) {\n  const [currentMessage, setCurrentMessage] = useState(\"\");\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Initialize study session tracking for chat\n  const studySession = useStudySession({\n    contentId: 'ai-mentor-chat',\n    contentType: 'chat',\n    autoStart: true\n  });\n\n  // Get current user data\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n\n  // AI mentor access is available to all authenticated users\n  const hasAIAccess = !!user;\n  const userTier = user?.subscriptionTier || 'basic';\n\n\n  const [messages, setMessages] = useState<Array<{role: 'user' | 'assistant', content: string, timestamp: Date}>>([]);\n\n  const chatMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const response = await fetch('/api/mentor/chat', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          message,\n          context: 'Louisiana Plumbing Code Section',\n          currentSection: currentSection\n        }),\n      });\n      \n      if (!response.ok) {\n        // Attach response for detailed error handling\n        const error = new Error('Failed to send message');\n        (error as any).response = response;\n        throw error;\n      }\n      \n      return response;\n    },\n    onSuccess: async (response) => {\n      try {\n        const data = await response.json();\n        // Add user message and AI response to local state\n        setMessages(prev => [\n          ...prev,\n          { role: 'user', content: currentMessage, timestamp: new Date() },\n          { role: 'assistant', content: data.response, timestamp: new Date() }\n        ]);\n      } catch (error) {\n        console.error('Error parsing chat response:', error);\n        toast({\n          title: \"Chat Error\", \n          description: \"Failed to parse response\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: async (error: any) => {\n      // Handle subscription-related errors with upgrade prompts\n      if (error.response?.status === 403) {\n        try {\n          const errorData = await error.response.json();\n          if (errorData.subscriptionRequired) {\n            toast({\n              title: \"Subscription Required\",\n              description: \"Professional tools access requires an active subscription. Upgrade to continue using AI mentor.\",\n              variant: \"destructive\",\n              action: (\n                <Button asChild size=\"sm\" className=\"bg-gradient-to-r from-orange-500 to-amber-600\">\n                  <Link href=\"/pricing\">Upgrade Now</Link>\n                </Button>\n              )\n            });\n            return;\n          }\n          if (errorData.requiresUpgrade) {\n            toast({\n              title: \"Upgrade for Full Access\",\n              description: \"Basic users are limited to current lesson sections. Upgrade for complete codebook access.\",\n              variant: \"default\",\n              action: (\n                <Button asChild size=\"sm\" className=\"bg-gradient-to-r from-orange-500 to-amber-600\">\n                  <Link href=\"/pricing\">Upgrade Now</Link>\n                </Button>\n              )\n            });\n            return;\n          }\n        } catch (e) {\n          // Fall through to generic error handling\n        }\n      }\n\n      // Generic error handling\n      toast({\n        title: \"Chat Error\",\n        description: error.message || \"Failed to send message\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSendMessage = () => {\n    if (!currentMessage.trim()) return;\n\n    // Store the message before clearing it\n    const messageToSend = currentMessage;\n    setCurrentMessage(\"\");\n    \n    chatMutation.mutate(messageToSend);\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    if (scrollAreaRef.current) {\n      scrollAreaRef.current.scrollTop = scrollAreaRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n\n  const getQuickPrompts = (currentSection?: string, userTier: string = 'basic') => {\n    // ALL users get section-specific prompts based on current lesson section\n    const sectionSuggestions: { [key: string]: string[] } = {\n      '101': [\n        \"Ask about the Louisiana State Health Officer's authority in plumbing code enforcement\",\n        \"What are the key responsibilities of local plumbing inspectors under Section 101?\", \n        \"How does the delegation of authority work from state to local levels?\",\n        \"What legal statutes support Louisiana plumbing code enforcement?\"\n      ],\n      '103': [\n        \"What are the permit requirements for different types of plumbing work in Louisiana?\",\n        \"When can plumbing work be done without a permit in Louisiana?\",\n        \"What documentation must be submitted with a plumbing permit application?\",\n        \"How long are plumbing permits valid in Louisiana?\"\n      ],\n      '105': [\n        \"What qualifications are required for plumbing inspectors in Louisiana?\",\n        \"How often must plumbing inspections be conducted during installation?\",\n        \"What happens if a plumbing installation fails inspection?\",\n        \"What records must be kept by plumbing inspectors?\"\n      ],\n      '107': [\n        \"What are the violation notice procedures in Louisiana plumbing code?\",\n        \"What penalties can be imposed for plumbing code violations?\",\n        \"How are emergency situations handled under Louisiana plumbing enforcement?\",\n        \"What is the process for appealing code violation citations?\"\n      ],\n      '109': [\n        \"What are the requirements for plumbing plan approval in Louisiana?\",\n        \"When must engineered drawings be submitted for plumbing systems?\",\n        \"What technical standards must plumbing plans meet?\",\n        \"How long does the plan review process typically take?\"\n      ]\n    };\n\n    return sectionSuggestions[currentSection || '101'] || sectionSuggestions['101'];\n  };\n\n  const getBasicContent = () => [\n    {\n      title: \"Louisiana Plumbing Code Section 1: General Administration\",\n      description: \"Complete overview of code administration and enforcement\",\n      downloadUrl: \"/public-objects/louisiana-code-section-1.pdf\"\n    },\n    {\n      title: \"Pipe Sizing Reference Guide\",\n      description: \"Comprehensive tables and calculations for pipe sizing\",\n      downloadUrl: \"/public-objects/pipe-sizing-guide.pdf\"\n    },\n    {\n      title: \"Fixture Installation Standards\",\n      description: \"Standard installation procedures for common fixtures\",\n      downloadUrl: \"/public-objects/fixture-installation-guide.pdf\"\n    },\n    {\n      title: \"Code Compliance Checklist\",\n      description: \"Quick reference checklist for common inspections\",\n      downloadUrl: \"/public-objects/compliance-checklist.pdf\"\n    },\n  ];\n\n\n  // Show different interface based on subscription tier\n  if (!hasAIAccess) {\n    // Redirect to upgrade - no download interface\n    return (\n      <div className=\"w-full max-w-full overflow-hidden\" data-testid=\"ai-mentor-chat\">\n        <Card className=\"min-h-[600px] overflow-hidden\">\n          <CardHeader className=\"border-b\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 rounded-full bg-gradient-to-r from-orange-500 to-amber-600 flex items-center justify-center\">\n                  <Lock className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    AI Mentor Chat - Upgrade Required\n                  </CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Get section-specific AI help with Louisiana plumbing codes\n                  </p>\n                </div>\n              </div>\n            </div>\n          </CardHeader>\n\n          <CardContent className=\"p-6 flex items-center justify-center\">\n            <div className=\"text-center max-w-md\">\n              <Crown className=\"w-16 h-16 mx-auto mb-4 text-orange-500\" />\n              <h3 className=\"text-xl font-semibold mb-2\">Section-Specific AI Mentor</h3>\n              <p className=\"text-muted-foreground mb-6\">\n                Get instant, intelligent answers about Section {currentSection || '101'} of Louisiana plumbing code.\n                Our AI mentor provides contextual help specific to your current lesson.\n              </p>\n              <Button asChild className=\"bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700\">\n                <Link href=\"/pricing\">\n                  Upgrade to Access AI Mentor\n                </Link>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Professional/Master Plans: AI Chat Interface\n  return (\n    <div className=\"w-full max-w-full overflow-hidden\" data-testid=\"ai-mentor-chat\">\n      <Card className=\"h-[600px] flex flex-col overflow-hidden\">\n        <CardHeader className=\"border-b\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center\">\n                <Bot className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  AI Mentor Chat - Section {currentSection || '101'}\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    <Lightbulb className=\"w-3 h-3 mr-1\" />\n                    Section {currentSection || '101'} Prompts\n                  </Badge>\n                  {userTier !== 'basic' && (\n                    <Badge className=\"text-xs bg-gradient-to-r from-green-500 to-emerald-600\">\n                      <BookOpen className=\"w-3 h-3 mr-1\" />\n                      Complete Access\n                    </Badge>\n                  )}\n                  <Badge className=\"text-xs bg-gradient-to-r from-blue-500 to-purple-600\">\n                    <Bot className=\"w-3 h-3 mr-1\" />\n                    AI-Powered\n                  </Badge>\n                </CardTitle>\n                <p className=\"text-sm text-muted-foreground\">\n                  {userTier === 'basic' \n                    ? `Get instant help with Louisiana plumbing code Section ${currentSection || '101'}`\n                    : `Section ${currentSection || '101'} prompts shown - ask about any Louisiana plumbing code section`\n                  }\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n              <Timer className=\"w-4 h-4\" />\n              <span>Session: {studySession.formattedTime}</span>\n            </div>\n          </div>\n        </CardHeader>\n\n        <CardContent className=\"flex-1 flex flex-col p-0 overflow-hidden min-w-0\">\n          {/* Quick Action Prompts */}\n          {messages.length === 0 && (\n            <div className=\"p-4 border-b bg-muted/30\">\n              <h3 className=\"text-sm font-medium mb-3\">Quick Start Prompts</h3>\n              <div className=\"grid grid-cols-1 gap-2\">\n                {getQuickPrompts(currentSection, userTier).map((prompt, index) => (\n                  <Button\n                    key={index}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"text-xs justify-start h-auto py-3 px-4 whitespace-normal text-left leading-relaxed min-h-[3rem]\"\n                    onClick={() => setCurrentMessage(prompt)}\n                    data-testid={`quick-prompt-${index}`}\n                  >\n                    <span className=\"block\">{prompt}</span>\n                  </Button>\n                ))}\n                {userTier === 'basic' && (\n                  <div className=\"mt-3 p-3 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-950 dark:to-amber-950 rounded-lg border border-orange-200 dark:border-orange-800\">\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <Crown className=\"w-4 h-4 text-orange-500\" />\n                      <span className=\"font-medium text-orange-700 dark:text-orange-300\">Want complete codebook access?</span>\n                    </div>\n                    <p className=\"text-xs text-orange-600 dark:text-orange-400 mt-1\">\n                      Professional and Master users can ask questions about any Louisiana plumbing code section, not just Section {currentSection || '101'}!\n                    </p>\n                    <Button asChild size=\"sm\" className=\"mt-2 bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white\">\n                      <Link href=\"/pricing\">Upgrade Now</Link>\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Chat Messages */}\n          <ScrollArea className=\"flex-1 p-4 overflow-x-hidden overflow-y-auto\" ref={scrollAreaRef}>\n            {messages.length > 0 ? (\n              <div className=\"space-y-4\">\n                {messages.map((message, index) => (\n                  <div\n                    key={index}\n                    className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    <div className={`flex items-start space-x-2 max-w-[80%] min-w-0 ${message.role === 'user' ? 'flex-row-reverse space-x-reverse' : ''}`}>\n                      <Avatar className=\"w-8 h-8\">\n                        <AvatarFallback className={message.role === 'user' ? 'bg-primary text-primary-foreground' : 'bg-gradient-to-r from-blue-500 to-purple-600 text-white'}>\n                          {message.role === 'user' ? <User className=\"w-4 h-4\" /> : <Bot className=\"w-4 h-4\" />}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className={`p-3 rounded-lg min-w-0 max-w-full ${\n                        message.role === 'user' \n                          ? 'bg-primary text-primary-foreground' \n                          : 'bg-muted'\n                      }`}>\n                        {message.role === 'assistant' ? (\n                          <div className=\"text-sm prose prose-sm max-w-none dark:prose-invert\">\n                            <ReactMarkdown>{message.content}</ReactMarkdown>\n                          </div>\n                        ) : (\n                          <p className=\"text-sm whitespace-pre-wrap break-words break-all\">{message.content}</p>\n                        )}\n                        <p className=\"text-xs opacity-70 mt-1\">\n                          {message.timestamp.toLocaleTimeString()}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Show thinking indicator when AI is processing */}\n                {chatMutation.isPending && (\n                  <div className=\"flex justify-start\">\n                    <div className=\"flex items-start space-x-2 max-w-[80%] min-w-0\">\n                      <Avatar className=\"w-8 h-8\">\n                        <AvatarFallback className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white\">\n                          <Bot className=\"w-4 h-4\" />\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"bg-muted rounded-lg p-3 min-w-0 max-w-full\">\n                        <div className=\"flex items-center space-x-2\">\n                          <div className=\"flex space-x-1\">\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\"></div>\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n                          </div>\n                          <span className=\"text-sm text-muted-foreground\">AI is thinking...</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center text-muted-foreground py-8\">\n                <Bot className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                <p>Start a conversation with your AI mentor!</p>\n                <p className=\"text-sm\">Ask about Louisiana plumbing codes, installation procedures, or code compliance.</p>\n              </div>\n            )}\n          </ScrollArea>\n\n          {/* Message Input */}\n          <div className=\"p-4 border-t overflow-hidden min-w-0\">\n            <div className=\"flex space-x-2 min-w-0\">\n              <Input\n                value={currentMessage}\n                onChange={(e) => setCurrentMessage(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Ask your plumbing question...\"\n                disabled={chatMutation.isPending}\n                className=\"flex-1 min-w-0\"\n                data-testid=\"message-input\"\n              />\n              <Button\n                onClick={handleSendMessage}\n                disabled={!currentMessage.trim() || chatMutation.isPending}\n                data-testid=\"send-message\"\n              >\n                <Send className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              {userTier === 'basic' \n                ? `AI mentor focused on Section ${currentSection || '101'} - upgrade for complete codebook access` \n                : 'AI mentor trained on complete Louisiana plumbing codes and industry best practices'\n              }\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":19549},"client/src/components/course-card.tsx":{"content":"import { Button } from \"@/components/ui/button\";\n\n// Map database UUIDs to friendly course identifiers\nfunction getCourseSlug(courseId: string): string {\n  const courseMapping: { [key: string]: string } = {\n    '5f02238b-afb2-4e7f-a488-96fb471fee56': 'journeyman-prep',\n    'b1f02238b-afb2-4e7f-a488-96fb471fee57': 'backflow-prevention',\n    'c2f02238b-afb2-4e7f-a488-96fb471fee58': 'natural-gas',\n    'd3f02238b-afb2-4e7f-a488-96fb471fee59': 'medical-gas',\n    'e4f02238b-afb2-4e7f-a488-96fb471fee60': 'master-plumber'\n  };\n  return courseMapping[courseId] || courseId;\n}\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { BookOpen, Clock, Users, Star, CheckCircle, Play } from \"lucide-react\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport { HelpCircle, Upload, Brain, Mic } from \"lucide-react\";\n\ninterface CourseCardProps {\n  course: {\n    id: string;\n    title: string;\n    description: string;\n    type: string;\n    price: string;\n    duration?: number;\n    lessons?: number;\n    practiceQuestions?: number;\n    isActive?: boolean;\n  };\n  isEnrolled?: boolean;\n  progress?: number;\n  isCompleted?: boolean;\n}\n\nexport default function CourseCard({ course, isEnrolled = false, progress = 0, isCompleted = false }: CourseCardProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Check user's subscription status\n  const { data: user } = useQuery({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n\n  // Fetch course content statistics\n  const { data: contentStats, isLoading, error } = useQuery<{\n    questions: number;\n    flashcards: number;\n    studyNotes: number;\n    studyPlans: number;\n    podcasts: number;\n    aiChat: number;\n  }>({\n    queryKey: [\"/api/courses\", course.id, \"stats\"],\n    retry: false,\n  });\n\n  // Debug logging\n  console.log('CourseCard Debug:', {\n    courseId: course.id,\n    contentStats,\n    isLoading,\n    error\n  });\n\n  const enrollMutation = useMutation({\n    mutationFn: () => apiRequest(\"POST\", `/api/courses/${course.id}/enroll`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enrollments\"] });\n      toast({\n        title: \"Enrollment Successful\",\n        description: `You have been enrolled in ${course.title}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Enrollment Failed\",\n        description: error.message || \"Failed to enroll in course\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getCourseIcon = () => {\n    switch (course.type) {\n      case \"journeyman\":\n        return BookOpen;\n      case \"backflow\":\n        return Star;\n      case \"natural_gas\":\n        return BookOpen;\n      case \"medical_gas\":\n        return BookOpen;\n      case \"master\":\n        return Star;\n      default:\n        return BookOpen;\n    }\n  };\n\n  const getCourseColor = () => {\n    switch (course.type) {\n      case \"journeyman\":\n        return \"bg-primary\";\n      case \"backflow\":\n        return \"bg-accent\";\n      case \"natural_gas\":\n        return \"bg-orange-500\";\n      case \"medical_gas\":\n        return \"bg-red-500\";\n      case \"master\":\n        return \"bg-purple-600\";\n      default:\n        return \"bg-primary\";\n    }\n  };\n\n  const handleEnroll = () => {\n    enrollMutation.mutate();\n  };\n\n  // Check if user has active subscription for course access\n  const hasActiveSubscription = () => {\n    if (!user) return false;\n    const validTiers = ['basic', 'professional', 'master'];\n    return validTiers.includes((user as any)?.subscriptionTier?.toLowerCase());\n  };\n\n  const IconComponent = getCourseIcon();\n  const colorClass = getCourseColor();\n\n  return (\n    <Card className={`hover:shadow-lg transition-shadow ${isCompleted ? 'border-green-200' : ''}`} data-testid={`course-card-${course.id}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"space-y-4\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between\">\n            <div className={`w-12 h-12 ${colorClass} rounded-lg flex items-center justify-center${course.isActive === false ? ' opacity-50' : ''}`}>\n              <IconComponent className=\"w-6 h-6 text-white\" />\n            </div>\n            <div className=\"flex gap-2\">\n              {course.isActive === false && (\n                <Badge className=\"bg-yellow-100 text-yellow-800\" data-testid=\"coming-soon-badge\">\n                  Coming Soon\n                </Badge>\n              )}\n            </div>\n          </div>\n\n          {/* Course Info */}\n          <div>\n            <h3 className=\"text-xl font-semibold text-card-foreground mb-2\" data-testid={`course-title-${course.id}`}>\n              {course.title}\n            </h3>\n            <p className=\"text-muted-foreground text-sm line-clamp-3\" data-testid={`course-description-${course.id}`}>\n              {course.description}\n            </p>\n          </div>\n\n          {/* Content Statistics */}\n          <div className=\"grid grid-cols-2 gap-2 text-xs text-muted-foreground\">\n            <div className=\"flex items-center space-x-1\">\n              <HelpCircle className=\"w-3 h-3\" />\n              <span>{contentStats?.questions || 0} Questions</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <Upload className=\"w-3 h-3\" />\n              <span>{contentStats?.flashcards || 0} Flashcards</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <BookOpen className=\"w-3 h-3\" />\n              <span>{contentStats?.studyNotes || 0} Study Notes</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <Clock className=\"w-3 h-3\" />\n              <span>{contentStats?.studyPlans || 0} Study Plans</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <Mic className=\"w-3 h-3\" />\n              <span>{contentStats?.podcasts || 0} Podcasts</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <Brain className=\"w-3 h-3\" />\n              <span>{contentStats?.aiChat || 0} AI Chat</span>\n            </div>\n          </div>\n\n\n          {/* Features */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center space-x-2 text-sm\">\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n              <span>State Approved Curriculum</span>\n            </div>\n            <div className=\"flex items-center space-x-2 text-sm\">\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n              <span>Practice Tests Included</span>\n            </div>\n            <div className=\"flex items-center space-x-2 text-sm\">\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n              <span>Certificate Upon Completion</span>\n            </div>\n          </div>\n\n          {/* Action */}\n          <div className=\"flex items-center justify-between pt-4 border-t\">\n            {!isEnrolled ? (\n              <>\n                <div className=\"text-sm text-muted-foreground\">\n                  {course.isActive === false ? \"Coming soon\" : \"Professional certification prep\"}\n                </div>\n                {course.isActive === false ? (\n                  <Button \n                    disabled\n                    data-testid={`button-coming-soon-${course.id}`}\n                  >\n                    Coming Soon\n                  </Button>\n                ) : !user ? (\n                  // User is not logged in - redirect to pricing\n                  <Button \n                    asChild\n                    data-testid={`button-start-${course.id}`}\n                  >\n                    <Link href=\"/pricing\">\n                      Enroll Now\n                    </Link>\n                  </Button>\n                ) : hasActiveSubscription() ? (\n                  // User is logged in and has subscription - enroll directly\n                  <Button \n                    onClick={handleEnroll}\n                    disabled={enrollMutation.isPending}\n                    data-testid={`button-start-${course.id}`}\n                  >\n                    {enrollMutation.isPending ? \"Enrolling...\" : \"Start Course\"}\n                  </Button>\n                ) : (\n                  // User is logged in but doesn't have subscription - go to pricing\n                  <Button \n                    asChild\n                    data-testid={`button-start-${course.id}`}\n                  >\n                    <Link href=\"/pricing\">\n                      Enroll Now\n                    </Link>\n                  </Button>\n                )}\n              </>\n            ) : (\n              <>\n                <div className=\"flex items-center space-x-1 text-sm text-muted-foreground\">\n                  <Users className=\"w-4 h-4\" />\n                  <span>Enrolled</span>\n                </div>\n                <Button \n                  variant={isCompleted ? \"outline\" : \"default\"}\n                  asChild\n                  data-testid={`button-continue-${course.id}`}\n                >\n                  <Link href={`/course/${getCourseSlug(course.id)}`}>\n                    <Play className=\"w-4 h-4 mr-2\" />\n                    {isCompleted ? \"Review\" : \"Continue\"}\n                  </Link>\n                </Button>\n              </>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":9668},"client/src/components/job-card.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MapPin, Clock, DollarSign, Building2, ExternalLink } from \"lucide-react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface JobCardProps {\n  job: {\n    id: string;\n    title: string;\n    company: string;\n    description: string;\n    location: string;\n    type: string;\n    salaryMin?: string;\n    salaryMax?: string;\n    requirements?: string[];\n    benefits?: string[];\n    isFeatured?: boolean;\n    createdAt: string;\n  };\n}\n\nexport default function JobCard({ job }: JobCardProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const applyMutation = useMutation({\n    mutationFn: () => apiRequest(\"POST\", `/api/jobs/${job.id}/apply`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/job-applications\"] });\n      toast({\n        title: \"Application Submitted\",\n        description: `Your application for ${job.title} has been submitted successfully.`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Application Failed\", \n        description: error.message || \"Failed to submit application\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatSalary = () => {\n    if (job.salaryMin && job.salaryMax) {\n      return `$${job.salaryMin}-${job.salaryMax}/hour`;\n    }\n    return \"Competitive salary\";\n  };\n\n  const getJobTypeColor = () => {\n    switch (job.type) {\n      case \"full_time\":\n        return \"bg-green-100 text-green-800\";\n      case \"part_time\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"contract\":\n        return \"bg-orange-100 text-orange-800\";\n      case \"temporary\":\n        return \"bg-purple-100 text-purple-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const formatJobType = () => {\n    return job.type.replace(\"_\", \" \").replace(/\\b\\w/g, l => l.toUpperCase());\n  };\n\n  const handleApply = () => {\n    applyMutation.mutate();\n  };\n\n  return (\n    <Card className={`hover:shadow-lg transition-shadow ${job.isFeatured ? 'border-accent' : ''}`} data-testid={`job-card-${job.id}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"space-y-4\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between\">\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-6 h-6 text-primary-foreground\" />\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center space-x-2 mb-1\">\n                  <h3 className=\"text-xl font-semibold text-card-foreground\" data-testid={`job-title-${job.id}`}>\n                    {job.title}\n                  </h3>\n                  {job.isFeatured && (\n                    <Badge className=\"bg-accent text-accent-foreground\">\n                      Featured\n                    </Badge>\n                  )}\n                </div>\n                <p className=\"text-muted-foreground font-medium\" data-testid={`job-company-${job.id}`}>\n                  {job.company}\n                </p>\n              </div>\n            </div>\n            <Button \n              onClick={handleApply}\n              disabled={applyMutation.isPending}\n              data-testid={`button-apply-${job.id}`}\n            >\n              {applyMutation.isPending ? \"Applying...\" : \"Apply Now\"}\n            </Button>\n          </div>\n\n          {/* Job Details */}\n          <div className=\"flex items-center space-x-6 text-sm text-muted-foreground\">\n            <div className=\"flex items-center space-x-1\">\n              <MapPin className=\"w-4 h-4\" />\n              <span data-testid={`job-location-${job.id}`}>{job.location}</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <Clock className=\"w-4 h-4\" />\n              <Badge variant=\"secondary\" className={getJobTypeColor()}>\n                {formatJobType()}\n              </Badge>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <DollarSign className=\"w-4 h-4\" />\n              <span data-testid={`job-salary-${job.id}`}>{formatSalary()}</span>\n            </div>\n          </div>\n\n          {/* Description */}\n          <p className=\"text-muted-foreground\" data-testid={`job-description-${job.id}`}>\n            {job.description}\n          </p>\n\n          {/* Requirements */}\n          {job.requirements && job.requirements.length > 0 && (\n            <div>\n              <h4 className=\"font-medium text-foreground mb-2\">Requirements:</h4>\n              <ul className=\"list-disc list-inside space-y-1 text-sm text-muted-foreground\">\n                {job.requirements.slice(0, 3).map((req, index) => (\n                  <li key={index}>{req}</li>\n                ))}\n                {job.requirements.length > 3 && (\n                  <li className=\"text-primary\">+{job.requirements.length - 3} more requirements</li>\n                )}\n              </ul>\n            </div>\n          )}\n\n          {/* Benefits */}\n          {job.benefits && job.benefits.length > 0 && (\n            <div className=\"flex flex-wrap gap-2\">\n              {job.benefits.slice(0, 4).map((benefit, index) => (\n                <Badge key={index} variant=\"outline\" className=\"text-xs\">\n                  {benefit}\n                </Badge>\n              ))}\n              {job.benefits.length > 4 && (\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  +{job.benefits.length - 4} more\n                </Badge>\n              )}\n            </div>\n          )}\n\n          {/* Footer */}\n          <div className=\"flex items-center justify-between pt-4 border-t text-sm text-muted-foreground\">\n            <span>Posted {new Date(job.createdAt).toLocaleDateString()}</span>\n            <Button variant=\"ghost\" size=\"sm\" data-testid={`view-details-${job.id}`}>\n              View Details\n              <ExternalLink className=\"w-3 h-3 ml-1\" />\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":6372},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/auth.ts":{"content":"import { apiRequest } from \"./queryClient\";\n\nexport interface LoginCredentials {\n  email: string;\n  password: string;\n}\n\nexport interface RegisterData {\n  firstName: string;\n  lastName: string;\n  email: string;\n  username: string;\n  password: string;\n  phone?: string;\n  referredBy?: string;\n}\n\nexport interface User {\n  id: string;\n  email: string;\n  username: string;\n  firstName?: string;\n  lastName?: string;\n  phone?: string;\n  subscriptionTier: 'basic' | 'professional' | 'master';\n  stripeCustomerId?: string;\n  stripeSubscriptionId?: string;\n  referralCode?: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport class AuthService {\n  /**\n   * Authenticate user with email and password\n   */\n  static async login(credentials: LoginCredentials): Promise<User> {\n    const response = await apiRequest(\"POST\", \"/api/auth/login\", credentials);\n    return response.json();\n  }\n\n  /**\n   * Register a new user account\n   */\n  static async register(data: RegisterData): Promise<{ message: string; userId: string }> {\n    const response = await apiRequest(\"POST\", \"/api/auth/register\", data);\n    return response.json();\n  }\n\n  /**\n   * Sign out the current user\n   */\n  static async logout(): Promise<void> {\n    await apiRequest(\"POST\", \"/api/auth/logout\");\n  }\n\n  /**\n   * Get current authenticated user information\n   */\n  static async getCurrentUser(): Promise<User | null> {\n    try {\n      const response = await apiRequest(\"GET\", \"/api/auth/me\");\n      return response.json();\n    } catch (error) {\n      // Return null if not authenticated (401 error)\n      return null;\n    }\n  }\n\n  /**\n   * Check if user is authenticated\n   */\n  static async isAuthenticated(): Promise<boolean> {\n    try {\n      const user = await this.getCurrentUser();\n      return user !== null;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get user's subscription status\n   */\n  static getSubscriptionTier(user: User | null): 'basic' | 'professional' | 'master' {\n    return user?.subscriptionTier || 'basic';\n  }\n\n  /**\n   * Check if user has access to specific features based on subscription tier\n   */\n  static hasFeatureAccess(user: User | null, feature: string): boolean {\n    const tier = this.getSubscriptionTier(user);\n    \n    const featureAccess = {\n      basic: [\n        'job_board',\n        'basic_calculators',\n        'practice_tests',\n        'email_support',\n        'ai_mentor'\n      ],\n      professional: [\n        'job_board',\n        'basic_calculators',\n        'complete_calculator_suite',\n        'photo_code_checker',\n        'ai_mentor',\n        'resume_builder',\n        'priority_support',\n        'practice_tests'\n      ],\n      master: [\n        'job_board',\n        'basic_calculators',\n        'complete_calculator_suite',\n        'photo_code_checker',\n        'ai_mentor',\n        'resume_builder',\n        'plan_analysis',\n        'material_list_generator',\n        'referral_commissions',\n        'book_store',\n        'white_glove_support',\n        'practice_tests'\n      ]\n    };\n\n    return featureAccess[tier].includes(feature);\n  }\n\n  /**\n   * Format user display name\n   */\n  static getDisplayName(user: User | null): string {\n    if (!user) return 'Guest';\n    \n    if (user.firstName && user.lastName) {\n      return `${user.firstName} ${user.lastName}`;\n    }\n    \n    if (user.firstName) {\n      return user.firstName;\n    }\n    \n    return user.username;\n  }\n\n  /**\n   * Check if user has completed profile setup\n   */\n  static isProfileComplete(user: User | null): boolean {\n    if (!user) return false;\n    \n    return !!(user.firstName && user.lastName && user.email);\n  }\n\n  /**\n   * Get user's referral code for sharing\n   */\n  static getReferralCode(user: User | null): string | null {\n    return user?.referralCode || null;\n  }\n\n  /**\n   * Generate referral link\n   */\n  static generateReferralLink(user: User | null): string | null {\n    const referralCode = this.getReferralCode(user);\n    if (!referralCode) return null;\n    \n    const baseUrl = window.location.origin;\n    return `${baseUrl}/register?ref=${referralCode}`;\n  }\n\n  /**\n   * Validate password strength\n   */\n  static validatePassword(password: string): {\n    isValid: boolean;\n    errors: string[];\n    strength: 'weak' | 'medium' | 'strong';\n  } {\n    const errors: string[] = [];\n    \n    if (password.length < 8) {\n      errors.push('Password must be at least 8 characters long');\n    }\n    \n    if (!/[A-Z]/.test(password)) {\n      errors.push('Password must contain at least one uppercase letter');\n    }\n    \n    if (!/[a-z]/.test(password)) {\n      errors.push('Password must contain at least one lowercase letter');\n    }\n    \n    if (!/\\d/.test(password)) {\n      errors.push('Password must contain at least one number');\n    }\n    \n    if (!/[!@#$%^&*(),.?\":{}|<>]/.test(password)) {\n      errors.push('Password should contain at least one special character');\n    }\n    \n    const isValid = errors.length === 0;\n    \n    let strength: 'weak' | 'medium' | 'strong' = 'weak';\n    if (password.length >= 12 && /[A-Z]/.test(password) && /[a-z]/.test(password) && /\\d/.test(password) && /[!@#$%^&*(),.?\":{}|<>]/.test(password)) {\n      strength = 'strong';\n    } else if (password.length >= 8 && errors.length <= 1) {\n      strength = 'medium';\n    }\n    \n    return { isValid, errors, strength };\n  }\n\n  /**\n   * Validate email format\n   */\n  static validateEmail(email: string): boolean {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  /**\n   * Get user's subscription status information\n   */\n  static getSubscriptionInfo(user: User | null) {\n    if (!user) return null;\n    \n    const tierInfo = {\n      basic: {\n        name: 'Basic',\n        price: '$49/month',\n        maxCourses: 1,\n        features: ['1 Certification Track', 'Basic Calculator Tools', 'Practice Tests', 'Job Board Access', 'Email Support']\n      },\n      professional: {\n        name: 'Professional',\n        price: '$79/month',\n        maxCourses: 3,\n        features: ['3 Certification Tracks', 'Complete Calculator Suite', 'Photo Code Checker', 'AI Mentor Support', 'Resume Builder', 'Priority Support']\n      },\n      master: {\n        name: 'Master',\n        price: '$99/month',\n        maxCourses: 5,\n        features: ['All 5 Certification Tracks', 'Plan Analysis Tools', 'Material List Generator', 'Referral Commissions', 'Book Store Access', 'White-Glove Support']\n      }\n    };\n    \n    return tierInfo[user.subscriptionTier] || tierInfo.basic;\n  }\n}\n\n// Export utility functions for use in components\nexport const {\n  login,\n  register,\n  logout,\n  getCurrentUser,\n  isAuthenticated,\n  hasFeatureAccess,\n  getDisplayName,\n  isProfileComplete,\n  getReferralCode,\n  generateReferralLink,\n  validatePassword,\n  validateEmail,\n  getSubscriptionInfo\n} = AuthService;\n","size_bytes":6847},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n    cache: \"no-store\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n      cache: \"no-store\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"returnNull\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: 5 * 60 * 1000, // 5 minutes instead of Infinity\n      retry: false,\n      networkMode: 'online', // Don't wait for network\n    },\n    mutations: {\n      retry: false,\n      networkMode: 'online',\n    },\n  },\n});\n","size_bytes":1558},"client/src/lib/stripe.ts":{"content":"import { loadStripe, Stripe } from '@stripe/stripe-js';\n\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\n\n// Initialize Stripe\nlet stripePromise: Promise<Stripe | null>;\n\nconst getStripeInstance = () => {\n  if (!stripePromise) {\n    stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n  }\n  return stripePromise;\n};\n\nexport const getStripe = getStripeInstance;\n\n// Stripe configuration\nexport const stripeConfig = {\n  appearance: {\n    theme: 'stripe' as const,\n    variables: {\n      colorPrimary: '#3b82f6',\n      colorBackground: '#ffffff',\n      colorText: '#1f2937',\n      colorDanger: '#ef4444',\n      fontFamily: 'Inter, system-ui, sans-serif',\n      spacingUnit: '4px',\n      borderRadius: '8px',\n    },\n  },\n  locale: 'en' as const,\n};\n\n// Pricing plans configuration\nexport const pricingPlans = {\n  basic: {\n    id: 'basic',\n    name: 'Basic',\n    price: 49.99,\n    priceId: 'price_1S4EusByFL1L8uV24yWoGtnf', // Basic Monthly - $49.99\n    annualPriceId: 'price_1S4EqJByFL1L8uV2KtL96A1l', // Basic Annual - $599.88\n    tier: 'basic',\n    description: 'Perfect for getting started',\n    features: [\n      '1 Certification Track',\n      'Basic Calculator Tools',\n      'Practice Tests',\n      'Job Board Access',\n      'Email Support'\n    ],\n    popular: false,\n  },\n  professional: {\n    id: 'professional',\n    name: 'Professional',\n    price: 59.99,\n    priceId: 'price_1S4F7cByFL1L8uV2U5V4tOje', // Professional Monthly - $79.99\n    annualPriceId: 'price_1S4F4wByFL1L8uV2xK3ArjCj', // Professional Annual - $959.88\n    tier: 'professional',\n    description: 'For serious professionals',\n    features: [\n      '1 Certification Track',\n      'Basic Calculator Tools',\n      'Practice Tests',\n      'Job Board Access',\n      'Email Support',\n      'Complete Calculator Suite',\n      'Photo Code Checker',\n      'AI Mentor Support',\n      'Resume Builder',\n      'Priority Support'\n    ],\n    popular: true,\n  },\n  master: {\n    id: 'master',\n    name: 'Master',\n    price: 74.99,\n    priceId: 'price_1S4F1jByFL1L8uV2YfeGdK7U', // Master Monthly - $99.99\n    annualPriceId: 'price_1S4EyGByFL1L8uV2c2IPcRGY', // Master Annual - $1199.88\n    tier: 'master',\n    description: 'Complete mastery package',\n    features: [\n      '1 Certification Track',\n      'Basic Calculator Tools',\n      'Practice Tests',\n      'Job Board Access',\n      'Email Support',\n      'Complete Calculator Suite',\n      'Photo Code Checker',\n      'AI Mentor Support',\n      'Resume Builder',\n      'Priority Support',\n      'Plan Analysis Tools',\n      'Material List Generator',\n      'Referral Commissions',\n      'Book Store Access',\n      'White-Glove Support'\n    ],\n    popular: false,\n  },\n};\n\nexport type PricingPlan = typeof pricingPlans[keyof typeof pricingPlans];\n\n// Subscription management utilities\nexport class StripeService {\n  /**\n   * Create a subscription for a user\n   */\n  static async createSubscription(priceId: string, tier: string) {\n    const response = await fetch('/api/create-subscription', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      credentials: 'include',\n      body: JSON.stringify({ priceId, tier }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.error?.message || 'Failed to create subscription');\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Format price for display\n   */\n  static formatPrice(cents: number, currency = 'USD'): string {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency,\n    }).format(cents / 100);\n  }\n\n  /**\n   * Get plan by ID\n   */\n  static getPlan(planId: string): PricingPlan | null {\n    return pricingPlans[planId as keyof typeof pricingPlans] || null;\n  }\n\n  /**\n   * Get all plans\n   */\n  static getAllPlans(): PricingPlan[] {\n    return Object.values(pricingPlans);\n  }\n\n  /**\n   * Get popular plan\n   */\n  static getPopularPlan(): PricingPlan {\n    return pricingPlans.professional;\n  }\n\n  /**\n   * Calculate trial end date (7 days from now)\n   */\n  static getTrialEndDate(): Date {\n    const trialEnd = new Date();\n    trialEnd.setDate(trialEnd.getDate() + 7);\n    return trialEnd;\n  }\n\n  /**\n   * Format trial end date for display\n   */\n  static formatTrialEndDate(): string {\n    return this.getTrialEndDate().toLocaleDateString('en-US', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n    });\n  }\n\n  /**\n   * Check if plan allows specific feature\n   */\n  static planAllowsFeature(planId: string, feature: string): boolean {\n    const plan = this.getPlan(planId);\n    if (!plan) return false;\n\n    const featureMapping = {\n      basic: ['job_board', 'basic_calculators', 'practice_tests', 'email_support'],\n      professional: [\n        'job_board',\n        'basic_calculators',\n        'complete_calculator_suite',\n        'photo_code_checker',\n        'ai_mentor',\n        'resume_builder',\n        'priority_support',\n        'practice_tests',\n      ],\n      master: [\n        'job_board',\n        'basic_calculators',\n        'complete_calculator_suite',\n        'photo_code_checker',\n        'ai_mentor',\n        'resume_builder',\n        'plan_analysis',\n        'material_list_generator',\n        'referral_commissions',\n        'book_store',\n        'white_glove_support',\n        'practice_tests',\n      ],\n    };\n\n    return featureMapping[plan.tier as keyof typeof featureMapping]?.includes(feature) || false;\n  }\n\n  /**\n   * Get upgrade suggestions for current plan\n   */\n  static getUpgradeSuggestions(currentPlanId: string): PricingPlan[] {\n    const currentPlan = this.getPlan(currentPlanId);\n    if (!currentPlan) return this.getAllPlans();\n\n    const planOrder = ['basic', 'professional', 'master'];\n    const currentIndex = planOrder.indexOf(currentPlan.tier);\n    \n    if (currentIndex === -1 || currentIndex === planOrder.length - 1) {\n      return [];\n    }\n\n    return planOrder\n      .slice(currentIndex + 1)\n      .map(tier => this.getPlan(tier))\n      .filter(Boolean) as PricingPlan[];\n  }\n\n  /**\n   * Calculate savings for annual billing (20% discount)\n   */\n  static calculateAnnualSavings(monthlyPrice: number): {\n    monthlyTotal: number;\n    annualTotal: number;\n    savings: number;\n    savingsPercent: number;\n  } {\n    const monthlyTotal = monthlyPrice * 12;\n    const annualTotal = monthlyTotal * 0.8; // 20% discount\n    const savings = monthlyTotal - annualTotal;\n    const savingsPercent = 20;\n\n    return {\n      monthlyTotal,\n      annualTotal,\n      savings,\n      savingsPercent,\n    };\n  }\n\n  /**\n   * Generate Stripe Elements options\n   */\n  static getElementsOptions(clientSecret: string) {\n    return {\n      clientSecret,\n      appearance: stripeConfig.appearance,\n      locale: stripeConfig.locale,\n    };\n  }\n\n  /**\n   * Handle Stripe errors\n   */\n  static handleStripeError(error: any): string {\n    if (error.type === 'card_error' || error.type === 'validation_error') {\n      return error.message;\n    }\n\n    switch (error.code) {\n      case 'card_declined':\n        return 'Your card was declined. Please try a different payment method.';\n      case 'expired_card':\n        return 'Your card has expired. Please use a different card.';\n      case 'incorrect_cvc':\n        return 'Your card\\'s security code is incorrect.';\n      case 'processing_error':\n        return 'An error occurred while processing your card. Please try again.';\n      case 'rate_limit':\n        return 'Too many requests. Please wait a moment and try again.';\n      default:\n        return 'An unexpected error occurred. Please try again.';\n    }\n  }\n\n  /**\n   * Validate subscription status\n   */\n  static validateSubscriptionStatus(status: string): {\n    isActive: boolean;\n    needsAction: boolean;\n    message: string;\n  } {\n    switch (status) {\n      case 'active':\n        return {\n          isActive: true,\n          needsAction: false,\n          message: 'Subscription is active',\n        };\n      case 'trialing':\n        return {\n          isActive: true,\n          needsAction: false,\n          message: 'Free trial is active',\n        };\n      case 'incomplete':\n        return {\n          isActive: false,\n          needsAction: true,\n          message: 'Payment information required',\n        };\n      case 'incomplete_expired':\n        return {\n          isActive: false,\n          needsAction: true,\n          message: 'Subscription setup expired. Please try again.',\n        };\n      case 'past_due':\n        return {\n          isActive: false,\n          needsAction: true,\n          message: 'Payment failed. Please update your payment method.',\n        };\n      case 'canceled':\n        return {\n          isActive: false,\n          needsAction: false,\n          message: 'Subscription has been canceled',\n        };\n      case 'unpaid':\n        return {\n          isActive: false,\n          needsAction: true,\n          message: 'Payment required to continue service',\n        };\n      default:\n        return {\n          isActive: false,\n          needsAction: true,\n          message: 'Unknown subscription status',\n        };\n    }\n  }\n}\n\n// Export utilities for direct use\nexport const {\n  createSubscription,\n  formatPrice,\n  getPlan,\n  getAllPlans,\n  getPopularPlan,\n  planAllowsFeature,\n  getUpgradeSuggestions,\n  calculateAnnualSavings,\n  getElementsOptions,\n  handleStripeError,\n  validateSubscriptionStatus,\n} = StripeService;\n\n// getStripe already exported above\n\n// Default export\nexport default StripeService;\n","size_bytes":9609},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/courses.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { Search, Users, BookOpen, CheckCircle, HelpCircle, Upload, Clock, Mic, Brain } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { AuthService, User } from \"@/lib/auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\n// Map database UUIDs to friendly course identifiers\nfunction getCourseSlug(courseId: string): string {\n  const courseMapping: { [key: string]: string } = {\n    '5f02238b-afb2-4e7f-a488-96fb471fee56': 'journeyman-prep',\n    'b1f02238b-afb2-4e7f-a488-96fb471fee57': 'backflow-prevention',\n    'c2f02238b-afb2-4e7f-a488-96fb471fee58': 'natural-gas',\n    'd3f02238b-afb2-4e7f-a488-96fb471fee59': 'medical-gas',\n    'e4f02238b-afb2-4e7f-a488-96fb471fee60': 'master-plumber'\n  };\n  return courseMapping[courseId] || courseId;\n}\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Course {\n  id: number;\n  title: string;\n  description: string;\n  price: number;\n  duration: number;\n  lessons: number;\n  isActive: boolean;\n}\n\nexport default function Courses() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(\"All Courses\");\n  const [selectedFilter, setSelectedFilter] = useState(\"Most Popular\");\n  const [user, setUser] = useState<User | null>(null);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: courses = [], isLoading, error } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const { data: enrollments = [] } = useQuery({\n    queryKey: [\"/api/enrollments\"],\n    enabled: !!user,\n  });\n\n  // Fetch content stats for each course using public endpoint\n  const { data: contentStats } = useQuery({\n    queryKey: [\"/api/courses\", \"all-stats\", courses.length],\n    queryFn: async () => {\n      const stats: any = {};\n      for (const course of courses) {\n        try {\n          const response = await apiRequest(\"GET\", `/api/courses/${course.id}/stats`);\n          const courseStats = await response.json();\n          stats[course.id] = courseStats || { \n            questions: 0, flashcards: 0, studyNotes: 0, \n            studyPlans: 0, podcasts: 0, aiChat: 0 \n          };\n        } catch (error) {\n          stats[course.id] = { \n            questions: 0, flashcards: 0, studyNotes: 0, \n            studyPlans: 0, podcasts: 0, aiChat: 0 \n          };\n        }\n      }\n      return stats;\n    },\n    enabled: courses.length > 0,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  // Get current user\n  useEffect(() => {\n    AuthService.getCurrentUser().then(setUser);\n  }, []);\n\n  // Check if user has active subscription\n  const hasActiveSubscription = () => {\n    if (!user) return false;\n    const validTiers = ['basic', 'professional', 'master'];\n    return validTiers.includes(user.subscriptionTier?.toLowerCase());\n  };\n\n  // Check if user is enrolled in a course\n  const isEnrolledIn = (courseId: number) => {\n    if (!Array.isArray(enrollments)) return false;\n    return enrollments.some((enrollment: any) => enrollment.courseId === courseId.toString());\n  };\n\n  // Enrollment mutation\n  const enrollMutation = useMutation({\n    mutationFn: (courseId: number) => apiRequest(\"POST\", `/api/courses/${courseId}/enroll`),\n    onSuccess: (_, courseId) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enrollments\"] });\n      const course = courses.find(c => c.id === courseId);\n      toast({\n        title: \"Enrollment Successful\",\n        description: `You have been enrolled in ${course?.title}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Enrollment Failed\",\n        description: error.message || \"Failed to enroll in course\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle enrollment button click\n  const handleEnrollClick = (course: Course) => {\n    if (!user) {\n      setLocation(\"/pricing\");\n      return;\n    }\n\n    if (isEnrolledIn(course.id)) {\n      setLocation(`/course/${getCourseSlug(course.id)}`);\n      return;\n    }\n\n    if (!hasActiveSubscription()) {\n      setLocation(\"/pricing\");\n      return;\n    }\n\n    enrollMutation.mutate(course.id);\n  };\n\n  // Get button text and state\n  const getButtonState = (course: Course) => {\n    if (!course.isActive) {\n      return { text: \"Coming Soon\", disabled: true, variant: \"disabled\" };\n    }\n\n    if (!user) {\n      return { text: \"Start Course\", disabled: false, variant: \"primary\" };\n    }\n\n    if (isEnrolledIn(course.id)) {\n      return { text: \"Continue Course\", disabled: false, variant: \"success\" };\n    }\n\n    if (!hasActiveSubscription()) {\n      return { text: \"Upgrade to Enroll\", disabled: false, variant: \"primary\" };\n    }\n\n    return { \n      text: enrollMutation.isPending ? \"Enrolling...\" : \"Enroll Now\", \n      disabled: enrollMutation.isPending, \n      variant: \"primary\" \n    };\n  };\n\n  const filteredCourses = courses.filter(course =>\n    course.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    course.description.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"p-8\">\n          <h1 className=\"text-3xl font-bold mb-4\">Louisiana Plumbing Courses</h1>\n          <p className=\"text-red-600\">Error loading courses. Please try again later.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Hero Section */}\n      <div className=\"bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-16 px-8\">\n        <div className=\"max-w-6xl mx-auto text-center\">\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">\n            Louisiana Plumbing Certification Courses\n          </h1>\n          <p className=\"text-xl mb-8 opacity-90\">\n            Master your plumbing skills with our comprehensive certification prep courses. All\n            courses are Louisiana State Board approved and designed by industry experts.\n          </p>\n          \n          <div className=\"flex flex-wrap justify-center gap-8 mt-8\">\n            <div className=\"flex items-center gap-2\">\n              <BookOpen className=\"w-6 h-6\" />\n              <span className=\"text-lg font-semibold\">5 Certification Tracks</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Users className=\"w-6 h-6\" />\n              <span className=\"text-lg font-semibold\">2,847+ Students</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"w-6 h-6\" />\n              <span className=\"text-lg font-semibold\">State Approved</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Search and Filter Section */}\n      <div className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-6xl mx-auto px-8 py-6\">\n          <div className=\"flex flex-col md:flex-row gap-4 items-center justify-between\">\n            <div className=\"relative flex-1 max-w-md\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search courses...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n              />\n            </div>\n            \n            <div className=\"flex gap-4\">\n              <select\n                value={selectedCategory}\n                onChange={(e) => setSelectedCategory(e.target.value)}\n                className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500\"\n              >\n                <option value=\"All Courses\">All Courses</option>\n                <option value=\"Certification\">Certification</option>\n                <option value=\"Training\">Training</option>\n              </select>\n              \n              <select\n                value={selectedFilter}\n                onChange={(e) => setSelectedFilter(e.target.value)}\n                className=\"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500\"\n              >\n                <option value=\"Most Popular\">Most Popular</option>\n                <option value=\"Newest\">Newest</option>\n                <option value=\"Price: Low to High\">Price: Low to High</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Course Tabs */}\n      <div className=\"bg-white border-b\">\n        <div className=\"max-w-6xl mx-auto px-8\">\n          <div className=\"flex space-x-8\">\n            <button className=\"py-4 px-2 border-b-2 border-indigo-500 text-indigo-600 font-medium\">\n              All Courses\n            </button>\n            <button className=\"py-4 px-2 text-gray-500 hover:text-gray-700\">\n              My Courses\n            </button>\n            <button className=\"py-4 px-2 text-gray-500 hover:text-gray-700\">\n              Completed\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Loading State */}\n      {isLoading && (\n        <div className=\"max-w-6xl mx-auto px-8 py-12\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full mx-auto mb-4\"></div>\n            <p className=\"text-gray-600\">Loading courses...</p>\n          </div>\n        </div>\n      )}\n\n      {/* Courses Grid */}\n      {!isLoading && (\n        <div className=\"max-w-6xl mx-auto px-8 py-12\">\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {filteredCourses.map((course) => (\n              <div key={course.id} className=\"bg-white rounded-xl shadow-sm border hover:shadow-md transition-shadow\">\n                <div className=\"p-6\">\n                  {/* Course Icon */}\n                  <div className=\"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-4\">\n                    <BookOpen className=\"w-6 h-6 text-indigo-600\" />\n                  </div>\n                  \n                  <h3 className=\"text-xl font-semibold mb-3 text-gray-900\">\n                    {course.title}\n                  </h3>\n                  \n                  <p className=\"text-gray-600 mb-4 line-clamp-3\">\n                    {course.description}\n                  </p>\n                  \n                  {/* Content Statistics */}\n                  <div className=\"grid grid-cols-2 gap-2 mb-4 text-xs\">\n                    <div className=\"flex items-center text-gray-600\">\n                      <HelpCircle className=\"w-3 h-3 mr-1\" />\n                      {contentStats?.[course.id]?.questions || 0} Questions\n                    </div>\n                    <div className=\"flex items-center text-gray-600\">\n                      <Upload className=\"w-3 h-3 mr-1\" />\n                      {contentStats?.[course.id]?.flashcards || 0} Flashcards\n                    </div>\n                    <div className=\"flex items-center text-gray-600\">\n                      <BookOpen className=\"w-3 h-3 mr-1\" />\n                      {contentStats?.[course.id]?.studyNotes || 0} Study Notes\n                    </div>\n                    <div className=\"flex items-center text-gray-600\">\n                      <Clock className=\"w-3 h-3 mr-1\" />\n                      {contentStats?.[course.id]?.studyPlans || 0} Study Plans\n                    </div>\n                    <div className=\"flex items-center text-gray-600\">\n                      <Mic className=\"w-3 h-3 mr-1\" />\n                      {contentStats?.[course.id]?.podcasts || 0} Podcasts\n                    </div>\n                    <div className=\"flex items-center text-gray-600\">\n                      <Brain className=\"w-3 h-3 mr-1\" />\n                      {contentStats?.[course.id]?.aiChat || 0} AI Chat\n                    </div>\n                  </div>\n                  \n                  {/* Features */}\n                  <div className=\"space-y-1 mb-4\">\n                    <div className=\"flex items-center text-sm text-green-600\">\n                      <CheckCircle className=\"w-4 h-4 mr-2\" />\n                      Comprehensive Curriculum\n                    </div>\n                    <div className=\"flex items-center text-sm text-green-600\">\n                      <CheckCircle className=\"w-4 h-4 mr-2\" />\n                      Practice Tests Included\n                    </div>\n                  </div>\n                  \n                  {/* Coming Soon Badge */}\n                  {!course.isActive && (\n                    <div className=\"mb-4\">\n                      <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800\">\n                        Coming Soon\n                      </span>\n                    </div>\n                  )}\n                  \n                  {/* Action Button */}\n                  {(() => {\n                    const buttonState = getButtonState(course);\n                    return (\n                      <button\n                        onClick={() => handleEnrollClick(course)}\n                        disabled={buttonState.disabled}\n                        className={`w-full py-2 px-4 rounded-lg font-medium transition-colors ${\n                          buttonState.variant === \"disabled\"\n                            ? \"bg-gray-100 text-gray-400 cursor-not-allowed\"\n                            : buttonState.variant === \"success\"\n                            ? \"bg-green-600 text-white hover:bg-green-700\"\n                            : \"bg-indigo-600 text-white hover:bg-indigo-700\"\n                        }`}\n                        data-testid={`button-enroll-${course.id}`}\n                      >\n                        {buttonState.text}\n                      </button>\n                    );\n                  })()}\n                </div>\n              </div>\n            ))}\n          </div>\n          \n          {filteredCourses.length === 0 && !isLoading && (\n            <div className=\"text-center py-12\">\n              <p className=\"text-gray-500\">No courses found matching your search.</p>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":14429},"client/src/pages/dashboard.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { User, Course, CourseEnrollment, MentorConversation, JobApplication } from \"@/../../shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  BookOpen, \n  Trophy, \n  Clock, \n  Target, \n  TrendingUp, \n  Calendar, \n  MessageCircle, \n  FileText,\n  Download,\n  Star,\n  CreditCard,\n  Check,\n  X,\n  Crown,\n  Zap,\n  DollarSign,\n  Settings\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport StandaloneAIMentorChat from \"@/components/standalone-ai-mentor-chat\";\nimport { ReferralInviter, ContactSupport } from \"@/components/referral-inviter\";\nimport { Link } from \"wouter\";\n\nexport default function Dashboard() {\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const { data: enrollments } = useQuery<CourseEnrollment[]>({\n    queryKey: [\"/api/enrollments\"],\n  });\n\n  const { data: courses } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const { data: conversations } = useQuery<MentorConversation[]>({\n    queryKey: [\"/api/mentor/conversations\"],\n  });\n\n  const { data: applications } = useQuery<JobApplication[]>({\n    queryKey: [\"/api/job-applications\"],\n  });\n\n  const getCompletedCourses = () => {\n    return enrollments?.filter((e) => e.isCompleted).length || 0;\n  };\n\n  const getAverageProgress = () => {\n    if (!enrollments?.length) return 0;\n    const total = enrollments.reduce((sum: number, e) => sum + parseFloat(e.progress || '0'), 0);\n    return Math.round(total / enrollments.length);\n  };\n\n  const getOverallGrade = () => {\n    // Calculate based on test scores and progress\n    return \"A-\"; // Placeholder\n  };\n\n  const getRecentActivity = () => {\n    return [\n      { type: \"course\", action: \"Completed lesson\", item: \"Pipe Sizing Fundamentals\", time: \"2 hours ago\" },\n      { type: \"test\", action: \"Passed practice test\", item: \"Backflow Prevention\", time: \"1 day ago\" },\n      { type: \"mentor\", action: \"Asked AI mentor\", item: \"Pressure testing procedures\", time: \"2 days ago\" },\n      { type: \"job\", action: \"Applied to job\", item: \"Journeyman Plumber at Gulf South\", time: \"3 days ago\" },\n    ];\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <section className=\"bg-gradient-to-r from-primary/10 to-accent/10 py-8\" data-testid=\"dashboard-header\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-foreground\" data-testid=\"welcome-message\">\n                Welcome back, {user?.firstName || user?.username}!\n              </h1>\n              <p className=\"text-muted-foreground mt-1\">\n                Continue your plumbing education journey\n              </p>\n            </div>\n            <div className=\"text-right\">\n              <Badge variant=\"secondary\" className=\"mb-2\" data-testid=\"subscription-tier\">\n                {user?.subscriptionTier || 'Basic'} Plan\n              </Badge>\n              <p className=\"text-sm text-muted-foreground\">\n                Member since {user?.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A'}\n              </p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <div className=\"max-w-full mx-auto px-4 sm:px-6 lg:px-12 py-8\">\n        <Tabs defaultValue=\"overview\" className=\"space-y-8\">\n          <TabsList className=\"grid w-full grid-cols-6\">\n            <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">Overview</TabsTrigger>\n            <TabsTrigger value=\"courses\" data-testid=\"tab-courses\">My Courses</TabsTrigger>\n            <TabsTrigger value=\"progress\" data-testid=\"tab-progress\">Progress</TabsTrigger>\n            <TabsTrigger value=\"mentor\" data-testid=\"tab-mentor\">AI Mentor</TabsTrigger>\n            <TabsTrigger value=\"subscription\" data-testid=\"tab-subscription\">Subscription</TabsTrigger>\n            <TabsTrigger value=\"jobs\" data-testid=\"tab-jobs\">Job Applications</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-8\">\n            {/* Quick Stats */}\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\" data-testid=\"quick-stats\">\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center space-x-2\">\n                    <BookOpen className=\"w-8 h-8 text-primary\" />\n                    <div>\n                      <p className=\"text-2xl font-bold\" data-testid=\"stat-courses\">{enrollments?.length || 0}</p>\n                      <p className=\"text-sm text-muted-foreground\">Enrolled Courses</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Trophy className=\"w-8 h-8 text-accent\" />\n                    <div>\n                      <p className=\"text-2xl font-bold\" data-testid=\"stat-completed\">{getCompletedCourses()}</p>\n                      <p className=\"text-sm text-muted-foreground\">Completed</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Target className=\"w-8 h-8 text-green-600\" />\n                    <div>\n                      <p className=\"text-2xl font-bold\" data-testid=\"stat-progress\">{getAverageProgress()}%</p>\n                      <p className=\"text-sm text-muted-foreground\">Avg Progress</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Star className=\"w-8 h-8 text-yellow-500\" />\n                    <div>\n                      <p className=\"text-2xl font-bold\" data-testid=\"stat-grade\">{getOverallGrade()}</p>\n                      <p className=\"text-sm text-muted-foreground\">Overall Grade</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n              {/* Recent Activity */}\n              <Card className=\"lg:col-span-2\" data-testid=\"recent-activity\">\n                <CardHeader>\n                  <CardTitle>Recent Activity</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {getRecentActivity().map((activity, index) => (\n                      <div key={index} className=\"flex items-center space-x-3 p-3 rounded-lg bg-muted/50\">\n                        <div className=\"w-2 h-2 bg-primary rounded-full\"></div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">\n                            <span className=\"font-medium\">{activity.action}</span> {activity.item}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">{activity.time}</p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Quick Actions */}\n              <Card data-testid=\"quick-actions\">\n                <CardHeader>\n                  <CardTitle>Quick Actions</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <Link href=\"/courses\">\n                    <Button className=\"w-full justify-start\" variant=\"outline\" data-testid=\"action-browse-courses\">\n                      <BookOpen className=\"w-4 h-4 mr-2\" />\n                      Browse Courses\n                    </Button>\n                  </Link>\n                  <Link href=\"/tools\">\n                    <Button className=\"w-full justify-start\" variant=\"outline\" data-testid=\"action-calculators\">\n                      <Target className=\"w-4 h-4 mr-2\" />\n                      Use Calculators\n                    </Button>\n                  </Link>\n                  <Link href=\"/jobs\">\n                    <Button className=\"w-full justify-start\" variant=\"outline\" data-testid=\"action-find-jobs\">\n                      <TrendingUp className=\"w-4 h-4 mr-2\" />\n                      Find Jobs\n                    </Button>\n                  </Link>\n                  <Button className=\"w-full justify-start\" variant=\"outline\" data-testid=\"action-download-certificate\">\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Download Certificate\n                  </Button>\n                  <Link href=\"/referrals\">\n                    <Button className=\"w-full justify-start\" variant=\"outline\" data-testid=\"action-referral-program\">\n                      <DollarSign className=\"w-4 h-4 mr-2\" />\n                      Referral Program\n                    </Button>\n                  </Link>\n                  {user && (user.email?.includes('admin') || user.subscriptionTier === 'master') && (\n                    <Link href=\"/admin\">\n                      <Button className=\"w-full justify-start\" variant=\"outline\" data-testid=\"action-admin-panel\">\n                        <Settings className=\"w-4 h-4 mr-2\" />\n                        Admin Panel\n                      </Button>\n                    </Link>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Referral and Support Section */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <ReferralInviter />\n              <ContactSupport />\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"courses\" className=\"space-y-8\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\" data-testid=\"enrolled-courses\">\n              {enrollments && enrollments.length > 0 ? enrollments.map((enrollment) => {\n                const course = courses?.find((c) => c.id === enrollment.courseId);\n                if (!course) return null;\n\n                return (\n                  <Card key={enrollment.id} className=\"hover:shadow-lg transition-shadow\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"space-y-4\">\n                        <div>\n                          <h3 className=\"font-semibold text-lg\" data-testid={`course-title-${course.id}`}>\n                            {course.title}\n                          </h3>\n                          <p className=\"text-sm text-muted-foreground\">{course.description}</p>\n                        </div>\n                        \n                        <div className=\"space-y-2\">\n                          <div className=\"flex justify-between text-sm\">\n                            <span>Progress</span>\n                            <span>{enrollment.progress}%</span>\n                          </div>\n                          <Progress value={parseFloat(enrollment.progress || '0')} className=\"h-2\" />\n                        </div>\n\n                        <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                          <span>{enrollment.completedLessons} / {course.lessons} lessons</span>\n                          {enrollment.isCompleted && (\n                            <Badge className=\"bg-green-100 text-green-800\">Completed</Badge>\n                          )}\n                        </div>\n\n                        <Button className=\"w-full\" asChild data-testid={`continue-course-${course.id}`}>\n                          <Link href={`/course/${course.id}`}>\n                            {enrollment.isCompleted ? 'Review' : 'Continue'}\n                          </Link>\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              }) : (\n                <div className=\"col-span-full text-center py-12\" data-testid=\"no-enrolled-courses\">\n                  <BookOpen className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">No enrolled courses</h3>\n                  <p className=\"text-muted-foreground mb-4\">Start learning by enrolling in a course</p>\n                  <Link href=\"/courses\">\n                    <Button data-testid=\"browse-all-courses\">Browse Courses</Button>\n                  </Link>\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"progress\" className=\"space-y-8\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n              {/* Progress Chart */}\n              <Card data-testid=\"progress-chart\">\n                <CardHeader>\n                  <CardTitle>Learning Progress</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-6\">\n                    {enrollments?.map((enrollment) => {\n                      const course = courses?.find((c) => c.id === enrollment.courseId);\n                      if (!course) return null;\n\n                      return (\n                        <div key={enrollment.id} className=\"space-y-2\">\n                          <div className=\"flex justify-between\">\n                            <span className=\"text-sm font-medium\">{course.title}</span>\n                            <span className=\"text-sm text-muted-foreground\">{enrollment.progress}%</span>\n                          </div>\n                          <Progress value={parseFloat(enrollment.progress || '0')} className=\"h-3\" />\n                        </div>\n                      );\n                    })}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Test Scores */}\n              <Card data-testid=\"test-scores\">\n                <CardHeader>\n                  <CardTitle>Recent Test Scores</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {enrollments?.filter((e) => e.testScores && Array.isArray(e.testScores) && e.testScores.length > 0).map((enrollment) => {\n                      const course = courses?.find((c) => c.id === enrollment.courseId);\n                      const latestScore = Array.isArray(enrollment.testScores) ? enrollment.testScores[enrollment.testScores.length - 1] : null;\n                      \n                      return (\n                        <div key={enrollment.id} className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n                          <div>\n                            <p className=\"font-medium\">{course?.title}</p>\n                            <p className=\"text-sm text-muted-foreground\">Practice Test</p>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className=\"text-lg font-bold\">{latestScore ? (latestScore as any).score : 'N/A'}%</p>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {latestScore ? new Date((latestScore as any).date).toLocaleDateString() : 'N/A'}\n                            </p>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"mentor\" className=\"space-y-8\">\n            <StandaloneAIMentorChat />\n          </TabsContent>\n\n          <TabsContent value=\"subscription\" className=\"space-y-8\">\n            <SubscriptionManagement />\n          </TabsContent>\n\n          <TabsContent value=\"jobs\" className=\"space-y-8\">\n            <Card data-testid=\"job-applications\">\n              <CardHeader>\n                <CardTitle>My Job Applications</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {applications && applications.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {applications.map((application) => (\n                      <div key={application.id} className=\"p-4 border rounded-lg\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <h3 className=\"font-semibold\">Job Title</h3>\n                            <p className=\"text-sm text-muted-foreground\">Company Name</p>\n                          </div>\n                          <Badge variant={application.status === 'pending' ? 'secondary' : 'default'}>\n                            {application.status}\n                          </Badge>\n                        </div>\n                        <p className=\"text-sm text-muted-foreground mt-2\">\n                          Applied {application.appliedAt ? new Date(application.appliedAt).toLocaleDateString() : 'N/A'}\n                        </p>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-12\">\n                    <FileText className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n                    <h3 className=\"text-lg font-semibold mb-2\">No job applications</h3>\n                    <p className=\"text-muted-foreground mb-4\">Start applying to jobs to track your applications here</p>\n                    <Link href=\"/jobs\">\n                      <Button>Browse Jobs</Button>\n                    </Link>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n\n// Subscription Management Component\nfunction SubscriptionManagement() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const { data: subscriptionStatus } = useQuery<any>({\n    queryKey: ['/api/subscription-status'],\n    retry: false,\n  });\n\n  const cancelMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/cancel-subscription\");\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Subscription Cancelled\",\n        description: \"Your subscription will be cancelled at the end of the current billing period.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/subscription-status'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to cancel subscription\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const pricingPlans = [\n    {\n      id: \"basic\",\n      name: \"Basic\",\n      price: \"$49\",\n      priceId: \"price_basic_monthly\",\n      tier: \"basic\",\n      description: \"Perfect for getting started\",\n      features: [\n        \"1 Certification Track\",\n        \"Basic Calculator Tools\", \n        \"Practice Tests\",\n        \"Job Board Access\",\n        \"Email Support\"\n      ]\n    },\n    {\n      id: \"professional\",\n      name: \"Professional\",\n      price: \"$79\",\n      priceId: \"price_professional_monthly\",\n      tier: \"professional\",\n      description: \"For serious professionals\",\n      popular: true,\n      features: [\n        \"3 Certification Tracks\",\n        \"Complete Calculator Suite\",\n        \"Photo Code Checker\",\n        \"AI Mentor Support\",\n        \"Resume Builder\",\n        \"Priority Support\"\n      ]\n    },\n    {\n      id: \"master\",\n      name: \"Master\",\n      price: \"$99\",\n      priceId: \"price_master_monthly\",\n      tier: \"master\",\n      description: \"Complete mastery package\",\n      features: [\n        \"All 5 Certification Tracks\",\n        \"Plan Analysis Tools\",\n        \"Material List Generator\",\n        \"Referral Commissions\",\n        \"Book Store Access\",\n        \"White-Glove Support\"\n      ]\n    }\n  ];\n\n  const currentPlan = pricingPlans.find(plan => plan.tier === user?.subscriptionTier) || pricingPlans[0];\n  const hasActiveSubscription = subscriptionStatus?.hasActiveSubscription || false;\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Current Subscription Status */}\n      <Card data-testid=\"current-subscription\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center space-x-2\">\n            <CreditCard className=\"w-5 h-5\" />\n            <span>Current Subscription</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-start justify-between\">\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center space-x-2 mb-2\">\n                  <h3 className=\"text-xl font-semibold\">{currentPlan.name} Plan</h3>\n                  {currentPlan.popular && <Crown className=\"w-5 h-5 text-yellow-500\" />}\n                  <Badge variant={hasActiveSubscription ? \"default\" : \"secondary\"}>\n                    {hasActiveSubscription ? \"Active\" : \"Inactive\"}\n                  </Badge>\n                </div>\n                <p className=\"text-2xl font-bold text-primary\">{currentPlan.price}/month</p>\n                <p className=\"text-muted-foreground\">{currentPlan.description}</p>\n              </div>\n\n              {subscriptionStatus?.currentPeriodEnd && (\n                <p className=\"text-sm text-muted-foreground\">\n                  {hasActiveSubscription ? \"Renews\" : \"Expires\"} on{\" \"}\n                  {new Date((subscriptionStatus?.currentPeriodEnd || 0) * 1000).toLocaleDateString()}\n                </p>\n              )}\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">Included Features:</h4>\n                <ul className=\"space-y-1\">\n                  {currentPlan.features.map((feature, index) => (\n                    <li key={index} className=\"flex items-center space-x-2 text-sm\">\n                      <Check className=\"w-4 h-4 text-green-600\" />\n                      <span>{feature}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              {hasActiveSubscription && user?.subscriptionTier !== 'basic' && (\n                <Button\n                  variant=\"destructive\"\n                  size=\"sm\"\n                  onClick={() => cancelMutation.mutate()}\n                  disabled={cancelMutation.isPending}\n                  data-testid=\"cancel-subscription\"\n                >\n                  {cancelMutation.isPending ? \"Cancelling...\" : \"Cancel Subscription\"}\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Upgrade Options */}\n      {(!hasActiveSubscription || user?.subscriptionTier === 'basic') && (\n        <Card data-testid=\"upgrade-options\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Zap className=\"w-5 h-5\" />\n              <span>Upgrade Your Plan</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {pricingPlans.filter(plan => plan.tier !== user?.subscriptionTier).map((plan) => (\n                <Card key={plan.id} className={`relative ${plan.popular ? 'border-primary' : ''}`}>\n                  {plan.popular && (\n                    <Badge className=\"absolute -top-2 left-1/2 transform -translate-x-1/2\">\n                      Most Popular\n                    </Badge>\n                  )}\n                  <CardContent className=\"p-6\">\n                    <div className=\"text-center mb-4\">\n                      <h3 className=\"text-lg font-semibold\">{plan.name}</h3>\n                      <p className=\"text-2xl font-bold text-primary\">{plan.price}/month</p>\n                      <p className=\"text-sm text-muted-foreground\">{plan.description}</p>\n                    </div>\n                    \n                    <ul className=\"space-y-2 mb-6\">\n                      {plan.features.slice(0, 4).map((feature, index) => (\n                        <li key={index} className=\"flex items-center space-x-2 text-sm\">\n                          <Check className=\"w-4 h-4 text-green-600\" />\n                          <span>{feature}</span>\n                        </li>\n                      ))}\n                      {plan.features.length > 4 && (\n                        <li className=\"text-sm text-muted-foreground\">\n                          +{plan.features.length - 4} more features\n                        </li>\n                      )}\n                    </ul>\n                    \n                    <Link href={`/subscribe?plan=${plan.id}&priceId=${plan.priceId}&tier=${plan.tier}`}>\n                      <Button className=\"w-full\" size=\"sm\">\n                        Upgrade to {plan.name}\n                      </Button>\n                    </Link>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Billing Information */}\n      <Card data-testid=\"billing-info\">\n        <CardHeader>\n          <CardTitle>Billing Information</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n              <div>\n                <p className=\"font-medium\">Payment Method</p>\n                <p className=\"text-sm text-muted-foreground\">Managed by Stripe</p>\n              </div>\n              <Button variant=\"outline\" size=\"sm\">\n                Update Payment\n              </Button>\n            </div>\n\n            <Alert>\n              <FileText className=\"h-4 w-4\" />\n              <AlertDescription>\n                For billing questions or to update your payment method, please contact our support team.\n                All billing is processed securely through Stripe.\n              </AlertDescription>\n            </Alert>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":26845},"client/src/pages/home.tsx":{"content":"import { useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Building2, Calculator, Camera, MessageCircle, Users, Star, Clock, MapPin, DollarSign } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport heroImage from \"@assets/generated_images/Louisiana_plumbing_prep_hero_image_70473180.png\";\nimport BetaBanner from \"@/components/beta-banner\";\n\nexport default function Home() {\n  useEffect(() => {\n    document.title = \"Louisiana Plumbing License Exam Prep - Journeyman, Master & Backflow Certification Training\";\n    \n    // Update meta description\n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute('content', 'Pass your Louisiana plumbing license exam with our comprehensive prep courses. Journeyman, master plumber, backflow prevention, and natural gas certification training. 95% pass rate. State-approved materials.');\n    }\n  }, []);\n\n  const courses = [\n    {\n      id: \"journeyman\",\n      title: \"Journeyman Plumber\",\n      description: \"Master residential and commercial plumbing systems, codes, and installation techniques.\",\n      price: \"Available\",\n      icon: Building2,\n      features: [\"120+ Practice Questions\", \"Video Lessons\", \"Code Books Included\"]\n    },\n    {\n      id: \"backflow\",\n      title: \"Backflow Prevention\",\n      description: \"Comprehensive training course covering backflow prevention testing, repairs, and field report completion.\",\n      price: \"Coming Soon\",\n      icon: Calculator,\n      features: [\"Device Testing Modules\", \"Cross-Connection Control\", \"Field Reports Training\"]\n    },\n    {\n      id: \"natural-gas\",\n      title: \"Natural Gas\",\n      description: \"Gas line installation, pressure testing, and safety protocols for natural gas systems.\",\n      price: \"Coming Soon\",\n      icon: Building2,\n      features: [\"Pressure Testing Procedures\", \"Safety Protocols\", \"Code Compliance\"]\n    },\n    {\n      id: \"medical-gas\",\n      title: \"Medical Gas\",\n      description: \"Hospital and healthcare facility gas systems installation and maintenance certification.\",\n      price: \"Coming Soon\",\n      icon: Building2,\n      features: [\"NFPA 99 Standards\", \"Critical Care Systems\", \"Purity Testing\"]\n    },\n    {\n      id: \"master\",\n      title: \"Master Plumber\",\n      description: \"Advanced business operations, code interpretation, and supervisory responsibilities.\",\n      price: \"Coming Soon\",\n      icon: Star,\n      features: [\"Business Law & Operations\", \"Advanced Code Interpretation\", \"Project Management\"],\n      badge: \"Most Advanced\"\n    }\n  ];\n\n  const tools = [\n    {\n      title: \"Pipe Sizing Calculator\",\n      description: \"Calculate proper pipe sizes for water supply systems based on fixture units and flow rates.\",\n      icon: Calculator\n    },\n    {\n      title: \"Plan Analysis Tool\",\n      description: \"Upload construction plans and get automated material lists and code compliance checks.\",\n      icon: Building2\n    },\n    {\n      title: \"Photo Code Checker\",\n      description: \"Take photos of installations and get instant AI-powered code compliance feedback.\",\n      icon: Camera\n    },\n    {\n      title: \"Pressure Loss Calculator\",\n      description: \"Calculate pressure losses through fittings, valves, and straight pipe runs.\",\n      icon: Calculator\n    }\n  ];\n\n  const jobs = [\n    {\n      title: \"Journeyman Plumber\",\n      company: \"Reliable Contracting LLC\",\n      location: \"Baton Rouge, LA\",\n      type: \"Full-time\",\n      salary: \"$28-35/hour\",\n      description: \"Seeking experienced journeyman plumber for residential and commercial projects. Must have valid Louisiana license and 3+ years experience.\",\n      badge: \"Featured\",\n      tags: [\"Residential\", \"Commercial\", \"Benefits\"]\n    },\n    {\n      title: \"Master Plumber - Supervisor\",\n      company: \"Gulf South Plumbing\",\n      location: \"New Orleans, LA\",\n      type: \"Full-time\",\n      salary: \"$45-55/hour\",\n      description: \"Lead team of 5+ plumbers on commercial construction projects. Master license required. Excellent leadership and project management skills needed.\",\n      badge: \"Urgent\",\n      tags: [\"Leadership\", \"Commercial\", \"Project Management\"]\n    },\n    {\n      title: \"Backflow Prevention Specialist\",\n      company: \"Acadiana Plumbing Services\",\n      location: \"Lafayette, LA\",\n      type: \"Contract\",\n      salary: \"$150-200/test\",\n      description: \"Certified backflow prevention assembly tester needed for commercial and industrial clients. Must have current Louisiana certification.\",\n      tags: [\"Backflow Testing\", \"Commercial\", \"Flexible Schedule\"]\n    }\n  ];\n\n  const pricingPlans = [\n    {\n      name: \"Basic\",\n      price: \"$49\",\n      description: \"Perfect for getting started\",\n      features: [\n        \"1 Certification Track\",\n        \"Basic Calculator Tools\",\n        \"Practice Tests\",\n        \"Job Board Access\",\n        \"Email Support\"\n      ]\n    },\n    {\n      name: \"Professional\",\n      price: \"$79\",\n      description: \"For serious professionals\",\n      popular: true,\n      features: [\n        \"3 Certification Tracks\",\n        \"Complete Calculator Suite\",\n        \"Photo Code Checker\",\n        \"AI Mentor Support\",\n        \"Resume Builder\",\n        \"Priority Support\"\n      ]\n    },\n    {\n      name: \"Master\",\n      price: \"$99\",\n      description: \"Complete mastery package\",\n      features: [\n        \"All 5 Certification Tracks\",\n        \"Plan Analysis Tools\",\n        \"Material List Generator\",\n        \"Referral Commissions\",\n        \"Book Store Access\",\n        \"White-Glove Support\"\n      ]\n    }\n  ];\n\n  return (\n    <div>\n      {/* Beta Banner */}\n      <section className=\"py-6 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <BetaBanner />\n        </div>\n      </section>\n\n      {/* Hero Section */}\n      <section className=\"gradient-hero text-white py-20\" data-testid=\"hero-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center\">\n            <div>\n              <h1 className=\"text-4xl lg:text-6xl font-bold mb-6 leading-tight\" data-testid=\"hero-title\">\n                Master Your<br />\n                Plumbing Career<br />\n                in Louisiana\n              </h1>\n              <p className=\"text-xl text-blue-100 mb-8 leading-relaxed\" data-testid=\"hero-description\">\n                Comprehensive prep courses for Journeyman, Backflow, Natural Gas, Medical Gas, and Master Plumber certifications. Take your Louisiana plumbing test with confidence that you will pass the first time.\n              </p>\n              <div className=\"flex flex-col sm:flex-row gap-4\">\n                <Link href=\"/pricing\">\n                  <Button size=\"lg\" className=\"bg-white text-primary hover:bg-gray-50 text-lg px-8 py-4\" data-testid=\"button-free-trial\">\n                    Get 50% Off First Month\n                  </Button>\n                </Link>\n              </div>\n              <div className=\"flex items-center space-x-6 mt-8 text-blue-100\">\n                <div className=\"flex items-center space-x-2\">\n                  <CheckCircle className=\"w-5 h-5\" />\n                  <span className=\"text-sm\">5 Certification Tracks</span>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <CheckCircle className=\"w-5 h-5\" />\n                  <span className=\"text-sm\">AI Mentor Support</span>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <CheckCircle className=\"w-5 h-5\" />\n                  <span className=\"text-sm\">Louisiana Job Placement</span>\n                </div>\n              </div>\n            </div>\n            <div className=\"relative\">\n              <img \n                src={heroImage} \n                alt=\"Louisiana plumbing certification and professional education\" \n                className=\"rounded-2xl shadow-2xl w-full h-auto\"\n                data-testid=\"hero-image\"\n              />\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Course Tracks Section */}\n      <section className=\"py-20 bg-muted/50\" data-testid=\"courses-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\" data-testid=\"courses-title\">\n              Five Professional Certification Tracks\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\" data-testid=\"courses-description\">\n              Comprehensive courses designed to prepare you for Louisiana state plumbing examinations with confidence.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {courses.map((course) => (\n              <Card key={course.id} className={`p-8 hover:shadow-lg transition-shadow relative ${course.badge ? 'border-accent' : ''}`} data-testid={`course-card-${course.id}`}>\n                {course.badge && (\n                  <Badge className=\"absolute -top-3 left-4 bg-accent text-accent-foreground\">\n                    {course.badge}\n                  </Badge>\n                )}\n                <CardContent className=\"p-0\">\n                  <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center mb-6\">\n                    <course.icon className=\"w-6 h-6 text-primary-foreground\" />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-card-foreground mb-3\" data-testid={`course-title-${course.id}`}>\n                    {course.title}\n                  </h3>\n                  <p className=\"text-muted-foreground mb-6\" data-testid={`course-description-${course.id}`}>\n                    {course.description}\n                  </p>\n                  <div className=\"space-y-3 mb-6\">\n                    {course.features.map((feature, index) => (\n                      <div key={index} className=\"flex items-center space-x-2 text-sm\">\n                        <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                        <span>{feature}</span>\n                      </div>\n                    ))}\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    {course.price === \"Coming Soon\" ? (\n                      <>\n                        <span className=\"text-lg font-semibold text-muted-foreground\" data-testid={`course-status-${course.id}`}>\n                          Coming Soon\n                        </span>\n                        <Button disabled data-testid={`button-coming-soon-${course.id}`}>\n                          Coming Soon\n                        </Button>\n                      </>\n                    ) : (\n                      <>\n                        <span className=\"text-lg font-semibold text-muted-foreground\">\n                          Available Now\n                        </span>\n                        <Link href=\"/pricing\">\n                          <Button data-testid={`button-start-course-${course.id}`}>\n                            Start Course\n                          </Button>\n                        </Link>\n                      </>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Professional Tools Section */}\n      <section className=\"py-20 bg-white\" data-testid=\"tools-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\" data-testid=\"tools-title\">\n              Professional Plumbing Tools & Calculators\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\" data-testid=\"tools-description\">\n              Comprehensive suite of calculators and analysis tools to support your plumbing work and studies.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center\">\n            <div>\n              <div className=\"space-y-8\">\n                {tools.map((tool, index) => (\n                  <div key={index} className=\"flex items-start space-x-4\" data-testid={`tool-${index}`}>\n                    <div className=\"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0\">\n                      <tool.icon className=\"w-6 h-6 text-primary\" />\n                    </div>\n                    <div>\n                      <h3 className=\"text-xl font-semibold text-foreground mb-2\" data-testid={`tool-title-${index}`}>\n                        {tool.title}\n                      </h3>\n                      <p className=\"text-muted-foreground\" data-testid={`tool-description-${index}`}>\n                        {tool.description}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n            \n            <div className=\"lg:pl-8\">\n              <Card className=\"bg-muted/50 p-8\" data-testid=\"calculator-demo\">\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-foreground mb-4\">Pipe Sizing Calculator</h3>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-foreground mb-2\">Fixture Units (WFU)</label>\n                      <input \n                        type=\"number\" \n                        className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:ring-2 focus:ring-primary focus:border-transparent\" \n                        placeholder=\"Enter fixture units\" \n                        defaultValue=\"45\"\n                        data-testid=\"input-fixture-units\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium text-foreground mb-2\">Pipe Material</label>\n                      <select \n                        className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:ring-2 focus:ring-primary focus:border-transparent\"\n                        data-testid=\"select-pipe-material\"\n                      >\n                        <option>Copper Type L</option>\n                        <option>PEX</option>\n                        <option>CPVC</option>\n                      </select>\n                    </div>\n                    <Link href=\"/tools\">\n                      <Button className=\"w-full\" data-testid=\"button-calculate-pipe-size\">\n                        Calculate Pipe Size\n                      </Button>\n                    </Link>\n                    <Card className=\"p-4 border\">\n                      <div className=\"text-sm text-muted-foreground mb-1\">Recommended Pipe Size:</div>\n                      <div className=\"text-2xl font-bold text-primary\" data-testid=\"calculated-pipe-size\">\n                        3/4\" Copper\n                      </div>\n                    </Card>\n                  </div>\n                </div>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* AI Mentor Section */}\n      <section className=\"py-20 bg-gradient-to-br from-purple-50 to-blue-50\" data-testid=\"ai-mentor-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center\">\n            <div className=\"order-2 lg:order-1\">\n              <img \n                src=\"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\" \n                alt=\"Professional mentor with apprentice reviewing blueprints\" \n                className=\"rounded-2xl shadow-xl w-full h-auto\"\n                data-testid=\"mentor-image\"\n              />\n            </div>\n            <div className=\"order-1 lg:order-2\">\n              <Badge className=\"bg-purple-100 text-purple-800 mb-4\">\n                AI-Powered\n              </Badge>\n              <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-6\" data-testid=\"mentor-title\">\n                24/7 AI Mentor Support\n              </h2>\n              <p className=\"text-xl text-muted-foreground mb-8\" data-testid=\"mentor-description\">\n                Get instant answers to your plumbing questions with our AI mentor trained on Louisiana plumbing codes and industry best practices.\n              </p>\n              \n              <div className=\"space-y-6 mb-8\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                  </div>\n                  <span className=\"text-foreground\">Instant code interpretation and clarification</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                  </div>\n                  <span className=\"text-foreground\">Step-by-step problem solving guidance</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                  </div>\n                  <span className=\"text-foreground\">Practice test explanations and feedback</span>\n                </div>\n              </div>\n              \n              <Card className=\"p-6 border\" data-testid=\"mentor-demo\">\n                <div className=\"flex items-start space-x-3\">\n                  <div className=\"w-8 h-8 bg-primary rounded-full flex items-center justify-center\">\n                    <MessageCircle className=\"w-4 h-4 text-primary-foreground\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm text-muted-foreground mb-1\">AI Mentor</p>\n                    <p className=\"text-foreground\">\"What's the minimum pipe size for a 3-fixture bathroom according to Louisiana code?\"</p>\n                  </div>\n                </div>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Louisiana Licensing Requirements SEO Section */}\n      <section className=\"py-20 bg-muted/30\" data-testid=\"licensing-requirements-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\" data-testid=\"licensing-title\">\n              Louisiana Plumbing License Requirements & Exam Information\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-4xl mx-auto\" data-testid=\"licensing-description\">\n              Complete guide to getting your Louisiana plumbing license. Requirements, exam details, and certification processes for journeyman, master, and specialty licenses.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12\">\n            <div>\n              <h3 className=\"text-2xl font-bold text-foreground mb-6\">Louisiana Journeyman Plumber License</h3>\n              <div className=\"space-y-4 mb-8\">\n                <div className=\"flex items-start space-x-3\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600 mt-1\" />\n                  <div>\n                    <p className=\"font-semibold text-foreground\">Education Requirements</p>\n                    <p className=\"text-muted-foreground text-sm\">Complete 4-year apprenticeship program or 8,000 hours of documented experience</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start space-x-3\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600 mt-1\" />\n                  <div>\n                    <p className=\"font-semibold text-foreground\">Exam Coverage</p>\n                    <p className=\"text-muted-foreground text-sm\">Louisiana State Plumbing Code, residential & commercial systems, safety protocols</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start space-x-3\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600 mt-1\" />\n                  <div>\n                    <p className=\"font-semibold text-foreground\">Application Process</p>\n                    <p className=\"text-muted-foreground text-sm\">Submit application to Louisiana State Board of Examiners of Plumbers</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start space-x-3\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600 mt-1\" />\n                  <div>\n                    <p className=\"font-semibold text-foreground\">Exam Fee</p>\n                    <p className=\"text-muted-foreground text-sm\">$85 examination fee plus $25 application processing fee</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            <div>\n              <h3 className=\"text-2xl font-bold text-foreground mb-6\">Specialty Certifications Available</h3>\n              <div className=\"space-y-6\">\n                <Card className=\"p-4\">\n                  <h4 className=\"font-semibold text-foreground mb-2\">Backflow Prevention Assembly Tester</h4>\n                  <p className=\"text-muted-foreground text-sm mb-2\">Test and maintain backflow prevention devices. Recertification required every 3 years.</p>\n                  <Badge variant=\"secondary\">State Certified</Badge>\n                </Card>\n                \n                <Card className=\"p-4\">\n                  <h4 className=\"font-semibold text-foreground mb-2\">Natural Gas Piping Installer</h4>\n                  <p className=\"text-muted-foreground text-sm mb-2\">Install natural gas piping systems in residential and commercial applications.</p>\n                  <Badge variant=\"secondary\">Code Compliant</Badge>\n                </Card>\n                \n                <Card className=\"p-4\">\n                  <h4 className=\"font-semibold text-foreground mb-2\">Medical Gas Installer</h4>\n                  <p className=\"text-muted-foreground text-sm mb-2\">Hospital and healthcare facility gas systems following NFPA 99 standards.</p>\n                  <Badge variant=\"secondary\">NFPA Certified</Badge>\n                </Card>\n                \n                <Card className=\"p-4\">\n                  <h4 className=\"font-semibold text-foreground mb-2\">Master Plumber License</h4>\n                  <p className=\"text-muted-foreground text-sm mb-2\">Business operations, advanced code interpretation, and supervisory responsibilities.</p>\n                  <Badge variant=\"secondary\">Advanced Level</Badge>\n                </Card>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"mt-16 bg-white rounded-lg p-8\">\n            <h3 className=\"text-2xl font-bold text-foreground mb-6 text-center\">Louisiana State Plumbing Code Coverage</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              <div className=\"text-center\">\n                <Building2 className=\"w-12 h-12 text-primary mx-auto mb-4\" />\n                <h4 className=\"font-semibold text-foreground mb-2\">Residential Systems</h4>\n                <p className=\"text-muted-foreground text-sm\">Water supply, drainage, fixtures, and venting systems for single and multi-family homes</p>\n              </div>\n              <div className=\"text-center\">\n                <Calculator className=\"w-12 h-12 text-primary mx-auto mb-4\" />\n                <h4 className=\"font-semibold text-foreground mb-2\">Commercial Applications</h4>\n                <p className=\"text-muted-foreground text-sm\">Large buildings, restaurants, hospitals, and industrial facility plumbing requirements</p>\n              </div>\n              <div className=\"text-center\">\n                <Star className=\"w-12 h-12 text-primary mx-auto mb-4\" />\n                <h4 className=\"font-semibold text-foreground mb-2\">Code Compliance</h4>\n                <p className=\"text-muted-foreground text-sm\">Safety protocols, inspection procedures, and Louisiana-specific regulations and requirements</p>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"text-center mt-12\">\n            <h3 className=\"text-xl font-bold text-foreground mb-4\">Ready to Start Your Louisiana Plumbing Career?</h3>\n            <p className=\"text-muted-foreground mb-6\">Join thousands of Louisiana plumbers who have advanced their careers with our state-approved training courses</p>\n            <Link href=\"/pricing\">\n              <Button size=\"lg\" data-testid=\"button-start-training\">\n                Start Your Certification Training Today\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </section>\n\n      {/* Job Board Preview */}\n      <section className=\"py-20 bg-white\" data-testid=\"jobs-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\" data-testid=\"jobs-title\">\n              Louisiana Plumbing Job Board\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\" data-testid=\"jobs-description\">\n              Connect with employers across Louisiana. Premium job postings with detailed company information and competitive salaries.\n            </p>\n          </div>\n          \n          <div className=\"space-y-6\">\n            {jobs.map((job, index) => (\n              <Card key={index} className=\"p-6 hover:shadow-lg transition-shadow\" data-testid={`job-card-${index}`}>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-start space-x-4\">\n                    <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n                      <span className=\"text-primary-foreground font-bold text-lg\">\n                        {job.company.charAt(0)}\n                      </span>\n                    </div>\n                    <div>\n                      <h3 className=\"text-xl font-semibold text-card-foreground mb-1\" data-testid={`job-title-${index}`}>\n                        {job.title}\n                      </h3>\n                      <p className=\"text-muted-foreground mb-2\" data-testid={`job-company-${index}`}>\n                        {job.company}\n                      </p>\n                      <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\n                        <div className=\"flex items-center space-x-1\">\n                          <MapPin className=\"w-4 h-4\" />\n                          <span data-testid={`job-location-${index}`}>{job.location}</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <Clock className=\"w-4 h-4\" />\n                          <span data-testid={`job-type-${index}`}>{job.type}</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <DollarSign className=\"w-4 h-4\" />\n                          <span data-testid={`job-salary-${index}`}>{job.salary}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    {job.badge && (\n                      <Badge className={job.badge === \"Featured\" ? \"bg-green-100 text-green-800\" : \"bg-purple-100 text-purple-800\"}>\n                        {job.badge}\n                      </Badge>\n                    )}\n                    <Link href=\"/jobs\">\n                      <Button data-testid={`button-apply-${index}`}>\n                        Apply Now\n                      </Button>\n                    </Link>\n                  </div>\n                </div>\n                <p className=\"text-muted-foreground mt-4\" data-testid={`job-description-${index}`}>\n                  {job.description}\n                </p>\n                <div className=\"flex items-center space-x-2 mt-4\">\n                  {job.tags.map((tag, tagIndex) => (\n                    <Badge key={tagIndex} variant=\"secondary\" className=\"text-xs\">\n                      {tag}\n                    </Badge>\n                  ))}\n                </div>\n              </Card>\n            ))}\n          </div>\n          \n          <div className=\"text-center mt-12\">\n            <Link href=\"/jobs\">\n              <Button size=\"lg\" data-testid=\"button-view-all-jobs\">\n                View All Jobs (47 Available)\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Section */}\n      <section className=\"py-20 bg-muted/50\" data-testid=\"pricing-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\" data-testid=\"pricing-title\">\n              Choose Your Learning Path\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\" data-testid=\"pricing-description\">\n              Flexible pricing plans designed for every stage of your plumbing career. Choose the plan that fits your needs.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n            {pricingPlans.map((plan, index) => (\n              <Card key={index} className={`p-8 hover:shadow-lg transition-shadow relative ${plan.popular ? 'border-2 border-primary' : ''}`} data-testid={`pricing-plan-${plan.name.toLowerCase()}`}>\n                {plan.popular && (\n                  <Badge className=\"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-primary text-primary-foreground\">\n                    Most Popular\n                  </Badge>\n                )}\n                <CardContent className=\"p-0\">\n                  <div className=\"text-center mb-8\">\n                    <h3 className=\"text-2xl font-bold text-card-foreground mb-2\" data-testid={`plan-name-${plan.name.toLowerCase()}`}>\n                      {plan.name}\n                    </h3>\n                    <div className=\"text-4xl font-bold text-primary mb-2\" data-testid={`plan-price-${plan.name.toLowerCase()}`}>\n                      {plan.price}<span className=\"text-xl font-normal text-muted-foreground\">/month</span>\n                    </div>\n                    <p className=\"text-muted-foreground\" data-testid={`plan-description-${plan.name.toLowerCase()}`}>\n                      {plan.description}\n                    </p>\n                  </div>\n                  \n                  <div className=\"space-y-4 mb-8\">\n                    {plan.features.map((feature, featureIndex) => (\n                      <div key={featureIndex} className=\"flex items-center space-x-3\">\n                        <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                        <span className=\"text-card-foreground\">{feature}</span>\n                      </div>\n                    ))}\n                  </div>\n                  \n                  <Link href=\"/pricing\">\n                    <Button className=\"w-full\" size=\"lg\" data-testid={`button-trial-${plan.name.toLowerCase()}`}>\n                      Choose Plan\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n          \n          <div className=\"text-center mt-12\">\n            <p className=\"text-muted-foreground mb-4\">Cancel anytime â€¢ Pro-rated billing â€¢ No setup fees</p>\n            <div className=\"flex items-center justify-center space-x-8 text-sm text-muted-foreground\">\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Louisiana State Approved</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Mobile App Included</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Secure Payment Processing</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n","size_bytes":33343},"client/src/pages/jobs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Search, MapPin, Clock, DollarSign, Briefcase, Filter, BookOpen, Lock, Plus } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport JobCard from \"@/components/job-card\";\n\nexport default function Jobs() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [locationFilter, setLocationFilter] = useState(\"all\");\n  const [typeFilter, setTypeFilter] = useState(\"all\");\n  const [page, setPage] = useState(1);\n\n  const { data: jobsData, isLoading, error } = useQuery({\n    queryKey: [\"/api/jobs\", { page, search: searchTerm, location: locationFilter, type: typeFilter }],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        page: page.toString(),\n        limit: \"10\",\n        ...(searchTerm && { search: searchTerm }),\n        ...(locationFilter !== \"all\" && { location: locationFilter }),\n        ...(typeFilter !== \"all\" && { type: typeFilter }),\n      });\n      const response = await fetch(`/api/jobs?${params}`);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Failed to fetch jobs');\n      }\n      return response.json();\n    },\n    retry: false,\n  });\n\n  const locations = [\n    { value: \"all\", label: \"All Locations\" },\n    { value: \"baton-rouge\", label: \"Baton Rouge\" },\n    { value: \"new-orleans\", label: \"New Orleans\" },\n    { value: \"lafayette\", label: \"Lafayette\" },\n    { value: \"shreveport\", label: \"Shreveport\" },\n    { value: \"lake-charles\", label: \"Lake Charles\" },\n  ];\n\n  const jobTypes = [\n    { value: \"all\", label: \"All Types\" },\n    { value: \"full_time\", label: \"Full-time\" },\n    { value: \"part_time\", label: \"Part-time\" },\n    { value: \"contract\", label: \"Contract\" },\n    { value: \"temporary\", label: \"Temporary\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Section */}\n      <section className=\"gradient-hero text-white py-16\" data-testid=\"jobs-hero\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <h1 className=\"text-4xl lg:text-5xl font-bold mb-6\" data-testid=\"jobs-title\">\n              Louisiana Plumbing Jobs\n            </h1>\n            <p className=\"text-xl text-blue-100 max-w-3xl mx-auto mb-8\" data-testid=\"jobs-description\">\n              Connect with top employers across Louisiana. Find your next opportunity in residential, commercial, \n              or specialized plumbing work.\n            </p>\n            <div className=\"flex items-center justify-center space-x-8 text-blue-100 mb-8\">\n              <div className=\"flex items-center space-x-2\">\n                <Briefcase className=\"w-5 h-5\" />\n                <span>47 Active Jobs</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <MapPin className=\"w-5 h-5\" />\n                <span>Statewide Opportunities</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <DollarSign className=\"w-5 h-5\" />\n                <span>Competitive Salaries</span>\n              </div>\n            </div>\n            <Link href=\"/employer-portal\">\n              <Button size=\"lg\" variant=\"secondary\" className=\"bg-white/10 hover:bg-white/20 text-white border-white/20\">\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Post a Job\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </section>\n\n      {/* Search and Filter Section */}\n      <section className=\"py-8 bg-white border-b\" data-testid=\"jobs-filters\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex flex-col lg:flex-row gap-4 items-center\">\n            <div className=\"flex-1 max-w-lg\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n                <Input\n                  placeholder=\"Search jobs, companies, or keywords...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                  data-testid=\"search-jobs\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"flex gap-4\">\n              <Select value={locationFilter} onValueChange={setLocationFilter}>\n                <SelectTrigger className=\"w-48\" data-testid=\"filter-location\">\n                  <SelectValue placeholder=\"Location\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {locations.map((location) => (\n                    <SelectItem key={location.value} value={location.value}>\n                      {location.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              <Select value={typeFilter} onValueChange={setTypeFilter}>\n                <SelectTrigger className=\"w-36\" data-testid=\"filter-type\">\n                  <SelectValue placeholder=\"Job Type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {jobTypes.map((type) => (\n                    <SelectItem key={type.value} value={type.value}>\n                      {type.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              <Button variant=\"outline\" size=\"icon\" data-testid=\"advanced-filters\">\n                <Filter className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Job Listings */}\n      <section className=\"py-16\" data-testid=\"jobs-listings\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          {error && error.message.includes(\"course enrollment\") ? (\n            <div className=\"max-w-4xl mx-auto\">\n              <Alert className=\"mb-8 border-amber-200 bg-amber-50\">\n                <Lock className=\"h-4 w-4 text-amber-600\" />\n                <AlertDescription className=\"text-amber-800\">\n                  <div className=\"space-y-4\">\n                    <div>\n                      <h3 className=\"font-semibold mb-2\">Job Board Access Requires Course Enrollment</h3>\n                      <p>Our exclusive job board is available only to students enrolled in our Louisiana Plumbing Code certification courses. This ensures our partner employers connect with qualified, trained professionals.</p>\n                    </div>\n                    <div className=\"flex flex-col sm:flex-row gap-4\">\n                      <Link href=\"/courses\">\n                        <Button className=\"bg-amber-600 hover:bg-amber-700\">\n                          <BookOpen className=\"w-4 h-4 mr-2\" />\n                          View Courses\n                        </Button>\n                      </Link>\n                      <Link href=\"/pricing\">\n                        <Button variant=\"outline\">\n                          See Pricing\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                </AlertDescription>\n              </Alert>\n              \n              <Card className=\"text-center py-16\">\n                <CardContent>\n                  <Lock className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-2xl font-bold mb-4\">Exclusive Student Job Board</h3>\n                  <p className=\"text-muted-foreground max-w-2xl mx-auto mb-6\">\n                    Get access to exclusive plumbing job opportunities across Louisiana by enrolling in our certification courses. \n                    Our partner employers prefer candidates who have completed our comprehensive training programs.\n                  </p>\n                  <div className=\"grid md:grid-cols-3 gap-6 max-w-4xl mx-auto\">\n                    <div className=\"text-center\">\n                      <div className=\"bg-primary/10 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3\">\n                        <Briefcase className=\"w-6 h-6 text-primary\" />\n                      </div>\n                      <h4 className=\"font-semibold mb-2\">Exclusive Opportunities</h4>\n                      <p className=\"text-sm text-muted-foreground\">Access jobs not posted elsewhere</p>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"bg-primary/10 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3\">\n                        <DollarSign className=\"w-6 h-6 text-primary\" />\n                      </div>\n                      <h4 className=\"font-semibold mb-2\">Higher Pay</h4>\n                      <p className=\"text-sm text-muted-foreground\">Premium positions for trained professionals</p>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"bg-primary/10 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3\">\n                        <MapPin className=\"w-6 h-6 text-primary\" />\n                      </div>\n                      <h4 className=\"font-semibold mb-2\">Statewide Network</h4>\n                      <p className=\"text-sm text-muted-foreground\">Opportunities across Louisiana</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          ) : (\n          <div className=\"flex flex-col lg:flex-row gap-8\">\n            {/* Main Content */}\n            <div className=\"flex-1\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div>\n                  <h2 className=\"text-2xl font-bold text-foreground\" data-testid=\"results-count\">\n                    {jobsData?.total || 0} Jobs Found\n                  </h2>\n                  <p className=\"text-muted-foreground\">\n                    Showing page {page} of {Math.ceil((jobsData?.total || 0) / 10)}\n                  </p>\n                </div>\n                \n                <Select defaultValue=\"newest\">\n                  <SelectTrigger className=\"w-48\" data-testid=\"sort-jobs\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"newest\">Newest First</SelectItem>\n                    <SelectItem value=\"salary-high\">Highest Salary</SelectItem>\n                    <SelectItem value=\"salary-low\">Lowest Salary</SelectItem>\n                    <SelectItem value=\"relevance\">Most Relevant</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {isLoading ? (\n                <div className=\"space-y-6\">\n                  {[...Array(5)].map((_, i) => (\n                    <Card key={i} className=\"p-6\">\n                      <div className=\"animate-pulse space-y-4\">\n                        <div className=\"flex items-start space-x-4\">\n                          <div className=\"w-12 h-12 bg-muted rounded-lg\"></div>\n                          <div className=\"flex-1 space-y-2\">\n                            <div className=\"h-6 bg-muted rounded w-1/3\"></div>\n                            <div className=\"h-4 bg-muted rounded w-1/4\"></div>\n                            <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n                          </div>\n                        </div>\n                      </div>\n                    </Card>\n                  ))}\n                </div>\n              ) : jobsData?.jobs?.length > 0 ? (\n                <div className=\"space-y-6\">\n                  {jobsData.jobs.map((job: any) => (\n                    <JobCard key={job.id} job={job} data-testid={`job-card-${job.id}`} />\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-16\" data-testid=\"no-jobs\">\n                  <Briefcase className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-foreground mb-2\">No jobs found</h3>\n                  <p className=\"text-muted-foreground\">Try adjusting your search criteria or check back later for new opportunities.</p>\n                </div>\n              )}\n\n              {/* Pagination */}\n              {jobsData?.total > 10 && (\n                <div className=\"flex items-center justify-center space-x-2 mt-8\" data-testid=\"pagination\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => setPage(page - 1)}\n                    disabled={page === 1}\n                    data-testid=\"prev-page\"\n                  >\n                    Previous\n                  </Button>\n                  <span className=\"px-4 py-2\">\n                    Page {page} of {Math.ceil(jobsData.total / 10)}\n                  </span>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => setPage(page + 1)}\n                    disabled={page >= Math.ceil(jobsData.total / 10)}\n                    data-testid=\"next-page\"\n                  >\n                    Next\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {/* Sidebar */}\n            <div className=\"lg:w-80\">\n              <div className=\"space-y-6\">\n                {/* Featured Employers */}\n                <Card data-testid=\"featured-employers\">\n                  <CardContent className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold mb-4\">Featured Employers</h3>\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"w-10 h-10 bg-primary rounded-lg flex items-center justify-center\">\n                          <span className=\"text-primary-foreground font-bold text-sm\">RC</span>\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">Reliable Contracting</p>\n                          <p className=\"text-sm text-muted-foreground\">3 open positions</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"w-10 h-10 bg-accent rounded-lg flex items-center justify-center\">\n                          <span className=\"text-accent-foreground font-bold text-sm\">GS</span>\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">Gulf South Plumbing</p>\n                          <p className=\"text-sm text-muted-foreground\">2 open positions</p>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Job Alerts */}\n                <Card data-testid=\"job-alerts\">\n                  <CardContent className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold mb-4\">Job Alerts</h3>\n                    <p className=\"text-muted-foreground text-sm mb-4\">\n                      Get notified when new jobs matching your criteria are posted.\n                    </p>\n                    <Button className=\"w-full\" data-testid=\"create-alert\">\n                      Create Job Alert\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                {/* Salary Guide */}\n                <Card data-testid=\"salary-guide\">\n                  <CardContent className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold mb-4\">Salary Guide</h3>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-sm\">Apprentice</span>\n                        <span className=\"text-sm font-medium\">$16-22/hr</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-sm\">Journeyman</span>\n                        <span className=\"text-sm font-medium\">$25-35/hr</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-sm\">Master Plumber</span>\n                        <span className=\"text-sm font-medium\">$40-60/hr</span>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </div>\n          </div>\n          )}\n        </div>\n      </section>\n    </div>\n  );\n}\n","size_bytes":17052},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/pricing.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { CheckCircle } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport BetaBanner from \"@/components/beta-banner\";\n\nexport default function Pricing() {\n  const [selectedPlan, setSelectedPlan] = useState<string | null>(null);\n  const [isAnnual, setIsAnnual] = useState(false);\n  \n  // Get current user to check beta tester status\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n  \n  // Check if we're still accepting beta testers (for anonymous users)\n  const { data: betaStatus } = useQuery<any>({\n    queryKey: [\"/api/beta-status\"],\n  });\n  \n  // Show beta pricing if user is a beta tester OR we're still accepting beta testers\n  const shouldShowBetaPricing = user?.isBetaTester || betaStatus?.isAcceptingBetaTesters || false;\n\n  useEffect(() => {\n    document.title = \"Louisiana Plumbing Certification Training Pricing - Journeyman, Master & Backflow Courses\";\n    \n    // Update meta description\n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute('content', 'Affordable Louisiana plumbing certification training from $19.99/month. Journeyman prep, master plumber courses, backflow prevention, and natural gas certification. AI tools included. Beta pricing available.');\n    }\n  }, []);\n\n  const calculatePrice = (basePrice: number, betaPrice: number, isAnnual: boolean, isBeta: boolean) => {\n    // Use beta price if user is beta tester\n    let monthlyPrice = isBeta ? betaPrice : basePrice;\n    \n    if (isAnnual) {\n      // Apply 20% annual discount\n      return parseFloat((monthlyPrice * 12 * 0.8).toFixed(2));\n    }\n    \n    return parseFloat(monthlyPrice.toFixed(2));\n  };\n\n\n  const pricingPlans = [\n    {\n      id: \"basic\",\n      name: \"Basic\",\n      basePrice: 26.99,\n      betaPrice: 19.99,\n      tier: \"basic\",\n      description: \"Perfect for getting started\",\n      features: [\n        \"Journeyman Prep Course\",\n        \"Basic Calculator Tools\", \n        \"Practice Tests\",\n        \"Job Board Access\",\n        \"Referral Commissions (10%)\",\n        \"Email Support\",\n        \"AI Mentor Lesson Specific\"\n      ]\n    },\n    {\n      id: \"professional\",\n      name: \"Professional\",\n      basePrice: 39.99,\n      betaPrice: 29.99,\n      tier: \"professional\",\n      description: \"For serious professionals\",\n      popular: true,\n      features: [\n        \"Journeyman Prep Course\",\n        \"Basic Calculator Tools\",\n        \"Practice Tests\",\n        \"Job Board Access\",\n        \"Referral Commissions (10%)\",\n        \"Email Support\",\n        \"Complete Calculator Suite\",\n        \"Photo Code Checker\",\n        \"AI Mentor Support\",\n        \"Resume Builder\",\n        \"Priority Support\"\n      ]\n    },\n    {\n      id: \"master\",\n      name: \"Master\",\n      basePrice: 66.99,\n      betaPrice: 49.99,\n      tier: \"master\",\n      description: \"Complete mastery package\",\n      features: [\n        \"Journeyman Prep Course\",\n        \"Basic Calculator Tools\",\n        \"Practice Tests\",\n        \"Job Board Access\",\n        \"Referral Commissions (10%)\",\n        \"Email Support\",\n        \"Complete Calculator Suite\",\n        \"Photo Code Checker\",\n        \"AI Mentor Support\",\n        \"Resume Builder\",\n        \"Priority Support\",\n        \"Material List Generator\",\n        \"Book Store Access\",\n        \"White-Glove Support\"\n      ]\n    }\n  ];\n\n  const handleSelectPlan = (planId: string) => {\n    setSelectedPlan(planId);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Beta Banner */}\n      {shouldShowBetaPricing && (\n        <section className=\"py-6 bg-background\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <BetaBanner showCTA={false} />\n          </div>\n        </section>\n      )}\n\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-primary/10 to-accent/10\" data-testid=\"pricing-hero\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h1 className=\"text-4xl lg:text-5xl font-bold text-foreground mb-6\" data-testid=\"pricing-hero-title\">\n            Choose Your Learning Path\n          </h1>\n          <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto mb-8\" data-testid=\"pricing-hero-description\">\n            Flexible pricing plans designed for every stage of your plumbing career. Cancel anytime - only pay for days used.\n          </p>\n          <div className=\"flex flex-col items-center space-y-6\">\n            <div className=\"flex items-center justify-center space-x-8 text-sm text-muted-foreground\">\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Cancel Anytime</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Pro-rated Billing</span>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-4 bg-card p-3 rounded-lg border\">\n              <span className={`text-sm font-medium ${!isAnnual ? 'text-primary' : 'text-muted-foreground'}`}>Monthly</span>\n              <Switch checked={isAnnual} onCheckedChange={setIsAnnual} />\n              <span className={`text-sm font-medium ${isAnnual ? 'text-primary' : 'text-muted-foreground'}`}>Annual</span>\n              {isAnnual && <Badge className=\"bg-green-100 text-green-800 text-xs\">Save 20%</Badge>}\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Plans */}\n      <section className=\"py-20\" data-testid=\"pricing-plans\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n            {pricingPlans.map((plan) => (\n              <Card \n                key={plan.id} \n                className={`p-8 hover:shadow-lg transition-all relative cursor-pointer ${\n                  plan.popular ? 'border-2 border-primary scale-105' : ''\n                } ${\n                  selectedPlan === plan.id ? 'ring-2 ring-primary' : ''\n                }`}\n                onClick={() => handleSelectPlan(plan.id)}\n                data-testid={`pricing-plan-${plan.id}`}\n              >\n                {plan.popular && (\n                  <Badge className=\"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-primary text-primary-foreground\">\n                    Most Popular\n                  </Badge>\n                )}\n                <CardContent className=\"p-0\">\n                  <div className=\"text-center mb-8\">\n                    <h3 className=\"text-2xl font-bold text-card-foreground mb-2\" data-testid={`plan-name-${plan.id}`}>\n                      {plan.name}\n                    </h3>\n                    <div className=\"text-4xl font-bold text-primary mb-2\" data-testid={`plan-price-${plan.id}`}>\n                      {isAnnual ? (\n                        <>\n                          ${calculatePrice(plan.basePrice, plan.betaPrice, isAnnual, shouldShowBetaPricing)}\n                          <span className=\"text-xl font-normal text-muted-foreground\">/year</span>\n                        </>\n                      ) : (\n                        <>\n                          ${calculatePrice(plan.basePrice, plan.betaPrice, isAnnual, shouldShowBetaPricing)}\n                          <span className=\"text-xl font-normal text-muted-foreground\">/month</span>\n                        </>\n                      )}\n                      \n                      {/* First Month Pricing Display */}\n                      {!isAnnual && (\n                        <div className=\"text-lg text-green-600 font-semibold mt-1\">\n                          First month: ${((shouldShowBetaPricing ? plan.betaPrice : plan.basePrice) * 0.5).toFixed(2)} (50% off)\n                        </div>\n                      )}\n                      \n                      {(isAnnual || shouldShowBetaPricing) && (\n                        <div className=\"text-sm space-y-1\">\n                          {(shouldShowBetaPricing ? plan.betaPrice : plan.basePrice) !== calculatePrice(plan.basePrice, plan.betaPrice, isAnnual, shouldShowBetaPricing) && (\n                            <div className=\"text-muted-foreground line-through\">\n                              {isAnnual ? `$${(plan.basePrice * 12).toFixed(2)}/year` : `$${plan.basePrice.toFixed(2)}/month`}\n                            </div>\n                          )}\n                          {shouldShowBetaPricing && (\n                            <div className=\"text-orange-600 font-semibold\">\n                              ðŸŽ‰ Beta: Special Launch Pricing\n                            </div>\n                          )}\n                          {isAnnual && (\n                            <div className=\"text-green-600 font-normal\">\n                              Save ${(((shouldShowBetaPricing ? plan.betaPrice : plan.basePrice) * 12) - calculatePrice(plan.basePrice, plan.betaPrice, isAnnual, shouldShowBetaPricing)).toFixed(2)} per year (20% off)\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                    <p className=\"text-muted-foreground\" data-testid={`plan-description-${plan.id}`}>\n                      {plan.description}\n                    </p>\n                  </div>\n                  \n                  <div className=\"space-y-4 mb-8\">\n                    {plan.features.map((feature, index) => (\n                      <div key={index} className=\"flex items-center space-x-3\">\n                        <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                        <span className=\"text-card-foreground\">{feature}</span>\n                      </div>\n                    ))}\n                  </div>\n                  \n                  <Link href={`/checkout?plan=${plan.tier}&planId=${plan.id}&isAnnual=${isAnnual}&planName=${plan.name}&price=$${calculatePrice(plan.basePrice, plan.betaPrice, isAnnual, shouldShowBetaPricing).toFixed(2)}`}>\n                    <Button \n                      className={`w-full ${plan.popular ? 'bg-primary hover:bg-primary/90' : ''}`}\n                      size=\"lg\"\n                      data-testid={`button-select-${plan.id}`}\n                    >\n                      Get Started Now\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Features Comparison */}\n      <section className=\"py-20 bg-muted/50\" data-testid=\"features-comparison\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-foreground mb-12\" data-testid=\"comparison-title\">\n            What's Included in Each Plan\n          </h2>\n          \n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full border-collapse bg-card rounded-lg overflow-hidden shadow-sm\">\n              <thead>\n                <tr className=\"bg-muted\">\n                  <th className=\"text-left p-4 font-semibold\">Features</th>\n                  <th className=\"text-center p-4 font-semibold\">Basic</th>\n                  <th className=\"text-center p-4 font-semibold\">Professional</th>\n                  <th className=\"text-center p-4 font-semibold\">Master</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y\">\n                <tr>\n                  <td className=\"p-4 font-medium\">Journeyman Prep Course</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Calculator Tools</td>\n                  <td className=\"p-4 text-center\">Basic</td>\n                  <td className=\"p-4 text-center\">Complete Suite</td>\n                  <td className=\"p-4 text-center\">Complete Suite</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">AI Mentor Lesson Specific</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">AI Mentor Support</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Photo Code Checker</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Resume Builder</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Practice Tests</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Job Board Access</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Email Support</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Priority Support</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Material List Generator</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Book Store Access</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">White-Glove Support</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âŒ</td>\n                  <td className=\"p-4 text-center\">âœ…</td>\n                </tr>\n                <tr>\n                  <td className=\"p-4 font-medium\">Referral Commissions</td>\n                  <td className=\"p-4 text-center\">10%</td>\n                  <td className=\"p-4 text-center\">10%</td>\n                  <td className=\"p-4 text-center\">10%</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </section>\n\n      {/* FAQ Section */}\n      <section className=\"py-20\" data-testid=\"pricing-faq\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-foreground mb-12\" data-testid=\"faq-title\">\n            Frequently Asked Questions\n          </h2>\n          \n          <div className=\"space-y-8\">\n            <div className=\"border-b pb-6\">\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">How does cancellation work?</h3>\n              <p className=\"text-muted-foreground\">\n                You can cancel anytime with no penalties. When you cancel, you'll only be charged for the days you actually used the service. For example, if you cancel after 10 days of a monthly plan, you'll only pay for those 10 days.\n              </p>\n            </div>\n            \n            <div className=\"border-b pb-6\">\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">Can I change plans later?</h3>\n              <p className=\"text-muted-foreground\">\n                Yes, you can upgrade or downgrade your plan at any time. Changes will be reflected in your next billing cycle, and you'll be prorated for any differences.\n              </p>\n            </div>\n            \n            \n            <div className=\"border-b pb-6\">\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">What payment methods do you accept?</h3>\n              <p className=\"text-muted-foreground\">\n                We accept all major credit cards (Visa, MasterCard, American Express, Discover) through our secure Stripe payment processing system.\n              </p>\n            </div>\n            \n            <div>\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">How does the cancel anytime policy work?</h3>\n              <p className=\"text-muted-foreground\">\n                You can cancel your subscription at any time with no penalties or fees. When you cancel, you'll only be charged for the actual days you used the service, not the full billing period.\n              </p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Bulk Enrollment Section */}\n      <section className=\"py-20\" data-testid=\"bulk-enrollment-section\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <Card className=\"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200\">\n            <CardContent className=\"p-8 text-center\">\n              <h2 className=\"text-2xl font-bold mb-4\">Need Training for Multiple Employees?</h2>\n              <p className=\"text-muted-foreground mb-6\">\n                Get special pricing for bulk enrollments. Perfect for plumbing companies training multiple technicians.\n              </p>\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                    <span>Volume Discounts</span>\n                  </div>\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                    <span>Progress Tracking</span>\n                  </div>\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                    <span>Company Reports</span>\n                  </div>\n                </div>\n                <Link href=\"/bulk-enrollment\">\n                  <Button size=\"lg\" className=\"bg-primary hover:bg-primary/90\">\n                    Get Bulk Enrollment Pricing\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-20 gradient-hero text-white\" data-testid=\"pricing-cta\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl lg:text-4xl font-bold mb-6\" data-testid=\"cta-title\">\n            Ready to Advance Your Plumbing Career?\n          </h2>\n          <p className=\"text-xl text-blue-100 mb-8\" data-testid=\"cta-description\">\n            Join thousands of Louisiana plumbers who have successfully advanced their careers with our comprehensive training programs.\n          </p>\n          <div className=\"flex justify-center\">\n            <Link href=\"#pricing-plans\">\n              <Button size=\"lg\" className=\"bg-white text-primary hover:bg-gray-50 text-lg px-8 py-4\" data-testid=\"cta-button-start\">\n                Get Started Today\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n","size_bytes":20969},"client/src/pages/subscribe.tsx":{"content":"import { useStripe, Elements, PaymentElement, useElements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useEffect, useState } from 'react';\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\n\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst SubscribeForm = ({ planName, price }: { planName: string; price: string }) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    if (!stripe || !elements) {\n      setIsLoading(false);\n      return;\n    }\n\n    const { error } = await stripe.confirmPayment({\n      elements,\n      confirmParams: {\n        return_url: `${window.location.origin}/dashboard`,\n      },\n    });\n\n    if (error) {\n      toast({\n        title: \"Payment Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } else {\n      toast({\n        title: \"Subscription Successful\",\n        description: \"Welcome to LA Plumb Prep!\",\n      });\n    }\n\n    setIsLoading(false);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\" data-testid=\"subscribe-form\">\n      <div className=\"bg-muted/50 rounded-lg p-6 mb-6\">\n        <h3 className=\"text-lg font-semibold mb-2\" data-testid=\"plan-summary-title\">\n          {planName} Plan\n        </h3>\n        <p className=\"text-2xl font-bold text-primary\" data-testid=\"plan-summary-price\">\n          {price}/month\n        </p>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          50% off first month â€¢ Cancel anytime\n        </p>\n      </div>\n\n      <PaymentElement />\n      \n      <Button \n        type=\"submit\" \n        className=\"w-full\" \n        size=\"lg\" \n        disabled={!stripe || isLoading}\n        data-testid=\"button-confirm-subscription\"\n      >\n        {isLoading ? \"Processing...\" : \"Start 50% Off First Month\"}\n      </Button>\n\n      <p className=\"text-xs text-muted-foreground text-center\">\n        By subscribing, you agree to our Terms of Service and Privacy Policy. \n        You'll be charged 50% off for your first month, then the full amount monthly.\n      </p>\n    </form>\n  );\n};\n\nexport default function Subscribe() {\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  // Check if user is already logged in and has subscription\n  const { data: user } = useQuery({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n\n  // Get plan details from URL params\n  const urlParams = new URLSearchParams(window.location.search);\n  const planId = urlParams.get('plan') || 'professional';\n  const priceId = urlParams.get('priceId') || 'price_1S1xriByFL1L8uV2cKXSxmwV';\n  const tier = urlParams.get('tier') || 'professional';\n\n  const planDetails = {\n    basic: { name: \"Basic\", price: \"$49\" },\n    professional: { name: \"Professional\", price: \"$79\" },\n    master: { name: \"Master\", price: \"$99\" }\n  };\n\n  const currentPlan = planDetails[planId as keyof typeof planDetails] || planDetails.professional;\n\n  // Redirect if user already has active subscription\n  useEffect(() => {\n    if (user && user.subscriptionTier) {\n      toast({\n        title: \"Already Subscribed\",\n        description: `You already have an active ${user.subscriptionTier} subscription!`,\n      });\n      setLocation(\"/dashboard\");\n      return;\n    }\n  }, [user, toast, setLocation]);\n\n  useEffect(() => {\n    // Create subscription as soon as the page loads\n    apiRequest(\"POST\", \"/api/create-subscription\", { priceId, tier })\n      .then((res) => res.json())\n      .then((data) => {\n        setClientSecret(data.clientSecret);\n      })\n      .catch((error) => {\n        toast({\n          title: \"Error\",\n          description: \"Failed to initialize subscription. Please try again.\",\n          variant: \"destructive\",\n        });\n        console.error(\"Subscription error:\", error);\n        setLocation(\"/pricing\");\n      });\n  }, [priceId, tier, toast, setLocation]);\n\n  if (!clientSecret) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\" data-testid=\"loading-subscription\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col items-center space-y-4\">\n              <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n              <p className=\"text-muted-foreground\">Setting up your subscription...</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-20\" data-testid=\"subscribe-page\">\n      <div className=\"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-foreground mb-4\" data-testid=\"subscribe-title\">\n            Complete Your Subscription\n          </h1>\n          <p className=\"text-muted-foreground\" data-testid=\"subscribe-description\">\n            Secure payment processing powered by Stripe. Your information is safe and encrypted.\n          </p>\n        </div>\n\n        <Card className=\"max-w-lg mx-auto\">\n          <CardHeader>\n            <CardTitle className=\"text-center\" data-testid=\"payment-form-title\">\n              Payment Information\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Elements stripe={stripePromise} options={{ clientSecret }}>\n              <SubscribeForm planName={currentPlan.name} price={currentPlan.price} />\n            </Elements>\n          </CardContent>\n        </Card>\n\n        <div className=\"text-center mt-8 space-y-4\">\n          <div className=\"flex items-center justify-center space-x-6 text-sm text-muted-foreground\">\n            <div className=\"flex items-center space-x-2\">\n              <svg className=\"w-4 h-4 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\"></path>\n              </svg>\n              <span>SSL Encrypted</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <svg className=\"w-4 h-4 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\"></path>\n              </svg>\n              <span>PCI Compliant</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <svg className=\"w-4 h-4 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\"></path>\n              </svg>\n              <span>Cancel Anytime</span>\n            </div>\n          </div>\n\n          <p className=\"text-xs text-muted-foreground max-w-md mx-auto\">\n            Questions about your subscription? Contact our support team at support@louisianaplanningacademy.com or call (555) 123-4567.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7873},"client/src/pages/tools.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Calculator, Camera, FileText, Upload, Download, AlertTriangle, CheckCircle, BookOpen, ExternalLink, Lock, Wand2, FileEdit, Users, BookOpenCheck, Timer, Package, ShoppingCart, CreditCard } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport PipeSizingCalculator from \"@/components/calculator/pipe-sizing\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useStudySession } from \"@/hooks/use-study-session\";\nimport { Link, useLocation } from \"wouter\";\nimport ProductManager from \"./admin/product-manager\";\n\nexport default function Tools() {\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [analysisResult, setAnalysisResult] = useState<any>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  // Initialize study session tracking for tools\n  const studySession = useStudySession({\n    contentId: 'professional-tools',\n    contentType: 'tools',\n    autoStart: true\n  });\n\n  // Check subscription status\n  const { data: subscriptionStatus } = useQuery({\n    queryKey: ['/api/subscription-status'],\n    retry: false,\n  });\n\n  const hasActiveSubscription = (subscriptionStatus as any)?.hasActiveSubscription;\n\n  const handlePhotoUpload = async (file: File) => {\n    if (!file) return;\n\n    setIsAnalyzing(true);\n    const formData = new FormData();\n    formData.append('photo', file);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/photos/upload\", formData);\n      const result = await response.json();\n      setAnalysisResult(result);\n      \n      toast({\n        title: \"Photo Analysis Complete\",\n        description: \"Your plumbing installation has been analyzed for code compliance.\",\n      });\n    } catch (error: any) {\n      if (error.message?.includes('subscription') || error.message?.includes('403')) {\n        toast({\n          title: \"Subscription Required\",\n          description: \"Professional tools require an active subscription. Upgrade to access AI analysis.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Upload Failed\",\n          description: \"Failed to analyze photo. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      setIsAnalyzing(false);\n    }\n  };\n\n  const handlePlanUpload = async (file: File) => {\n    if (!file) return;\n\n    setIsAnalyzing(true);\n    const formData = new FormData();\n    formData.append('plan', file);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/plans/upload\", formData);\n      const result = await response.json();\n      setAnalysisResult(result);\n      \n      toast({\n        title: \"Plan Analysis Complete\",\n        description: \"Material list and code compliance check generated.\",\n      });\n    } catch (error: any) {\n      if (error.message?.includes('subscription') || error.message?.includes('403')) {\n        toast({\n          title: \"Subscription Required\",\n          description: \"Professional tools require an active subscription. Upgrade to access AI analysis.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Upload Failed\",\n          description: \"Failed to analyze plans. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      setIsAnalyzing(false);\n    }\n  };\n\n  const tools = [\n    {\n      id: \"pipe-sizing\",\n      title: \"Pipe Sizing Calculator\",\n      description: \"Calculate proper pipe sizes for water supply systems based on fixture units and flow rates.\",\n      icon: Calculator,\n      category: \"Calculators\"\n    },\n    {\n      id: \"pressure-loss\",\n      title: \"Pressure Loss Calculator\",\n      description: \"Calculate pressure losses through fittings, valves, and straight pipe runs.\",\n      icon: Calculator,\n      category: \"Calculators\"\n    },\n    {\n      id: \"photo-checker\",\n      title: \"Photo Code Checker\",\n      description: \"Upload photos of installations for AI-powered code compliance analysis.\",\n      icon: Camera,\n      category: \"AI Tools\"\n    },\n    {\n      id: \"plan-analysis\",\n      title: \"Plan Analysis Tool\",\n      description: \"Pay-per-use plan analysis with spatial mapping and material lists ($4.99-$39.99).\",\n      icon: FileText,\n      category: \"AI Tools\",\n      external: true,\n      link: \"/tools/plan-analysis\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Section */}\n      <section className=\"gradient-hero text-white py-16\" data-testid=\"tools-hero\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <div className=\"flex items-center justify-center gap-4 mb-6\">\n              <h1 className=\"text-4xl lg:text-5xl font-bold\" data-testid=\"tools-title\">\n                Professional Plumbing Tools\n              </h1>\n              {studySession.isActive && (\n                <Badge variant=\"secondary\" className=\"flex items-center gap-1 bg-white/20 text-white border-white/30\">\n                  <Timer className=\"w-4 h-4\" />\n                  {studySession.formattedTime}\n                </Badge>\n              )}\n            </div>\n            <p className=\"text-xl text-blue-100 max-w-3xl mx-auto mb-8\" data-testid=\"tools-description\">\n              Comprehensive suite of calculators and AI-powered analysis tools to support your plumbing work and studies.\n            </p>\n            <div className=\"flex items-center justify-center space-x-8 text-blue-100\">\n              <div className=\"flex items-center space-x-2\">\n                <Calculator className=\"w-5 h-5\" />\n                <span>Professional Calculators</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <Camera className=\"w-5 h-5\" />\n                <span>AI Code Analysis</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <FileText className=\"w-5 h-5\" />\n                <span>Plan Analysis</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Tools Section */}\n      <section className=\"py-16\" data-testid=\"tools-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <Tabs defaultValue=\"calculators\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-3 mb-8\">\n              <TabsTrigger value=\"calculators\" data-testid=\"tab-calculators\">Calculators</TabsTrigger>\n              <TabsTrigger value=\"ai-tools\" data-testid=\"tab-ai-tools\">AI Tools</TabsTrigger>\n              <TabsTrigger value=\"resources\" data-testid=\"tab-resources\">Resources</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"calculators\" className=\"space-y-8\">\n              {!hasActiveSubscription && (\n                <Alert className=\"border-amber-200 bg-amber-50 dark:bg-amber-900/20\" data-testid=\"calculator-subscription-notice\">\n                  <CreditCard className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    Professional calculators require an active subscription. \n                    <Link href=\"/pricing\" className=\"text-primary hover:underline ml-1\">\n                      Upgrade now\n                    </Link> to access pipe sizing, pressure loss, and flow rate calculators.\n                  </AlertDescription>\n                </Alert>\n              )}\n              \n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Pipe Sizing Calculator */}\n                <Card className={`lg:col-span-2 ${!hasActiveSubscription ? \"opacity-60\" : \"\"}`} data-testid=\"pipe-sizing-tool\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <Calculator className=\"w-5 h-5\" />\n                      <span>Pipe Sizing Calculator</span>\n                      {!hasActiveSubscription && <Lock className=\"w-4 h-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {hasActiveSubscription ? (\n                      <PipeSizingCalculator />\n                    ) : (\n                      <div className=\"space-y-4\">\n                        <p className=\"text-muted-foreground text-sm\">\n                          Calculate proper pipe sizes for water supply systems based on fixture units and flow rates.\n                        </p>\n                        <Button \n                          className=\"w-full\" \n                          disabled\n                          data-testid=\"calculator-subscription-required\"\n                        >\n                          Subscription Required\n                        </Button>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Pressure Loss Calculator */}\n                <Card data-testid=\"pressure-loss-tool\" className={!hasActiveSubscription ? \"opacity-60\" : \"\"}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <Calculator className=\"w-5 h-5\" />\n                      <span>Pressure Loss Calculator</span>\n                      {!hasActiveSubscription && <Lock className=\"w-4 h-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium mb-2\">Pipe Length (ft)</label>\n                        <input\n                          type=\"number\"\n                          className=\"w-full px-3 py-2 border border-border rounded-md bg-background\"\n                          placeholder=\"Enter length\"\n                          data-testid=\"input-pipe-length\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium mb-2\">Flow Rate (GPM)</label>\n                        <input\n                          type=\"number\"\n                          className=\"w-full px-3 py-2 border border-border rounded-md bg-background\"\n                          placeholder=\"Enter flow rate\"\n                          data-testid=\"input-flow-rate\"\n                        />\n                      </div>\n                      <Button \n                        className=\"w-full\" \n                        disabled={!hasActiveSubscription}\n                        data-testid=\"calculate-pressure-loss\"\n                      >\n                        {!hasActiveSubscription ? \"Subscription Required\" : \"Calculate Pressure Loss\"}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Flow Rate Calculator */}\n                <Card data-testid=\"flow-rate-tool\" className={!hasActiveSubscription ? \"opacity-60\" : \"\"}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <Calculator className=\"w-5 h-5\" />\n                      <span>Flow Rate Calculator</span>\n                      {!hasActiveSubscription && <Lock className=\"w-4 h-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium mb-2\">Pipe Diameter (inches)</label>\n                        <input\n                          type=\"number\"\n                          className=\"w-full px-3 py-2 border border-border rounded-md bg-background\"\n                          placeholder=\"Enter diameter\"\n                          data-testid=\"input-pipe-diameter\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium mb-2\">Velocity (ft/s)</label>\n                        <input\n                          type=\"number\"\n                          className=\"w-full px-3 py-2 border border-border rounded-md bg-background\"\n                          placeholder=\"Enter velocity\"\n                          data-testid=\"input-velocity\"\n                        />\n                      </div>\n                      <Button \n                        className=\"w-full\" \n                        disabled={!hasActiveSubscription}\n                        data-testid=\"calculate-flow-rate\"\n                      >\n                        {!hasActiveSubscription ? \"Subscription Required\" : \"Calculate Flow Rate\"}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"ai-tools\" className=\"space-y-8\">\n              {!hasActiveSubscription && (\n                <Alert className=\"border-primary/20 bg-primary/5 dark:bg-primary/10\" data-testid=\"subscription-notice\">\n                  <Wand2 className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    Unlock powerful AI-powered plumbing tools with advanced photo analysis, plan review, and AI mentor features.\n                    <Link href=\"/tools/ai-pricing\" className=\"text-primary hover:underline ml-1 font-semibold\">\n                      View AI Tools Pricing â†’\n                    </Link>\n                  </AlertDescription>\n                </Alert>\n              )}\n              \n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Photo Code Checker */}\n                <Card data-testid=\"photo-checker-tool\" className={!hasActiveSubscription ? \"opacity-60\" : \"\"}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <Camera className=\"w-5 h-5\" />\n                      <span>Photo Code Checker</span>\n                      <Badge variant=\"secondary\">AI Powered</Badge>\n                      {!hasActiveSubscription && <Lock className=\"w-4 h-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      <p className=\"text-muted-foreground text-sm\">\n                        <strong>Advanced Photo Analysis:</strong> Upload photos of plumbing installations and get instant AI-powered Louisiana code compliance analysis. Our GPT-5 powered system identifies violations, safety hazards, pipe sizing issues, joint problems, and clearance violations with 95% accuracy. Get detailed violation reports and corrective recommendations within seconds.\n                      </p>\n                      \n                      <input\n                        type=\"file\"\n                        ref={fileInputRef}\n                        className=\"hidden\"\n                        accept=\"image/*\"\n                        onChange={(e) => {\n                          const file = e.target.files?.[0];\n                          if (file) handlePhotoUpload(file);\n                        }}\n                        data-testid=\"photo-input\"\n                      />\n                      \n                      {hasActiveSubscription ? (\n                        <Button\n                          onClick={() => fileInputRef.current?.click()}\n                          disabled={isAnalyzing}\n                          className=\"w-full\"\n                          data-testid=\"upload-photo-button\"\n                        >\n                          <Upload className=\"w-4 h-4 mr-2\" />\n                          {isAnalyzing ? \"Analyzing...\" : \"Upload Photo\"}\n                        </Button>\n                      ) : (\n                        <div className=\"space-y-2\">\n                          <Link href=\"/tools/ai-pricing\" className=\"w-full\">\n                            <Button\n                              className=\"w-full\"\n                              variant=\"outline\"\n                              data-testid=\"pay-per-use-photo-button\"\n                            >\n                              <Camera className=\"w-4 h-4 mr-2\" />\n                              Pay $2.99 to Analyze\n                            </Button>\n                          </Link>\n                          <Link href=\"/tools/ai-pricing\" className=\"w-full\">\n                            <Button className=\"w-full\" variant=\"ghost\" size=\"sm\" data-testid=\"get-ai-tools-button\">\n                              Or get unlimited access\n                            </Button>\n                          </Link>\n                        </div>\n                      )}\n\n                      {analysisResult?.analysis && (\n                        <div className=\"space-y-4 mt-6\">\n                          <div className=\"flex items-center space-x-2\">\n                            {analysisResult.analysis.isCompliant ? (\n                              <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                            ) : (\n                              <AlertTriangle className=\"w-5 h-5 text-red-600\" />\n                            )}\n                            <span className=\"font-medium\">\n                              {analysisResult.analysis.isCompliant ? \"Code Compliant\" : \"Code Violations Found\"}\n                            </span>\n                          </div>\n                          \n                          {analysisResult.analysis.violations?.length > 0 && (\n                            <div>\n                              <h4 className=\"font-medium text-red-600 mb-2\">Violations:</h4>\n                              <ul className=\"list-disc list-inside space-y-1 text-sm\">\n                                {analysisResult.analysis.violations.map((violation: string, index: number) => (\n                                  <li key={index}>{violation}</li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                          \n                          {analysisResult.analysis.recommendations?.length > 0 && (\n                            <div>\n                              <h4 className=\"font-medium text-blue-600 mb-2\">Recommendations:</h4>\n                              <ul className=\"list-disc list-inside space-y-1 text-sm\">\n                                {analysisResult.analysis.recommendations.map((rec: string, index: number) => (\n                                  <li key={index}>{rec}</li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Plan Analysis Tool */}\n                <Card data-testid=\"plan-analysis-tool\" className={!hasActiveSubscription ? \"opacity-60\" : \"\"}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <FileText className=\"w-5 h-5\" />\n                      <span>Plan Analysis Tool</span>\n                      <Badge variant=\"secondary\">AI Powered</Badge>\n                      {!hasActiveSubscription && <Lock className=\"w-4 h-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      <p className=\"text-muted-foreground text-sm\">\n                        <strong>ðŸ”§ Numbered Fitting Placement System:</strong> Upload construction plans to get professional installation diagrams with numbered fittings, comprehensive material lists, and Louisiana code compliance checks. Each fitting gets a unique number that matches a detailed parts list - like a puzzle system for rough-in work. Perfect for contractors, estimators, and project planning.\n                      </p>\n                      \n                      <input\n                        type=\"file\"\n                        className=\"hidden\"\n                        accept=\"image/*,.pdf\"\n                        onChange={(e) => {\n                          const file = e.target.files?.[0];\n                          if (file) handlePlanUpload(file);\n                        }}\n                        data-testid=\"plan-input\"\n                      />\n                      \n                      {hasActiveSubscription ? (\n                        <Button\n                          onClick={() => (document.querySelector('input[data-testid=\"plan-input\"]') as HTMLInputElement)?.click()}\n                          disabled={isAnalyzing}\n                          className=\"w-full\"\n                          data-testid=\"upload-plan-button\"\n                        >\n                          <FileText className=\"w-4 h-4 mr-2\" />\n                          {isAnalyzing ? \"Analyzing...\" : \"Upload Plans\"}\n                        </Button>\n                      ) : (\n                        <div className=\"space-y-3\">\n                          <div className=\"text-xs text-muted-foreground bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg\">\n                            <strong>Pay-per-use pricing by file size:</strong>\n                            <div className=\"mt-2 space-y-1\">\n                              <div>â€¢ Small (up to 2MB): <span className=\"font-medium text-green-600\">$4.99</span></div>\n                              <div>â€¢ Medium (2-10MB): <span className=\"font-medium text-blue-600\">$9.99</span></div>\n                              <div>â€¢ Large (10-25MB): <span className=\"font-medium text-orange-600\">$19.99</span></div>\n                              <div>â€¢ Enterprise (25MB+): <span className=\"font-medium text-purple-600\">$39.99</span></div>\n                            </div>\n                          </div>\n                          <Link href=\"/tools/plan-analysis\" className=\"w-full\">\n                            <Button\n                              className=\"w-full\"\n                              variant=\"outline\"\n                              data-testid=\"pay-per-use-plan-button\"\n                            >\n                              <FileEdit className=\"w-4 h-4 mr-2\" />\n                              Analyze Plan\n                            </Button>\n                          </Link>\n                        </div>\n                      )}\n\n                      {analysisResult?.materialList && (\n                        <div className=\"space-y-6 mt-6\">\n                          {/* Numbered Fitting Placement PDF */}\n                          {analysisResult.pdfUrl && (\n                            <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\n                              <div className=\"flex items-center justify-between\">\n                                <div>\n                                  <h4 className=\"font-medium text-blue-900 dark:text-blue-100\">ðŸ”§ Numbered Fitting Placement Diagram</h4>\n                                  <p className=\"text-sm text-blue-700 dark:text-blue-300 mt-1\">\n                                    Professional installation guide with numbered fittings matched to parts list\n                                  </p>\n                                </div>\n                                <Button \n                                  size=\"sm\" \n                                  className=\"bg-blue-600 hover:bg-blue-700\"\n                                  onClick={() => window.open(analysisResult.pdfUrl, '_blank')}\n                                  data-testid=\"download-fitting-diagram\"\n                                >\n                                  <Download className=\"w-4 h-4 mr-2\" />\n                                  Download PDF\n                                </Button>\n                              </div>\n                            </div>\n                          )}\n\n                          {/* Numbered Fittings Preview */}\n                          {analysisResult.numberedFittings && analysisResult.numberedFittings.length > 0 && (\n                            <div>\n                              <h4 className=\"font-medium mb-3\">ðŸ”¢ Numbered Fitting Guide (Preview)</h4>\n                              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto\">\n                                {analysisResult.numberedFittings.slice(0, 8).map((fitting: any) => (\n                                  <div key={fitting.number} className=\"border rounded-lg p-3 bg-gray-50 dark:bg-gray-800\">\n                                    <div className=\"flex items-start gap-3\">\n                                      <div className=\"bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold\">\n                                        {fitting.number}\n                                      </div>\n                                      <div className=\"flex-1 min-w-0\">\n                                        <p className=\"text-sm font-medium truncate\">{fitting.description}</p>\n                                        <p className=\"text-xs text-muted-foreground\">{fitting.size} â€¢ {fitting.type}</p>\n                                        {fitting.pipeLength && (\n                                          <p className=\"text-xs text-blue-600 dark:text-blue-400\">\n                                            {fitting.pipeSize} Ã— {fitting.pipeLength}\"\n                                          </p>\n                                        )}\n                                        {fitting.position && (\n                                          <div className=\"flex items-center gap-1 mt-1\">\n                                            <span className={`text-xs ${\n                                              fitting.position.confidence > 0.7 ? 'text-green-600 dark:text-green-400' :\n                                              fitting.position.confidence > 0.3 ? 'text-yellow-600 dark:text-yellow-400' :\n                                              'text-gray-500 dark:text-gray-400'\n                                            }`}>\n                                              {fitting.position.confidence > 0.7 ? 'â—' :\n                                               fitting.position.confidence > 0.3 ? 'â—' : 'â—‹'}\n                                            </span>\n                                            <span className=\"text-xs text-muted-foreground\">\n                                              {fitting.position.confidence > 0.7 ? 'Precise location' :\n                                               fitting.position.confidence > 0.3 ? 'Approximate location' :\n                                               'General area'}\n                                            </span>\n                                          </div>\n                                        )}\n                                      </div>\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                              {analysisResult.numberedFittings.length > 8 && (\n                                <p className=\"text-sm text-muted-foreground mt-2 text-center\">\n                                  +{analysisResult.numberedFittings.length - 8} more fittings in full PDF\n                                </p>\n                              )}\n                            </div>\n                          )}\n\n                          {/* Material List */}\n                          <div className=\"space-y-4\">\n                            <div className=\"flex items-center justify-between\">\n                              <h4 className=\"font-medium\">ðŸ“‹ Complete Material List</h4>\n                              <Button size=\"sm\" variant=\"outline\" data-testid=\"download-materials\">\n                                <Download className=\"w-4 h-4 mr-2\" />\n                                Download\n                              </Button>\n                            </div>\n                            \n                            <div className=\"border rounded-lg overflow-hidden\">\n                              <table className=\"w-full text-sm\">\n                                <thead className=\"bg-muted\">\n                                  <tr>\n                                    <th className=\"text-left p-3\">Item</th>\n                                    <th className=\"text-center p-3\">Qty</th>\n                                    <th className=\"text-right p-3\">Cost</th>\n                                  </tr>\n                                </thead>\n                                <tbody className=\"divide-y\">\n                                  {analysisResult.materialList.slice(0, 5).map((item: any, index: number) => (\n                                    <tr key={index}>\n                                      <td className=\"p-3\">{item.item}</td>\n                                      <td className=\"p-3 text-center\">{item.quantity} {item.unit}</td>\n                                      <td className=\"p-3 text-right\">${item.estimatedCost}</td>\n                                    </tr>\n                                  ))}\n                                </tbody>\n                              </table>\n                            </div>\n                            \n                            <div className=\"text-right font-medium\">\n                              Total: ${analysisResult.totalEstimatedCost}\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n\n            <TabsContent value=\"resources\" className=\"space-y-8\">\n              {!hasActiveSubscription && (\n                <Alert className=\"border-amber-200 bg-amber-50 dark:bg-amber-900/20\" data-testid=\"resources-subscription-notice\">\n                  <CreditCard className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    Professional resources require an active subscription. \n                    <Link href=\"/pricing\" className=\"text-primary hover:underline ml-1\">\n                      Upgrade now\n                    </Link> to access unit converters, quick reference guides, and code books.\n                  </AlertDescription>\n                </Alert>\n              )}\n              \n              <div className=\"grid grid-cols-1 gap-6\">\n                <CodeBooksSection />\n              </div>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n\n                <Card data-testid=\"resource-conversion\" className={!hasActiveSubscription ? \"opacity-60\" : \"\"}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <span>Unit Converter</span>\n                      {!hasActiveSubscription && <Lock className=\"w-4 h-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-muted-foreground text-sm mb-4\">\n                      Convert between different units commonly used in plumbing.\n                    </p>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full\"\n                      disabled={!hasActiveSubscription}\n                    >\n                      {!hasActiveSubscription ? \"Subscription Required\" : \"Open Converter\"}\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                <Card data-testid=\"resource-reference\" className={!hasActiveSubscription ? \"opacity-60\" : \"\"}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <span>Quick Reference</span>\n                      {!hasActiveSubscription && <Lock className=\"w-4 h-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-muted-foreground text-sm mb-4\">\n                      Common pipe sizes, fittings, and code requirements at a glance.\n                    </p>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full\"\n                      disabled={!hasActiveSubscription}\n                    >\n                      {!hasActiveSubscription ? \"Subscription Required\" : \"View Reference\"}\n                    </Button>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </section>\n    </div>\n  );\n}\n\n// Content importer for specific components\nfunction ContentImporter() {\n  const [contentItems, setContentItems] = useState([\n    { \n      chapter: 1, \n      section: 1, \n      title: '', \n      content: '',\n      selectedComponent: 'quiz' as string\n    },\n  ]);\n  const [importing, setImporting] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const addContentItem = () => {\n    setContentItems([...contentItems, { \n      chapter: 1, \n      section: 1, \n      title: '', \n      content: '',\n      selectedComponent: 'quiz'\n    }]);\n  };\n\n  const removeContentItem = (index: number) => {\n    setContentItems(contentItems.filter((_, i) => i !== index));\n  };\n\n  const updateContentItem = (index: number, field: string, value: any) => {\n    const updated = [...contentItems];\n    updated[index] = { ...updated[index], [field]: value };\n    setContentItems(updated);\n  };\n\n  const importMutation = useMutation({\n    mutationFn: async (contentData: any[]) => {\n      setImporting(true);\n      const response = await apiRequest(\"POST\", \"/api/admin/import-content\", {\n        content: contentData\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Content Imported Successfully\",\n        description: `Imported ${data.count} content items.`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/courses\"] });\n      // Reset form\n      setContentItems([{ \n        chapter: 1, \n        section: 1, \n        title: '', \n        content: '',\n        selectedComponent: 'quiz'\n      }]);\n    },\n    onError: () => {\n      toast({\n        title: \"Import Failed\",\n        description: \"Failed to import content. Please check your data and try again.\",\n        variant: \"destructive\",\n      });\n    },\n    onSettled: () => {\n      setImporting(false);\n    }\n  });\n\n  const handleImport = () => {\n    const validItems = contentItems.filter(item => item.title.trim() && item.content.trim());\n    if (validItems.length === 0) {\n      toast({\n        title: \"No Valid Content\",\n        description: \"Please add at least one item with title and content.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    // Create content entries for import\n    const contentToImport = validItems.map(item => ({\n      title: item.title,\n      type: componentTypes.find(c => c.key === item.selectedComponent)?.type || 'quiz',\n      chapter: item.chapter,\n      section: item.section,\n      content: item.content\n    }));\n    \n    importMutation.mutate(contentToImport);\n  };\n\n  const componentTypes = [\n    { key: 'introduction', label: 'Introduction', type: 'lesson' },\n    { key: 'podcast', label: 'Podcast', type: 'podcast' },\n    { key: 'quiz', label: 'Quiz', type: 'quiz' },\n    { key: 'flashcards', label: 'Flashcards', type: 'flashcards' },\n    { key: 'studyNotes', label: 'Study Notes', type: 'study-notes' },\n    { key: 'teachMe', label: 'Teach Me (Chat)', type: 'chat' },\n    { key: 'lessonPlan', label: 'Lesson Plan', type: 'lesson-plan' },\n  ];\n\n  return (\n    <Card data-testid=\"content-importer\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center space-x-2\">\n          <FileEdit className=\"w-5 h-5\" />\n          <span>Content Generator</span>\n          <Badge variant=\"secondary\">Import to Components</Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <div className=\"flex items-start space-x-3\">\n              <FileEdit className=\"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0\" />\n              <div>\n                <h4 className=\"font-medium text-blue-900 dark:text-blue-100 mb-1\">Import Content to Specific Components</h4>\n                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                  Create content and import directly to specific components like Quiz Questions, Lesson Plans, Study Notes, and more.\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Content Items */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h4 className=\"font-medium\">Content Items</h4>\n              <Button variant=\"outline\" size=\"sm\" onClick={addContentItem} data-testid=\"add-content-item\">\n                <Upload className=\"w-4 h-4 mr-2\" />\n                Add Item\n              </Button>\n            </div>\n\n            <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n              {contentItems.map((item, index) => (\n                <div key={index} className=\"p-4 border rounded-lg bg-muted/30\" data-testid={`content-item-${index}`}>\n                  <div className=\"space-y-4\">\n                    {/* Basic Info Row */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-8 gap-3\">\n                      {/* Chapter */}\n                      <div className=\"md:col-span-1\">\n                        <Label className=\"text-xs\">Chapter</Label>\n                        <Input\n                          type=\"number\"\n                          value={item.chapter}\n                          onChange={(e) => updateContentItem(index, 'chapter', parseInt(e.target.value) || 1)}\n                          className=\"text-sm h-8\"\n                          min=\"1\"\n                          data-testid={`chapter-${index}`}\n                        />\n                      </div>\n\n                      {/* Section */}\n                      <div className=\"md:col-span-1\">\n                        <Label className=\"text-xs\">Section</Label>\n                        <Input\n                          type=\"number\"\n                          value={item.section}\n                          onChange={(e) => updateContentItem(index, 'section', parseInt(e.target.value) || 1)}\n                          className=\"text-sm h-8\"\n                          min=\"1\"\n                          data-testid={`section-${index}`}\n                        />\n                      </div>\n\n                      {/* Title */}\n                      <div className=\"md:col-span-5\">\n                        <Label className=\"text-xs\">Title</Label>\n                        <Input\n                          value={item.title}\n                          onChange={(e) => updateContentItem(index, 'title', e.target.value)}\n                          placeholder=\"e.g., Louisiana State Plumbing Code Â§101 Administration\"\n                          className=\"text-sm h-8\"\n                          data-testid={`title-${index}`}\n                        />\n                      </div>\n\n                      {/* Remove */}\n                      <div className=\"md:col-span-1 flex items-end\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => removeContentItem(index)}\n                          disabled={contentItems.length === 1}\n                          className=\"h-8 w-8 p-0 text-red-600 hover:text-red-800 hover:bg-red-50\"\n                          data-testid={`remove-${index}`}\n                        >\n                          Ã—\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Component Selection */}\n                    <div>\n                      <Label className=\"text-xs\">Import to Component</Label>\n                      <select\n                        value={item.selectedComponent}\n                        onChange={(e) => updateContentItem(index, 'selectedComponent', e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-border rounded-md bg-background\"\n                        data-testid={`component-${index}`}\n                      >\n                        {componentTypes.map((component) => (\n                          <option key={component.key} value={component.key}>\n                            {component.label}\n                          </option>\n                        ))}\n                      </select>\n                    </div>\n\n                    {/* Content Text Area */}\n                    <div>\n                      <Label className=\"text-xs\">Content</Label>\n                      <Textarea\n                        value={item.content}\n                        onChange={(e) => updateContentItem(index, 'content', e.target.value)}\n                        placeholder=\"Paste your content here...\"\n                        className=\"text-sm min-h-[120px]\"\n                        data-testid={`content-${index}`}\n                      />\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Import Button */}\n            <Button\n              onClick={handleImport}\n              disabled={importing}\n              className=\"w-full\"\n              data-testid=\"import-content\"\n            >\n              <FileEdit className=\"w-4 h-4 mr-2\" />\n              {importing ? \"Importing Content...\" : `Import ${contentItems.filter(u => u.title && u.content).length} Items`}\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\n// Admin section for privately uploading code books\nfunction AdminCodeBooksSection() {\n  const [uploading, setUploading] = useState(false);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: privateCodeBooks, isLoading } = useQuery({\n    queryKey: [\"/api/admin/code-books\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/code-books\");\n      if (!response.ok) throw new Error(\"Failed to fetch private code books\");\n      return response.json();\n    },\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async (file: File) => {\n      setUploading(true);\n      const formData = new FormData();\n      formData.append('codebook', file);\n      \n      const response = await apiRequest(\"POST\", \"/api/admin/code-books/upload\", formData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Code Book Uploaded\",\n        description: \"The code book has been uploaded privately and is ready for lesson content generation.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/code-books\"] });\n      setSelectedFile(null);\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    },\n    onError: () => {\n      toast({\n        title: \"Upload Failed\", \n        description: \"Failed to upload code book. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n    onSettled: () => {\n      setUploading(false);\n    }\n  });\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file && file.type === \"application/pdf\") {\n      setSelectedFile(file);\n    } else {\n      toast({\n        title: \"Invalid File\",\n        description: \"Please select a PDF file only.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleUpload = () => {\n    if (selectedFile) {\n      uploadMutation.mutate(selectedFile);\n    }\n  };\n\n  return (\n    <Card data-testid=\"admin-code-books\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center space-x-2\">\n          <Lock className=\"w-5 h-5\" />\n          <span>Private Code Books Management</span>\n          <Badge variant=\"secondary\">Admin Only</Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <div className=\"flex items-start space-x-3\">\n              <Lock className=\"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0\" />\n              <div>\n                <h4 className=\"font-medium text-blue-900 dark:text-blue-100 mb-1\">Private Reference Library</h4>\n                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                  Upload code books privately for your reference only. These won't be distributed but will be used to generate original lesson content, study materials, and quizzes.\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Upload Section */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-medium\">Upload New Code Book</h4>\n            \n            <input\n              type=\"file\"\n              ref={fileInputRef}\n              className=\"hidden\"\n              accept=\".pdf\"\n              onChange={handleFileSelect}\n              data-testid=\"codebook-file-input\"\n            />\n            \n            <div className=\"flex items-center space-x-3\">\n              <Button\n                variant=\"outline\"\n                onClick={() => fileInputRef.current?.click()}\n                disabled={uploading}\n                data-testid=\"select-codebook-button\"\n              >\n                <FileText className=\"w-4 h-4 mr-2\" />\n                Select PDF\n              </Button>\n              \n              {selectedFile && (\n                <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n                  <span>{selectedFile.name}</span>\n                  <span>({(selectedFile.size / 1024 / 1024).toFixed(1)} MB)</span>\n                </div>\n              )}\n            </div>\n            \n            {selectedFile && (\n              <Button\n                onClick={handleUpload}\n                disabled={uploading}\n                className=\"w-full\"\n                data-testid=\"upload-codebook-button\"\n              >\n                <Upload className=\"w-4 h-4 mr-2\" />\n                {uploading ? \"Uploading...\" : \"Upload Code Book\"}\n              </Button>\n            )}\n          </div>\n\n          {/* Private Library List */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-medium\">Private Code Book Library</h4>\n            \n            {isLoading ? (\n              <p className=\"text-muted-foreground text-sm\">Loading private library...</p>\n            ) : (!privateCodeBooks || privateCodeBooks.length === 0) ? (\n              <div className=\"text-center py-8 bg-muted/50 rounded-lg\">\n                <BookOpen className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium mb-2\">No Private Code Books</h3>\n                <p className=\"text-muted-foreground text-sm\">\n                  Upload PDF code books to start generating lesson content.\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {privateCodeBooks.map((book: any, index: number) => (\n                  <div key={index} className=\"flex items-center justify-between p-3 border rounded-lg bg-muted/30\" data-testid={`private-book-${index}`}>\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-8 h-8 bg-primary/10 rounded flex items-center justify-center\">\n                        <FileText className=\"w-4 h-4 text-primary\" />\n                      </div>\n                      <div>\n                        <h5 className=\"font-medium text-sm\">{book.name}</h5>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Uploaded {new Date(book.uploadedAt).toLocaleDateString()} â€¢ {book.size}\n                        </p>\n                      </div>\n                    </div>\n                    <Badge variant=\"secondary\" className=\"text-xs\">\n                      <Lock className=\"w-3 h-3 mr-1\" />\n                      Private\n                    </Badge>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\n// AI-powered lesson content generator\nfunction LessonContentGenerator() {\n  const [contentType, setContentType] = useState<'lesson' | 'quiz' | 'study-guide'>('lesson');\n  const [topic, setTopic] = useState('');\n  const [generating, setGenerating] = useState(false);\n  const [generatedContent, setGeneratedContent] = useState<any>(null);\n  const { toast } = useToast();\n\n  const generateContentMutation = useMutation({\n    mutationFn: async (params: { type: string; topic: string }) => {\n      setGenerating(true);\n      const response = await apiRequest(\"POST\", \"/api/admin/generate-content\", {\n        contentType: params.type,\n        topic: params.topic\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setGeneratedContent(data);\n      toast({\n        title: \"Content Generated\",\n        description: `Your ${contentType} content has been generated successfully.`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Generation Failed\",\n        description: \"Failed to generate content. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n    onSettled: () => {\n      setGenerating(false);\n    }\n  });\n\n  const handleGenerate = () => {\n    if (!topic.trim()) {\n      toast({\n        title: \"Missing Topic\",\n        description: \"Please enter a topic for content generation.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    generateContentMutation.mutate({ type: contentType, topic: topic.trim() });\n  };\n\n  const contentTypes = [\n    { value: 'lesson', label: 'Lesson Plan', icon: FileEdit, description: 'Complete lesson with objectives and activities' },\n    { value: 'quiz', label: 'Quiz & Test', icon: BookOpenCheck, description: 'Multiple choice and practical questions' },\n    { value: 'study-guide', label: 'Study Guide', icon: BookOpen, description: 'Comprehensive study materials and summaries' }\n  ];\n\n  return (\n    <Card data-testid=\"lesson-content-generator\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center space-x-2\">\n          <Wand2 className=\"w-5 h-5\" />\n          <span>AI Lesson Content Generator</span>\n          <Badge variant=\"secondary\">AI Powered</Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800\">\n            <div className=\"flex items-start space-x-3\">\n              <Wand2 className=\"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0\" />\n              <div>\n                <h4 className=\"font-medium text-green-900 dark:text-green-100 mb-1\">AI Content Creation</h4>\n                <p className=\"text-sm text-green-700 dark:text-green-300\">\n                  Generate original educational content based on your private code book library. All content created is yours to use and distribute.\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Content Type Selection */}\n          <div className=\"space-y-3\">\n            <Label htmlFor=\"content-type\">Content Type</Label>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n              {contentTypes.map((type) => (\n                <div\n                  key={type.value}\n                  className={`p-3 border rounded-lg cursor-pointer transition-colors ${\n                    contentType === type.value \n                      ? 'border-primary bg-primary/5' \n                      : 'border-muted hover:border-primary/50'\n                  }`}\n                  onClick={() => setContentType(type.value as any)}\n                  data-testid={`content-type-${type.value}`}\n                >\n                  <div className=\"flex items-center space-x-2 mb-1\">\n                    <type.icon className=\"w-4 h-4\" />\n                    <span className=\"font-medium text-sm\">{type.label}</span>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">{type.description}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Topic Input */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"topic\">Topic</Label>\n            <Input\n              id=\"topic\"\n              value={topic}\n              onChange={(e) => setTopic(e.target.value)}\n              placeholder=\"e.g., Water Pressure Systems, Backflow Prevention, Gas Line Installation\"\n              data-testid=\"topic-input\"\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Enter the specific plumbing topic you want to create content for\n            </p>\n          </div>\n\n          {/* Generate Button */}\n          <Button\n            onClick={handleGenerate}\n            disabled={generating || !topic.trim()}\n            className=\"w-full\"\n            data-testid=\"generate-content-button\"\n          >\n            <Wand2 className=\"w-4 h-4 mr-2\" />\n            {generating ? \"Generating Content...\" : `Generate ${contentTypes.find(t => t.value === contentType)?.label}`}\n          </Button>\n\n          {/* Generated Content Display */}\n          {generatedContent && (\n            <div className=\"space-y-4 mt-6 p-4 border rounded-lg bg-muted/30\">\n              <div className=\"flex items-center justify-between\">\n                <h4 className=\"font-medium\">Generated Content</h4>\n                <Button size=\"sm\" variant=\"outline\" data-testid=\"download-generated-content\">\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Download\n                </Button>\n              </div>\n              \n              <div className=\"max-h-96 overflow-y-auto\">\n                <div className=\"prose prose-sm max-w-none dark:prose-invert\">\n                  <div dangerouslySetInnerHTML={{ __html: generatedContent.content || generatedContent.html }} />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction CodeBooksSection() {\n  const { data: codeBooks, isLoading } = useQuery({\n    queryKey: [\"/api/code-books\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/code-books\");\n      return response.json();\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center space-x-2\">\n            <BookOpen className=\"w-5 h-5\" />\n            <span>Code Books & Resources</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-muted-foreground\">Loading available code books...</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card data-testid=\"code-books-section\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center space-x-2\">\n          <BookOpen className=\"w-5 h-5\" />\n          <span>Study Materials & Resources</span>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          <p className=\"text-muted-foreground text-sm\">\n            Download original study materials, lesson plans, and educational resources created specifically for Louisiana plumbing certification.\n          </p>\n          \n          {(!codeBooks || codeBooks.length === 0) ? (\n            <div className=\"text-center py-8\">\n              <FileText className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-foreground mb-2\">No Study Materials Available</h3>\n              <p className=\"text-muted-foreground text-sm\">\n                Original educational content will appear here once created.\n              </p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {codeBooks.map((book: any, index: number) => (\n                <Card key={index} className=\"hover:shadow-md transition-shadow\" data-testid={`code-book-${index}`}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start space-x-3\">\n                      <div className=\"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0\">\n                        <FileText className=\"w-5 h-5 text-primary\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className=\"font-medium text-foreground mb-1 truncate\" data-testid={`book-title-${index}`}>\n                          {book.name}\n                        </h4>\n                        <p className=\"text-sm text-muted-foreground mb-2 line-clamp-2\">\n                          {book.description}\n                        </p>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-xs text-muted-foreground\">{book.size}</span>\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            asChild\n                            data-testid={`download-book-${index}`}\n                          >\n                            <a href={book.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center space-x-1\">\n                              <Download className=\"w-3 h-3\" />\n                              <span>Download</span>\n                              <ExternalLink className=\"w-3 h-3\" />\n                            </a>\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":59502},"client/src/components/calculator/pipe-sizing.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Calculator, Info } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface CalculationResult {\n  recommendedSize: string;\n  velocityCheck: boolean;\n  pressureLoss: number;\n  explanation: string;\n}\n\nexport default function PipeSizingCalculator() {\n  const [fixtureUnits, setFixtureUnits] = useState(\"\");\n  const [pipeLength, setPipeLength] = useState(\"\");\n  const [material, setMaterial] = useState(\"\");\n  const [isCalculating, setIsCalculating] = useState(false);\n  const [result, setResult] = useState<CalculationResult | null>(null);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n\n  const materials = [\n    { value: \"copper_l\", label: \"Copper Type L\" },\n    { value: \"copper_m\", label: \"Copper Type M\" },\n    { value: \"pex\", label: \"PEX\" },\n    { value: \"cpvc\", label: \"CPVC\" },\n    { value: \"pvc\", label: \"PVC\" },\n  ];\n\n  const handleCalculate = async () => {\n    setError(\"\");\n    setResult(null);\n\n    if (!fixtureUnits || !pipeLength || !material) {\n      setError(\"Please fill in all required fields\");\n      return;\n    }\n\n    if (parseFloat(fixtureUnits) <= 0 || parseFloat(pipeLength) <= 0) {\n      setError(\"Values must be greater than zero\");\n      return;\n    }\n\n    setIsCalculating(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/calculator/pipe-size\", {\n        fixtureUnits: parseInt(fixtureUnits),\n        pipeLength: parseInt(pipeLength),\n        material: material,\n      });\n\n      const calculationResult = await response.json();\n      setResult(calculationResult);\n\n      toast({\n        title: \"Calculation Complete\",\n        description: `Recommended pipe size: ${calculationResult.recommendedSize}`,\n      });\n    } catch (error: any) {\n      setError(error.message || \"Calculation failed. Please try again.\");\n    } finally {\n      setIsCalculating(false);\n    }\n  };\n\n  const handleReset = () => {\n    setFixtureUnits(\"\");\n    setPipeLength(\"\");\n    setMaterial(\"\");\n    setResult(null);\n    setError(\"\");\n  };\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"pipe-sizing-calculator\">\n      {/* Input Form */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div>\n          <Label htmlFor=\"fixtureUnits\">Fixture Units (WFU)</Label>\n          <Input\n            id=\"fixtureUnits\"\n            type=\"number\"\n            value={fixtureUnits}\n            onChange={(e) => setFixtureUnits(e.target.value)}\n            placeholder=\"Enter fixture units\"\n            min=\"1\"\n            data-testid=\"input-fixture-units\"\n          />\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Total water fixture units for the system\n          </p>\n        </div>\n\n        <div>\n          <Label htmlFor=\"pipeLength\">Pipe Length (ft)</Label>\n          <Input\n            id=\"pipeLength\"\n            type=\"number\"\n            value={pipeLength}\n            onChange={(e) => setPipeLength(e.target.value)}\n            placeholder=\"Enter pipe length\"\n            min=\"1\"\n            data-testid=\"input-pipe-length\"\n          />\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Total developed length of pipe run\n          </p>\n        </div>\n\n        <div>\n          <Label htmlFor=\"material\">Pipe Material</Label>\n          <Select value={material} onValueChange={setMaterial}>\n            <SelectTrigger data-testid=\"select-pipe-material\">\n              <SelectValue placeholder=\"Select material\" />\n            </SelectTrigger>\n            <SelectContent>\n              {materials.map((mat) => (\n                <SelectItem key={mat.value} value={mat.value}>\n                  {mat.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Choose the pipe material type\n          </p>\n        </div>\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"flex space-x-3\">\n        <Button \n          onClick={handleCalculate}\n          disabled={isCalculating}\n          className=\"flex-1\"\n          data-testid=\"button-calculate\"\n        >\n          <Calculator className=\"w-4 h-4 mr-2\" />\n          {isCalculating ? \"Calculating...\" : \"Calculate Pipe Size\"}\n        </Button>\n        <Button \n          variant=\"outline\" \n          onClick={handleReset}\n          data-testid=\"button-reset\"\n        >\n          Reset\n        </Button>\n      </div>\n\n      {/* Error Display */}\n      {error && (\n        <Alert data-testid=\"calculation-error\">\n          <AlertDescription>{error}</AlertDescription>\n        </Alert>\n      )}\n\n      {/* Results Display */}\n      {result && (\n        <Card className=\"bg-muted/50\" data-testid=\"calculation-results\">\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center space-x-2\">\n                <Calculator className=\"w-5 h-5 text-primary\" />\n                <h3 className=\"text-lg font-semibold\">Calculation Results</h3>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"text-center p-4 bg-background rounded-lg\">\n                  <p className=\"text-sm text-muted-foreground mb-1\">Recommended Size</p>\n                  <p className=\"text-2xl font-bold text-primary\" data-testid=\"result-pipe-size\">\n                    {result.recommendedSize}\n                  </p>\n                </div>\n\n                <div className=\"text-center p-4 bg-background rounded-lg\">\n                  <p className=\"text-sm text-muted-foreground mb-1\">Velocity Check</p>\n                  <p className={`text-lg font-semibold ${result.velocityCheck ? 'text-green-600' : 'text-red-600'}`} data-testid=\"result-velocity-check\">\n                    {result.velocityCheck ? \"âœ“ Pass\" : \"âœ— Fail\"}\n                  </p>\n                </div>\n\n                <div className=\"text-center p-4 bg-background rounded-lg\">\n                  <p className=\"text-sm text-muted-foreground mb-1\">Pressure Loss</p>\n                  <p className=\"text-lg font-semibold\" data-testid=\"result-pressure-loss\">\n                    {result.pressureLoss} PSI\n                  </p>\n                </div>\n              </div>\n\n              {result.explanation && (\n                <div className=\"p-4 bg-blue-50 border-l-4 border-blue-400 rounded\">\n                  <div className=\"flex items-start space-x-2\">\n                    <Info className=\"w-4 h-4 text-blue-600 mt-0.5\" />\n                    <div>\n                      <p className=\"text-sm font-medium text-blue-800\">Explanation</p>\n                      <p className=\"text-sm text-blue-700 mt-1\" data-testid=\"result-explanation\">\n                        {result.explanation}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Reference Information */}\n      <Card className=\"bg-blue-50\" data-testid=\"reference-info\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-start space-x-2\">\n            <Info className=\"w-4 h-4 text-blue-600 mt-0.5\" />\n            <div>\n              <p className=\"text-sm font-medium text-blue-800\">Reference Information</p>\n              <ul className=\"text-xs text-blue-700 mt-1 space-y-1\">\n                <li>â€¢ Calculations based on Louisiana Plumbing Code requirements</li>\n                <li>â€¢ Maximum water velocity should not exceed 8 ft/s for noise control</li>\n                <li>â€¢ Pressure loss calculations include friction losses through fittings</li>\n                <li>â€¢ Results are for sizing guidance only - verify with local code requirements</li>\n              </ul>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8351},"client/src/components/layout/footer.tsx":{"content":"import { Building2, Twitter, Linkedin, Facebook } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Footer() {\n  const courseLinks = [\n    { name: \"Journeyman Plumber\", href: \"/courses\" },\n    { name: \"Backflow Prevention\", href: \"/courses\" },\n    { name: \"Natural Gas\", href: \"/courses\" },\n    { name: \"Medical Gas\", href: \"/courses\" },\n    { name: \"Master Plumber\", href: \"/courses\" },\n  ];\n\n  const supportLinks = [\n    { name: \"Help Center\", href: \"/help\" },\n    { name: \"Contact Us\", href: \"/contact\" },\n    { name: \"Louisiana State Board\", href: \"/louisiana-board\" },\n    { name: \"Technical Support\", href: \"/technical-support\" },\n    { name: \"System Status\", href: \"/system-status\" },\n  ];\n\n  const legalLinks = [\n    { name: \"Privacy Policy\", href: \"#\" },\n    { name: \"Terms of Service\", href: \"#\" },\n    { name: \"Accessibility\", href: \"#\" },\n  ];\n\n  return (\n    <footer className=\"bg-foreground text-background py-16\" data-testid=\"footer\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n          <div className=\"md:col-span-2\">\n            <div className=\"flex items-center space-x-2 mb-4\" data-testid=\"footer-logo\">\n              <div className=\"w-8 h-8 bg-primary rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-5 h-5 text-primary-foreground\" />\n              </div>\n              <div>\n                <h3 className=\"text-xl font-bold\" data-testid=\"footer-brand-name\">LA Plumb Prep</h3>\n                <p className=\"text-sm text-background/70\" data-testid=\"footer-brand-tagline\">Official State Prep Course</p>\n              </div>\n            </div>\n            <p className=\"text-background/70 mb-6 max-w-md\" data-testid=\"footer-description\">\n              Empowering Louisiana plumbers with comprehensive certification preparation, professional tools, and career advancement opportunities.\n            </p>\n            <div className=\"flex items-center space-x-4\">\n              <span className=\"text-sm text-background/70\">Follow us:</span>\n              <button className=\"text-background/70 hover:text-background transition-colors\" data-testid=\"social-link-twitter\">\n                <Twitter className=\"w-5 h-5\" />\n              </button>\n              <button className=\"text-background/70 hover:text-background transition-colors\" data-testid=\"social-link-facebook\">\n                <Facebook className=\"w-5 h-5\" />\n              </button>\n              <button className=\"text-background/70 hover:text-background transition-colors\" data-testid=\"social-link-linkedin\">\n                <Linkedin className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n          \n          <div>\n            <h4 className=\"text-lg font-semibold mb-4\" data-testid=\"footer-courses-title\">Courses</h4>\n            <ul className=\"space-y-2 text-background/70\">\n              {courseLinks.map((link, index) => (\n                <li key={index}>\n                  <a href={link.href} className=\"hover:text-background transition-colors block cursor-pointer\" data-testid={`footer-course-link-${index}`}>\n                    {link.name}\n                  </a>\n                </li>\n              ))}\n            </ul>\n          </div>\n          \n          <div>\n            <h4 className=\"text-lg font-semibold mb-4\" data-testid=\"footer-support-title\">Support</h4>\n            <ul className=\"space-y-2 text-background/70\">\n              <li>\n                <a \n                  href=\"/help\"\n                  className=\"hover:text-background transition-colors text-left block cursor-pointer\" \n                  data-testid=\"footer-support-link-0\"\n                >\n                  Help Center\n                </a>\n              </li>\n              {supportLinks.slice(1).map((link, index) => (\n                <li key={index + 1}>\n                  <a \n                    href={link.href}\n                    className=\"hover:text-background transition-colors text-left block cursor-pointer\" \n                    data-testid={`footer-support-link-${index + 1}`}\n                  >\n                    {link.name}\n                  </a>\n                </li>\n              ))}\n            </ul>\n          </div>\n        </div>\n        \n        <div className=\"border-t border-background/20 mt-12 pt-8\">\n          <div className=\"flex flex-col md:flex-row justify-between items-center\">\n            <p className=\"text-background/70 text-sm\" data-testid=\"footer-copyright\">\n              Â© 2024 LA Plumb Prep. All rights reserved.\n            </p>\n            <div className=\"flex items-center space-x-6 mt-4 md:mt-0\">\n              <a \n                href=\"/privacy\"\n                className=\"text-background/70 hover:text-background text-sm transition-colors cursor-pointer\"\n                data-testid=\"footer-legal-link-0\"\n              >\n                Privacy Policy\n              </a>\n              <a \n                href=\"/terms\"\n                className=\"text-background/70 hover:text-background text-sm transition-colors cursor-pointer\"\n                data-testid=\"footer-legal-link-1\"\n              >\n                Terms of Service\n              </a>\n              <a \n                href=\"/accessibility\"\n                className=\"text-background/70 hover:text-background text-sm transition-colors cursor-pointer\"\n                data-testid=\"footer-legal-link-2\"\n              >\n                Accessibility\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":5607},"client/src/components/layout/header.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Menu, Building2, ChevronDown, User as UserIcon } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { NotificationsBell } from \"@/components/notifications-bell\";\nimport type { User } from \"@/../../shared/schema\";\n\nexport default function Header() {\n  const [location] = useLocation();\n  const [isOpen, setIsOpen] = useState(false);\n\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n    staleTime: 30000, // 30 seconds\n    enabled: true, // Always enabled but non-blocking\n  });\n\n  const navigation = [\n    { name: \"Courses\", href: \"#\" }, // Now handled as dropdown\n    { name: \"AI Tools\", href: \"#\" }, // Now handled as dropdown\n    { name: \"Store\", href: \"#\" }, // Now handled as dropdown\n    { name: \"For Companies\", href: \"#\" }, // Now handled as dropdown\n    { name: \"Job Board\", href: \"/jobs\" },\n  ];\n\n  const handleLogout = async () => {\n    try {\n      await apiRequest(\"POST\", \"/api/auth/logout\");\n      window.location.href = \"/\";\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      // Fallback to redirect even if logout fails\n      window.location.href = \"/\";\n    }\n  };\n\n  return (\n    <header className=\"bg-white border-b border-border sticky top-0 z-50\" data-testid=\"header\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex justify-between items-center h-16\">\n          <Link href=\"/\">\n            <div className=\"flex items-center space-x-4 cursor-pointer\" data-testid=\"logo\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 bg-primary rounded-lg flex items-center justify-center\">\n                  <Building2 className=\"w-6 h-6 text-primary-foreground\" />\n                </div>\n                <div className=\"min-w-0 flex-shrink-0\">\n                  <h1 className=\"text-xl font-bold text-primary whitespace-nowrap\" data-testid=\"brand-name\">\n                    LA Plumb Prep\n                  </h1>\n                </div>\n              </div>\n            </div>\n          </Link>\n\n          {/* Desktop Navigation */}\n          <nav className=\"hidden md:flex items-center space-x-6\">\n            {navigation.map((item) => {\n              if (item.name === \"Courses\") {\n                return (\n                  <DropdownMenu key={item.name}>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" className=\"flex items-center space-x-1 text-sm font-medium\">\n                        <span>Courses</span>\n                        <ChevronDown className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/pricing\" className=\"cursor-pointer\">\n                          Louisiana Journeyman Prep\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/pricing\" className=\"cursor-pointer\">\n                          Master Plumber Prep\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/pricing\" className=\"cursor-pointer\">\n                          Backflow Prevention Training\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/pricing\" className=\"cursor-pointer\">\n                          Natural Gas Certification\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/pricing\" className=\"cursor-pointer\">\n                          Medical Gas Installer Certification\n                        </Link>\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                );\n              }\n              if (item.name === \"AI Tools\") {\n                return (\n                  <DropdownMenu key={item.name}>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" className=\"flex items-center space-x-1 text-sm font-medium\">\n                        <span>AI Tools</span>\n                        <ChevronDown className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/ai-photo-pricing\" className=\"cursor-pointer\">\n                          AI Photo Analysis\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/plan-analysis-tool\" className=\"cursor-pointer\">\n                          Plan Analysis Tool\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/tools#pipe-sizing\" className=\"cursor-pointer\">\n                          Pipe Sizing Calculator\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/tools#pipe-sizing\" className=\"cursor-pointer\">\n                          Pressure Loss Calculator\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/tools#pipe-sizing\" className=\"cursor-pointer\">\n                          Flow Rate Calculator\n                        </Link>\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                );\n              }\n              if (item.name === \"Store\") {\n                return (\n                  <DropdownMenu key={item.name}>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" className=\"flex items-center space-x-1 text-sm font-medium\">\n                        <span>Store</span>\n                        <ChevronDown className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/store\" className=\"cursor-pointer\">\n                          LA Plumb Store\n                        </Link>\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                );\n              }\n              if (item.name === \"For Companies\") {\n                return (\n                  <DropdownMenu key={item.name}>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"ghost\" className=\"flex items-center space-x-1 text-sm font-medium\">\n                        <span>For Companies</span>\n                        <ChevronDown className=\"h-4 w-4\" />\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/employer-signup\" className=\"cursor-pointer\">\n                          Post Job Openings\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/pricing\" className=\"cursor-pointer\">\n                          Register Apprentices\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/plan-analysis-tool\" className=\"cursor-pointer\">\n                          Plan Analysis Tool\n                        </Link>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/ai-photo-pricing\" className=\"cursor-pointer\">\n                          Photo Code Analysis\n                        </Link>\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                );\n              }\n              return (\n                <Link key={item.name} href={item.href}>\n                  <span \n                    className={`text-sm font-medium transition-colors hover:text-primary cursor-pointer ${\n                      location === item.href ? 'text-primary' : 'text-foreground'\n                    }`}\n                    data-testid={`nav-link-${item.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    {item.name}\n                  </span>\n                </Link>\n              );\n            })}\n          </nav>\n          \n          {/* Desktop Auth Buttons */}\n          <div className=\"hidden md:flex items-center space-x-4\">\n            {user ? (\n              <div className=\"flex items-center space-x-3\">\n                <Link href=\"/dashboard\">\n                  <Button variant=\"ghost\" data-testid=\"button-dashboard\">\n                    Dashboard\n                  </Button>\n                </Link>\n                <NotificationsBell />\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" data-testid=\"user-menu-trigger\">\n                      <div className=\"flex items-center space-x-2\">\n                        <UserIcon className=\"h-4 w-4\" />\n                        <span className=\"hidden lg:inline\">\n                          {user?.firstName || 'User'}\n                        </span>\n                        <ChevronDown className=\"h-4 w-4\" />\n                      </div>\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/profile\" data-testid=\"profile-link\">\n                        Profile\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/billing\" data-testid=\"billing-link\">\n                        Billing\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/settings\" data-testid=\"settings-link\">\n                        Settings\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem \n                      onClick={handleLogout}\n                      className=\"text-red-600 cursor-pointer\"\n                      data-testid=\"logout-button\"\n                    >\n                      Logout\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </div>\n            ) : (\n              <div className=\"flex items-center space-x-3\">\n                <Link href=\"/login\">\n                  <Button variant=\"ghost\" data-testid=\"button-login\">\n                    Log in\n                  </Button>\n                </Link>\n                <Link href=\"/register\">\n                  <Button data-testid=\"button-register\">\n                    Get Started\n                  </Button>\n                </Link>\n              </div>\n            )}\n          </div>\n\n          {/* Mobile Menu */}\n          <div className=\"md:hidden flex items-center space-x-2\">\n            {/* Mobile Menu */}\n            <Sheet>\n              <SheetTrigger asChild>\n                <Button variant=\"outline\" size=\"sm\">\n                  <Menu className=\"h-4 w-4\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"right\">\n                <div className=\"flex flex-col space-y-4 mt-8\">\n                  <div className=\"flex items-center justify-between\">\n                    <h2 className=\"text-lg font-semibold\">Menu</h2>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    {/* Mobile Courses */}\n                    <div className=\"space-y-2\">\n                      <h3 className=\"font-medium text-gray-900 dark:text-white\">Courses</h3>\n                      <div className=\"pl-4 space-y-2\">\n                        <Link href=\"/pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Louisiana Journeyman Prep\n                        </Link>\n                        <Link href=\"/pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Master Plumber Prep\n                        </Link>\n                        <Link href=\"/pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Backflow Prevention Training\n                        </Link>\n                        <Link href=\"/pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Natural Gas Certification\n                        </Link>\n                        <Link href=\"/pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Medical Gas Installer Certification\n                        </Link>\n                      </div>\n                    </div>\n                    \n                    {/* Mobile AI Tools */}\n                    <div className=\"space-y-2\">\n                      <h3 className=\"font-medium text-gray-900 dark:text-white\">AI Tools</h3>\n                      <div className=\"pl-4 space-y-2\">\n                        <Link href=\"/ai-photo-pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          AI Photo Analysis\n                        </Link>\n                        <Link href=\"/plan-analysis-tool\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Plan Analysis Tool\n                        </Link>\n                        <Link href=\"/tools#pipe-sizing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Pipe Sizing Calculator\n                        </Link>\n                        <Link href=\"/tools#pipe-sizing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Pressure Loss Calculator\n                        </Link>\n                        <Link href=\"/tools#pipe-sizing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Flow Rate Calculator\n                        </Link>\n                      </div>\n                    </div>\n                    \n                    {/* Mobile Store */}\n                    <div className=\"space-y-2\">\n                      <h3 className=\"font-medium text-gray-900 dark:text-white\">Store</h3>\n                      <div className=\"pl-4 space-y-2\">\n                        <Link href=\"/store\" className=\"block text-gray-600 dark:text-gray-300\">\n                          LA Plumb Store\n                        </Link>\n                      </div>\n                    </div>\n                    \n                    {/* Mobile For Companies */}\n                    <div className=\"space-y-2\">\n                      <h3 className=\"font-medium text-gray-900 dark:text-white\">For Companies</h3>\n                      <div className=\"pl-4 space-y-2\">\n                        <Link href=\"/employer-signup\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Post Job Openings\n                        </Link>\n                        <Link href=\"/pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Register Apprentices\n                        </Link>\n                        <Link href=\"/plan-analysis-tool\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Plan Analysis Tool\n                        </Link>\n                        <Link href=\"/ai-photo-pricing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Photo Code Analysis\n                        </Link>\n                      </div>\n                    </div>\n                    \n                    <Link href=\"/podcasts\" className=\"block text-gray-600 dark:text-gray-300\">\n                      Podcasts\n                    </Link>\n                    <Link href=\"/jobs\" className=\"block text-gray-600 dark:text-gray-300\">\n                      Job Board\n                    </Link>\n                    \n                    {user ? (\n                      <>\n                        <Link href=\"/dashboard\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Dashboard\n                        </Link>\n                        <Link href=\"/profile\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Profile\n                        </Link>\n                        <Link href=\"/billing\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Billing\n                        </Link>\n                        <Link href=\"/settings\" className=\"block text-gray-600 dark:text-gray-300\">\n                          Settings\n                        </Link>\n                        <Button\n                          onClick={handleLogout}\n                          variant=\"outline\"\n                          className=\"w-full text-red-600 border-red-600\"\n                          data-testid=\"mobile-logout-button\"\n                        >\n                          Logout\n                        </Button>\n                      </>\n                    ) : (\n                      <>\n                        <Link href=\"/login\" className=\"block\">\n                          <Button variant=\"outline\" className=\"w-full\" data-testid=\"mobile-button-login\">\n                            Log in\n                          </Button>\n                        </Link>\n                        <Link href=\"/register\" className=\"block\">\n                          <Button className=\"w-full\" data-testid=\"mobile-button-register\">\n                            Get Started\n                          </Button>\n                        </Link>\n                      </>\n                    )}\n                  </div>\n                </div>\n              </SheetContent>\n            </Sheet>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}","size_bytes":18982},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/pages/auth/login.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Building2, Eye, EyeOff } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport plumbingEducationImage from \"@assets/generated_images/Louisiana_plumbing_prep_interface_dd5de1e1.png\";\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\");\n\n    try {\n      await apiRequest(\"POST\", \"/api/auth/login\", { email, password });\n      \n      // Invalidate the auth query to refetch user data\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      \n      toast({\n        title: \"Welcome back!\",\n        description: \"You have successfully logged in.\",\n      });\n      \n      setLocation(\"/dashboard\");\n    } catch (error: any) {\n      setError(error.message || \"Login failed. Please check your credentials.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex\">\n      {/* Left side - Image */}\n      <div className=\"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary/5 to-primary/10 items-center justify-center p-12\">\n        <div className=\"max-w-lg\">\n          <img \n            src={plumbingEducationImage} \n            alt=\"Professional plumbing education and certification training\"\n            className=\"w-full h-auto rounded-lg shadow-2xl\"\n          />\n          <div className=\"mt-8 text-center\">\n            <h3 className=\"text-2xl font-bold text-foreground mb-4\">\n              Master Louisiana Plumbing Code\n            </h3>\n            <p className=\"text-muted-foreground text-lg leading-relaxed\">\n              Professional certification preparation designed by experts for Louisiana plumbers. \n              Comprehensive courses, AI-powered assistance, and proven success methods.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Right side - Form */}\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-md w-full space-y-8\">\n          {/* Header */}\n          <div className=\"text-center\" data-testid=\"login-header\">\n            <Link href=\"/\">\n              <div className=\"flex items-center justify-center space-x-2 mb-6 cursor-pointer\">\n                <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n                  <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n                </div>\n                <div className=\"text-left\">\n                  <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n                  <p className=\"text-xs text-muted-foreground\">Official State Prep Course</p>\n                </div>\n              </div>\n            </Link>\n            <h2 className=\"text-3xl font-bold text-foreground\" data-testid=\"login-title\">\n              Sign in to your account\n            </h2>\n            <p className=\"mt-2 text-muted-foreground\" data-testid=\"login-subtitle\">\n              Continue your plumbing education journey\n            </p>\n          </div>\n\n        {/* Login Form */}\n        <Card data-testid=\"login-form\">\n          <CardHeader>\n            <CardTitle>Welcome Back</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {error && (\n              <Alert className=\"mb-6\" data-testid=\"login-error\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              <div>\n                <Label htmlFor=\"email\">Email address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  className=\"mt-1\"\n                  placeholder=\"Enter your email\"\n                  data-testid=\"input-email\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"password\">Password</Label>\n                <div className=\"relative mt-1\">\n                  <Input\n                    id=\"password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    required\n                    placeholder=\"Enter your password\"\n                    data-testid=\"input-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    data-testid=\"toggle-password\"\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                    ) : (\n                      <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center\">\n                  <input\n                    id=\"remember-me\"\n                    name=\"remember-me\"\n                    type=\"checkbox\"\n                    className=\"h-4 w-4 text-primary focus:ring-primary border-border rounded\"\n                    data-testid=\"checkbox-remember\"\n                  />\n                  <Label htmlFor=\"remember-me\" className=\"ml-2 text-sm\">\n                    Remember me\n                  </Label>\n                </div>\n\n                <div className=\"text-sm\">\n                  <a href=\"#\" className=\"font-medium text-primary hover:text-primary/80\" data-testid=\"link-forgot-password\">\n                    Forgot your password?\n                  </a>\n                </div>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={isLoading}\n                data-testid=\"button-login\"\n              >\n                {isLoading ? \"Signing in...\" : \"Sign in\"}\n              </Button>\n            </form>\n\n            <div className=\"mt-6\">\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <div className=\"w-full border-t border-border\" />\n                </div>\n                <div className=\"relative flex justify-center text-sm\">\n                  <span className=\"px-2 bg-background text-muted-foreground\">Or</span>\n                </div>\n              </div>\n\n              <div className=\"mt-6 text-center\">\n                <p className=\"text-sm text-muted-foreground\">\n                  Don't have an account?{' '}\n                  <Link href=\"/register\">\n                    <a className=\"font-medium text-primary hover:text-primary/80\" data-testid=\"link-register\">\n                      Sign up for free\n                    </a>\n                  </Link>\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Benefits */}\n        <div className=\"text-center space-y-4\" data-testid=\"login-benefits\">\n          <p className=\"text-sm text-muted-foreground\">\n            Join thousands of Louisiana plumbers advancing their careers\n          </p>\n          <div className=\"flex items-center justify-center space-x-6 text-xs text-muted-foreground\">\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n              <span>State Approved Courses</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n              <span>AI Mentor Support</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-2 h-2 bg-purple-500 rounded-full\"></div>\n              <span>Job Placement</span>\n            </div>\n          </div>\n        </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9011},"client/src/pages/auth/register.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Building2, Eye, EyeOff, CheckCircle } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function Register() {\n  const [, setLocation] = useLocation();\n  const [formData, setFormData] = useState({\n    firstName: \"\",\n    lastName: \"\",\n    email: \"\",\n    username: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    phone: \"\",\n    referredBy: \"\",\n  });\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({ ...prev, [name]: value }));\n  };\n\n  const validateForm = () => {\n    if (formData.password !== formData.confirmPassword) {\n      setError(\"Passwords do not match\");\n      return false;\n    }\n    if (formData.password.length < 8) {\n      setError(\"Password must be at least 8 characters long\");\n      return false;\n    }\n    return true;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    if (!validateForm()) return;\n\n    setIsLoading(true);\n\n    try {\n      await apiRequest(\"POST\", \"/api/auth/register\", {\n        firstName: formData.firstName,\n        lastName: formData.lastName,\n        email: formData.email,\n        username: formData.username,\n        password: formData.password,\n        phone: formData.phone,\n        referredBy: formData.referredBy || undefined,\n      });\n\n      toast({\n        title: \"Account created successfully!\",\n        description: \"Choose your learning plan to get started.\",\n      });\n\n      setLocation(\"/pricing\");\n    } catch (error: any) {\n      setError(error.message || \"Registration failed. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const passwordRequirements = [\n    { met: formData.password.length >= 8, text: \"At least 8 characters\" },\n    { met: /[A-Z]/.test(formData.password), text: \"One uppercase letter\" },\n    { met: /[a-z]/.test(formData.password), text: \"One lowercase letter\" },\n    { met: /\\d/.test(formData.password), text: \"One number\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-8\" data-testid=\"register-header\">\n          <Link href=\"/\">\n            <div className=\"flex items-center justify-center space-x-2 mb-6 cursor-pointer\">\n              <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n              </div>\n              <div className=\"text-left\">\n                <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n                <p className=\"text-xs text-muted-foreground\">Official State Prep Course</p>\n              </div>\n            </div>\n          </Link>\n          <h2 className=\"text-3xl font-bold text-foreground\" data-testid=\"register-title\">\n            Create your account\n          </h2>\n          <p className=\"mt-2 text-muted-foreground\" data-testid=\"register-subtitle\">\n            Start your plumbing education journey today\n          </p>\n        </div>\n\n        {/* Registration Form */}\n        <Card data-testid=\"register-form\">\n          <CardHeader>\n            <CardTitle>Join LA Plumb Prep</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {error && (\n              <Alert className=\"mb-6\" data-testid=\"register-error\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {/* Name Fields */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"firstName\">First Name</Label>\n                  <Input\n                    id=\"firstName\"\n                    name=\"firstName\"\n                    type=\"text\"\n                    value={formData.firstName}\n                    onChange={handleInputChange}\n                    required\n                    className=\"mt-1\"\n                    placeholder=\"Enter your first name\"\n                    data-testid=\"input-first-name\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"lastName\">Last Name</Label>\n                  <Input\n                    id=\"lastName\"\n                    name=\"lastName\"\n                    type=\"text\"\n                    value={formData.lastName}\n                    onChange={handleInputChange}\n                    required\n                    className=\"mt-1\"\n                    placeholder=\"Enter your last name\"\n                    data-testid=\"input-last-name\"\n                  />\n                </div>\n              </div>\n\n              {/* Email and Username */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"email\">Email Address</Label>\n                  <Input\n                    id=\"email\"\n                    name=\"email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={handleInputChange}\n                    required\n                    className=\"mt-1\"\n                    placeholder=\"Enter your email\"\n                    data-testid=\"input-email\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"username\">Username</Label>\n                  <Input\n                    id=\"username\"\n                    name=\"username\"\n                    type=\"text\"\n                    value={formData.username}\n                    onChange={handleInputChange}\n                    required\n                    className=\"mt-1\"\n                    placeholder=\"Choose a username\"\n                    data-testid=\"input-username\"\n                  />\n                </div>\n              </div>\n\n              {/* Phone Number */}\n              <div>\n                <Label htmlFor=\"phone\">Phone Number (Optional)</Label>\n                <Input\n                  id=\"phone\"\n                  name=\"phone\"\n                  type=\"tel\"\n                  value={formData.phone}\n                  onChange={handleInputChange}\n                  className=\"mt-1\"\n                  placeholder=\"(555) 123-4567\"\n                  data-testid=\"input-phone\"\n                />\n              </div>\n\n              {/* Password Fields */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"password\">Password</Label>\n                  <div className=\"relative mt-1\">\n                    <Input\n                      id=\"password\"\n                      name=\"password\"\n                      type={showPassword ? \"text\" : \"password\"}\n                      value={formData.password}\n                      onChange={handleInputChange}\n                      required\n                      placeholder=\"Create a password\"\n                      data-testid=\"input-password\"\n                    />\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                      onClick={() => setShowPassword(!showPassword)}\n                      data-testid=\"toggle-password\"\n                    >\n                      {showPassword ? (\n                        <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                      ) : (\n                        <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                      )}\n                    </Button>\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n                  <div className=\"relative mt-1\">\n                    <Input\n                      id=\"confirmPassword\"\n                      name=\"confirmPassword\"\n                      type={showConfirmPassword ? \"text\" : \"password\"}\n                      value={formData.confirmPassword}\n                      onChange={handleInputChange}\n                      required\n                      placeholder=\"Confirm your password\"\n                      data-testid=\"input-confirm-password\"\n                    />\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                      onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                      data-testid=\"toggle-confirm-password\"\n                    >\n                      {showConfirmPassword ? (\n                        <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                      ) : (\n                        <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              </div>\n\n              {/* Password Requirements */}\n              {formData.password && (\n                <div className=\"space-y-2\" data-testid=\"password-requirements\">\n                  <p className=\"text-sm font-medium\">Password Requirements:</p>\n                  <div className=\"grid grid-cols-2 gap-2\">\n                    {passwordRequirements.map((req, index) => (\n                      <div key={index} className=\"flex items-center space-x-2 text-sm\">\n                        <CheckCircle className={`w-4 h-4 ${req.met ? 'text-green-500' : 'text-muted-foreground'}`} />\n                        <span className={req.met ? 'text-green-600' : 'text-muted-foreground'}>\n                          {req.text}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Referral Code */}\n              <div>\n                <Label htmlFor=\"referredBy\">Referral Code (Optional)</Label>\n                <Input\n                  id=\"referredBy\"\n                  name=\"referredBy\"\n                  type=\"text\"\n                  value={formData.referredBy}\n                  onChange={handleInputChange}\n                  className=\"mt-1\"\n                  placeholder=\"Enter referral code\"\n                  data-testid=\"input-referral-code\"\n                />\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Have a referral code? Enter it to give your referrer 10% commission.\n                </p>\n              </div>\n\n              {/* Terms and Conditions */}\n              <div className=\"flex items-center\">\n                <input\n                  id=\"terms\"\n                  name=\"terms\"\n                  type=\"checkbox\"\n                  required\n                  className=\"h-4 w-4 text-primary focus:ring-primary border-border rounded\"\n                  data-testid=\"checkbox-terms\"\n                />\n                <Label htmlFor=\"terms\" className=\"ml-2 text-sm\">\n                  I agree to the{' '}\n                  <a href=\"#\" className=\"text-primary hover:text-primary/80\">Terms of Service</a>\n                  {' '}and{' '}\n                  <a href=\"#\" className=\"text-primary hover:text-primary/80\">Privacy Policy</a>\n                </Label>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={isLoading}\n                data-testid=\"button-register\"\n              >\n                {isLoading ? \"Creating account...\" : \"Create Account\"}\n              </Button>\n            </form>\n\n            <div className=\"mt-6\">\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <div className=\"w-full border-t border-border\" />\n                </div>\n                <div className=\"relative flex justify-center text-sm\">\n                  <span className=\"px-2 bg-background text-muted-foreground\">Already have an account?</span>\n                </div>\n              </div>\n\n              <div className=\"mt-6 text-center\">\n                <Link href=\"/login\">\n                  <a className=\"font-medium text-primary hover:text-primary/80\" data-testid=\"link-login\">\n                    Sign in to your account\n                  </a>\n                </Link>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Benefits */}\n        <div className=\"text-center mt-8 space-y-4\" data-testid=\"register-benefits\">\n          <p className=\"text-sm text-muted-foreground\">\n            What you'll get with your free account:\n          </p>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\n            <div className=\"flex items-center space-x-2\">\n              <CheckCircle className=\"w-4 h-4 text-green-500\" />\n              <span>Access to all certification courses</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <CheckCircle className=\"w-4 h-4 text-green-500\" />\n              <span>Access to job board</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <CheckCircle className=\"w-4 h-4 text-green-500\" />\n              <span>Basic calculator tools</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":14239},"client/src/pages/course-content.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useRoute } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  BookOpen, \n  Play, \n  Clock, \n  Star, \n  CheckCircle, \n  ExternalLink,\n  Headphones,\n  MessageSquare,\n  Bookmark,\n  NotebookPen,\n  Lock\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': '5f02238b-afb2-4e7f-a488-96fb471fee56',\n    'backflow-prevention': 'b1f02238b-afb2-4e7f-a488-96fb471fee57',\n    'natural-gas': 'c2f02238b-afb2-4e7f-a488-96fb471fee58',\n    'medical-gas': 'd3f02238b-afb2-4e7f-a488-96fb471fee59',\n    'master-plumber': 'e4f02238b-afb2-4e7f-a488-96fb471fee60'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface CourseContent {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: number;\n  content: any;\n  quizgeckoUrl?: string;\n  duration?: number;\n  isActive: boolean;\n  sortOrder: number;\n}\n\ninterface Course {\n  id: string;\n  title: string;\n  description: string;\n  duration?: number;\n  lessons?: number;\n  practiceQuestions?: number;\n}\n\nexport default function CourseContent() {\n  const [match, params] = useRoute(\"/course/:courseId\");\n  const courseId = params?.courseId;\n  const queryClient = useQueryClient();\n\n  // Force cache invalidation on component mount to get fresh data\n  useEffect(() => {\n    if (courseId) {\n      queryClient.invalidateQueries({ queryKey: [`/api/courses/${courseId}/content`] });\n    }\n  }, [courseId, queryClient]);\n\n  if (!courseId) {\n    return <div>Course not found</div>;\n  }\n\n  const { data: courses } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n  \n  // Map friendly URL to database UUID for course lookup\n  const courseUUID = getCourseUUID(courseId);\n  const course = courses?.find(c => c.id === courseUUID);\n\n  const { data: content, isLoading } = useQuery<CourseContent[]>({\n    queryKey: [`/api/courses/${courseId}/content`],\n    staleTime: 0,\n    gcTime: 0,\n    refetchOnMount: 'always',\n  });\n\n  const { data: sectionProgress } = useQuery<Array<{section: number, isUnlocked: boolean, isAdmin: boolean}>>({\n    queryKey: [`/api/section-progress/${courseId}`],\n    enabled: !!courseId,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/2\"></div>\n          <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n          <div className=\"space-y-2\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"h-20 bg-gray-200 rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!course) {\n    return <div>Course not found</div>;\n  }\n\n  if (!content || !Array.isArray(content) || content.length === 0) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Course Content</h1>\n          <p>No lessons available yet. Content is being prepared.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Group content by section\n  const contentBySection = content.reduce((acc, item) => {\n    // Handle null/undefined sections by defaulting to section number\n    const sectionKey = item.section?.toString() || '101';\n    if (!acc[sectionKey]) acc[sectionKey] = [];\n    acc[sectionKey].push(item);\n    return acc;\n  }, {} as Record<string, CourseContent[]>);\n  \n  // Get unique sections sorted and filter out placeholder sections\n  const allSections = Object.keys(contentBySection).sort((a, b) => Number(a) - Number(b));\n  \n  // Only show the actual Louisiana State Plumbing Code sections (101-109)\n  const sections = allSections.filter(section => {\n    const sectionNum = Number(section);\n    \n    // Only keep sections 101, 103, 105, 107, 109 (the real LSPC sections)\n    return sectionNum >= 101 && sectionNum <= 109;\n  });\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case 'lesson': return BookOpen;\n      case 'quiz': return Star;\n      case 'podcast': return Headphones;\n      case 'chat': return MessageSquare;\n      case 'flashcards': return Bookmark;\n      case 'study-notes': return NotebookPen;\n      default: return BookOpen;\n    }\n  };\n\n  const getTypeLabel = (type: string) => {\n    switch (type) {\n      case 'lesson': return 'Introduction';\n      case 'quiz': return 'Quiz';\n      case 'podcast': return 'Podcast';\n      case 'chat': return 'Teach Me/Chat';\n      case 'flashcards': return 'Flashcards';\n      case 'study-notes': return 'Study Notes';\n      default: return type;\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'lesson': return 'bg-blue-100 text-blue-800 border-blue-200';\n      case 'quiz': return 'bg-green-100 text-green-800 border-green-200';\n      case 'podcast': return 'bg-purple-100 text-purple-800 border-purple-200';\n      case 'chat': return 'bg-orange-100 text-orange-800 border-orange-200';\n      case 'flashcards': return 'bg-pink-100 text-pink-800 border-pink-200';\n      case 'study-notes': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      default: return 'bg-gray-100 text-gray-800 border-gray-200';\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      {/* Course Header */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Link href=\"/dashboard\" className=\"text-primary hover:underline\">\n            Dashboard\n          </Link>\n          <span>/</span>\n          <span className=\"text-muted-foreground\">Course Content</span>\n        </div>\n        \n        <div className=\"bg-white rounded-lg shadow-sm border p-6\">\n          <h1 className=\"text-3xl font-bold text-foreground mb-4\" data-testid=\"course-title\">\n            {course.title}\n          </h1>\n          <p className=\"text-muted-foreground mb-6\">{course.description}</p>\n          \n          <div className=\"flex items-center gap-6 text-sm text-muted-foreground\">\n            {course.duration && (\n              <div className=\"flex items-center gap-1\">\n                <Clock className=\"w-4 h-4\" />\n                <span>{course.duration} hours</span>\n              </div>\n            )}\n            {course.lessons && (\n              <div className=\"flex items-center gap-1\">\n                <BookOpen className=\"w-4 h-4\" />\n                <span>{course.lessons} lessons</span>\n              </div>\n            )}\n            {course.practiceQuestions && (\n              <div className=\"flex items-center gap-1\">\n                <Star className=\"w-4 h-4\" />\n                <span>{course.practiceQuestions} quizzes</span>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Course Lessons by Section */}\n      <div className=\"space-y-6\">\n        <h2 className=\"text-xl font-semibold mb-4\" data-testid=\"lessons-header\">\n          Course Lessons\n        </h2>\n        \n        {sections.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <BookOpen className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-medium mb-2\">No Lessons Available</h3>\n              <p className=\"text-muted-foreground\">\n                This course doesn't have any lessons yet. Check back later!\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          sections.map((section) => {\n            const sectionItems = contentBySection[section];\n            \n            // Create proper section titles based on your actual Louisiana State Plumbing Code sections\n            const getSectionInfo = (sectionNum: string) => {\n              const num = Number(sectionNum);\n              switch (num) {\n                case 101:\n                  return { title: \"Louisiana State Plumbing Code Â§101\", subtitle: \"Administration\" };\n                case 103:\n                  return { title: \"Louisiana State Plumbing Code Â§103\", subtitle: \"Availability\" };\n                case 105:\n                  return { title: \"Louisiana State Plumbing Code Â§105\", subtitle: \"Effective Date and Edition\" };\n                case 107:\n                  return { title: \"Louisiana State Plumbing Code Â§107\", subtitle: \"Purpose and Scope\" };\n                case 109:\n                  return { title: \"Louisiana State Plumbing Code Â§109\", subtitle: \"Permitting and Inspection Limitations\" };\n                default:\n                  return { title: `Louisiana State Plumbing Code Â§${sectionNum}`, subtitle: sectionItems[0]?.title.split(' - ')[0] || `Section ${sectionNum}` };\n              }\n            };\n            \n            const sectionInfo = getSectionInfo(section);\n            const sectionTitle = sectionInfo.title;\n            const sectionSubtitle = sectionInfo.subtitle;\n            \n            // Calculate lesson progress (placeholder for now)\n            const progress = 0;\n            const contentCount = sectionItems.length;\n            \n            // Check if this section is unlocked\n            const sectionNum = Number(section);\n            const sectionStatus = sectionProgress?.find(s => s.section === sectionNum);\n            const isUnlocked = sectionStatus?.isUnlocked ?? false;\n            const isAdmin = sectionStatus?.isAdmin ?? false;\n            \n            // Section 101 is always unlocked for all users (starting section)\n            // Other sections require completion of previous section\n            const isFirstSection = sectionNum === 101;\n            const shouldShowAsLocked = !isFirstSection && !isUnlocked && !isAdmin;\n            \n            return (\n              <Card key={section} className={`hover:shadow-md transition-shadow ${shouldShowAsLocked ? 'opacity-60' : ''}`} data-testid={`lesson-card-${section}`}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <Badge className=\"bg-primary/10 text-primary\" data-testid={`lesson-section-${section}`}>\n                          Section {section}\n                        </Badge>\n                        <Badge variant=\"outline\" data-testid={`lesson-content-count-${section}`}>\n                          {contentCount} parts\n                        </Badge>\n                        {shouldShowAsLocked && (\n                          <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800\">\n                            <Lock className=\"w-3 h-3 mr-1\" />\n                            Locked\n                          </Badge>\n                        )}\n                      </div>\n                      <h3 className=\"text-lg font-semibold text-foreground mb-1\" data-testid={`lesson-title-${section}`}>\n                        {sectionTitle}\n                      </h3>\n                      <p className=\"text-sm text-muted-foreground mb-3\" data-testid={`lesson-description-${section}`}>\n                        {sectionSubtitle}\n                      </p>\n                      \n                      {/* Progress bar for enrolled users */}\n                      {progress > 0 && (\n                        <div className=\"space-y-1 mb-3\">\n                          <div className=\"flex justify-between text-xs\">\n                            <span>Progress</span>\n                            <span>{progress}%</span>\n                          </div>\n                          <Progress value={progress} className=\"h-1.5\" data-testid={`lesson-progress-${section}`} />\n                        </div>\n                      )}\n                      \n                      {/* Content overview */}\n                      <div className=\"flex items-center space-x-3 text-xs text-muted-foreground flex-wrap\">\n                        <div className=\"flex items-center space-x-1\">\n                          <BookOpen className=\"w-3 h-3\" />\n                          <span>Introduction</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <Headphones className=\"w-3 h-3\" />\n                          <span>Podcast</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <MessageSquare className=\"w-3 h-3\" />\n                          <span>Chat</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <Bookmark className=\"w-3 h-3\" />\n                          <span>Flashcards</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <NotebookPen className=\"w-3 h-3\" />\n                          <span>Study Notes</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <Star className=\"w-3 h-3\" />\n                          <span>Quiz</span>\n                        </div>\n                      </div>\n                      \n                      {shouldShowAsLocked && (\n                        <p className=\"text-xs text-red-600 mt-2\">\n                          ðŸ”’ Complete the previous section's quiz with {sectionTitle.toLowerCase().includes('chapter review') ? '80%' : '70%'}+ to unlock\n                        </p>\n                      )}\n                    </div>\n                    \n                    <div className=\"ml-4\">\n                      {(isFirstSection || isUnlocked || isAdmin) ? (\n                        <Button \n                          asChild\n                          data-testid={`button-start-lesson-${section}`}\n                          className={shouldShowAsLocked ? \"opacity-75\" : \"\"}\n                        >\n                          <Link href={`/course/${courseId}/lesson/${section}`}>\n                            {shouldShowAsLocked ? <Lock className=\"w-4 h-4 mr-2\" /> : <Play className=\"w-4 h-4 mr-2\" />}\n                            {shouldShowAsLocked ? \"Locked\" : (progress > 0 ? \"Continue\" : \"Start\")}\n                          </Link>\n                        </Button>\n                      ) : (\n                        <Button \n                          disabled\n                          variant=\"secondary\"\n                          className=\"opacity-50\"\n                          data-testid={`button-locked-lesson-${section}`}\n                        >\n                          <Lock className=\"w-4 h-4 mr-2\" />\n                          Locked\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })\n        )}\n      </div>\n\n      {content.length === 0 && (\n        <Card>\n          <CardContent className=\"p-8 text-center\">\n            <BookOpen className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-foreground mb-2\">No Content Available</h3>\n            <p className=\"text-muted-foreground\">\n              Course content is being prepared. Check back soon!\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":15849},"client/src/pages/lesson.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport AIMentorChat from \"@/components/ai-mentor-chat\";\nimport { AuthService } from \"@/lib/auth\";\nimport { \n  BookOpen, \n  Play, \n  Clock, \n  ExternalLink,\n  Headphones,\n  MessageSquare,\n  Bookmark,\n  NotebookPen,\n  HelpCircle,\n  ChevronRight,\n  ArrowLeft,\n  Lock,\n  Brain,\n  Plus\n} from \"lucide-react\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\n// Component for Continue Where You Left Off button\nfunction ContinueWhereLeftOffButton({ courseId, section, navigate }: { \n  courseId: string; \n  section: string; \n  navigate: (path: string) => void; \n}) {\n  const { data: currentStep, isLoading } = useQuery<{stepType?: string}>({\n    queryKey: [`/api/lesson-progress/${courseId}/${section}/current`],\n    enabled: !!courseId && !!section,\n  });\n\n  // Map step types to their proper routes\n  const getStepRoute = (stepType: string): string => {\n    switch (stepType) {\n      case 'introduction':\n        return `/course/${courseId}/lesson/${section}/introduction`;\n      case 'podcast':\n        return `/course/${courseId}/lesson/${section}/podcast`;\n      case 'flashcards':\n        return `/course/${courseId}/lesson/${section}/flashcards`;\n      case 'ai-chat':\n        return `/course/${courseId}/lesson/${section}/ai-chat`;\n      case 'study-notes':\n        return `/course/${courseId}/lesson/${section}/study-notes`;\n      case 'quiz':\n        return `/course/${courseId}/lesson/${section}/quiz`;\n      default:\n        return `/course/${courseId}/lesson/${section}/introduction`;\n    }\n  };\n\n  const handleContinue = () => {\n    if (currentStep?.stepType) {\n      const route = getStepRoute(currentStep.stepType);\n      navigate(route);\n    } else {\n      // Default to introduction if no progress found\n      navigate(`/course/${courseId}/lesson/${section}/introduction`);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Button variant=\"outline\" disabled data-testid=\"continue-where-left-off-loading\">\n        <Clock className=\"w-4 h-4 mr-2 animate-spin\" />\n        Loading...\n      </Button>\n    );\n  }\n\n  return (\n    <Button \n      onClick={handleContinue} \n      className=\"flex items-center gap-2\"\n      data-testid=\"continue-where-left-off-button\"\n    >\n      <Play className=\"w-4 h-4\" />\n      {currentStep?.stepType ? `Continue ${currentStep.stepType}` : 'Start Lesson'}\n    </Button>\n  );\n}\n\ninterface CourseContent {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: string;\n  content: any;\n  quizgeckoUrl?: string;\n  duration?: number;\n  isActive: boolean;\n  sortOrder: number;\n}\n\ninterface Course {\n  id: string;\n  title: string;\n  description: string;\n}\n\nexport default function Lesson() {\n  const [match, params] = useRoute(\"/course/:courseId/lesson/:section\");\n  const [, navigate] = useLocation();\n  const courseId = params?.courseId;\n  const section = params?.section;\n\n  if (!courseId || !section) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  const { data: courses } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n  \n  const course = courses?.find(c => c.id === resolvedCourseId);\n\n  const { data: allContent, isLoading } = useQuery<CourseContent[]>({\n    queryKey: [`/api/courses/${resolvedCourseId}/content`],\n  });\n\n  const { data: sectionProgress } = useQuery<Array<{section: number, isUnlocked: boolean, isAdmin: boolean}>>({\n    queryKey: [`/api/section-progress/${resolvedCourseId}`],\n    enabled: !!resolvedCourseId,\n  });\n\n  // Check user authentication and subscription access\n  const { data: currentUser } = useQuery<any>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n\n  // Helper functions to handle study plan filtering\n  const normalizeType = (type: string) => type?.toLowerCase().replace(/_/g, '-').trim();\n  const isStudyPlanType = (item: CourseContent) => {\n    const normalizedType = normalizeType(item.type);\n    return /^study[- ]?plans?($|-[0-9]+$)/i.test(normalizedType) || \n           /study\\s*plan/i.test(item.title || '');\n  };\n\n  // Filter content for this specific section and remove all study plan variants\n  const sectionContent = allContent?.filter(item => {\n    const itemSection = item.section?.toString();\n    const urlSection = section?.toString();\n    return itemSection === urlSection && !isStudyPlanType(item);\n  });\n  \n  // Define the correct lesson flow order based on user requirements  \n  // AI intro â†’ Podcast â†’ Flashcards â†’ AI chat â†’ Study notes â†’ Quiz (20 questions, 70% pass)\n  const contentOrder = ['lesson', 'podcast', 'flashcards', 'chat', 'study-notes', 'quiz'];\n  \n  // Remove duplicates by type - keep only the first occurrence of each type\n  const uniqueContent = sectionContent?.reduce((acc: CourseContent[], current) => {\n    const normalizedType = normalizeType(current.type);\n    const existingType = acc.find(item => normalizeType(item.type) === normalizedType);\n    if (!existingType) {\n      acc.push(current);\n    }\n    return acc;\n  }, []);\n\n  // Filter out AI Study Assistant (chat) if user doesn't have proper subscription\n  const hasAIMentorAccess = AuthService.hasFeatureAccess(currentUser, 'ai_mentor');\n  const accessibleContent = uniqueContent?.filter(item => {\n    // Hide AI Study Assistant if user doesn't have Professional or Master subscription\n    if (normalizeType(item.type) === 'chat' && !hasAIMentorAccess) {\n      return false;\n    }\n    return true;\n  });\n  \n  // Sort content by the defined order\n  const sortedContent = accessibleContent?.sort((a, b) => {\n    const aIndex = contentOrder.indexOf(normalizeType(a.type));\n    const bIndex = contentOrder.indexOf(normalizeType(b.type));\n    return aIndex - bIndex;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/2\"></div>\n          <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n          <div className=\"space-y-2\">\n            {[1, 2, 3, 4, 5, 6].map((i) => (\n              <div key={i} className=\"h-20 bg-gray-200 rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!course || !sortedContent || sortedContent.length === 0) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Check if this section is unlocked\n  const sectionNum = Number(section);\n  const sectionStatus = sectionProgress?.find(s => s.section === sectionNum);\n  const isUnlocked = sectionStatus?.isUnlocked ?? false;\n  const isAdmin = sectionStatus?.isAdmin ?? false;\n\n  // For demo purposes, don't show locked message for admin users\n  if (!isUnlocked && !isAdmin && sectionProgress) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"text-center\">\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-8 max-w-md mx-auto\">\n            <Lock className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\n            <h2 className=\"text-xl font-semibold text-red-800 mb-2\">Section Locked</h2>\n            <p className=\"text-red-600 mb-4\">\n              You need to complete the previous section's quiz with {sortedContent[0]?.title?.toLowerCase().includes('chapter review') ? '80%' : '70%'} or higher to unlock this section.\n            </p>\n            <Button asChild variant=\"outline\">\n              <Link href={`/course/${courseId}`}>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Course\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case 'lesson': return BookOpen;\n      case 'quiz': return HelpCircle;\n      case 'podcast': return Headphones;\n      case 'chat': return MessageSquare;\n      case 'flashcards': return Bookmark;\n      case 'study-notes': return NotebookPen;\n      case 'study-plan': return Clock;\n      default: return BookOpen;\n    }\n  };\n\n  const getTypeLabel = (type: string) => {\n    switch (type) {\n      case 'lesson': return 'AI Introduction';\n      case 'quiz': return 'Section Quiz (20 Questions)';\n      case 'podcast': return 'Audio Lesson';\n      case 'chat': return 'AI Study Assistant';\n      case 'flashcards': return 'Flashcard Review';\n      case 'study-notes': return 'Study Notes';\n      case 'study-plan': return 'Choose Study Plan (Optional)';\n      default: return type;\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'lesson': return 'bg-blue-100 text-blue-800 border-blue-200';\n      case 'quiz': return 'bg-green-100 text-green-800 border-green-200';\n      case 'podcast': return 'bg-purple-100 text-purple-800 border-purple-200';\n      case 'chat': return 'bg-orange-100 text-orange-800 border-orange-200';\n      case 'flashcards': return 'bg-pink-100 text-pink-800 border-pink-200';\n      case 'study-notes': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      case 'study-plan': return 'bg-indigo-100 text-indigo-800 border-indigo-200';\n      default: return 'bg-gray-100 text-gray-800 border-gray-200';\n    }\n  };\n\n  const getTypeDescription = (type: string) => {\n    switch (type) {\n      case 'lesson': return 'AI-generated introduction to key concepts and regulations';\n      case 'quiz': return '20 questions, no time limit, 70% required to pass. Wrong answers reviewed with AI';\n      case 'podcast': return 'Audio lesson covering practical applications and examples';\n      case 'chat': return 'Interactive AI assistant for questions and clarifications';\n      case 'flashcards': return 'Quick review of key terms and concepts';\n      case 'study-notes': return 'Comprehensive notes and reference materials';\n      case 'study-plan': return 'Optional: Generate a timed study plan or proceed with lesson flow';\n      default: return '';\n    }\n  };\n\n  const getLessonStepRoute = (type: string) => {\n    switch (type) {\n      case 'lesson': return 'introduction';\n      case 'podcast': return 'podcast';\n      case 'flashcards': return 'flashcards';\n      case 'chat': return 'ai-chat';\n      case 'study-notes': return 'study-notes';\n      case 'quiz': return 'quiz';\n      default: return 'introduction';\n    }\n  };\n\n  // Remove progress tracking - user doesn't want completion status\n  // const progress = 45;\n  // const completed = Math.floor(sortedContent.length * (progress / 100));\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      {/* Back Navigation */}\n      <div className=\"mb-6\">\n        <Button variant=\"ghost\" asChild data-testid=\"button-back-course\">\n          <Link href={`/course/${courseId}`}>\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Course\n          </Link>\n        </Button>\n      </div>\n\n      {/* Lesson Header */}\n      <div className=\"bg-gradient-to-r from-primary/10 to-accent/10 rounded-lg p-6 mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <Badge className=\"mb-2\" data-testid={`lesson-section-${section}`}>\n              Section {section}\n            </Badge>\n            <h1 className=\"text-3xl font-bold text-foreground mb-2\" data-testid=\"lesson-title\">\n              Louisiana State Plumbing Code Â§{section}\n            </h1>\n            <p className=\"text-muted-foreground\" data-testid=\"lesson-description\">\n              {sortedContent[0]?.title.split(' - ')[0] || `Section ${section} Content`}\n            </p>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-lg font-medium text-primary\">\n              Section {section}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">\n              {sortedContent.length} learning activities\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Tabbed Interface with Study Plans */}\n      <Tabs defaultValue=\"lesson-flow\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"lesson-flow\" className=\"flex items-center gap-2\" data-testid=\"tab-lesson-flow\">\n            <BookOpen className=\"h-4 w-4\" />\n            Lesson Content\n          </TabsTrigger>\n          <TabsTrigger value=\"study-plans\" className=\"flex items-center gap-2\" data-testid=\"tab-study-plans\">\n            <Clock className=\"h-4 w-4\" />\n            Timed Study Plans\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"lesson-flow\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-xl font-semibold\" data-testid=\"lesson-content-header\">\n              Lesson Flow\n            </h2>\n            <ContinueWhereLeftOffButton \n              courseId={resolvedCourseId} \n              section={section} \n              navigate={navigate}\n            />\n          </div>\n          \n          {sortedContent?.map((item, index) => {\n            const IconComponent = getTypeIcon(item.type);\n            // Remove completion tracking - user doesn't want this\n            // const isCompleted = index < completed;\n            // const isCurrent = index === completed;\n\n            // Regular handling for other content types\n            return (\n              <Card \n                key={item.id} \n                className=\"transition-all hover:shadow-md\"\n                data-testid={`content-card-${item.type}-${index}`}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      {/* Step Number */}\n                      <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-primary text-primary-foreground border-2 border-primary\" data-testid={`step-number-${index + 1}`}>\n                        {index + 1}\n                      </div>\n                      \n                      {/* Content Info */}\n                      <div>\n                        <div className=\"flex items-center space-x-2\">\n                          <IconComponent className=\"w-5 h-5 text-muted-foreground\" />\n                          <Badge variant=\"outline\" className={getTypeColor(item.type)} data-testid={`content-type-${item.type}`}>\n                            {getTypeLabel(item.type)}\n                          </Badge>\n                        </div>\n                        <h3 className=\"font-medium text-foreground mt-1\" data-testid={`content-title-${index}`}>\n                          {getTypeLabel(item.type)}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          {getTypeDescription(item.type)}\n                        </p>\n                        {item.duration && (\n                          <div className=\"flex items-center space-x-1 text-sm text-muted-foreground mt-1\">\n                            <Clock className=\"w-3 h-3\" />\n                            <span>{item.duration}h</span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    \n                    {/* Action Button */}\n                    <div className=\"flex items-center space-x-2\">\n                      {item.type === 'chat' ? (\n                        hasAIMentorAccess ? (\n                          <Button \n                            variant=\"default\"\n                            onClick={() => {\n                              setTimeout(() => {\n                                const chatElement = document.querySelector('[data-testid=\"ai-mentor-chat\"]');\n                                if (chatElement) {\n                                  chatElement.scrollIntoView({ behavior: 'smooth' });\n                                }\n                              }, 100);\n                            }}\n                            data-testid={`button-study-${item.type}-${index}`}\n                          >\n                            <Play className=\"w-4 h-4 mr-2\" />\n                            Start Chat\n                          </Button>\n                        ) : (\n                          <Button \n                            variant=\"outline\"\n                            asChild\n                            data-testid={`button-upgrade-${item.type}-${index}`}\n                          >\n                            <Link href=\"/pricing\">\n                              <Lock className=\"w-4 h-4 mr-2\" />\n                              Upgrade to Pro\n                            </Link>\n                          </Button>\n                        )\n                      ) : (\n                        <Button \n                          variant=\"default\"\n                          asChild\n                          data-testid={`button-study-${item.type}-${index}`}\n                        >\n                          <Link href={`/course/${courseId}/lesson/${section}/${getLessonStepRoute(item.type)}`}>\n                            <Play className=\"w-4 h-4 mr-2\" />\n                            Start\n                          </Link>\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </TabsContent>\n\n        <TabsContent value=\"study-plans\" className=\"space-y-6\">\n          {/* AI Study Plan Generation */}\n          <StudentAIStudyPlanGenerator \n            courseId={resolvedCourseId} \n            sectionNumber={section} \n          />\n        </TabsContent>\n      </Tabs>\n\n      {/* AI Mentor Chat Section */}\n      <div className=\"mt-12 pt-8 border-t\" data-testid=\"ai-mentor-chat\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <div className=\"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center\">\n            <MessageSquare className=\"h-5 w-5 text-orange-600\" />\n          </div>\n          <div>\n            <h2 className=\"text-2xl font-bold text-foreground\">AI Mentor Chat</h2>\n            <p className=\"text-muted-foreground\">Get instant help with Louisiana plumbing code questions</p>\n          </div>\n        </div>\n        <AIMentorChat currentSection={section} />\n      </div>\n\n      {/* Navigation */}\n      <div className=\"flex justify-between mt-8 pt-6 border-t\">\n        <Button variant=\"outline\" asChild data-testid=\"button-previous-lesson\">\n          <Link href={`/course/${courseId}`}>\n            â† All Lessons\n          </Link>\n        </Button>\n        \n        <Button asChild data-testid=\"button-next-lesson\">\n          <Link href={`/course/${courseId}`}>\n            Next Lesson â†’\n          </Link>\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction StudentAIStudyPlanGenerator({ \n  courseId, \n  sectionNumber \n}: { \n  courseId: string; \n  sectionNumber: string; \n}) {\n  const { toast } = useToast();\n  const [duration, setDuration] = useState(\"45\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [generatedPlan, setGeneratedPlan] = useState<any>(null);\n  const [showPlan, setShowPlan] = useState(false);\n\n  const generateStudyPlan = async () => {\n    if (!courseId || !sectionNumber) {\n      toast({\n        title: \"Missing information\",\n        description: \"Unable to generate study plan for this section\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsGenerating(true);\n    setGeneratedPlan(null);\n\n    try {\n      const response = await apiRequest(\"POST\", `/api/generate-study-plan/${sectionNumber}`, {\n        courseId,\n        duration: parseInt(duration)\n      });\n\n      setGeneratedPlan(response);\n      setShowPlan(true);\n      toast({\n        title: \"AI Study Plan Generated!\",\n        description: `Your personalized ${duration}-minute study plan is ready`,\n        variant: \"default\"\n      });\n    } catch (error: any) {\n      console.error(\"Study plan generation error:\", error);\n      if (error.status === 402) {\n        toast({\n          title: \"Subscription Required\",\n          description: \"Upgrade your plan to generate personalized AI study plans\",\n          variant: \"destructive\"\n        });\n      } else {\n        toast({\n          title: \"Generation Failed\",\n          description: error.message || \"Failed to generate study plan. Please try again.\",\n          variant: \"destructive\"\n        });\n      }\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const startStudyPlan = () => {\n    if (generatedPlan) {\n      // Scroll to top and show the plan\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* AI Study Plan Header */}\n      <div className=\"text-center\">\n        <div className=\"w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-4\">\n          <Brain className=\"h-8 w-8 text-blue-600\" />\n        </div>\n        <h3 className=\"text-xl font-semibold mb-2\">AI-Generated Study Plan</h3>\n        <p className=\"text-muted-foreground text-sm max-w-md mx-auto mb-6\">\n          Generate a personalized study plan based on this section's content using AI\n        </p>\n      </div>\n\n      {/* Configuration */}\n      <Card className=\"max-w-md mx-auto\">\n        <CardContent className=\"p-6\">\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"duration\" className=\"text-sm font-medium\">\n                Study Duration\n              </Label>\n              <Select value={duration} onValueChange={setDuration} disabled={isGenerating}>\n                <SelectTrigger className=\"w-full mt-2\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"30\">30 minutes</SelectItem>\n                  <SelectItem value=\"45\">45 minutes</SelectItem>\n                  <SelectItem value=\"60\">60 minutes</SelectItem>\n                  <SelectItem value=\"90\">90 minutes</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <Button\n              onClick={generateStudyPlan}\n              disabled={isGenerating}\n              className=\"w-full\"\n              data-testid=\"button-generate-ai-study-plan\"\n            >\n              {isGenerating ? (\n                <>\n                  <Brain className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Generating Your Plan...\n                </>\n              ) : (\n                <>\n                  <Brain className=\"h-4 w-4 mr-2\" />\n                  Generate AI Study Plan\n                </>\n              )}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Generated Study Plan Display */}\n      {generatedPlan && showPlan && (\n        <Card className=\"max-w-4xl mx-auto border-2 border-green-200 bg-green-50/50\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle className=\"text-green-800 flex items-center gap-2\">\n                  <Brain className=\"h-5 w-5\" />\n                  {generatedPlan.studyPlan.title}\n                </CardTitle>\n                <p className=\"text-green-700 text-sm mt-2\">\n                  Duration: {generatedPlan.studyPlan.estimatedDuration} minutes â€¢ \n                  Based on: {generatedPlan.basedOnLesson}\n                </p>\n              </div>\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setShowPlan(false)}>\n                Ã—\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"bg-white rounded-lg p-4 max-h-96 overflow-y-auto mb-4\">\n              <div className=\"prose prose-sm max-w-none\">\n                <div className=\"whitespace-pre-wrap text-sm leading-relaxed\">\n                  {generatedPlan.studyPlan.content}\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"flex gap-3 justify-center\">\n              <Button onClick={startStudyPlan} className=\"flex items-center gap-2\">\n                <Play className=\"h-4 w-4\" />\n                Start Study Session\n              </Button>\n              <Button \n                variant=\"outline\"\n                onClick={() => {\n                  setGeneratedPlan(null);\n                  setShowPlan(false);\n                }}\n              >\n                Generate New Plan\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":25773},"client/src/components/content-viewer.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  BookOpen, \n  MessageSquare, \n  CheckCircle, \n  ExternalLink,\n  RefreshCw,\n  Loader2\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useStudySession } from \"@/hooks/use-study-session\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport PodcastPlayer from \"@/components/podcast-player\";\nimport InteractiveQuiz from \"@/components/interactive-quiz\";\n\ninterface ContentViewerProps {\n  contentId: string;\n  contentType: string;\n  title?: string;\n  courseId?: string;\n  sectionId?: string;\n  onComplete?: () => void;\n}\n\ninterface ContentData {\n  id: string;\n  title: string;\n  type: string;\n  content?: {\n    extracted?: {\n      content?: string;\n      transcript?: string;\n      text?: string;\n    };\n    text?: string;\n  };\n}\n\nexport default function ContentViewer(props: ContentViewerProps) {\n  const [location, navigate] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const { contentId, contentType, title, courseId, sectionId, onComplete } = props;\n\n  // Define lesson flow order\n  const lessonFlow = [\n    { type: 'introduction', label: 'Introduction' },\n    { type: 'podcast', label: 'Podcast' },\n    { type: 'flashcards', label: 'Flashcards' },\n    { type: 'ai-chat', label: 'AI Chat' },\n    { type: 'study-notes', label: 'Study Notes' },\n    { type: 'quiz', label: 'Quiz' }\n  ];\n\n  // Define lesson sequences - related lessons that should flow together\n  const lessonSequences: { [key: string]: string[] } = {\n    '101': ['101', '103', '107', '105'], // Administration sequence\n    '103': ['101', '103', '107', '105'], // Same sequence, different starting point\n    '107': ['101', '103', '107', '105'],\n    '105': ['101', '103', '107', '105'],\n    // Add more sequences as needed for odd-numbered sections only\n    '109': ['109'], // Single lesson\n  };\n\n  const getNextStep = () => {\n    // Determine current step based on contentId or contentType\n    let currentStepIndex = -1;\n    \n    // More specific checks for contentId patterns\n    if (contentId.includes('intro') || contentType === 'introduction') {\n      currentStepIndex = 0; // Introduction\n    } else if (contentId.includes('podcast') || contentType === 'podcast') {\n      currentStepIndex = 1; // Podcast\n    } else if (contentId.includes('flashcard') || contentType === 'flashcards') {\n      currentStepIndex = 2; // Flashcards\n    } else if (contentId.includes('chat') || contentId.includes('ai-chat') || contentType === 'ai-chat') {\n      currentStepIndex = 3; // AI Chat\n    } else if (contentId.includes('notes') || contentId.includes('study-notes') || contentType === 'study-notes') {\n      currentStepIndex = 4; // Study Notes\n    } else if (contentId.includes('quiz') || contentType === 'quiz') {\n      currentStepIndex = 5; // Quiz\n    } else {\n      // Default fallback - try to detect from content title\n      if (content?.title) {\n        const titleLower = content.title.toLowerCase();\n        if (titleLower.includes('intro')) currentStepIndex = 0;\n        else if (titleLower.includes('podcast')) currentStepIndex = 1;\n        else if (titleLower.includes('flashcard')) currentStepIndex = 2;\n        else if (titleLower.includes('chat')) currentStepIndex = 3;\n        else if (titleLower.includes('notes')) currentStepIndex = 4;\n        else if (titleLower.includes('quiz')) currentStepIndex = 5;\n      }\n    }\n\n\n    const nextIndex = currentStepIndex + 1;\n    if (nextIndex < lessonFlow.length) {\n      return lessonFlow[nextIndex];\n    }\n    return null; // No next step, end of lesson\n  };\n\n  const getCurrentSection = (): string => {\n    // Extract section number from various sources\n    if (sectionId) return sectionId;\n    if (contentId.includes('section-')) {\n      const match = contentId.match(/section-(\\d+)/);\n      if (match) return match[1];\n    }\n    if (content?.title) {\n      const match = content.title.match(/Section\\s+(\\d+)/i);\n      if (match) return match[1];\n    }\n    return '101'; // Default fallback\n  };\n\n  const getNextLessonInSequence = (currentSection: string): string | null => {\n    const sequence = lessonSequences[currentSection];\n    if (!sequence) return null;\n    \n    const currentIndex = sequence.indexOf(currentSection);\n    if (currentIndex === -1 || currentIndex === sequence.length - 1) {\n      return null; // End of sequence\n    }\n    \n    return sequence[currentIndex + 1];\n  };\n\n  const navigateToNextStep = () => {\n    const nextStep = getNextStep();\n    const currentSection = getCurrentSection();\n    \n    if (nextStep && courseId && sectionId) {\n      // Still within current lesson - navigate to next step page\n      navigate(`/course/${courseId}/lesson/${sectionId}/${nextStep.type}`);\n    } else {\n      // End of current lesson - check for next lesson in sequence\n      const nextLesson = getNextLessonInSequence(currentSection);\n      if (nextLesson && courseId) {\n        // Navigate to next lesson in sequence\n        navigate(`/course/${courseId}/lesson/${nextLesson}`);\n      } else {\n        // End of lesson sequence, complete it\n        handleComplete();\n      }\n    }\n  };\n  \n  // Initialize study session with valid props\n  const { startSession, endSession } = useStudySession({ \n    contentId: contentId || 'unknown', \n    contentType: (contentType || 'lesson') as any,\n    autoStart: false\n  });\n  \n  // Start session when component loads\n  useEffect(() => {\n    if (contentId) {\n      startSession();\n    }\n  }, [contentId]);\n\n  // Stop any existing audio when component loads\n  useEffect(() => {\n    if (typeof window !== 'undefined' && window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n  }, []);\n\n  // Fetch content\n  const { data: content, isLoading } = useQuery<ContentData>({\n    queryKey: [`/api/content/${contentId}/display`],\n    enabled: !!contentId,\n  });\n\n  // For quiz content, we don't need to wait for full content loading\n  const isQuizContent = contentType === 'quiz' || content?.type === 'quiz';\n\n  // Extract content mutation\n  const extractMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/course-content/${contentId}/extract`);\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/course-content\", contentId] });\n      toast({ title: \"Content extracted successfully!\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Extraction failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Complete content mutation\n  const completeMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/course-content/${contentId}/complete`);\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/course-content\"] });\n      endSession();\n      toast({ title: \"Content completed!\" });\n      navigate(\"/courses\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to complete content\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleComplete = () => {\n    completeMutation.mutate();\n  };\n\n  if (isLoading && !isQuizContent) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"w-8 h-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  // For quiz content, show the interactive quiz immediately\n  if (isQuizContent) {\n    const section = content?.title?.match(/\\d+/)?.[0] || title?.match(/\\d+/)?.[0] || sectionId || '101';\n    \n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <div className=\"mb-6\">\n          <Button \n            variant=\"outline\" \n            onClick={() => navigate(\"/courses\")}\n            className=\"mb-4\"\n          >\n            â† Back to Courses\n          </Button>\n          \n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold\">{content?.title || title}</h1>\n              <Badge variant=\"secondary\" className=\"mt-2\">\n                Interactive Quiz\n              </Badge>\n            </div>\n          </div>\n        </div>\n\n        <InteractiveQuiz \n          section={section}\n          contentId={contentId}\n          onComplete={() => {\n            handleComplete();\n          }}\n        />\n      </div>\n    );\n  }\n\n  if (!content) {\n    return (\n      <div className=\"text-center p-8\">\n        <p>Content not found</p>\n        <Button onClick={() => navigate(\"/courses\")} className=\"mt-4\">\n          Back to Courses\n        </Button>\n      </div>\n    );\n  }\n\n  // Check for autoStart parameter from URL (when user clicks Review)\n  const urlParams = new URLSearchParams(location.split('?')[1] || '');\n  const shouldAutoStart = urlParams.get('autostart') === 'true';\n\n  const renderPodcastContent = () => {\n    if (!content) return null;\n    \n    const extracted = content.content?.extracted;\n    const podcastContent = extracted?.transcript || extracted?.content || extracted?.text || '';\n    \n    if (!podcastContent) {\n      return (\n        <div className=\"text-center p-6\">\n          <p className=\"mb-4\">No podcast content available.</p>\n          <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n            {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n            Generate Podcast\n          </Button>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Podcast Header */}\n        <Card className=\"mb-6\">\n          <CardHeader className=\"text-center\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <span className=\"text-2xl\">ðŸŽ§</span>\n            </div>\n            <CardTitle className=\"text-2xl\">{content.title || 'Podcast Lesson'}</CardTitle>\n            <p className=\"text-muted-foreground\">\n              Audio lesson with interactive transcript\n            </p>\n          </CardHeader>\n        </Card>\n\n        {/* Podcast Player - Clean Interface */}\n        <PodcastPlayer \n          content={podcastContent} \n          autoStart={shouldAutoStart} \n        />\n        \n        {/* Continue Button */}\n        <Card className=\"mt-6\">\n          <CardContent className=\"p-6 text-center\">\n            <p className=\"text-muted-foreground mb-4\">\n              Listen to the complete audio lesson to continue\n            </p>\n            <Button onClick={navigateToNextStep} className=\"w-full max-w-sm mx-auto\">\n              <CheckCircle className=\"w-4 h-4 mr-2\" />\n              {(() => {\n                const nextStep = getNextStep();\n                if (nextStep) {\n                  return `Continue to ${nextStep.label}`;\n                } else {\n                  const currentSection = getCurrentSection();\n                  const nextLesson = getNextLessonInSequence(currentSection);\n                  return nextLesson ? `Continue to Section ${nextLesson}` : 'Complete Lesson';\n                }\n              })()}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  };\n\n  const renderTextContent = () => {\n    if (!content) return null;\n    \n    const text = content.content?.extracted?.content || content.content?.text || content.title;\n    const nextStep = getNextStep();\n    \n    return (\n      <div className=\"space-y-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BookOpen className=\"w-5 h-5\" />\n              {content.title}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"prose max-w-none\">\n              {text ? (\n                <div dangerouslySetInnerHTML={{ __html: text.replace(/\\n/g, '<br/>') }} />\n              ) : (\n                <p>No content available</p>\n              )}\n            </div>\n            \n            <Button onClick={navigateToNextStep} className=\"w-full mt-6\">\n              {(() => {\n                if (nextStep) {\n                  return `Continue to ${nextStep.label}`;\n                } else {\n                  const currentSection = getCurrentSection();\n                  const nextLesson = getNextLessonInSequence(currentSection);\n                  return nextLesson ? `Continue to Section ${nextLesson}` : 'Complete Lesson';\n                }\n              })()}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  };\n\n  const renderQuizContent = () => {\n    if (!content) return null;\n    \n    // Extract section from content title or ID\n    const section = content.title?.match(/\\d+/)?.[0] || sectionId || '101';\n    \n    return (\n      <InteractiveQuiz \n        section={section}\n        contentId={contentId}\n        title={content.title}\n        onComplete={() => {\n          handleComplete();\n        }}\n      />\n    );\n  };\n\n  const renderContent = () => {\n    switch (contentType) {\n      case 'podcast':\n        return renderPodcastContent();\n      case 'quiz':\n        return renderQuizContent();\n      default:\n        return renderTextContent();\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <div className=\"mb-6\">\n        <Button \n          variant=\"outline\" \n          onClick={() => navigate(\"/courses\")}\n          className=\"mb-4\"\n        >\n          â† Back to Courses\n        </Button>\n        \n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">{content.title}</h1>\n            <Badge variant=\"secondary\" className=\"mt-2\">\n              {contentType.charAt(0).toUpperCase() + contentType.slice(1)}\n            </Badge>\n          </div>\n        </div>\n      </div>\n\n      {renderContent()}\n    </div>\n  );\n}","size_bytes":14439},"client/src/pages/content-view.tsx":{"content":"import { useRoute, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft } from \"lucide-react\";\nimport ContentViewer from \"@/components/content-viewer\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ninterface Course {\n  id: string;\n  title: string;\n  description: string;\n}\n\ninterface ContentData {\n  id: string;\n  title: string;\n  type: string;\n  section?: number;\n  content?: any;\n}\n\nexport default function ContentView() {\n  const [match, params] = useRoute(\"/course/:courseId/content/:contentId\");\n  const courseId = params?.courseId;\n  const contentId = params?.contentId;\n\n  if (!courseId || !contentId) {\n    return <div>Content not found</div>;\n  }\n\n  const { data: courses } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n  \n  const course = courses?.find(c => c.id === courseId);\n\n  const { data: content } = useQuery<ContentData>({\n    queryKey: [`/api/content/${contentId}/display`],\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Back Navigation */}\n      <div className=\"border-b bg-white\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <Button variant=\"ghost\" asChild data-testid=\"button-back-lesson\">\n            <Link href={`/course/${courseId}/lesson/${content?.section?.toString() || ''}`}>\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Lesson\n            </Link>\n          </Button>\n        </div>\n      </div>\n\n      {/* Content Viewer */}\n      <div className=\"container mx-auto px-4 py-8\">\n        {contentId ? (\n          <ContentViewer\n            contentId={contentId}\n            contentType={content?.type || 'lesson'}\n            title={content?.title || ''}\n            courseId={courseId || ''}\n            sectionId={content?.section?.toString() || ''}\n            onComplete={() => {\n              console.log('Content completed');\n            }}\n          />\n        ) : (\n          <div className=\"text-center py-8\">\n            <div className=\"animate-pulse space-y-4\">\n              <div className=\"h-8 bg-gray-200 rounded w-1/2 mx-auto\"></div>\n              <div className=\"h-4 bg-gray-200 rounded w-3/4 mx-auto\"></div>\n              <div className=\"h-32 bg-gray-200 rounded\"></div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":2330},"server/content-extractor.ts":{"content":"import * as cheerio from 'cheerio';\n\ninterface ExtractedContent {\n  type: 'lesson' | 'quiz' | 'podcast' | 'chat' | 'flashcards' | 'study-notes';\n  title: string;\n  content: any;\n  duration?: number;\n}\n\nexport class ContentExtractor {\n\n  async extractFromQuizGecko(url: string, contentType: string): Promise<ExtractedContent | null> {\n    try {\n      // If URL is provided, try to extract content from it\n      if (url && url.trim()) {\n        console.log(`Attempting to extract ${contentType} content from URL: ${url}`);\n        \n        // Try to extract content from the URL\n        const extractedContent = await this.extractContentFromUrl(url, contentType);\n        if (extractedContent) {\n          return extractedContent;\n        }\n        \n        console.error(`Failed to extract ${contentType} content from URL: ${url} - No content extracted`);\n        return null;\n      }\n      \n      // If no URL provided, return null instead of sample content\n      console.error(`No URL provided for ${contentType} content extraction`);\n      return null;\n    } catch (error) {\n      console.error(`Failed to extract content from ${url}:`, error);\n      return null;\n    }\n  }\n\n  private async extractContentFromUrl(url: string, contentType: string): Promise<ExtractedContent | null> {\n    try {\n      // Use native fetch with timeout for security\n      const response = await fetch(url, {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\n        },\n        signal: AbortSignal.timeout(30000) // 30 second timeout for security\n      });\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      \n      const html = await response.text();\n      \n      // Use cheerio to parse the HTML\n      const $ = cheerio.load(html);\n      \n      // Extract content based on the type\n      switch (contentType) {\n        case 'quiz':\n          return await this.extractQuizFromHtml($, url);\n        case 'lesson':\n          return await this.extractLessonFromHtml($, url);\n        case 'flashcards':\n          return await this.extractFlashcardsFromHtml($, url);\n        case 'study-notes':\n          return await this.extractStudyNotesFromHtml($, url);\n        case 'podcast':\n          return await this.extractPodcastFromHtml($, url);\n        case 'chat':\n          return await this.extractChatFromHtml($, url);\n        default:\n          return null;\n      }\n    } catch (error) {\n      console.error(`Error extracting content from URL ${url}:`, error);\n      return null;\n    }\n  }\n\n  private async extractQuizFromHtml($: cheerio.CheerioAPI, url: string): Promise<ExtractedContent | null> {\n    try {\n      // Look for quiz questions in various possible structures\n      const questions: any[] = [];\n      let questionId = 0;\n      \n      // Try to find quiz questions by common selectors\n      const questionElements = $('div[class*=\"question\"], .quiz-question, [data-question], .q, .question');\n      \n      questionElements.each((index, element) => {\n        const questionText = $(element).find('h3, h4, h5, p, .question-text, .q-text').first().text().trim();\n        if (!questionText) return;\n        \n        const options: any[] = [];\n        let optionId = 0;\n        \n        // Look for answer options\n        const optionElements = $(element).find('li, .option, .answer, [data-option], .choice, input[type=\"radio\"], label');\n        optionElements.each((i, optionEl) => {\n          const optionText = $(optionEl).text().trim();\n          if (optionText && optionText.length > 2) {\n            // Try to determine if this is the correct answer\n            const isCorrect = $(optionEl).hasClass('correct') || \n                            $(optionEl).hasClass('right') || \n                            $(optionEl).attr('data-correct') === 'true' ||\n                            $(optionEl).find('.correct, .right').length > 0;\n            \n            options.push({\n              id: optionId++,\n              text: optionText,\n              isCorrect: isCorrect\n            });\n          }\n        });\n        \n        // If we found a question with some options, add it\n        if (questionText && options.length >= 2) {\n          // If no correct answer was found, mark the first option as correct (fallback)\n          if (!options.some(opt => opt.isCorrect)) {\n            options[0].isCorrect = true;\n          }\n          \n          questions.push({\n            id: questionId++,\n            question: questionText,\n            options: options.slice(0, 4), // Limit to 4 options\n            type: 'multiple-choice',\n            explanation: $(element).find('.explanation, .info, .details').text().trim() || `Explanation for: ${questionText}`,\n            reference: url\n          });\n        }\n      });\n      \n      // If we didn't find structured quiz content, try to extract from text content\n      if (questions.length === 0) {\n        const textContent = $('body').text();\n        const extractedQuestions = this.extractQuestionsFromText(textContent, url);\n        questions.push(...extractedQuestions);\n      }\n      \n      // Ensure we have at least some questions\n      if (questions.length === 0) {\n        return null;\n      }\n      \n      return {\n        type: 'quiz',\n        title: $('title').text() || 'Extracted Quiz',\n        content: {\n          questions: questions,\n          totalQuestions: questions.length,\n          passingScore: 70,\n          extractedAt: new Date().toISOString(),\n          sourceUrl: url\n        }\n      };\n    } catch (error) {\n      console.error('Error extracting quiz from HTML:', error);\n      return null;\n    }\n  }\n\n  public extractQuestionsFromText(text: string, url: string): any[] {\n    const questions: any[] = [];\n    \n    // Parse structured quiz format like in the database\n    // Look for pattern: **1. Question text**\\nA. Option\\nB. Option âœ“\\nC. Option\\nD. Option\n    const questionBlocks = text.split(/\\*\\*\\d+\\./).filter(block => block.trim().length > 0);\n    \n    questionBlocks.forEach((block, index) => {\n      // Extract question text (until first A.)\n      const questionMatch = block.match(/^([^A]*?)(?=[A-D]\\.)/s);\n      if (!questionMatch) return;\n      \n      const questionText = questionMatch[1].replace(/\\*\\*/g, '').trim();\n      if (questionText.length < 10) return;\n      \n      // Extract options (A., B., C., D.)\n      const optionMatches = block.match(/([A-D])\\.([^A-D]*?)(?=[A-D]\\.|$)/gs);\n      if (!optionMatches || optionMatches.length < 2) return;\n      \n      const options: any[] = [];\n      \n      optionMatches.forEach((optionMatch, optIndex) => {\n        const optionText = optionMatch.replace(/^[A-D]\\./, '').trim();\n        // Remove checkmarks and extra formatting\n        const cleanText = optionText.replace(/âœ“/g, '').replace(/\\*\\*/g, '').trim();\n        \n        if (cleanText.length > 0) {\n          const isCorrect = optionText.includes('âœ“');\n          options.push({\n            id: `${index}-${optIndex}`,\n            text: cleanText,\n            isCorrect: isCorrect\n          });\n        }\n      });\n      \n      // Only add question if we have valid options and at least one correct answer\n      if (options.length >= 2 && options.some(opt => opt.isCorrect)) {\n        questions.push({\n          id: `q-${index}`,\n          question: questionText,\n          options: options,\n          type: 'multiple-choice',\n          explanation: `Reference: Louisiana State Plumbing Code`,\n          reference: url || 'Louisiana State Plumbing Code'\n        });\n      }\n    });\n    \n    // If the structured approach didn't work, try the old pattern matching\n    if (questions.length === 0) {\n      const questionPattern = /(?:^|\\n)(?:\\d+\\.|\\d+\\)|Q\\d+[:.]|Question\\s+\\d+[:.])\\s*(.+?)(?=(?:\\n(?:\\d+\\.|\\d+\\)|Q\\d+[:.]|Question\\s+\\d+[:.])|\\n[A-D][\\).]\\s|\\n\\n|\\nAnswer|\\nExplanation|$))/gim;\n      const matches = text.match(questionPattern);\n      \n      if (matches) {\n        matches.forEach((match, index) => {\n          const questionText = match.replace(/^(?:\\d+\\.|\\d+\\)|Q\\d+[:.]|Question\\s+\\d+[:.])\\s*/, '').trim();\n          \n          if (questionText.length > 10) {\n            questions.push({\n              id: `fallback-${index}`,\n              question: questionText,\n              options: [\n                { id: `${index}-0`, text: \"Option A (extracted from content)\", isCorrect: true },\n                { id: `${index}-1`, text: \"Option B (extracted from content)\", isCorrect: false },\n                { id: `${index}-2`, text: \"Option C (extracted from content)\", isCorrect: false },\n                { id: `${index}-3`, text: \"Option D (extracted from content)\", isCorrect: false }\n              ],\n              type: 'multiple-choice',\n              explanation: `This question was extracted from the source content.`,\n              reference: url\n            });\n          }\n        });\n      }\n    }\n    \n    return questions.slice(0, 20); // Limit to 20 questions\n  }\n\n  private async extractLessonFromHtml($: cheerio.CheerioAPI, url: string): Promise<ExtractedContent | null> {\n    try {\n      const title = $('title').text() || $('h1').first().text() || 'Extracted Lesson';\n      \n      // Extract main content\n      const content = $('main, .content, .lesson, article, .post, .text').first();\n      const html = content.length > 0 ? content.html() || '' : $('body').html() || '';\n      const text = content.length > 0 ? content.text() : $('body').text();\n      \n      return {\n        type: 'lesson',\n        title: title,\n        content: {\n          html: html,\n          text: text.trim(),\n          extractedAt: new Date().toISOString(),\n          sourceUrl: url\n        }\n      };\n    } catch (error) {\n      console.error('Error extracting lesson from HTML:', error);\n      return null;\n    }\n  }\n\n  private async extractFlashcardsFromHtml($: cheerio.CheerioAPI, url: string): Promise<ExtractedContent | null> {\n    try {\n      const title = $('title').text() || 'Extracted Flashcards';\n      const cards: any[] = [];\n      let cardId = 0;\n\n      // Look for flashcard structures\n      const cardElements = $('div[class*=\"card\"], .flashcard, .card, [data-card], .term, .definition');\n      \n      cardElements.each((index, element) => {\n        const front = $(element).find('.front, .term, .question, h3, h4').first().text().trim();\n        const back = $(element).find('.back, .definition, .answer, p').first().text().trim();\n        \n        if (front && back && front.length > 5 && back.length > 5) {\n          cards.push({\n            id: cardId++,\n            front: front,\n            back: back\n          });\n        }\n      });\n\n      // If no structured cards found, try to extract from text content\n      if (cards.length === 0) {\n        const textContent = $('body').text();\n        const extractedCards = this.extractFlashcardsFromText(textContent);\n        cards.push(...extractedCards);\n      }\n\n      if (cards.length === 0) {\n        return null;\n      }\n\n      return {\n        type: 'flashcards',\n        title: title,\n        content: {\n          cards: cards,\n          totalCards: cards.length,\n          extractedAt: new Date().toISOString(),\n          sourceUrl: url\n        }\n      };\n    } catch (error) {\n      console.error('Error extracting flashcards from HTML:', error);\n      return null;\n    }\n  }\n\n  private extractFlashcardsFromText(text: string): any[] {\n    const cards: any[] = [];\n    \n    // Clean and normalize the text\n    const cleanText = text.trim().replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n    \n    // Simple approach: Split by empty lines and look for patterns\n    const lines = cleanText.split('\\n');\n    const blocks: string[] = [];\n    let currentBlock = '';\n    \n    // Group lines into text blocks separated by empty lines\n    for (const line of lines) {\n      if (line.trim() === '') {\n        if (currentBlock.trim()) {\n          blocks.push(currentBlock.trim());\n          currentBlock = '';\n        }\n      } else {\n        if (currentBlock) currentBlock += '\\n';\n        currentBlock += line;\n      }\n    }\n    \n    // Add the last block if it exists\n    if (currentBlock.trim()) {\n      blocks.push(currentBlock.trim());\n    }\n    \n    // Now pair up blocks as front/back of flashcards\n    for (let i = 0; i < blocks.length - 1; i += 2) {\n      const front = blocks[i];\n      const back = blocks[i + 1];\n      \n      if (front && back) {\n        // Basic validation: front should be shorter and more title-like\n        const frontIsTitle = front.length < back.length && front.length < 150 && !front.includes('.');\n        const backIsDefinition = back.length > 20;\n        \n        if (frontIsTitle || (front.length > 5 && back.length > 10)) {\n          cards.push({\n            id: cards.length,\n            front: front,\n            back: back\n          });\n        }\n      }\n    }\n    \n    // If no cards found with block pairing, try other methods\n    if (cards.length === 0) {\n      // Try splitting on double line breaks\n      const sections = cleanText.split(/\\n\\s*\\n\\s*\\n/);\n      \n      for (const section of sections) {\n        const parts = section.split(/\\n\\s*\\n/);\n        if (parts.length >= 2) {\n          const front = parts[0]?.trim();\n          const back = parts.slice(1).join('\\n\\n').trim();\n          \n          if (front && back && front.length > 3 && back.length > 10) {\n            cards.push({\n              id: cards.length,\n              front: front,\n              back: back\n            });\n          }\n        }\n      }\n    }\n    \n    // Final fallback: colon-separated format\n    if (cards.length === 0) {\n      const colonPattern = /^(.+?):\\s*(.+)$/gm;\n      let match;\n      \n      while ((match = colonPattern.exec(cleanText)) !== null) {\n        const front = match[1]?.trim();\n        const back = match[2]?.trim();\n        \n        if (front && back && front.length > 3 && back.length > 10) {\n          cards.push({\n            id: cards.length,\n            front: front,\n            back: back\n          });\n        }\n      }\n    }\n    \n    return cards;\n  }\n\n  private async extractStudyNotesFromHtml($: cheerio.CheerioAPI, url: string): Promise<ExtractedContent | null> {\n    try {\n      const title = $('title').text() || 'Extracted Study Notes';\n      \n      // Extract key points and content\n      const keyPoints: string[] = [];\n      const listItems = $('ul li, ol li, .key-point, .note, .highlight, .important');\n      \n      listItems.each((index, element) => {\n        const text = $(element).text().trim();\n        if (text && text.length > 10) {\n          keyPoints.push(text);\n        }\n      });\n\n      // Extract main content areas\n      const contentAreas = $('main, .content, .notes, article, .study-content, .summary');\n      const html = contentAreas.length > 0 ? contentAreas.html() || '' : $('body').html() || '';\n      \n      // If no structured content, extract from paragraphs\n      if (keyPoints.length === 0) {\n        $('p, h1, h2, h3, h4, h5, h6').each((index, element) => {\n          const text = $(element).text().trim();\n          if (text && text.length > 20) {\n            keyPoints.push(text);\n          }\n        });\n      }\n\n      if (keyPoints.length === 0) {\n        return null;\n      }\n\n      return {\n        type: 'study-notes',\n        title: title,\n        content: {\n          keyPoints: keyPoints.slice(0, 20), // Limit to 20 key points\n          html: html,\n          summary: `Study notes extracted from ${url}`,\n          extractedAt: new Date().toISOString(),\n          sourceUrl: url\n        }\n      };\n    } catch (error) {\n      console.error('Error extracting study notes from HTML:', error);\n      return null;\n    }\n  }\n\n  private async extractPodcastFromHtml($: cheerio.CheerioAPI, url: string): Promise<ExtractedContent | null> {\n    try {\n      // Extract title - QuizGecko uses h1 for lesson titles\n      let title = $('h1').first().text().trim() || $('title').text() || 'Extracted Lesson';\n      \n      // Extract lesson description - QuizGecko puts descriptions in specific areas\n      let description = '';\n      \n      // Look for description in various QuizGecko structures\n      const descElements = $('p:contains(\"This covers\"), p:contains(\"This lesson\"), p:contains(\"covers\"), .description, .summary, .lesson-description, .content-description');\n      if (descElements.length > 0) {\n        description = descElements.first().text().trim();\n      }\n      \n      // Extract section number from title (e.g., \"Â§101\", \"Section 101\")\n      const sectionMatch = title.match(/Â§?(\\d+)/);\n      const sectionNumber = sectionMatch ? sectionMatch[1] : null;\n      \n      // Look for question count\n      const questionMatch = $.html().match(/(\\d+)\\s*Questions?/i);\n      const questionCount = questionMatch ? parseInt(questionMatch[1]) : null;\n      \n      // Look for header image\n      const headerImage = $('img[src*=\"assets.content-delivery\"]').attr('src') || \n                         $('img[src*=\"cdn\"]').first().attr('src') || null;\n      \n      // Look for audio elements or embedded podcast content\n      const audioUrl = $('audio').attr('src') || $('source').attr('src') || \n                      $('[src*=\".mp3\"], [src*=\".wav\"], [src*=\".m4a\"]').attr('src') || null;\n      \n      // Create comprehensive transcript from available content\n      let transcript = '';\n      \n      if (description) {\n        transcript = `Louisiana State Plumbing Code Lesson: ${title}\n\n${description}`;\n        \n        if (questionCount) {\n          transcript += `\\n\\nThis lesson includes ${questionCount} questions to test your understanding.`;\n        }\n        \n        if (sectionNumber) {\n          transcript += `\\n\\nSection: ${sectionNumber}`;\n        }\n        \n        transcript += `\\n\\nExtracted from: ${url}`;\n      }\n\n      // If we have good content, create the lesson\n      if (title && (description || transcript.length > 50)) {\n        const formattedTranscript = transcript || `Audio lesson: ${title}\\n\\nExtracted from ${url}`;\n\n        return {\n          type: 'podcast',\n          title: title,\n          content: {\n            audioUrl: audioUrl,\n            transcript: formattedTranscript,\n            description: description || `Lesson content from ${title}`,\n            sectionNumber: sectionNumber,\n            questionCount: questionCount,\n            headerImage: headerImage,\n            extractedAt: new Date().toISOString(),\n            sourceUrl: url\n          },\n          duration: Math.ceil(formattedTranscript.length / 1000) // Rough estimate: 1 minute per 1000 chars\n        };\n      }\n\n      return null;\n    } catch (error) {\n      console.error('Error extracting podcast from HTML:', error);\n      return null;\n    }\n  }\n\n  private async extractChatFromHtml($: cheerio.CheerioAPI, url: string): Promise<ExtractedContent | null> {\n    try {\n      const title = $('title').text() || 'Extracted Chat Content';\n      \n      // Extract main content for chat/teaching material\n      const contentAreas = $('main, .content, .chat, article, .lesson, .teaching');\n      const html = contentAreas.length > 0 ? contentAreas.html() || '' : $('body').html() || '';\n      const textContent = contentAreas.length > 0 ? contentAreas.text() : $('body').text();\n\n      // Extract key topics and concepts\n      const topics: string[] = [];\n      $('h1, h2, h3, h4, h5, h6, .topic, .concept, .key-point').each((index, element) => {\n        const text = $(element).text().trim();\n        if (text && text.length > 5) {\n          topics.push(text);\n        }\n      });\n\n      if (textContent.trim().length < 50) {\n        return null;\n      }\n\n      // Format content for interactive chat/teaching\n      const chatContent = `\nContent extracted from ${url}\n\n${textContent.trim()}\n\nðŸ§  Key Topics Available:\n${topics.slice(0, 10).map(topic => `â€¢ ${topic}`).join('\\n')}\n\nThis content is available for interactive discussion and learning.\n      `.trim();\n\n      return {\n        type: 'chat',\n        title: title,\n        content: {\n          chatContent: chatContent,\n          html: html,\n          topics: topics.slice(0, 10),\n          extractedAt: new Date().toISOString(),\n          sourceUrl: url\n        }\n      };\n    } catch (error) {\n      console.error('Error extracting chat content from HTML:', error);\n      return null;\n    }\n  }\n\n  private createSampleContent(url: string, contentType: string): ExtractedContent {\n    const baseTitle = \"Louisiana Plumbing Code Administration\";\n    \n    switch (contentType) {\n      case 'lesson':\n        return {\n          type: 'lesson',\n          title: `${baseTitle} - Lesson`,\n          content: {\n            html: `\n              <div class=\"lesson-content\">\n                <h2>Louisiana State Plumbing Code Â§101 - Administration</h2>\n                <h3>Subchapter A. General</h3>\n                \n                <h4>Purpose and Scope</h4>\n                <p>This code establishes minimum requirements to safeguard life, property, and public welfare by regulating and controlling the design, construction, installation, alteration, repair, relocation, replacement, addition to, use or maintenance of plumbing systems.</p>\n                \n                <h4>Authority</h4>\n                <p>The Louisiana State Uniform Construction Code Council has the authority to administer and enforce this code. Local jurisdictions may adopt additional requirements that are more restrictive than this code.</p>\n                \n                <h4>Applicability</h4>\n                <ul>\n                  <li>New construction of plumbing systems</li>\n                  <li>Alterations to existing plumbing systems</li>\n                  <li>Repairs and maintenance of plumbing systems</li>\n                  <li>Replacement of plumbing fixtures and components</li>\n                </ul>\n                \n                <h4>Code Enforcement</h4>\n                <p>Code enforcement officials have the authority to:</p>\n                <ul>\n                  <li>Issue permits and conduct inspections</li>\n                  <li>Review and approve plans and specifications</li>\n                  <li>Issue stop-work orders for violations</li>\n                  <li>Require corrections to non-compliant work</li>\n                </ul>\n                \n                <h4>Permits Required</h4>\n                <p>Permits are required for most plumbing work including:</p>\n                <ul>\n                  <li>Installation of new plumbing systems</li>\n                  <li>Replacement of water heaters</li>\n                  <li>Sewer line repairs and replacements</li>\n                  <li>Gas line installations and modifications</li>\n                </ul>\n              </div>\n            `,\n            text: \"Louisiana State Plumbing Code Â§101 - Administration covers the purpose, scope, authority, and enforcement of plumbing regulations in Louisiana.\",\n            extractedAt: new Date().toISOString()\n          }\n        };\n\n      case 'quiz':\n        return {\n          type: 'quiz',\n          title: `${baseTitle} - Quiz`,\n          content: {\n            questions: [\n              {\n                id: 0,\n                question: \"What is the primary purpose of the Louisiana State Plumbing Code?\",\n                options: [\n                  { id: 0, text: \"To increase construction costs\", isCorrect: false },\n                  { id: 1, text: \"To safeguard life, property, and public welfare\", isCorrect: true },\n                  { id: 2, text: \"To limit plumbing installations\", isCorrect: false },\n                  { id: 3, text: \"To reduce the number of plumbers\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Section 101 establishes minimum requirements to safeguard life, property, and public welfare.\",\n                reference: \"Louisiana Plumbing Code Â§101.1\"\n              },\n              {\n                id: 1,\n                question: \"Who has the authority to administer and enforce the Louisiana Plumbing Code?\",\n                options: [\n                  { id: 0, text: \"Local plumbers\", isCorrect: false },\n                  { id: 1, text: \"Louisiana State Uniform Construction Code Council\", isCorrect: true },\n                  { id: 2, text: \"Building contractors\", isCorrect: false },\n                  { id: 3, text: \"Property owners\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"The Louisiana State Uniform Construction Code Council administers and enforces the code statewide.\",\n                reference: \"Louisiana Plumbing Code Â§101.2\"\n              },\n              {\n                id: 2,\n                question: \"Which of the following requires a permit under the Louisiana Plumbing Code?\",\n                options: [\n                  { id: 0, text: \"Unclogging a drain\", isCorrect: false },\n                  { id: 1, text: \"Replacing a faucet washer\", isCorrect: false },\n                  { id: 2, text: \"Installing a new water heater\", isCorrect: true },\n                  { id: 3, text: \"Cleaning a toilet\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Water heater installations are major plumbing work requiring permits and inspections.\",\n                reference: \"Louisiana Plumbing Code Â§101.4\"\n              },\n              {\n                id: 3,\n                question: \"What is the legal basis for Louisiana Plumbing Code enforcement?\",\n                options: [\n                  { id: 0, text: \"Municipal ordinances only\", isCorrect: false },\n                  { id: 1, text: \"Louisiana Revised Statute 36:258(B) and Title 40\", isCorrect: true },\n                  { id: 2, text: \"Federal building codes\", isCorrect: false },\n                  { id: 3, text: \"Insurance company requirements\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"R.S. 36:258(B) and Title 40 provide the statutory authority for code enforcement.\",\n                reference: \"Louisiana Revised Statutes 36:258(B)\"\n              },\n              {\n                id: 4,\n                question: \"When was the current Louisiana Plumbing Code originally promulgated?\",\n                options: [\n                  { id: 0, text: \"January 2000\", isCorrect: false },\n                  { id: 1, text: \"June 2002\", isCorrect: true },\n                  { id: 2, text: \"November 2012\", isCorrect: false },\n                  { id: 3, text: \"March 2015\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"The code was originally promulgated in June 2002, with amendments in November 2012.\",\n                reference: \"Louisiana Register Vol. 28, No. 6\"\n              },\n              {\n                id: 5,\n                question: \"What action can inspectors take when code violations are found?\",\n                options: [\n                  { id: 0, text: \"Only issue warnings\", isCorrect: false },\n                  { id: 1, text: \"Issue stop-work orders\", isCorrect: true },\n                  { id: 2, text: \"Immediately shut off utilities\", isCorrect: false },\n                  { id: 3, text: \"Call the police\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Inspectors have authority to issue stop-work orders requiring corrections before work continues.\",\n                reference: \"Louisiana Plumbing Code Â§101.3\"\n              },\n              {\n                id: 6,\n                question: \"Can local jurisdictions modify the Louisiana State Plumbing Code?\",\n                options: [\n                  { id: 0, text: \"No, they must follow it exactly\", isCorrect: false },\n                  { id: 1, text: \"Yes, but only to make it more restrictive\", isCorrect: true },\n                  { id: 2, text: \"Yes, they can make it less restrictive\", isCorrect: false },\n                  { id: 3, text: \"Only with state approval\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Local jurisdictions may adopt more restrictive requirements but cannot be less restrictive than state code.\",\n                reference: \"Louisiana Plumbing Code Â§101.2\"\n              },\n              {\n                id: 7,\n                question: \"Who can delegate plumbing inspection authority in Louisiana?\",\n                options: [\n                  { id: 0, text: \"The governor\", isCorrect: false },\n                  { id: 1, text: \"The state health officer\", isCorrect: true },\n                  { id: 2, text: \"Local mayors\", isCorrect: false },\n                  { id: 3, text: \"Building contractors\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"The state health officer has authority and can delegate inspection responsibilities to qualified local entities.\",\n                reference: \"Louisiana Revised Statutes Title 40\"\n              },\n              {\n                id: 8,\n                question: \"What is the minimum passing score for plumbing examinations under this code?\",\n                options: [\n                  { id: 0, text: \"60%\", isCorrect: false },\n                  { id: 1, text: \"70%\", isCorrect: true },\n                  { id: 2, text: \"80%\", isCorrect: false },\n                  { id: 3, text: \"85%\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"A minimum score of 70% is required to pass plumbing examinations in Louisiana.\",\n                reference: \"Louisiana Plumbing Code Â§101.5\"\n              },\n              {\n                id: 9,\n                question: \"Which of the following does NOT require a plumbing permit?\",\n                options: [\n                  { id: 0, text: \"Replacing a kitchen sink\", isCorrect: false },\n                  { id: 1, text: \"Clearing a clogged drain\", isCorrect: true },\n                  { id: 2, text: \"Installing a garbage disposal\", isCorrect: false },\n                  { id: 3, text: \"Relocating a gas line\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Minor maintenance work like clearing clogs does not require a permit.\",\n                reference: \"Louisiana Plumbing Code Â§101.4\"\n              },\n              {\n                id: 10,\n                question: \"What happens if work begins without a required permit?\",\n                options: [\n                  { id: 0, text: \"Work can continue with a warning\", isCorrect: false },\n                  { id: 1, text: \"Double permit fees may apply\", isCorrect: true },\n                  { id: 2, text: \"No penalty applies\", isCorrect: false },\n                  { id: 3, text: \"Only a verbal warning is given\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Working without a permit may result in double permit fees and stop-work orders.\",\n                reference: \"Louisiana Plumbing Code Â§101.6\"\n              },\n              {\n                id: 11,\n                question: \"How often must plumbing licenses be renewed in Louisiana?\",\n                options: [\n                  { id: 0, text: \"Every year\", isCorrect: true },\n                  { id: 1, text: \"Every two years\", isCorrect: false },\n                  { id: 2, text: \"Every three years\", isCorrect: false },\n                  { id: 3, text: \"Every five years\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Plumbing licenses in Louisiana must be renewed annually.\",\n                reference: \"Louisiana Plumbing Code Â§101.7\"\n              },\n              {\n                id: 12,\n                question: \"What documentation must be available during inspection?\",\n                options: [\n                  { id: 0, text: \"Only the permit\", isCorrect: false },\n                  { id: 1, text: \"Permit and approved plans\", isCorrect: true },\n                  { id: 2, text: \"Business license only\", isCorrect: false },\n                  { id: 3, text: \"Insurance certificate only\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Both the permit and approved plans must be readily available during any inspection.\",\n                reference: \"Louisiana Plumbing Code Â§101.8\"\n              },\n              {\n                id: 13,\n                question: \"What is the fee structure based on for plumbing permits?\",\n                options: [\n                  { id: 0, text: \"Time of year\", isCorrect: false },\n                  { id: 1, text: \"Scope and complexity of work\", isCorrect: true },\n                  { id: 2, text: \"Contractor's experience\", isCorrect: false },\n                  { id: 3, text: \"Property size only\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Permit fees are determined by the scope and complexity of the plumbing work being performed.\",\n                reference: \"Louisiana Plumbing Code Â§101.9\"\n              },\n              {\n                id: 14,\n                question: \"Which revision of the International Plumbing Code does Louisiana's code reference?\",\n                options: [\n                  { id: 0, text: \"2015 IPC\", isCorrect: false },\n                  { id: 1, text: \"2018 IPC\", isCorrect: true },\n                  { id: 2, text: \"2021 IPC\", isCorrect: false },\n                  { id: 3, text: \"2012 IPC\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Louisiana's code is based on the 2018 International Plumbing Code with state-specific amendments.\",\n                reference: \"Louisiana Plumbing Code Â§101.10\"\n              },\n              {\n                id: 15,\n                question: \"What constitutes a major alteration requiring plan review?\",\n                options: [\n                  { id: 0, text: \"Any change over $500\", isCorrect: false },\n                  { id: 1, text: \"Adding more than two fixtures\", isCorrect: true },\n                  { id: 2, text: \"Any residential work\", isCorrect: false },\n                  { id: 3, text: \"Emergency repairs only\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Major alterations, including adding more than two fixtures, require plan review and approval.\",\n                reference: \"Louisiana Plumbing Code Â§101.11\"\n              },\n              {\n                id: 16,\n                question: \"Who is responsible for scheduling inspections?\",\n                options: [\n                  { id: 0, text: \"The property owner\", isCorrect: false },\n                  { id: 1, text: \"The licensed plumber or permit holder\", isCorrect: true },\n                  { id: 2, text: \"The general contractor\", isCorrect: false },\n                  { id: 3, text: \"The code enforcement office\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"The licensed plumber or permit holder is responsible for scheduling required inspections.\",\n                reference: \"Louisiana Plumbing Code Â§101.12\"\n              },\n              {\n                id: 17,\n                question: \"What is the time frame for requesting inspection after completion?\",\n                options: [\n                  { id: 0, text: \"Same day\", isCorrect: false },\n                  { id: 1, text: \"Within 24 hours\", isCorrect: true },\n                  { id: 2, text: \"Within one week\", isCorrect: false },\n                  { id: 3, text: \"Within 30 days\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Inspections must be requested within 24 hours of completing the work phase.\",\n                reference: \"Louisiana Plumbing Code Â§101.13\"\n              },\n              {\n                id: 18,\n                question: \"What action can result in license suspension or revocation?\",\n                options: [\n                  { id: 0, text: \"Late permit application\", isCorrect: false },\n                  { id: 1, text: \"Willful code violations or unsafe practices\", isCorrect: true },\n                  { id: 2, text: \"Minor paperwork errors\", isCorrect: false },\n                  { id: 3, text: \"Customer complaints only\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Willful violations of the code or engaging in unsafe practices can result in license suspension or revocation.\",\n                reference: \"Louisiana Plumbing Code Â§101.14\"\n              },\n              {\n                id: 19,\n                question: \"What must be included in plumbing plan submissions?\",\n                options: [\n                  { id: 0, text: \"Cost estimates only\", isCorrect: false },\n                  { id: 1, text: \"Fixture locations, pipe sizes, and materials\", isCorrect: true },\n                  { id: 2, text: \"Contractor references\", isCorrect: false },\n                  { id: 3, text: \"Insurance information\", isCorrect: false }\n                ],\n                type: 'multiple-choice',\n                explanation: \"Plan submissions must include detailed information about fixture locations, pipe sizes, and materials to be used.\",\n                reference: \"Louisiana Plumbing Code Â§101.15\"\n              }\n            ],\n            totalQuestions: 20,\n            passingScore: 70,\n            extractedAt: new Date().toISOString()\n          }\n        };\n\n      case 'flashcards':\n        return {\n          type: 'flashcards',\n          title: `${baseTitle} - Flashcards`,\n          content: {\n            cards: [\n              {\n                id: 0,\n                front: \"What does Louisiana Plumbing Code Â§101 establish?\",\n                back: \"Minimum requirements to safeguard life, property, and public welfare through regulation of plumbing systems\"\n              },\n              {\n                id: 1,\n                front: \"Who administers the Louisiana State Plumbing Code?\",\n                back: \"Louisiana State Uniform Construction Code Council\"\n              },\n              {\n                id: 2,\n                front: \"Name three types of work that require permits\",\n                back: \"New plumbing installations, water heater replacements, sewer line repairs, gas line modifications\"\n              },\n              {\n                id: 3,\n                front: \"What authority do code enforcement officials have?\",\n                back: \"Issue permits, conduct inspections, review plans, issue stop-work orders, require corrections\"\n              },\n              {\n                id: 4,\n                front: \"What is the legal basis for Louisiana Plumbing Code enforcement?\",\n                back: \"Louisiana Revised Statute 36:258(B) and Title 40, which delegates authority to the state health officer\"\n              },\n              {\n                id: 5,\n                front: \"When was the current Louisiana Plumbing Code promulgated?\",\n                back: \"Originally promulgated June 2002, with amendments in November 2012\"\n              },\n              {\n                id: 6,\n                front: \"What happens when a code violation is found?\",\n                back: \"Inspector issues a stop-work order, requiring corrections before work can continue\"\n              },\n              {\n                id: 7,\n                front: \"Who can perform plumbing inspections in Louisiana?\",\n                back: \"Licensed plumbing inspectors certified by the state health officer or delegated local authorities\"\n              },\n              {\n                id: 8,\n                front: \"What is required before starting any plumbing work?\",\n                back: \"Valid permit issued by the local jurisdiction or state authority, with approved plans when required\"\n              },\n              {\n                id: 9,\n                front: \"How does local jurisdiction authority work with state code?\",\n                back: \"Local jurisdictions may adopt the state code or create more restrictive requirements, but cannot be less restrictive\"\n              },\n              {\n                id: 10,\n                front: \"What types of buildings are covered under Section 101?\",\n                back: \"All buildings and structures within Louisiana jurisdiction, including residential, commercial, and industrial\"\n              },\n              {\n                id: 11,\n                front: \"What documentation must be maintained during plumbing work?\",\n                back: \"Valid permits, approved plans, inspection records, and completion certificates\"\n              },\n              {\n                id: 12,\n                front: \"What is the role of the Department of Health and Hospitals?\",\n                back: \"Adopts and oversees Part XIV of the Sanitary Code, known as the Louisiana State Plumbing Code\"\n              },\n              {\n                id: 13,\n                front: \"Can the state health officer delegate enforcement authority?\",\n                back: \"Yes, authority can be delegated to local plumbing inspectors and other qualified entities\"\n              },\n              {\n                id: 14,\n                front: \"What Louisiana Register volumes contain the code history?\",\n                back: \"Vol. 28, No. 6 (June 2002 promulgation) and Vol. 38, No. 11 (November 2012 amendments)\"\n              },\n              {\n                id: 15,\n                front: \"What statutory sections provide the legal framework?\",\n                back: \"R.S. 40:4(A)(7) and R.S. 40:5(2), (3), (7), (9), (16), (17), and (20)\"\n              }\n            ],\n            totalCards: 16,\n            extractedAt: new Date().toISOString()\n          }\n        };\n\n      case 'study-notes':\n        return {\n          type: 'study-notes',\n          title: `${baseTitle} - Study Notes`,\n          content: {\n            keyPoints: [\n              \"Louisiana Plumbing Code Â§101 establishes minimum safety requirements\",\n              \"Code safeguards life, property, and public welfare\",\n              \"Louisiana State Uniform Construction Code Council has enforcement authority\",\n              \"Local jurisdictions can adopt more restrictive requirements\",\n              \"Permits required for most plumbing work\",\n              \"Code enforcement officials can issue stop-work orders\",\n              \"Applies to new construction, alterations, repairs, and replacements\"\n            ],\n            html: `\n              <div class=\"study-notes\">\n                <h3>Key Concepts - Louisiana Plumbing Code Administration</h3>\n                <div class=\"section\">\n                  <h4>Regulatory Framework</h4>\n                  <p>The Louisiana State Plumbing Code provides a comprehensive regulatory framework for plumbing systems throughout the state.</p>\n                </div>\n                <div class=\"section\">\n                  <h4>Enforcement Structure</h4>\n                  <p>The code creates a clear enforcement structure with defined roles for state and local authorities.</p>\n                </div>\n                <div class=\"section\">\n                  <h4>Permit Process</h4>\n                  <p>A systematic permit process ensures compliance with safety standards before, during, and after installation.</p>\n                </div>\n              </div>\n            `,\n            summary: \"Study notes covering the administrative framework of Louisiana's plumbing code\",\n            extractedAt: new Date().toISOString()\n          }\n        };\n\n      case 'podcast':\n        return {\n          type: 'podcast',\n          title: `${baseTitle} - Audio Lesson`,\n          content: {\n            audioUrl: null, // Would need actual audio content\n            transcript: `\n              Welcome to our Louisiana Plumbing Code series. Today we're covering Section 101 - Administration.\n              \n              The Louisiana State Plumbing Code Section 101 lays the foundation for all plumbing work in our state. This section is crucial because it defines who has authority, what requires permits, and how the code is enforced.\n              \n              First, let's talk about the purpose. The code exists to safeguard life, property, and public welfare. This isn't just bureaucracy - it's about ensuring that plumbing systems are safe and reliable.\n              \n              The Louisiana State Uniform Construction Code Council is the authority that administers this code statewide. However, local jurisdictions can adopt more restrictive requirements if they choose.\n              \n              When it comes to permits, most plumbing work requires one. This includes new installations, water heater replacements, sewer line work, and gas line modifications. Simple repairs like unclogging drains typically don't require permits.\n              \n              Code enforcement officials have significant authority. They can issue permits, conduct inspections, review plans, and even issue stop-work orders for violations.\n              \n              Understanding this administrative framework is essential for any plumbing professional working in Louisiana.\n            `,\n            description: \"Audio lesson covering Louisiana Plumbing Code administration requirements\",\n            extractedAt: new Date().toISOString()\n          },\n          duration: 8\n        };\n\n      case 'chat':\n        return {\n          type: 'chat',\n          title: `${baseTitle} - Interactive Chat`,\n          content: {\n            chatContent: `This section, Â§101, deals with the general administration of the Louisiana State Plumbing Code (LSPC). Essentially, it explains that the Department of Health and Hospitals has officially adopted Part XIV of the Sanitary Code, which is referred to as the Louisiana State Plumbing Code.\n\nThis code sets the standards for plumbing across the state.\n\nðŸ§  Key Concept: Louisiana State Plumbing Code (LSPC)\nThis is the official set of rules and regulations governing plumbing work in Louisiana, adopted by the state's Department of Health and Hospitals.\n\nKey Topics Available:\nâ€¢ Who enforces the LSPC?\nâ€¢ What is the legal basis for the LSPC?\nâ€¢ Historical notes about the code's adoption and amendments\nâ€¢ Enforcement authority and delegation\nâ€¢ Statutory authority (R.S. 36:258(B) and Title 40)\nâ€¢ Code promulgation history (June 2002, amended November 2012)\n\nEnforcement Authority:\nThe enforcement of the Louisiana State Plumbing Code (LSPC) falls under the authority of the state health officer. This individual is responsible for ensuring that the code's provisions are followed throughout Louisiana. However, the state health officer can also delegate this authority to local plumbing inspectors and other qualified entities.\n\nLegal Basis:\nThe legal foundation stems from Louisiana Revised Statutes (R.S.), primarily R.S. 36:258(B), with additional provisions in Chapters 1 and 4 of Title 40. The code is promulgated in accordance with R.S. 40:4(A)(7) and R.S. 40:5(2), (3), (7), (9), (16), (17), and (20).\n\nHistorical Notes:\n- Promulgated: June 2002 (Louisiana Register, Vol. 28, No. 6)\n- Amended: November 2012 (Louisiana Register, Vol. 38, No. 11)`,\n            html: `\n              <div class=\"chat-content\">\n                <h3>Louisiana State Plumbing Code Â§101 - Administration Overview</h3>\n                <div class=\"key-concept\">\n                  <h4>ðŸ§  Key Concept: Louisiana State Plumbing Code (LSPC)</h4>\n                  <p>This is the official set of rules and regulations governing plumbing work in Louisiana, adopted by the state's Department of Health and Hospitals.</p>\n                </div>\n                \n                <div class=\"topics\">\n                  <h4>Available Discussion Topics:</h4>\n                  <ul>\n                    <li>Who enforces the LSPC and delegation of authority</li>\n                    <li>Legal basis and statutory authority</li>\n                    <li>Historical notes and amendments</li>\n                    <li>Code enforcement responsibilities</li>\n                    <li>Violations and penalties</li>\n                  </ul>\n                </div>\n                \n                <div class=\"enforcement\">\n                  <h4>Enforcement Authority</h4>\n                  <p>The state health officer is primarily responsible for enforcing the LSPC, but this authority can be delegated to qualified individuals or entities at the local level.</p>\n                </div>\n                \n                <div class=\"legal-basis\">\n                  <h4>Legal Foundation</h4>\n                  <p>Based on Louisiana Revised Statutes, primarily R.S. 36:258(B) and Title 40, Chapters 1 and 4.</p>\n                </div>\n              </div>\n            `,\n            extractedAt: new Date().toISOString()\n          }\n        };\n\n      default:\n        return {\n          type: contentType as any,\n          title: `${baseTitle} - Content`,\n          content: {\n            html: `<p>Sample content for ${contentType} has been extracted and is ready for display.</p>`,\n            extractedAt: new Date().toISOString()\n          }\n        };\n    }\n  }\n}\n\nexport const contentExtractor = new ContentExtractor();","size_bytes":49812},"server/populate-chat-answers.ts":{"content":"import { storage } from \"./storage\";\n\nconst chatAnswers = [\n  {\n    question: \"Who enforces the Louisiana State Plumbing Code?\",\n    answer: \"The Louisiana State Plumbing Code (LSPC) is enforced by the **state health officer**, who has the primary responsibility for ensuring code compliance throughout Louisiana.\\n\\nKey points about enforcement:\\nâ€¢ The state health officer can **delegate this authority** to local plumbing inspectors\\nâ€¢ Local parishes and municipalities can have their own qualified enforcement officers\\nâ€¢ This delegation system ensures consistent code enforcement across different jurisdictions\\nâ€¢ Enforcement includes permit issuance, inspections, and violation corrections\",\n    keywords: [\"enforce\", \"enforces\", \"enforcement\", \"authority\", \"health officer\", \"delegate\"]\n  },\n  {\n    question: \"What is the legal basis for the Louisiana State Plumbing Code?\",\n    answer: \"The legal foundation for the Louisiana State Plumbing Code stems from specific **Louisiana Revised Statutes (R.S.)**:\\n\\n**Primary Authority:** R.S. 36:258(B)\\n**Additional Provisions:** Chapters 1 and 4 of Title 40\\n**Supporting Statutes:** R.S. 40:4(A)(7) and R.S. 40:5(2), (3), (7), (9), (16), (17), and (20)\\n\\nThe Department of Health and Hospitals officially adopted Part XIV of the Sanitary Code, which is referred to as the Louisiana State Plumbing Code.\",\n    keywords: [\"legal basis\", \"lspc\", \"statute\", \"statutes\", \"r.s.\", \"title 40\", \"sanitary code\"]\n  },\n  {\n    question: \"What are the historical notes about the Louisiana State Plumbing Code?\",\n    answer: \"**Historical Timeline of the Louisiana State Plumbing Code:**\\n\\nðŸ“… **June 2002:** Originally promulgated by the Department of Health and Hospitals, Office of Public Health\\nâ€¢ Published in Louisiana Register, Vol. 28, No. 6\\n\\nðŸ“… **November 2012:** Major amendments made\\nâ€¢ Published in Louisiana Register, Vol. 38, No. 11\\nâ€¢ Reference: LR 38:2795\\n\\nThis gives us the current version that's been in effect for over a decade with important updates from the 2012 amendments.\",\n    keywords: [\"historical\", \"history\", \"amendment\", \"amendments\", \"promulgate\", \"promulgated\", \"2002\", \"2012\"]\n  },\n  {\n    question: \"How does the enforcement authority delegation process work?\",\n    answer: \"**Enforcement Authority Delegation Process:**\\n\\nðŸ›ï¸ **Primary Authority:** State health officer\\nâ¬‡ï¸ **Can delegate to:**\\nâ€¢ Local plumbing inspectors\\nâ€¢ Parish enforcement officers\\nâ€¢ Municipal code officials\\nâ€¢ Other qualified entities\\n\\n**Benefits of delegation:**\\nâ€¢ Ensures local expertise and faster response\\nâ€¢ Maintains consistent statewide standards\\nâ€¢ Allows for regional enforcement adaptation\\nâ€¢ Creates accountability at multiple levels\",\n    keywords: [\"delegation\", \"delegate\", \"authority\", \"local\", \"parish\", \"municipal\"]\n  },\n  {\n    question: \"What about code violations and penalties?\",\n    answer: \"While Section 101 focuses on administration rather than specific violations, **code enforcement officials have authority to:**\\n\\nâš ï¸ **Issue stop-work orders** for non-compliant installations\\nðŸ“‹ **Require corrections** to meet code standards\\nðŸ” **Conduct inspections** at various project stages\\nðŸ“ **Review and approve plans** before work begins\\n\\nFor specific violation procedures and penalties, you would need to consult other sections of the Louisiana Plumbing Code that detail enforcement actions.\",\n    keywords: [\"violation\", \"violations\", \"penalties\", \"stop-work\", \"inspections\", \"corrections\"]\n  },\n  {\n    question: \"What are the key responsibilities of the state health officer?\",\n    answer: \"**Key Responsibilities of the State Health Officer:**\\n\\nðŸ‘¨â€âš–ï¸ **Primary Duties:**\\nâ€¢ Overall enforcement of the Louisiana State Plumbing Code\\nâ€¢ Delegation of authority to qualified local officials\\nâ€¢ Ensuring statewide code compliance\\nâ€¢ Oversight of local enforcement activities\\n\\nðŸ¤ **Delegation Powers:**\\nâ€¢ Can authorize local inspectors to enforce the code\\nâ€¢ Maintains oversight while allowing local implementation\\nâ€¢ Ensures consistent application across Louisiana\",\n    keywords: [\"responsibilities\", \"health officer\", \"duties\", \"oversight\", \"statewide\"]\n  },\n  {\n    question: \"How do local jurisdiction requirements work?\",\n    answer: \"**Local Jurisdiction Requirements:**\\n\\nðŸ›ï¸ **Local Authority:**\\nâ€¢ Can adopt **more restrictive** requirements than the state code\\nâ€¢ Cannot adopt **less restrictive** requirements\\nâ€¢ Must maintain consistency with Louisiana State Plumbing Code\\n\\nðŸ“‹ **Implementation:**\\nâ€¢ Local jurisdictions handle day-to-day enforcement\\nâ€¢ Issue permits and conduct inspections\\nâ€¢ Apply both state code and local amendments\\nâ€¢ Report to state health officer as needed\",\n    keywords: [\"local\", \"jurisdiction\", \"requirements\", \"restrictive\", \"permits\", \"amendments\"]\n  },\n  {\n    question: \"What is Section 101 about?\",\n    answer: \"**Louisiana Plumbing Code Section 101 - Administration** covers the foundational aspects of code management:\\n\\nðŸ“‹ **Key Topics:**\\nâ€¢ Enforcement authority and delegation\\nâ€¢ Legal basis and statutory foundation\\nâ€¢ Historical development and amendments\\nâ€¢ Administrative responsibilities\\nâ€¢ Local jurisdiction requirements\\n\\nThis section establishes who has authority to enforce the code, how that authority can be delegated, and the legal framework that supports the entire Louisiana State Plumbing Code system.\",\n    keywords: [\"section 101\", \"administration\", \"code management\", \"foundational\"]\n  }\n];\n\nexport async function populateChatAnswers() {\n  console.log(\"Populating chat answers...\");\n  \n  try {\n    // Check if answers already exist\n    const existing = await storage.getAllChatAnswers();\n    if (existing.length > 0) {\n      console.log(\"Chat answers already exist, skipping population\");\n      return;\n    }\n\n    // Create all answers\n    for (const answer of chatAnswers) {\n      await storage.createChatAnswer(answer);\n      console.log(`Added answer: ${answer.question}`);\n    }\n    \n    console.log(`Successfully populated ${chatAnswers.length} chat answers`);\n  } catch (error) {\n    console.error(\"Error populating chat answers:\", error);\n  }\n}","size_bytes":6227},"client/src/hooks/use-study-session.ts":{"content":"import { useState, useRef, useEffect } from 'react';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface StudySession {\n  id: string;\n  contentId: string;\n  contentType: string;\n  sessionStart: string;\n  sessionEnd?: string;\n  durationSeconds?: number;\n  completed: boolean;\n}\n\ninterface UseStudySessionOptions {\n  contentId: string;\n  contentType: 'lesson' | 'quiz' | 'flashcards' | 'chat' | 'podcast' | 'notes' | 'tools';\n  autoStart?: boolean;\n}\n\nexport function useStudySession({ contentId, contentType, autoStart = true }: UseStudySessionOptions) {\n  const [session, setSession] = useState<StudySession | null>(null);\n  const [elapsedTime, setElapsedTime] = useState(0);\n  const [isActive, setIsActive] = useState(false);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n  const startTimeRef = useRef<number | null>(null);\n\n  // Start a new study session\n  const startSession = async () => {\n    try {\n      const response = await apiRequest('POST', '/api/study-sessions/start', { contentId, contentType });\n      const newSession = await response.json();\n      \n      setSession(newSession);\n      setIsActive(true);\n      startTimeRef.current = Date.now();\n      setElapsedTime(0);\n      \n      // Start the timer\n      intervalRef.current = setInterval(() => {\n        if (startTimeRef.current) {\n          setElapsedTime(Math.floor((Date.now() - startTimeRef.current) / 1000));\n        }\n      }, 1000);\n      \n      return newSession;\n    } catch (error) {\n      console.error('Failed to start study session:', error);\n      return null;\n    }\n  };\n\n  // End the current study session\n  const endSession = async () => {\n    if (!session || !isActive) return null;\n\n    try {\n      const response = await apiRequest('POST', `/api/study-sessions/${session.id}/end`);\n      const completedSession = await response.json();\n      \n      setIsActive(false);\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n      \n      setSession(completedSession);\n      return completedSession;\n    } catch (error) {\n      console.error('Failed to end study session:', error);\n      return null;\n    }\n  };\n\n  // Pause the timer (without ending the session)\n  const pauseTimer = () => {\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current);\n      intervalRef.current = null;\n    }\n    setIsActive(false);\n  };\n\n  // Resume the timer\n  const resumeTimer = () => {\n    if (!session || isActive) return;\n    \n    setIsActive(true);\n    startTimeRef.current = Date.now() - (elapsedTime * 1000);\n    \n    intervalRef.current = setInterval(() => {\n      if (startTimeRef.current) {\n        setElapsedTime(Math.floor((Date.now() - startTimeRef.current) / 1000));\n      }\n    }, 1000);\n  };\n\n  // Format elapsed time as HH:MM:SS\n  const formatTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    \n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Auto-start session if enabled\n  useEffect(() => {\n    if (autoStart && !session) {\n      startSession();\n    }\n  }, [contentId, contentType, autoStart]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, []);\n\n  // Auto-end session when leaving the page\n  useEffect(() => {\n    const handleBeforeUnload = () => {\n      if (session && isActive) {\n        // Use navigator.sendBeacon for reliable cleanup\n        navigator.sendBeacon(`/api/study-sessions/${session.id}/end`, '{}');\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [session, isActive]);\n\n  return {\n    session,\n    elapsedTime,\n    isActive,\n    formattedTime: formatTime(elapsedTime),\n    startSession,\n    endSession,\n    pauseTimer,\n    resumeTimer,\n  };\n}","size_bytes":4175},"client/src/components/referral-inviter.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/hooks/use-toast';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Mail, Send, Users, Gift } from 'lucide-react';\n\nexport function ReferralInviter() {\n  const [email, setEmail] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const { toast } = useToast();\n\n  const sendInvitationMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const response = await apiRequest('POST', '/api/referrals/send-invitation', { email });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: 'Referral Sent!',\n        description: `Invitation sent successfully to ${email}. Your referral code: ${data.referralCode}`,\n      });\n      setEmail('');\n      setIsOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Failed to Send',\n        description: error.message || 'Could not send referral invitation. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleSendInvitation = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email.trim()) {\n      toast({\n        title: 'Email Required',\n        description: 'Please enter an email address to send the invitation.',\n        variant: 'destructive',\n      });\n      return;\n    }\n    \n    if (!email.includes('@')) {\n      toast({\n        title: 'Invalid Email',\n        description: 'Please enter a valid email address.',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    sendInvitationMutation.mutate(email.trim());\n  };\n\n  if (!isOpen) {\n    return (\n      <Card className=\"border-primary/20\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center\">\n              <Gift className=\"w-6 h-6 text-primary\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-foreground\">Refer Friends & Earn</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Help others advance their plumbing careers and earn rewards\n              </p>\n            </div>\n            <Button onClick={() => setIsOpen(true)} data-testid=\"open-referral-inviter\">\n              <Users className=\"w-4 h-4 mr-2\" />\n              Invite Friends\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"border-primary/20\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center space-x-2\">\n          <Mail className=\"w-5 h-5\" />\n          <span>Send Referral Invitation</span>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleSendInvitation} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"referral-email\">Email Address</Label>\n            <Input\n              id=\"referral-email\"\n              type=\"email\"\n              placeholder=\"friend@example.com\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              data-testid=\"referral-email-input\"\n            />\n          </div>\n          \n          <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <h4 className=\"font-medium text-blue-900 dark:text-blue-100 mb-2\">What they'll receive:</h4>\n            <ul className=\"text-sm text-blue-700 dark:text-blue-300 space-y-1\">\n              <li>â€¢ Professional invitation email with your referral code</li>\n              <li>â€¢ Access to Louisiana Plumbing Code certification course</li>\n              <li>â€¢ Professional tools and AI-powered assistance</li>\n              <li>â€¢ Special benefits for being referred by you</li>\n            </ul>\n          </div>\n\n          <div className=\"flex space-x-2\">\n            <Button\n              type=\"submit\"\n              disabled={sendInvitationMutation.isPending}\n              className=\"flex-1\"\n              data-testid=\"send-referral-button\"\n            >\n              <Send className=\"w-4 h-4 mr-2\" />\n              {sendInvitationMutation.isPending ? 'Sending...' : 'Send Invitation'}\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => {\n                setIsOpen(false);\n                setEmail('');\n              }}\n              data-testid=\"cancel-referral-button\"\n            >\n              Cancel\n            </Button>\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport function ContactSupport() {\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    subject: '',\n    message: '',\n  });\n  const [isOpen, setIsOpen] = useState(false);\n  const { toast } = useToast();\n\n  const contactSupportMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest('POST', '/api/support/contact', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Message Sent!',\n        description: 'Your support request has been sent. We\\'ll get back to you soon.',\n      });\n      setFormData({ name: '', email: '', subject: '', message: '' });\n      setIsOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Failed to Send',\n        description: error.message || 'Could not send support request. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.name || !formData.email || !formData.subject || !formData.message) {\n      toast({\n        title: 'All Fields Required',\n        description: 'Please fill in all fields before sending.',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    contactSupportMutation.mutate(formData);\n  };\n\n  if (!isOpen) {\n    return (\n      <Card className=\"border-orange-200 dark:border-orange-800\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"w-12 h-12 bg-orange-100 dark:bg-orange-900/20 rounded-full flex items-center justify-center\">\n              <Mail className=\"w-6 h-6 text-orange-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-foreground\">Need Help?</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Contact our support team for assistance\n              </p>\n            </div>\n            <Button variant=\"outline\" onClick={() => setIsOpen(true)} data-testid=\"open-contact-support\">\n              <Mail className=\"w-4 h-4 mr-2\" />\n              Contact Support\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"border-orange-200 dark:border-orange-800\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center space-x-2\">\n          <Mail className=\"w-5 h-5\" />\n          <span>Contact Support</span>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"support-name\">Name</Label>\n              <Input\n                id=\"support-name\"\n                placeholder=\"Your name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                data-testid=\"support-name-input\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"support-email\">Email</Label>\n              <Input\n                id=\"support-email\"\n                type=\"email\"\n                placeholder=\"your@email.com\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                data-testid=\"support-email-input\"\n              />\n            </div>\n          </div>\n          \n          <div className=\"space-y-2\">\n            <Label htmlFor=\"support-subject\">Subject</Label>\n            <Input\n              id=\"support-subject\"\n              placeholder=\"What do you need help with?\"\n              value={formData.subject}\n              onChange={(e) => setFormData({ ...formData, subject: e.target.value })}\n              data-testid=\"support-subject-input\"\n            />\n          </div>\n          \n          <div className=\"space-y-2\">\n            <Label htmlFor=\"support-message\">Message</Label>\n            <Textarea\n              id=\"support-message\"\n              placeholder=\"Please describe your issue or question...\"\n              className=\"min-h-[120px]\"\n              value={formData.message}\n              onChange={(e) => setFormData({ ...formData, message: e.target.value })}\n              data-testid=\"support-message-input\"\n            />\n          </div>\n\n          <div className=\"flex space-x-2\">\n            <Button\n              type=\"submit\"\n              disabled={contactSupportMutation.isPending}\n              className=\"flex-1\"\n              data-testid=\"send-support-button\"\n            >\n              <Send className=\"w-4 h-4 mr-2\" />\n              {contactSupportMutation.isPending ? 'Sending...' : 'Send Message'}\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => {\n                setIsOpen(false);\n                setFormData({ name: '', email: '', subject: '', message: '' });\n              }}\n              data-testid=\"cancel-support-button\"\n            >\n              Cancel\n            </Button>\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":10256},"server/email.ts":{"content":"import nodemailer from 'nodemailer';\n\n// Email service configuration\nexport class EmailService {\n  private supportTransporter: nodemailer.Transporter;\n  private referralTransporter: nodemailer.Transporter;\n  private noreplyTransporter: nodemailer.Transporter;\n\n  constructor() {\n    // Support email transporter\n    this.supportTransporter = nodemailer.createTransport({\n      host: 'mail.privateemail.com', // Namecheap SMTP\n      port: 587,\n      secure: false,\n      auth: {\n        user: process.env.SUPPORT_USER || process.env.SUPPORT_EMAIL,\n        pass: process.env.SUPPORT_PASS,\n      },\n    });\n\n    // Referral email transporter\n    this.referralTransporter = nodemailer.createTransport({\n      host: 'mail.privateemail.com',\n      port: 587,\n      secure: false,\n      auth: {\n        user: process.env.REFERRALS_USER || process.env.REFERRALS_FROM,\n        pass: process.env.REFERRALS_PASS,\n      },\n    });\n\n    // No-reply email transporter\n    this.noreplyTransporter = nodemailer.createTransport({\n      host: 'mail.privateemail.com',\n      port: 587,\n      secure: false,\n      auth: {\n        user: process.env.NOREPLY_USER,\n        pass: process.env.NOREPLY_PASS,\n      },\n    });\n  }\n\n  // Send referral invitation email\n  async sendReferralInvitation(params: {\n    toEmail: string;\n    referrerName: string;\n    referralCode: string;\n    referralLink: string;\n  }) {\n    const { toEmail, referrerName, referralCode, referralLink } = params;\n    \n    const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center;\">\n          <h1 style=\"margin: 0; font-size: 28px;\">ðŸ”§ LA Plumb Prep</h1>\n          <p style=\"margin: 10px 0 0 0; font-size: 16px;\">Louisiana Plumbing Code Certification</p>\n        </div>\n        \n        <div style=\"padding: 30px; background: #f9f9f9;\">\n          <h2 style=\"color: #333; margin-bottom: 20px;\">You're Invited to Join LA Plumb Prep!</h2>\n          \n          <p style=\"font-size: 16px; line-height: 1.6; color: #555;\">\n            <strong>${referrerName}</strong> has invited you to join LA Plumb Prep - Louisiana's premier plumbing certification preparation platform.\n          </p>\n          \n          <div style=\"background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; margin: 20px 0;\">\n            <h3 style=\"color: #667eea; margin-top: 0;\">What You'll Get:</h3>\n            <ul style=\"color: #555; line-height: 1.8;\">\n              <li>Complete Louisiana Plumbing Code preparation course</li>\n              <li>Interactive quizzes and practice tests</li>\n              <li>Professional plumbing tools and calculators</li>\n              <li>AI-powered mentor and code checker</li>\n              <li>Study guides and flashcards</li>\n              <li>Job board with Louisiana plumbing opportunities</li>\n            </ul>\n          </div>\n          \n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${referralLink}\" \n               style=\"display: inline-block; background: #667eea; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px;\">\n              Get Started with Code: ${referralCode}\n            </a>\n          </div>\n          \n          <p style=\"font-size: 14px; color: #666; margin-top: 30px;\">\n            Use referral code <strong>${referralCode}</strong> when signing up to get special benefits and support your referrer!\n          </p>\n        </div>\n        \n        <div style=\"background: #333; color: #ccc; padding: 20px; text-align: center; font-size: 12px;\">\n          <p>Â© 2025 LA Plumb Prep. All rights reserved.</p>\n          <p>Official Louisiana State Prep Course | laplumbprep.com</p>\n        </div>\n      </div>\n    `;\n\n    await this.referralTransporter.sendMail({\n      from: `\"LA Plumb Prep Referrals\" <${process.env.REFERRALS_FROM}>`,\n      to: toEmail,\n      subject: `${referrerName} invited you to LA Plumb Prep - Louisiana Plumbing Certification`,\n      html: htmlContent,\n    });\n  }\n\n  // Send welcome email to new users\n  async sendWelcomeEmail(params: {\n    toEmail: string;\n    firstName: string;\n    loginLink: string;\n  }) {\n    const { toEmail, firstName, loginLink } = params;\n    \n    const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center;\">\n          <h1 style=\"margin: 0; font-size: 28px;\">ðŸŽ‰ Welcome to LA Plumb Prep!</h1>\n        </div>\n        \n        <div style=\"padding: 30px; background: #f9f9f9;\">\n          <h2 style=\"color: #333;\">Welcome, ${firstName}!</h2>\n          \n          <p style=\"font-size: 16px; line-height: 1.6; color: #555;\">\n            You're now part of Louisiana's premier plumbing certification preparation platform. We're excited to help you advance your plumbing career!\n          </p>\n          \n          <div style=\"background: white; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n            <h3 style=\"color: #667eea; margin-top: 0;\">Your Journey Starts Here:</h3>\n            <ol style=\"color: #555; line-height: 1.8;\">\n              <li>Complete your profile and choose your subscription</li>\n              <li>Start with Section 101 - Administration</li>\n              <li>Work through all course materials systematically</li>\n              <li>Use our professional tools for real-world practice</li>\n              <li>Take practice quizzes to test your knowledge</li>\n            </ol>\n          </div>\n          \n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${loginLink}\" \n               style=\"display: inline-block; background: #667eea; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px;\">\n              Access Your Dashboard\n            </a>\n          </div>\n          \n          <p style=\"font-size: 14px; color: #666;\">\n            Need help? Contact our support team at support@laplumbprep.com\n          </p>\n        </div>\n        \n        <div style=\"background: #333; color: #ccc; padding: 20px; text-align: center; font-size: 12px;\">\n          <p>Â© 2025 LA Plumb Prep. All rights reserved.</p>\n        </div>\n      </div>\n    `;\n\n    await this.noreplyTransporter.sendMail({\n      from: `\"LA Plumb Prep\" <${process.env.NOREPLY_USER}>`,\n      to: toEmail,\n      subject: 'Welcome to LA Plumb Prep - Let\\'s Get Started!',\n      html: htmlContent,\n    });\n  }\n\n  // Send support notification\n  async sendSupportNotification(params: {\n    fromEmail: string;\n    fromName: string;\n    subject: string;\n    message: string;\n    userInfo?: any;\n  }) {\n    const { fromEmail, fromName, subject, message, userInfo } = params;\n    \n    const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #333;\">New Support Request</h2>\n        \n        <div style=\"background: #f9f9f9; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n          <p><strong>From:</strong> ${fromName} (${fromEmail})</p>\n          <p><strong>Subject:</strong> ${subject}</p>\n          ${userInfo ? `<p><strong>User Info:</strong> ${JSON.stringify(userInfo, null, 2)}</p>` : ''}\n        </div>\n        \n        <div style=\"background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px;\">\n          <h3>Message:</h3>\n          <p style=\"white-space: pre-wrap;\">${message}</p>\n        </div>\n      </div>\n    `;\n\n    await this.supportTransporter.sendMail({\n      from: `\"LA Plumb Prep Support\" <${process.env.SUPPORT_EMAIL}>`,\n      to: process.env.SUPPORT_EMAIL,\n      replyTo: fromEmail,\n      subject: `[Support] ${subject}`,\n      html: htmlContent,\n    });\n  }\n\n  // Send course completion certificate\n  async sendCompletionCertificate(params: {\n    toEmail: string;\n    firstName: string;\n    lastName: string;\n    courseName: string;\n    completionDate: string;\n    certificateUrl?: string;\n  }) {\n    const { toEmail, firstName, lastName, courseName, completionDate, certificateUrl } = params;\n    \n    const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center;\">\n          <h1 style=\"margin: 0; font-size: 28px;\">ðŸ† Congratulations!</h1>\n          <p style=\"margin: 10px 0 0 0; font-size: 16px;\">Course Completion Certificate</p>\n        </div>\n        \n        <div style=\"padding: 30px; background: #f9f9f9;\">\n          <h2 style=\"color: #333;\">Well Done, ${firstName}!</h2>\n          \n          <p style=\"font-size: 16px; line-height: 1.6; color: #555;\">\n            You have successfully completed <strong>${courseName}</strong> on ${completionDate}.\n          </p>\n          \n          <div style=\"background: white; padding: 20px; border-radius: 8px; border: 2px solid #667eea; margin: 20px 0; text-align: center;\">\n            <h3 style=\"color: #667eea; margin-top: 0;\">Certificate of Completion</h3>\n            <p style=\"font-size: 18px; color: #333;\"><strong>${firstName} ${lastName}</strong></p>\n            <p style=\"color: #666;\">has successfully completed</p>\n            <p style=\"font-size: 20px; color: #667eea; font-weight: bold;\">${courseName}</p>\n            <p style=\"color: #666;\">on ${completionDate}</p>\n          </div>\n          \n          ${certificateUrl ? `\n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${certificateUrl}\" \n               style=\"display: inline-block; background: #667eea; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px;\">\n              Download Certificate\n            </a>\n          </div>\n          ` : ''}\n          \n          <p style=\"font-size: 14px; color: #666;\">\n            Keep learning and advancing your plumbing career with LA Plumb Prep!\n          </p>\n        </div>\n        \n        <div style=\"background: #333; color: #ccc; padding: 20px; text-align: center; font-size: 12px;\">\n          <p>Â© 2025 LA Plumb Prep. All rights reserved.</p>\n        </div>\n      </div>\n    `;\n\n    await this.noreplyTransporter.sendMail({\n      from: `\"LA Plumb Prep\" <${process.env.NOREPLY_USER}>`,\n      to: toEmail,\n      subject: `ðŸ† Course Completion Certificate - ${courseName}`,\n      html: htmlContent,\n    });\n  }\n\n  // General purpose email sending method\n  async sendEmail(params: {\n    to: string;\n    subject: string;\n    html: string;\n    from?: string;\n  }) {\n    const { to, subject, html, from } = params;\n    \n    await this.noreplyTransporter.sendMail({\n      from: from || `\"LA Plumb Prep\" <${process.env.NOREPLY_USER}>`,\n      to: to,\n      subject: subject,\n      html: html,\n    });\n  }\n}\n\n// Create singleton instance\nexport const emailService = new EmailService();","size_bytes":11132},"client/src/pages/product-detail.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useRoute } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Star, ExternalLink, ChevronLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\n// Amazon affiliate utility\nconst buildAmazonUrl = (productName: string, price: string) => {\n  const searchTerm = encodeURIComponent(productName);\n  return `https://www.amazon.com/s?k=${searchTerm}&tag=laplumbprep-20&linkCode=ur2&linkId=${Math.random().toString(36).substring(2)}&camp=1789&creative=9325`;\n};\n\nexport default function ProductDetail() {\n  const [, params] = useRoute(\"/store/product/:id\");\n\n  const { data: product, isLoading } = useQuery({\n    queryKey: [\"/api/products\", params?.id],\n    queryFn: async () => {\n      const response = await fetch(`/api/products/${params?.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch product\");\n      return response.json();\n    },\n    enabled: !!params?.id,\n  });\n\n  const { data: reviews } = useQuery({\n    queryKey: [\"/api/products\", params?.id, \"reviews\"],\n    queryFn: async () => {\n      const response = await fetch(`/api/products/${params?.id}/reviews`);\n      if (!response.ok) throw new Error(\"Failed to fetch reviews\");\n      return response.json();\n    },\n    enabled: !!params?.id,\n  });\n\n\n  const renderStars = (rating: number) => {\n    return Array.from({ length: 5 }, (_, i) => (\n      <Star\n        key={i}\n        className={`w-5 h-5 ${\n          i < Math.floor(rating) ? \"fill-yellow-400 text-yellow-400\" : \"text-gray-300\"\n        }`}\n      />\n    ));\n  };\n\n  const formatPrice = (price: string) => {\n    return `$${parseFloat(price).toFixed(2)}`;\n  };\n\n  const handleBuyOnAmazon = () => {\n    if (product) {\n      window.open(buildAmazonUrl(product.name, product.price), \"_blank\", \"noopener,noreferrer\");\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <div className=\"animate-pulse\">\n            <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-8\"></div>\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n              <div className=\"h-96 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n              <div className=\"space-y-4\">\n                <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-3/4\"></div>\n                <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2\"></div>\n                <div className=\"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/4\"></div>\n                <div className=\"h-32 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!product) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <div className=\"text-center py-12\">\n            <h2 className=\"text-2xl font-semibold text-gray-900 dark:text-white mb-4\">\n              Product not found\n            </h2>\n            <Link href=\"/store\">\n              <Button>Back to Store</Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Breadcrumb */}\n        <div className=\"mb-8\">\n          <Link href=\"/store\" className=\"inline-flex items-center text-blue-600 hover:text-blue-700\" data-testid=\"back-to-store\">\n            <ChevronLeft className=\"w-4 h-4 mr-1\" />\n            Back to Store\n          </Link>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n          {/* Product Image */}\n          <div className=\"space-y-4\">\n            <div className=\"relative overflow-hidden rounded-lg bg-white dark:bg-gray-800 p-4\">\n              <img\n                src={product.imageUrl || \"/api/placeholder/600/400\"}\n                alt={product.name}\n                className=\"w-full h-96 object-contain\"\n                data-testid=\"product-image-large\"\n              />\n              {product.isFeatured && (\n                <Badge className=\"absolute top-6 left-6 bg-blue-600 text-white\" data-testid=\"featured-badge\">\n                  Featured\n                </Badge>\n              )}\n            </div>\n          </div>\n\n          {/* Product Info */}\n          <div className=\"space-y-6\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-4\" data-testid=\"product-title\">\n                {product.name}\n              </h1>\n              \n              {/* Rating */}\n              <div className=\"flex items-center gap-4 mb-4\">\n                <div className=\"flex items-center\" data-testid=\"product-rating\">\n                  {renderStars(parseFloat(product.rating || \"0\"))}\n                </div>\n                <span className=\"text-sm text-gray-500\" data-testid=\"review-count\">\n                  {product.reviewCount || 0} reviews\n                </span>\n                {product.brand && (\n                  <Badge variant=\"outline\" data-testid=\"product-brand\">\n                    {product.brand}\n                  </Badge>\n                )}\n              </div>\n\n              {/* Price */}\n              <div className=\"flex items-center gap-4 mb-6\">\n                <span className=\"text-3xl font-bold text-blue-600\" data-testid=\"product-price\">\n                  {formatPrice(product.price)}\n                </span>\n                {product.originalPrice && parseFloat(product.originalPrice) > parseFloat(product.price) && (\n                  <span className=\"text-xl text-gray-500 line-through\" data-testid=\"original-price\">\n                    {formatPrice(product.originalPrice)}\n                  </span>\n                )}\n              </div>\n\n              {/* Description */}\n              <p className=\"text-gray-600 dark:text-gray-300 mb-6\" data-testid=\"product-description\">\n                {product.description}\n              </p>\n\n              {/* Features */}\n              {product.features && product.features.length > 0 && (\n                <div className=\"mb-6\">\n                  <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3\" data-testid=\"features-title\">\n                    Key Features\n                  </h3>\n                  <ul className=\"space-y-2\" data-testid=\"features-list\">\n                    {product.features.map((feature: string, index: number) => (\n                      <li key={index} className=\"flex items-start gap-2 text-gray-600 dark:text-gray-300\">\n                        <span className=\"w-1.5 h-1.5 bg-blue-600 rounded-full mt-2 flex-shrink-0\"></span>\n                        {feature}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              {/* Shop on Amazon */}\n              <div className=\"mb-6\">\n                <Button\n                  onClick={handleBuyOnAmazon}\n                  size=\"lg\"\n                  className=\"w-full\"\n                  data-testid=\"shop-on-amazon-button\"\n                >\n                  <ExternalLink className=\"w-5 h-5 mr-2\" />\n                  Shop on Amazon\n                </Button>\n                <p className=\"text-sm text-gray-500 mt-2 text-center\">\n                  Redirects to Amazon with our affiliate partnership\n                </p>\n              </div>\n\n              {/* Category */}\n              <div className=\"mb-6\">\n                <span className=\"text-sm text-gray-500\">Category: </span>\n                <Badge variant=\"secondary\" data-testid=\"product-category\">\n                  {product.category.replace(/_/g, \" \").replace(/\\b\\w/g, (l: string) => l.toUpperCase())}\n                </Badge>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Specifications */}\n        {product.specifications && (\n          <Card className=\"mb-8\">\n            <CardHeader>\n              <CardTitle data-testid=\"specifications-title\">Specifications</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\" data-testid=\"specifications-grid\">\n                {Object.entries(product.specifications).map(([key, value]) => (\n                  <div key={key} className=\"flex justify-between py-2 border-b border-gray-200 dark:border-gray-700\">\n                    <span className=\"font-medium text-gray-900 dark:text-white\">\n                      {key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}\n                    </span>\n                    <span className=\"text-gray-600 dark:text-gray-300\">{value as string}</span>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Reviews */}\n        {reviews && reviews.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle data-testid=\"reviews-title\">\n                Customer Reviews ({reviews.length})\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6\" data-testid=\"reviews-list\">\n                {reviews.map((review: any) => (\n                  <div key={review.id} className=\"border-b border-gray-200 dark:border-gray-700 pb-6 last:border-b-0\">\n                    <div className=\"flex items-center gap-4 mb-2\">\n                      <div className=\"flex items-center\" data-testid=\"review-rating\">\n                        {renderStars(review.rating)}\n                      </div>\n                      <span className=\"font-medium text-gray-900 dark:text-white\">\n                        {review.title}\n                      </span>\n                    </div>\n                    <p className=\"text-gray-600 dark:text-gray-300 mb-2\" data-testid=\"review-comment\">\n                      {review.comment}\n                    </p>\n                    <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                      <span>By {review.user?.firstName || \"Anonymous\"}</span>\n                      <span>â€¢</span>\n                      <span>{new Date(review.createdAt).toLocaleDateString()}</span>\n                      {review.isVerifiedPurchase && (\n                        <>\n                          <span>â€¢</span>\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            Verified Purchase\n                          </Badge>\n                        </>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":10982},"client/src/pages/store.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Star, Search, ExternalLink } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\n// Amazon affiliate utility\nconst buildAmazonUrl = (productName: string, price: string) => {\n  const searchTerm = encodeURIComponent(productName);\n  return `https://www.amazon.com/s?k=${searchTerm}&tag=laplumbprep-20&linkCode=ur2&linkId=${Math.random().toString(36).substring(2)}&camp=1789&creative=9325`;\n};\n\nexport default function Store() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [category, setCategory] = useState(\"\");\n  const [page, setPage] = useState(1);\n\n  const { data: productsData, isLoading } = useQuery({\n    queryKey: [\"/api/products\", { search: searchTerm, category, page }],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (searchTerm) params.set(\"search\", searchTerm);\n      if (category && category !== \"all\") params.set(\"category\", category);\n      params.set(\"page\", page.toString());\n      params.set(\"limit\", \"12\");\n      \n      const response = await fetch(`/api/products?${params}`);\n      if (!response.ok) throw new Error(\"Failed to fetch products\");\n      return response.json();\n    },\n  });\n\n\n  const { data: featuredProducts } = useQuery({\n    queryKey: [\"/api/products/featured\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/products/featured?limit=4\");\n      if (!response.ok) throw new Error(\"Failed to fetch featured products\");\n      return response.json();\n    },\n  });\n\n  const categories = [\n    { value: \"gas_detection\", label: \"Gas Detection\" },\n    { value: \"pipe_tools\", label: \"Pipe Tools\" },\n    { value: \"measuring\", label: \"Measuring Tools\" },\n    { value: \"safety\", label: \"Safety Equipment\" },\n    { value: \"valves\", label: \"Valves\" },\n    { value: \"fittings\", label: \"Fittings\" },\n    { value: \"books\", label: \"Books & Manuals\" },\n    { value: \"training_materials\", label: \"Training Materials\" },\n  ];\n\n  const renderStars = (rating: number) => {\n    return Array.from({ length: 5 }, (_, i) => (\n      <Star\n        key={i}\n        className={`w-4 h-4 ${\n          i < Math.floor(rating) ? \"fill-yellow-400 text-yellow-400\" : \"text-gray-300\"\n        }`}\n      />\n    ));\n  };\n\n  const formatPrice = (price: string) => {\n    return `$${parseFloat(price).toFixed(2)}`;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <div className=\"animate-pulse space-y-8\">\n            <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4\"></div>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n              {Array.from({ length: 8 }, (_, i) => (\n                <div key={i} className=\"bg-white dark:bg-gray-800 rounded-lg p-4 space-y-4\">\n                  <div className=\"h-48 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n                  <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4\"></div>\n                  <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-4\" data-testid=\"store-title\">\n            Professional Plumbing Tools & Equipment\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"store-description\">\n            Discover high-quality tools and equipment recommended by Louisiana plumbing professionals\n          </p>\n        </div>\n\n        {/* Featured Products */}\n        {featuredProducts && featuredProducts.length > 0 && (\n          <div className=\"mb-12\">\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-6\" data-testid=\"featured-title\">\n              Featured Products\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {featuredProducts.map((product: any) => (\n                <Card key={product.id} className=\"group hover:shadow-lg transition-shadow\" data-testid={`featured-product-${product.id}`}>\n                  <CardHeader className=\"p-0\">\n                    <div className=\"relative overflow-hidden rounded-t-lg\">\n                      <img\n                        src={product.imageUrl || \"/api/placeholder/300/200\"}\n                        alt={product.name}\n                        className=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\"\n                        data-testid=\"product-image\"\n                      />\n                      <Badge className=\"absolute top-2 left-2 bg-blue-600 text-white\" data-testid=\"featured-badge\">\n                        Featured\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"p-4\">\n                    <CardTitle className=\"text-lg mb-2 line-clamp-2\" data-testid=\"product-name\">\n                      {product.name}\n                    </CardTitle>\n                    <p className=\"text-gray-600 dark:text-gray-300 text-sm mb-3 line-clamp-2\" data-testid=\"product-description\">\n                      {product.shortDescription || product.description}\n                    </p>\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <div className=\"flex items-center\" data-testid=\"product-rating\">\n                        {renderStars(parseFloat(product.rating || \"0\"))}\n                      </div>\n                      <span className=\"text-sm text-gray-500\" data-testid=\"review-count\">\n                        ({product.reviewCount || 0})\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-xl font-bold text-blue-600\" data-testid=\"product-price\">\n                        {formatPrice(product.price)}\n                      </span>\n                      {product.originalPrice && parseFloat(product.originalPrice) > parseFloat(product.price) && (\n                        <span className=\"text-sm text-gray-500 line-through\" data-testid=\"original-price\">\n                          {formatPrice(product.originalPrice)}\n                        </span>\n                      )}\n                    </div>\n                  </CardContent>\n                  <CardFooter className=\"p-4 pt-0\">\n                    <Button \n                      className=\"w-full\" \n                      data-testid=\"shop-amazon-button\"\n                      onClick={() => window.open(buildAmazonUrl(product.name, product.price), '_blank', 'noopener,noreferrer')}\n                    >\n                      <ExternalLink className=\"w-4 h-4 mr-2\" />\n                      Shop on Amazon\n                    </Button>\n                  </CardFooter>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Search and Filters */}\n        <div className=\"mb-8 flex flex-col md:flex-row gap-4\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n            <Input\n              placeholder=\"Search products...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"search-input\"\n            />\n          </div>\n          <Select value={category} onValueChange={setCategory}>\n            <SelectTrigger className=\"w-full md:w-64\" data-testid=\"category-filter\">\n              <SelectValue placeholder=\"All Categories\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\" data-testid=\"category-all\">All Categories</SelectItem>\n              {categories.map((cat) => (\n                <SelectItem key={cat.value} value={cat.value} data-testid={`category-${cat.value}`}>\n                  {cat.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Products Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8\">\n          {(productsData?.products || []).map((product: any) => (\n            <Card key={product.id} className=\"group hover:shadow-lg transition-shadow\" data-testid={`product-card-${product.id}`}>\n              <CardHeader className=\"p-0\">\n                <div className=\"relative overflow-hidden rounded-t-lg\">\n                  <img\n                    src={product.imageUrl || \"/api/placeholder/300/200\"}\n                    alt={product.name}\n                    className=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\"\n                    data-testid=\"product-image\"\n                  />\n                  {product.isFeatured && (\n                    <Badge className=\"absolute top-2 left-2 bg-blue-600 text-white\" data-testid=\"featured-badge\">\n                      Featured\n                    </Badge>\n                  )}\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                <CardTitle className=\"text-lg mb-2 line-clamp-2\" data-testid=\"product-name\">\n                  {product.name}\n                </CardTitle>\n                <p className=\"text-gray-600 dark:text-gray-300 text-sm mb-3 line-clamp-2\" data-testid=\"product-description\">\n                  {product.shortDescription || product.description}\n                </p>\n                <div className=\"flex items-center gap-2 mb-3\">\n                  <div className=\"flex items-center\" data-testid=\"product-rating\">\n                    {renderStars(parseFloat(product.rating || \"0\"))}\n                  </div>\n                  <span className=\"text-sm text-gray-500\" data-testid=\"review-count\">\n                    ({product.reviewCount || 0})\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-xl font-bold text-blue-600\" data-testid=\"product-price\">\n                    {formatPrice(product.price)}\n                  </span>\n                  {product.originalPrice && parseFloat(product.originalPrice) > parseFloat(product.price) && (\n                    <span className=\"text-sm text-gray-500 line-through\" data-testid=\"original-price\">\n                      {formatPrice(product.originalPrice)}\n                    </span>\n                  )}\n                </div>\n              </CardContent>\n              <CardFooter className=\"p-4 pt-0\">\n                <Button \n                  className=\"w-full\" \n                  data-testid=\"shop-amazon-button\"\n                  onClick={() => window.open(buildAmazonUrl(product.name, product.price), '_blank', 'noopener,noreferrer')}\n                >\n                  <ExternalLink className=\"w-4 h-4 mr-2\" />\n                  Shop on Amazon\n                </Button>\n              </CardFooter>\n            </Card>\n          ))}\n        </div>\n\n        {/* Pagination */}\n        {productsData?.total && productsData.total > 12 && (\n          <div className=\"flex justify-center items-center gap-4\" data-testid=\"pagination\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setPage(Math.max(1, page - 1))}\n              disabled={page === 1}\n              data-testid=\"prev-page\"\n            >\n              Previous\n            </Button>\n            <span className=\"text-sm text-gray-600 dark:text-gray-300\" data-testid=\"page-info\">\n              Page {page} of {Math.ceil(productsData.total / 12)}\n            </span>\n            <Button\n              variant=\"outline\"\n              onClick={() => setPage(page + 1)}\n              disabled={page >= Math.ceil(productsData.total / 12)}\n              data-testid=\"next-page\"\n            >\n              Next\n            </Button>\n          </div>\n        )}\n\n        {/* Empty State */}\n        {(!productsData?.products || productsData?.products?.length === 0) && !isLoading && (\n          <div className=\"text-center py-12\" data-testid=\"empty-state\">\n            <Search className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\n              No products found\n            </h3>\n            <p className=\"text-gray-600 dark:text-gray-300\">\n              Try adjusting your search or filter criteria\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":13247},"client/src/pages/admin/product-manager.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Plus, Edit, Trash2, Star, Package, Upload, Download, ExternalLink } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ProductForm {\n  name: string;\n  description: string;\n  shortDescription: string;\n  category: string;\n  price: string;\n  originalPrice: string;\n  amazonUrl: string;\n  imageUrl: string;\n  brand: string;\n  model: string;\n  features: string[];\n  isActive: boolean;\n  isFeatured: boolean;\n  tags: string[];\n}\n\nconst defaultForm: ProductForm = {\n  name: \"\",\n  description: \"\",\n  shortDescription: \"\",\n  category: \"\",\n  price: \"\",\n  originalPrice: \"\",\n  amazonUrl: \"\",\n  imageUrl: \"\",\n  brand: \"\",\n  model: \"\",\n  features: [],\n  isActive: true,\n  isFeatured: false,\n  tags: [],\n};\n\nexport default function ProductManager() {\n  const [activeTab, setActiveTab] = useState(\"list\");\n  const [editingProduct, setEditingProduct] = useState<any>(null);\n  const [form, setForm] = useState<ProductForm>(defaultForm);\n  const [newFeature, setNewFeature] = useState(\"\");\n  const [newTag, setNewTag] = useState(\"\");\n  const [extractingFromAmazon, setExtractingFromAmazon] = useState(false);\n  const [amazonUrl, setAmazonUrl] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const categories = [\n    { value: \"gas_detection\", label: \"Gas Detection\" },\n    { value: \"pipe_tools\", label: \"Pipe Tools\" },\n    { value: \"measuring\", label: \"Measuring Tools\" },\n    { value: \"safety\", label: \"Safety Equipment\" },\n    { value: \"valves\", label: \"Valves\" },\n    { value: \"fittings\", label: \"Fittings\" },\n    { value: \"books\", label: \"Books & Manuals\" },\n    { value: \"training_materials\", label: \"Training Materials\" },\n  ];\n\n  const { data: products, isLoading } = useQuery({\n    queryKey: [\"/api/products\", { limit: 100 }],\n    queryFn: async () => {\n      const response = await fetch(\"/api/products?limit=100\");\n      if (!response.ok) throw new Error(\"Failed to fetch products\");\n      return response.json();\n    },\n  });\n\n  const createProductMutation = useMutation({\n    mutationFn: async (productData: any) => {\n      const response = await fetch(\"/api/products\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(productData),\n      });\n      if (!response.ok) throw new Error(\"Failed to create product\");\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Product created successfully!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setForm(defaultForm);\n      setActiveTab(\"list\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateProductMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      const response = await fetch(`/api/products/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error(\"Failed to update product\");\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Product updated successfully!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setEditingProduct(null);\n      setForm(defaultForm);\n      setActiveTab(\"list\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteProductMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await fetch(`/api/products/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete product\");\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Product deleted successfully!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const extractFromAmazonMutation = useMutation({\n    mutationFn: async (url: string) => {\n      const response = await fetch(\"/api/amazon/extract\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ url }),\n      });\n      if (!response.ok) throw new Error(\"Failed to extract product data\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.success) {\n        setForm({\n          ...form,\n          name: data.name || form.name,\n          description: data.description || form.description,\n          shortDescription: data.shortDescription || form.shortDescription,\n          price: data.price || form.price,\n          amazonUrl: data.amazonUrl || form.amazonUrl,\n          imageUrl: data.imageUrl || form.imageUrl,\n          brand: data.brand || form.brand,\n          features: data.features || form.features,\n        });\n        toast({\n          title: \"Success\",\n          description: \"Product information extracted from Amazon!\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Extraction Failed\",\n        description: error.message || \"Failed to extract product information\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!form.name || !form.description || !form.category || !form.price || !form.amazonUrl) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const productData = {\n      ...form,\n      price: form.price.toString(),\n      originalPrice: form.originalPrice ? form.originalPrice.toString() : undefined,\n      features: Array.isArray(form.features) ? form.features : [],\n      tags: Array.isArray(form.tags) ? form.tags : [],\n    };\n\n    if (editingProduct) {\n      updateProductMutation.mutate({ id: editingProduct.id, data: productData });\n    } else {\n      createProductMutation.mutate(productData);\n    }\n  };\n\n  const handleEdit = (product: any) => {\n    setEditingProduct(product);\n    setForm({\n      name: product.name,\n      description: product.description,\n      shortDescription: product.shortDescription || \"\",\n      category: product.category,\n      price: product.price.toString(),\n      originalPrice: product.originalPrice?.toString() || \"\",\n      amazonUrl: product.amazonUrl,\n      imageUrl: product.imageUrl || \"\",\n      brand: product.brand || \"\",\n      model: product.model || \"\",\n      features: product.features || [],\n      isActive: product.isActive,\n      isFeatured: product.isFeatured,\n      tags: product.tags || [],\n    });\n    setActiveTab(\"form\");\n  };\n\n  const handleAddFeature = () => {\n    if (newFeature.trim()) {\n      setForm({ ...form, features: [...form.features, newFeature.trim()] });\n      setNewFeature(\"\");\n    }\n  };\n\n  const handleRemoveFeature = (index: number) => {\n    setForm({ ...form, features: form.features.filter((_, i) => i !== index) });\n  };\n\n  const handleAddTag = () => {\n    if (newTag.trim()) {\n      setForm({ ...form, tags: [...form.tags, newTag.trim()] });\n      setNewTag(\"\");\n    }\n  };\n\n  const handleRemoveTag = (index: number) => {\n    setForm({ ...form, tags: form.tags.filter((_, i) => i !== index) });\n  };\n\n  const handleExtractFromAmazon = () => {\n    if (!amazonUrl.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter an Amazon URL\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!amazonUrl.includes('amazon.com') && !amazonUrl.includes('amzn.to')) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a valid Amazon.com URL\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    extractFromAmazonMutation.mutate(amazonUrl);\n  };\n\n  const formatPrice = (price: string | number) => {\n    return `$${parseFloat(price.toString()).toFixed(2)}`;\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-4\" data-testid=\"product-manager-title\">\n          Product Manager\n        </h1>\n        <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"product-manager-description\">\n          Manage your store products, add new items, and update existing inventory\n        </p>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"list\" data-testid=\"tab-list\">\n            <Package className=\"w-4 h-4 mr-2\" />\n            Products List\n          </TabsTrigger>\n          <TabsTrigger value=\"form\" data-testid=\"tab-form\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            {editingProduct ? \"Edit Product\" : \"Add Product\"}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"list\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-between\">\n                <span>All Products ({products?.products?.length || 0})</span>\n                <Button onClick={() => { setForm(defaultForm); setEditingProduct(null); setActiveTab(\"form\"); }} data-testid=\"add-product-button\">\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Add Product\n                </Button>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"space-y-4\">\n                  {Array.from({ length: 3 }, (_, i) => (\n                    <div key={i} className=\"animate-pulse border rounded-lg p-4\">\n                      <div className=\"flex gap-4\">\n                        <div className=\"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n                        <div className=\"flex-1 space-y-2\">\n                          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4\"></div>\n                          <div className=\"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2\"></div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"space-y-4\" data-testid=\"products-list\">\n                  {products?.products?.map((product: any) => (\n                    <div key={product.id} className=\"border rounded-lg p-4 hover:shadow-md transition-shadow\" data-testid={`product-item-${product.id}`}>\n                      <div className=\"flex gap-4\">\n                        <img\n                          src={product.imageUrl || \"/api/placeholder/64/64\"}\n                          alt={product.name}\n                          className=\"w-16 h-16 object-cover rounded\"\n                          data-testid=\"product-image\"\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-start justify-between\">\n                            <div>\n                              <h3 className=\"font-semibold text-lg mb-1\" data-testid=\"product-name\">\n                                {product.name}\n                              </h3>\n                              <p className=\"text-gray-600 dark:text-gray-300 text-sm mb-2\" data-testid=\"product-description\">\n                                {product.shortDescription || product.description.substring(0, 100)}...\n                              </p>\n                              <div className=\"flex items-center gap-4 mb-2\">\n                                <span className=\"font-bold text-blue-600\" data-testid=\"product-price\">\n                                  {formatPrice(product.price)}\n                                </span>\n                                <Badge variant=\"outline\" data-testid=\"product-category\">\n                                  {product.category.replace(/_/g, \" \").replace(/\\b\\w/g, (l: string) => l.toUpperCase())}\n                                </Badge>\n                                {product.isFeatured && (\n                                  <Badge className=\"bg-blue-600\" data-testid=\"featured-badge\">\n                                    <Star className=\"w-3 h-3 mr-1\" />\n                                    Featured\n                                  </Badge>\n                                )}\n                                {!product.isActive && (\n                                  <Badge variant=\"destructive\" data-testid=\"inactive-badge\">\n                                    Inactive\n                                  </Badge>\n                                )}\n                              </div>\n                              <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                                <span>â˜… {product.rating || \"0.0\"}</span>\n                                <span>â€¢</span>\n                                <span>{product.reviewCount || 0} reviews</span>\n                                <span>â€¢</span>\n                                <span>{product.brand || \"No brand\"}</span>\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Button size=\"sm\" variant=\"outline\" onClick={() => handleEdit(product)} data-testid=\"edit-product-button\">\n                                <Edit className=\"w-4 h-4\" />\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => deleteProductMutation.mutate(product.id)}\n                                disabled={deleteProductMutation.isPending}\n                                data-testid=\"delete-product-button\"\n                              >\n                                <Trash2 className=\"w-4 h-4\" />\n                              </Button>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"form\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle data-testid=\"form-title\">\n                {editingProduct ? `Edit Product: ${editingProduct.name}` : \"Add New Product\"}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-6\" data-testid=\"product-form\">\n                {/* Amazon URL Extractor */}\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-200 dark:border-blue-800\">\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <ExternalLink className=\"w-5 h-5 text-blue-600\" />\n                      <h3 className=\"font-medium text-blue-900 dark:text-blue-100\">\n                        Quick Product Import from Amazon\n                      </h3>\n                    </div>\n                    <p className=\"text-sm text-blue-700 dark:text-blue-300 mb-4\">\n                      Paste an Amazon product URL and we'll automatically extract the product name, price, description, features, and images for you!\n                    </p>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        placeholder=\"https://www.amazon.com/product-link...\"\n                        value={amazonUrl}\n                        onChange={(e) => setAmazonUrl(e.target.value)}\n                        className=\"flex-1\"\n                        data-testid=\"input-amazon-url\"\n                      />\n                      <Button\n                        type=\"button\"\n                        onClick={handleExtractFromAmazon}\n                        disabled={extractFromAmazonMutation.isPending}\n                        className=\"bg-blue-600 hover:bg-blue-700\"\n                        data-testid=\"extract-amazon-button\"\n                      >\n                        {extractFromAmazonMutation.isPending ? (\n                          <>\n                            <Download className=\"w-4 h-4 mr-2 animate-spin\" />\n                            Extracting...\n                          </>\n                        ) : (\n                          <>\n                            <Download className=\"w-4 h-4 mr-2\" />\n                            Extract\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Basic Information */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"name\">Product Name *</Label>\n                    <Input\n                      id=\"name\"\n                      value={form.name}\n                      onChange={(e) => setForm({ ...form, name: e.target.value })}\n                      placeholder=\"Enter product name\"\n                      required\n                      data-testid=\"input-name\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"category\">Category *</Label>\n                    <Select value={form.category} onValueChange={(value) => setForm({ ...form, category: value })}>\n                      <SelectTrigger data-testid=\"select-category\">\n                        <SelectValue placeholder=\"Select category\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {categories.map((cat) => (\n                          <SelectItem key={cat.value} value={cat.value}>\n                            {cat.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"shortDescription\">Short Description</Label>\n                  <Input\n                    id=\"shortDescription\"\n                    value={form.shortDescription}\n                    onChange={(e) => setForm({ ...form, shortDescription: e.target.value })}\n                    placeholder=\"Brief product description for listings\"\n                    data-testid=\"input-short-description\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Full Description *</Label>\n                  <Textarea\n                    id=\"description\"\n                    value={form.description}\n                    onChange={(e) => setForm({ ...form, description: e.target.value })}\n                    placeholder=\"Detailed product description\"\n                    rows={4}\n                    required\n                    data-testid=\"textarea-description\"\n                  />\n                </div>\n\n                {/* Pricing */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"price\">Price *</Label>\n                    <Input\n                      id=\"price\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={form.price}\n                      onChange={(e) => setForm({ ...form, price: e.target.value })}\n                      placeholder=\"0.00\"\n                      required\n                      data-testid=\"input-price\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"originalPrice\">Original Price (Optional)</Label>\n                    <Input\n                      id=\"originalPrice\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={form.originalPrice}\n                      onChange={(e) => setForm({ ...form, originalPrice: e.target.value })}\n                      placeholder=\"0.00\"\n                      data-testid=\"input-original-price\"\n                    />\n                  </div>\n                </div>\n\n                {/* Product Details */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"brand\">Brand</Label>\n                    <Input\n                      id=\"brand\"\n                      value={form.brand}\n                      onChange={(e) => setForm({ ...form, brand: e.target.value })}\n                      placeholder=\"Product brand\"\n                      data-testid=\"input-brand\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"model\">Model</Label>\n                    <Input\n                      id=\"model\"\n                      value={form.model}\n                      onChange={(e) => setForm({ ...form, model: e.target.value })}\n                      placeholder=\"Product model\"\n                      data-testid=\"input-model\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"imageUrl\">Image URL</Label>\n                    <Input\n                      id=\"imageUrl\"\n                      value={form.imageUrl}\n                      onChange={(e) => setForm({ ...form, imageUrl: e.target.value })}\n                      placeholder=\"https://...\"\n                      data-testid=\"input-image-url\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"amazonUrl\">Amazon URL *</Label>\n                  <Input\n                    id=\"amazonUrl\"\n                    value={form.amazonUrl}\n                    onChange={(e) => setForm({ ...form, amazonUrl: e.target.value })}\n                    placeholder=\"https://amzn.to/...\"\n                    required\n                    data-testid=\"input-amazon-url\"\n                  />\n                </div>\n\n                {/* Features */}\n                <div className=\"space-y-4\">\n                  <Label>Product Features</Label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      value={newFeature}\n                      onChange={(e) => setNewFeature(e.target.value)}\n                      placeholder=\"Add a feature\"\n                      onKeyPress={(e) => e.key === \"Enter\" && (e.preventDefault(), handleAddFeature())}\n                      data-testid=\"input-new-feature\"\n                    />\n                    <Button type=\"button\" onClick={handleAddFeature} data-testid=\"add-feature-button\">\n                      Add\n                    </Button>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2\" data-testid=\"features-list\">\n                    {form.features.map((feature, index) => (\n                      <Badge key={index} variant=\"secondary\" className=\"flex items-center gap-1\">\n                        {feature}\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveFeature(index)}\n                          className=\"ml-1 hover:text-red-500\"\n                          data-testid={`remove-feature-${index}`}\n                        >\n                          Ã—\n                        </button>\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Tags */}\n                <div className=\"space-y-4\">\n                  <Label>Tags</Label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      value={newTag}\n                      onChange={(e) => setNewTag(e.target.value)}\n                      placeholder=\"Add a tag\"\n                      onKeyPress={(e) => e.key === \"Enter\" && (e.preventDefault(), handleAddTag())}\n                      data-testid=\"input-new-tag\"\n                    />\n                    <Button type=\"button\" onClick={handleAddTag} data-testid=\"add-tag-button\">\n                      Add\n                    </Button>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2\" data-testid=\"tags-list\">\n                    {form.tags.map((tag, index) => (\n                      <Badge key={index} variant=\"outline\" className=\"flex items-center gap-1\">\n                        {tag}\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveTag(index)}\n                          className=\"ml-1 hover:text-red-500\"\n                          data-testid={`remove-tag-${index}`}\n                        >\n                          Ã—\n                        </button>\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Settings */}\n                <Separator />\n                <div className=\"flex items-center gap-6\">\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      checked={form.isActive}\n                      onCheckedChange={(checked) => setForm({ ...form, isActive: checked })}\n                      data-testid=\"switch-active\"\n                    />\n                    <Label>Active</Label>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      checked={form.isFeatured}\n                      onCheckedChange={(checked) => setForm({ ...form, isFeatured: checked })}\n                      data-testid=\"switch-featured\"\n                    />\n                    <Label>Featured</Label>\n                  </div>\n                </div>\n\n                {/* Submit */}\n                <div className=\"flex items-center gap-4 pt-4\">\n                  <Button\n                    type=\"submit\"\n                    disabled={createProductMutation.isPending || updateProductMutation.isPending}\n                    data-testid=\"submit-button\"\n                  >\n                    <Upload className=\"w-4 h-4 mr-2\" />\n                    {editingProduct\n                      ? updateProductMutation.isPending\n                        ? \"Updating...\"\n                        : \"Update Product\"\n                      : createProductMutation.isPending\n                      ? \"Creating...\"\n                      : \"Create Product\"}\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setForm(defaultForm);\n                      setEditingProduct(null);\n                      setActiveTab(\"list\");\n                    }}\n                    data-testid=\"cancel-button\"\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":28508},"client/src/pages/admin/job-approval.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  CheckCircle, \n  XCircle, \n  Clock, \n  Building2, \n  MapPin, \n  DollarSign,\n  Mail,\n  Calendar,\n  Eye,\n  AlertTriangle\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Job } from \"@/../../shared/schema\";\n\nexport default function JobApproval() {\n  const [selectedJobId, setSelectedJobId] = useState<string>(\"\");\n  const [rejectionReason, setRejectionReason] = useState(\"\");\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: pendingJobs = [], isLoading } = useQuery<Job[]>({\n    queryKey: [\"/api/admin/jobs/pending\"],\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n\n  const approveJobMutation = useMutation({\n    mutationFn: (jobId: string) => \n      apiRequest(\"PUT\", `/api/admin/jobs/${jobId}/approve`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/jobs/pending\"] });\n      toast({\n        title: \"Job Approved\",\n        description: \"The job posting has been approved and is now live.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Approval Failed\",\n        description: error.message || \"Failed to approve job\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const rejectJobMutation = useMutation({\n    mutationFn: ({ jobId, reason }: { jobId: string; reason: string }) => \n      apiRequest(\"PUT\", `/api/admin/jobs/${jobId}/reject`, { rejectionReason: reason }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/jobs/pending\"] });\n      setShowRejectModal(false);\n      setRejectionReason(\"\");\n      setSelectedJobId(\"\");\n      toast({\n        title: \"Job Rejected\",\n        description: \"The job posting has been rejected and the employer has been notified.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Rejection Failed\",\n        description: error.message || \"Failed to reject job\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleApprove = (jobId: string) => {\n    approveJobMutation.mutate(jobId);\n  };\n\n  const handleReject = (jobId: string) => {\n    setSelectedJobId(jobId);\n    setShowRejectModal(true);\n  };\n\n  const submitRejection = () => {\n    if (!rejectionReason.trim()) {\n      toast({\n        title: \"Rejection Reason Required\",\n        description: \"Please provide a reason for rejecting this job posting.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    rejectJobMutation.mutate({ jobId: selectedJobId, reason: rejectionReason });\n  };\n\n  const formatSalary = (min?: string, max?: string) => {\n    if (!min && !max) return \"Salary not specified\";\n    if (min && max) return `$${min} - $${max}/hour`;\n    if (min) return `From $${min}/hour`;\n    if (max) return `Up to $${max}/hour`;\n  };\n\n  const formatJobType = (type: string) => {\n    return type.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-8\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"flex items-center justify-center py-16\">\n            <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <div className=\"bg-white border-b\">\n        <div className=\"max-w-6xl mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold\" data-testid=\"admin-title\">\n                Job Approval Dashboard\n              </h1>\n              <p className=\"text-muted-foreground mt-1\">\n                Review and approve job postings from employers\n              </p>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <Badge variant=\"secondary\" className=\"text-sm\">\n                <Clock className=\"w-4 h-4 mr-2\" />\n                {pendingJobs.length} Pending\n              </Badge>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-6xl mx-auto px-4 py-8\">\n        {pendingJobs.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-16 text-center\">\n              <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto mb-4\" />\n              <h3 className=\"text-xl font-semibold mb-2\">All Caught Up!</h3>\n              <p className=\"text-muted-foreground\">\n                There are no pending job postings to review at this time.\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-6\">\n            {pendingJobs.map((job) => (\n              <Card key={job.id} className=\"relative\" data-testid={`job-card-${job.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center space-x-2\">\n                        <CardTitle className=\"text-xl\">{job.title}</CardTitle>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {formatJobType(job.type)}\n                        </Badge>\n                      </div>\n                      <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\n                        <div className=\"flex items-center space-x-1\">\n                          <Building2 className=\"w-4 h-4\" />\n                          <span>{job.company}</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <MapPin className=\"w-4 h-4\" />\n                          <span>{job.location}</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <DollarSign className=\"w-4 h-4\" />\n                          <span>{formatSalary(job.salaryMin, job.salaryMax)}</span>\n                        </div>\n                      </div>\n                    </div>\n                    <Badge variant=\"secondary\">\n                      <Clock className=\"w-3 h-3 mr-1\" />\n                      Pending Review\n                    </Badge>\n                  </div>\n                </CardHeader>\n                \n                <CardContent className=\"space-y-6\">\n                  <Tabs defaultValue=\"details\" className=\"w-full\">\n                    <TabsList className=\"grid w-full grid-cols-3\">\n                      <TabsTrigger value=\"details\">Job Details</TabsTrigger>\n                      <TabsTrigger value=\"requirements\">Requirements</TabsTrigger>\n                      <TabsTrigger value=\"employer\">Employer Info</TabsTrigger>\n                    </TabsList>\n                    \n                    <TabsContent value=\"details\" className=\"space-y-4 mt-4\">\n                      <div>\n                        <h4 className=\"font-medium mb-2\">Job Description</h4>\n                        <p className=\"text-sm text-muted-foreground whitespace-pre-line\">\n                          {job.description}\n                        </p>\n                      </div>\n                      {job.benefits && (\n                        <div>\n                          <h4 className=\"font-medium mb-2\">Benefits</h4>\n                          <ul className=\"text-sm text-muted-foreground space-y-1\">\n                            {(job.benefits || []).map((benefit, index) => (\n                              <li key={index}>â€¢ {benefit}</li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n                    </TabsContent>\n                    \n                    <TabsContent value=\"requirements\" className=\"space-y-4 mt-4\">\n                      <div>\n                        <h4 className=\"font-medium mb-2\">Requirements</h4>\n                        <ul className=\"text-sm text-muted-foreground space-y-1\">\n                          {(job.requirements || []).map((req, index) => (\n                            <li key={index}>â€¢ {req}</li>\n                          ))}\n                        </ul>\n                      </div>\n                    </TabsContent>\n                    \n                    <TabsContent value=\"employer\" className=\"space-y-4 mt-4\">\n                      <div className=\"grid md:grid-cols-2 gap-4\">\n                        <div>\n                          <h4 className=\"font-medium mb-2\">Contact Information</h4>\n                          <div className=\"space-y-1 text-sm text-muted-foreground\">\n                            <div className=\"flex items-center space-x-2\">\n                              <Mail className=\"w-4 h-4\" />\n                              <span>{job.contactEmail}</span>\n                            </div>\n                          </div>\n                        </div>\n                        <div>\n                          <h4 className=\"font-medium mb-2\">Posting Date</h4>\n                          <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n                            <Calendar className=\"w-4 h-4\" />\n                            <span>{job.createdAt ? new Date(job.createdAt).toLocaleDateString() : 'Unknown'}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </TabsContent>\n                  </Tabs>\n\n                  {/* Action Buttons */}\n                  <div className=\"flex items-center justify-end space-x-3 pt-4 border-t\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => handleReject(job.id)}\n                      disabled={rejectJobMutation.isPending}\n                      data-testid={`button-reject-${job.id}`}\n                    >\n                      <XCircle className=\"w-4 h-4 mr-2\" />\n                      Reject\n                    </Button>\n                    <Button\n                      onClick={() => handleApprove(job.id)}\n                      disabled={approveJobMutation.isPending}\n                      data-testid={`button-approve-${job.id}`}\n                    >\n                      <CheckCircle className=\"w-4 h-4 mr-2\" />\n                      {approveJobMutation.isPending ? \"Approving...\" : \"Approve & Publish\"}\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n\n        {/* Reject Modal */}\n        {showRejectModal && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\" data-testid=\"reject-modal\">\n            <Card className=\"w-full max-w-md mx-4\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n                  <span>Reject Job Posting</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <p className=\"text-sm text-muted-foreground\">\n                  Please provide a reason for rejecting this job posting. This will be sent to the employer.\n                </p>\n                <Textarea\n                  value={rejectionReason}\n                  onChange={(e) => setRejectionReason(e.target.value)}\n                  placeholder=\"Reason for rejection...\"\n                  rows={4}\n                  data-testid=\"input-rejection-reason\"\n                />\n                <div className=\"flex space-x-3\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      setShowRejectModal(false);\n                      setRejectionReason(\"\");\n                      setSelectedJobId(\"\");\n                    }}\n                    className=\"flex-1\"\n                    data-testid=\"button-cancel-reject\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    onClick={submitRejection}\n                    disabled={rejectJobMutation.isPending || !rejectionReason.trim()}\n                    className=\"flex-1\"\n                    data-testid=\"button-confirm-reject\"\n                  >\n                    {rejectJobMutation.isPending ? \"Rejecting...\" : \"Reject Job\"}\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":13235},"client/src/pages/employer-portal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Building2, MapPin, DollarSign, Clock, CheckCircle, Mail, Phone, BarChart3, Edit, Star, RefreshCw, Settings } from \"lucide-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst employerSchema = z.object({\n  companyName: z.string().min(2, \"Company name is required\"),\n  contactName: z.string().min(2, \"Contact name is required\"),\n  contactEmail: z.string().email(\"Valid email is required\"),\n  contactPhone: z.string().optional(),\n  companyWebsite: z.string().optional().refine((val) => {\n    if (!val || val === \"\") return true;\n    const urlPattern = /^(https?:\\/\\/)?(www\\.)?[a-zA-Z0-9-]+(\\.[a-zA-Z]{2,})+(\\S*)?$/;\n    return urlPattern.test(val);\n  }, \"Please enter a valid website URL\"),\n  companyDescription: z.string().min(10, \"Please provide a brief company description\"),\n  address: z.string().min(5, \"Address is required\"),\n  city: z.string().min(2, \"City is required\"),\n  zipCode: z.string().min(5, \"Valid ZIP code is required\"),\n});\n\nconst jobSchema = z.object({\n  title: z.string().min(3, \"Job title is required\"),\n  description: z.string().min(50, \"Please provide a detailed job description (min 50 characters)\"),\n  location: z.string().min(3, \"Location is required\"),\n  type: z.enum([\"full_time\", \"part_time\", \"contract\", \"temporary\"]),\n  salaryMin: z.string().optional(),\n  salaryMax: z.string().optional(),\n  requirements: z.string().min(10, \"Please list job requirements\"),\n  benefits: z.string().optional(),\n});\n\ntype EmployerData = z.infer<typeof employerSchema>;\ntype JobData = z.infer<typeof jobSchema>;\n\nexport default function EmployerPortal() {\n  const [step, setStep] = useState<'pricing' | 'employer' | 'job' | 'payment' | 'success'>('pricing');\n  const [employerId, setEmployerId] = useState<string>(\"\");\n  const [selectedPlan, setSelectedPlan] = useState<'basic' | 'premium'>('basic');\n  const [quantity, setQuantity] = useState<number>(1);\n  const [clientSecret, setClientSecret] = useState<string>(\"\");\n  const [paymentData, setPaymentData] = useState<any>(null);\n  const { toast } = useToast();\n\n  // Bulk pricing logic with progressive discounts\n  const calculatePricing = (basePrice: number, qty: number) => {\n    let discount = 0;\n    if (qty >= 10) discount = 0.25; // 25% off for 10+\n    else if (qty >= 5) discount = 0.15; // 15% off for 5+\n    else if (qty >= 3) discount = 0.10; // 10% off for 3+\n    \n    const unitPrice = basePrice * (1 - discount);\n    const totalPrice = unitPrice * qty;\n    const totalSavings = (basePrice * qty) - totalPrice;\n    \n    return { unitPrice, totalPrice, totalSavings, discount };\n  };\n\n  const basicPrice = 49;\n  const premiumPrice = 89;\n  \n  const basicPricing = calculatePricing(basicPrice, quantity);\n  const premiumPricing = calculatePricing(premiumPrice, quantity);\n\n  const employerForm = useForm<EmployerData>({\n    resolver: zodResolver(employerSchema),\n    defaultValues: {\n      state: \"Louisiana\",\n    },\n  });\n\n  const jobForm = useForm<JobData>({\n    resolver: zodResolver(jobSchema),\n  });\n\n  const registerEmployerMutation = useMutation({\n    mutationFn: (data: EmployerData) => \n      apiRequest(\"POST\", \"/api/employers/register\", data),\n    onSuccess: (response) => {\n      setEmployerId(response.employerId);\n      setStep('job');\n      toast({\n        title: \"Registration Successful\",\n        description: \"Your company has been registered. Now let's create your job posting.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Registration Failed\",\n        description: error.message || \"Failed to register company\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createPaymentIntentMutation = useMutation({\n    mutationFn: ({ quantity, planType }: { quantity: number; planType: string }) => \n      apiRequest(\"POST\", \"/api/employers/payment-intent\", { quantity, planType }),\n    onSuccess: (response: any) => {\n      setClientSecret(response.clientSecret);\n      setPaymentData(response);\n      setStep('payment');\n      toast({\n        title: \"Payment Ready\",\n        description: \"Please complete your payment to post your job(s).\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Payment Error\",\n        description: error.message || \"Failed to create payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createJobMutation = useMutation({\n    mutationFn: (data: JobData & { \n      requirements: string[]; \n      benefits?: string[]; \n      planType: 'basic' | 'premium';\n      quantity: number;\n      unitPrice: number;\n      totalPrice: number;\n      discount: number;\n    }) => \n      apiRequest(\"POST\", `/api/employers/${employerId}/jobs`, data),\n    onSuccess: (response: any) => {\n      setStep('success');\n      \n      // Show different messages based on AI approval\n      if (response.status === 'approved') {\n        toast({\n          title: \"Job Posted Successfully! ðŸŽ‰\",\n          description: \"Your job posting was automatically approved and is now live!\",\n        });\n      } else {\n        toast({\n          title: \"Job Posted for Review\",\n          description: `Your ${quantity} job posting${quantity > 1 ? 's have' : ' has'} been submitted for manual review.`,\n        });\n      }\n      \n      // Store AI review data for display on success page\n      setPaymentData(prev => ({ ...prev, aiReview: response.aiReview }));\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Job Posting Failed\",\n        description: error.message || \"Failed to create job posting\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmitEmployer = (data: EmployerData) => {\n    registerEmployerMutation.mutate(data);\n  };\n\n  const onSubmitJob = (data: JobData) => {\n    // Store job data for after payment\n    const pricing = selectedPlan === 'basic' ? basicPricing : premiumPricing;\n    const processedData = {\n      ...data,\n      requirements: data.requirements,\n      benefits: data.benefits,\n      planType: selectedPlan,\n      quantity: quantity,\n      unitPrice: pricing.unitPrice,\n      totalPrice: pricing.totalPrice,\n      discount: pricing.discount,\n    };\n    \n    // Store job data in state for after payment\n    setPaymentData({ ...paymentData, jobData: processedData });\n    \n    // Create payment intent first\n    createPaymentIntentMutation.mutate({ \n      quantity, \n      planType: selectedPlan \n    });\n  };\n\n  const formatJobType = (type: string) => {\n    return type.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n  };\n\n  if (step === 'success') {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <div className=\"max-w-4xl mx-auto px-4 py-16\">\n          <Card className=\"text-center\">\n            <CardContent className=\"pt-12 pb-16\">\n              <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto mb-6\" />\n              <h1 className=\"text-3xl font-bold mb-4\" data-testid=\"success-title\">\n                Job Posted Successfully!\n              </h1>\n              \n              {/* AI Review Status */}\n              {paymentData?.aiReview && (\n                <div className=\"mb-6\">\n                  {paymentData.aiReview.isPlumbingRelated ? (\n                    <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 max-w-2xl mx-auto\">\n                      <div className=\"flex items-center justify-center text-green-700 font-semibold mb-2\">\n                        <CheckCircle className=\"w-5 h-5 mr-2\" />\n                        AI Review: Approved for Plumbing Industry\n                      </div>\n                      <p className=\"text-sm text-green-600\">\n                        Quality Score: {paymentData.aiReview.qualityScore}/10\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-2xl mx-auto\">\n                      <div className=\"flex items-center justify-center text-yellow-700 font-semibold mb-2\">\n                        <RefreshCw className=\"w-5 h-5 mr-2\" />\n                        AI Review: Pending Manual Review\n                      </div>\n                      <p className=\"text-sm text-yellow-600\">\n                        Quality Score: {paymentData.aiReview.qualityScore}/10\n                      </p>\n                    </div>\n                  )}\n                </div>\n              )}\n              \n              <p className=\"text-muted-foreground text-lg mb-8 max-w-2xl mx-auto\">\n                Your {quantity} {selectedPlan} job posting{quantity > 1 ? 's have' : ' has'} been submitted and {quantity > 1 ? 'are' : 'is'} {paymentData?.aiReview?.isPlumbingRelated ? 'now live on our platform' : 'pending review by our team'}. \n                {!paymentData?.aiReview?.isPlumbingRelated && `We'll notify you via email once ${quantity > 1 ? 'they\\'re' : 'it\\'s'} approved and live on our platform.`}\n              </p>\n              \n              {/* Pricing Summary */}\n              <div className=\"bg-gray-50 rounded-lg p-6 mb-8 max-w-2xl mx-auto\">\n                <h3 className=\"font-semibold mb-4\">Order Summary</h3>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span>{quantity}x {selectedPlan.charAt(0).toUpperCase() + selectedPlan.slice(1)} Job Post{quantity > 1 ? 's' : ''}</span>\n                    <span>${((selectedPlan === 'basic' ? basicPrice : premiumPrice) * quantity).toFixed(2)}</span>\n                  </div>\n                  {(selectedPlan === 'basic' ? basicPricing : premiumPricing).discount > 0 && (\n                    <div className=\"flex justify-between text-green-600\">\n                      <span>Volume Discount ({Math.round((selectedPlan === 'basic' ? basicPricing : premiumPricing).discount * 100)}% off)</span>\n                      <span>-${(selectedPlan === 'basic' ? basicPricing : premiumPricing).totalSavings.toFixed(2)}</span>\n                    </div>\n                  )}\n                  <hr className=\"my-2\" />\n                  <div className=\"flex justify-between font-semibold\">\n                    <span>Total</span>\n                    <span>${(selectedPlan === 'basic' ? basicPricing : premiumPricing).totalPrice.toFixed(2)}</span>\n                  </div>\n                </div>\n              </div>\n              <div className=\"bg-blue-50 rounded-lg p-6 mb-8 max-w-2xl mx-auto\">\n                <h3 className=\"font-semibold mb-2\">What happens next?</h3>\n                <ul className=\"text-sm text-muted-foreground space-y-2 text-left\">\n                  <li>â€¢ Our team will review your job posting within 24-48 hours</li>\n                  <li>â€¢ You'll receive an email confirmation once approved</li>\n                  <li>â€¢ Your job will be visible to apprentice plumbers in our training program</li>\n                  <li>â€¢ Applications will be forwarded directly to your email</li>\n                  <li>â€¢ Access detailed analytics about student applications and engagement</li>\n                </ul>\n              </div>\n              <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                <Button \n                  size=\"lg\" \n                  onClick={() => window.location.href = \"/employer/dashboard\"} \n                  data-testid=\"manage-jobs\"\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                >\n                  <Edit className=\"w-5 h-5 mr-2\" />\n                  Manage Job Listings\n                </Button>\n                <Button \n                  size=\"lg\" \n                  onClick={() => window.location.href = \"/employer/analytics\"} \n                  data-testid=\"view-analytics\"\n                  className=\"bg-green-600 hover:bg-green-700\"\n                >\n                  <BarChart3 className=\"w-5 h-5 mr-2\" />\n                  View Analytics\n                </Button>\n                <Button \n                  size=\"lg\" \n                  variant=\"outline\"\n                  onClick={() => window.location.href = \"/\"} \n                  data-testid=\"return-home\"\n                >\n                  Return to Homepage\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Section */}\n      <section className=\"gradient-hero text-white py-16\" data-testid=\"employer-hero\">\n        <div className=\"max-w-4xl mx-auto px-4 text-center\">\n          <h1 className=\"text-4xl lg:text-5xl font-bold mb-6\" data-testid=\"hero-title\">\n            Hire Certified Louisiana Plumbers\n          </h1>\n          <p className=\"text-xl text-blue-100 max-w-3xl mx-auto mb-8\">\n            Connect with certified plumbers, journeymen, apprentices, and plumbing professionals across Louisiana. \n            Access a comprehensive database of qualified candidates and get detailed analytics on all applications.\n          </p>\n          <div className=\"flex items-center justify-center space-x-8 text-blue-100\">\n            <div className=\"flex items-center space-x-2\">\n              <Building2 className=\"w-5 h-5\" />\n              <span>Certified Professionals</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <MapPin className=\"w-5 h-5\" />\n              <span>All Skill Levels</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <CheckCircle className=\"w-5 h-5\" />\n              <span>Application Analytics</span>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Unique Selling Point */}\n      <section className=\"py-12 bg-gradient-to-r from-blue-50 to-green-50\">\n        <div className=\"max-w-5xl mx-auto px-4\">\n          <div className=\"text-center mb-8\">\n            <div className=\"inline-flex items-center bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold mb-4\">\n              <Star className=\"w-4 h-4 mr-2\" />\n              EXCLUSIVE FEATURE - No Other Job Board Offers This\n            </div>\n            <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">\n              The Only Job Board That Adapts With Your Business\n            </h2>\n            <p className=\"text-lg text-gray-700 max-w-3xl mx-auto mb-8\">\n              <strong>Pay once, post smart.</strong> Unlike Indeed, LinkedIn, or ZipRecruiter, you can completely modify your listings without additional fees.\n            </p>\n          </div>\n          \n          <div className=\"grid md:grid-cols-3 gap-6\">\n            <div className=\"bg-white rounded-xl p-6 border border-blue-100 shadow-lg\">\n              <div className=\"flex items-center mb-4\">\n                <Edit className=\"text-blue-600 w-8 h-8 mr-3\" />\n                <h3 className=\"font-bold text-lg\">Change Position Types</h3>\n              </div>\n              <p className=\"text-gray-600 mb-4\">\n                Switch from \"Master Plumber Needed\" to \"Journeyman Plumber\" based on budget or application response\n              </p>\n              <div className=\"text-sm text-blue-600 font-medium\">\n                âœ“ No extra payment required\n              </div>\n            </div>\n            \n            <div className=\"bg-white rounded-xl p-6 border border-green-100 shadow-lg\">\n              <div className=\"flex items-center mb-4\">\n                <RefreshCw className=\"text-green-600 w-8 h-8 mr-3\" />\n                <h3 className=\"font-bold text-lg\">Pause & Reactivate</h3>\n              </div>\n              <p className=\"text-gray-600 mb-4\">\n                Stop applications while interviewing candidates, then reactivate when you need more applicants\n              </p>\n              <div className=\"text-sm text-green-600 font-medium\">\n                âœ“ Preserve your original posting\n              </div>\n            </div>\n            \n            <div className=\"bg-white rounded-xl p-6 border border-purple-100 shadow-lg\">\n              <div className=\"flex items-center mb-4\">\n                <Settings className=\"text-purple-600 w-8 h-8 mr-3\" />\n                <h3 className=\"font-bold text-lg\">Update Everything</h3>\n              </div>\n              <p className=\"text-gray-600 mb-4\">\n                Modify salary ranges, requirements, location, or job description based on market response\n              </p>\n              <div className=\"text-sm text-purple-600 font-medium\">\n                âœ“ Unlimited edits included\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"text-center mt-8\">\n            <p className=\"text-sm text-gray-600\">\n              <strong>Why we're different:</strong> Other platforms charge you again for every change. We believe you should get full value from your investment.\n            </p>\n          </div>\n        </div>\n      </section>\n\n      {/* Progress Steps */}\n      <section className=\"py-8 bg-white border-b\">\n        <div className=\"max-w-4xl mx-auto px-4\">\n          <div className=\"flex items-center justify-center space-x-2\">\n            <div className={`flex items-center space-x-2 ${step === 'pricing' ? 'text-primary' : 'text-muted-foreground'}`}>\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${\n                step === 'pricing' ? 'bg-primary text-primary-foreground' : 'bg-muted'\n              }`}>\n                1\n              </div>\n              <span className=\"font-medium hidden sm:block\">Pricing</span>\n            </div>\n            <div className=\"w-8 h-px bg-muted\"></div>\n            <div className={`flex items-center space-x-2 ${step === 'employer' ? 'text-primary' : 'text-muted-foreground'}`}>\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${\n                step === 'employer' ? 'bg-primary text-primary-foreground' : 'bg-muted'\n              }`}>\n                2\n              </div>\n              <span className=\"font-medium hidden sm:block\">Company Info</span>\n            </div>\n            <div className=\"w-8 h-px bg-muted\"></div>\n            <div className={`flex items-center space-x-2 ${step === 'job' ? 'text-primary' : 'text-muted-foreground'}`}>\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${\n                step === 'job' ? 'bg-primary text-primary-foreground' : 'bg-muted'\n              }`}>\n                3\n              </div>\n              <span className=\"font-medium hidden sm:block\">Job Details</span>\n            </div>\n            <div className=\"w-8 h-px bg-muted\"></div>\n            <div className={`flex items-center space-x-2 ${step === 'success' ? 'text-primary' : 'text-muted-foreground'}`}>\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${\n                step === 'success' ? 'bg-primary text-primary-foreground' : 'bg-muted'\n              }`}>\n                4\n              </div>\n              <span className=\"font-medium hidden sm:block\">Complete</span>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Form Section */}\n      <section className=\"py-16\">\n        <div className=\"max-w-4xl mx-auto px-4\">\n          {step === 'employer' && (\n            <Card data-testid=\"employer-form\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Building2 className=\"w-6 h-6\" />\n                  <span>Company Information</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Form {...employerForm}>\n                  <form onSubmit={employerForm.handleSubmit(onSubmitEmployer)} className=\"space-y-6\">\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={employerForm.control}\n                        name=\"companyName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Company Name *</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-company-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={employerForm.control}\n                        name=\"contactName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Contact Person *</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-contact-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={employerForm.control}\n                        name=\"contactEmail\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Email Address *</FormLabel>\n                            <FormControl>\n                              <Input type=\"email\" {...field} data-testid=\"input-contact-email\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={employerForm.control}\n                        name=\"contactPhone\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Phone Number</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-contact-phone\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={employerForm.control}\n                      name=\"companyWebsite\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Company Website</FormLabel>\n                          <FormControl>\n                            <Input {...field} placeholder=\"https://\" data-testid=\"input-company-website\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={employerForm.control}\n                      name=\"companyDescription\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Company Description *</FormLabel>\n                          <FormControl>\n                            <Textarea \n                              {...field} \n                              rows={4}\n                              placeholder=\"Tell us about your company...\"\n                              data-testid=\"input-company-description\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid md:grid-cols-3 gap-6\">\n                      <FormField\n                        control={employerForm.control}\n                        name=\"address\"\n                        render={({ field }) => (\n                          <FormItem className=\"md:col-span-2\">\n                            <FormLabel>Address *</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-address\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={employerForm.control}\n                        name=\"zipCode\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>ZIP Code *</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-zip-code\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={employerForm.control}\n                        name=\"city\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>City *</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-city\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={employerForm.control}\n                        name=\"state\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>State</FormLabel>\n                            <FormControl>\n                              <Input {...field} disabled />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <Button \n                      type=\"submit\" \n                      size=\"lg\" \n                      className=\"w-full\"\n                      disabled={registerEmployerMutation.isPending}\n                      data-testid=\"button-continue-employer\"\n                    >\n                      {registerEmployerMutation.isPending ? \"Registering...\" : \"Continue to Pricing\"}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          )}\n\n          {step === 'pricing' && (\n            <Card data-testid=\"pricing-form\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center justify-center space-x-2\">\n                  <BarChart3 className=\"w-6 h-6\" />\n                  <span>Job Posting Plans</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {/* Quantity Selector */}\n                <div className=\"mb-8 text-center\">\n                  <h3 className=\"text-lg font-semibold mb-4\">How many job postings do you need?</h3>\n                  <div className=\"flex items-center justify-center space-x-4\">\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => setQuantity(Math.max(1, quantity - 1))}\n                      disabled={quantity <= 1}\n                      data-testid=\"quantity-decrease\"\n                    >\n                      -\n                    </Button>\n                    <div className=\"w-16 text-center\">\n                      <Input \n                        type=\"number\" \n                        value={quantity} \n                        onChange={(e) => setQuantity(Math.max(1, parseInt(e.target.value) || 1))}\n                        className=\"text-center\"\n                        min=\"1\"\n                        data-testid=\"quantity-input\"\n                      />\n                    </div>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => setQuantity(quantity + 1)}\n                      data-testid=\"quantity-increase\"\n                    >\n                      +\n                    </Button>\n                  </div>\n                  {quantity >= 3 && (\n                    <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg\">\n                      <p className=\"text-green-700 font-medium\">\n                        ðŸŽ‰ Bulk Discount Applied! \n                        {quantity >= 10 ? \" Save 25%\" : quantity >= 5 ? \" Save 15%\" : \" Save 10%\"}\n                      </p>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"grid md:grid-cols-2 gap-6 mb-8\">\n                  {/* Basic Job Posting */}\n                  <Card className={`border-2 hover:border-primary transition-colors cursor-pointer ${\n                    selectedPlan === 'basic' ? 'border-primary bg-primary/5' : ''\n                  }`}>\n                    <CardContent className=\"p-6\">\n                      <div className=\"text-center mb-6\">\n                        <h3 className=\"text-2xl font-bold\">Basic Job Post</h3>\n                        <div className=\"space-y-2\">\n                          {basicPricing.discount > 0 && (\n                            <div className=\"text-lg text-muted-foreground line-through\">\n                              ${(basicPrice * quantity).toFixed(2)}\n                            </div>\n                          )}\n                          <div className=\"text-3xl font-bold text-primary\">\n                            ${basicPricing.totalPrice.toFixed(2)}\n                          </div>\n                          <p className=\"text-muted-foreground\">\n                            ${basicPricing.unitPrice.toFixed(2)} per 60-day listing\n                          </p>\n                          {basicPricing.totalSavings > 0 && (\n                            <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700\">\n                              Save ${basicPricing.totalSavings.toFixed(2)}!\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <ul className=\"space-y-3 mb-6\">\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>60-day active job listing</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Receive student applications</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Basic application analytics</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Email notifications</span>\n                        </li>\n                      </ul>\n                      <Button \n                        className=\"w-full bg-primary hover:bg-primary/90 text-white\" \n                        onClick={() => {\n                          setSelectedPlan('basic');\n                          setStep('employer');\n                        }}\n                        data-testid=\"select-basic-plan\"\n                      >\n                        Select Basic Plan\n                      </Button>\n                    </CardContent>\n                  </Card>\n\n                  {/* Premium Job Posting */}\n                  <Card className={`border-2 hover:border-primary transition-colors cursor-pointer ${\n                    selectedPlan === 'premium' ? 'border-primary bg-primary/5' : ''\n                  }`}>\n                    <CardContent className=\"p-6\">\n                      <div className=\"text-center mb-6\">\n                        <Badge className=\"mb-2\">Most Popular</Badge>\n                        <h3 className=\"text-2xl font-bold\">Premium Job Post</h3>\n                        <div className=\"space-y-2\">\n                          {premiumPricing.discount > 0 && (\n                            <div className=\"text-lg text-muted-foreground line-through\">\n                              ${(premiumPrice * quantity).toFixed(2)}\n                            </div>\n                          )}\n                          <div className=\"text-3xl font-bold text-primary\">\n                            ${premiumPricing.totalPrice.toFixed(2)}\n                          </div>\n                          <p className=\"text-muted-foreground\">\n                            ${premiumPricing.unitPrice.toFixed(2)} per 120-day listing\n                          </p>\n                          {premiumPricing.totalSavings > 0 && (\n                            <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700\">\n                              Save ${premiumPricing.totalSavings.toFixed(2)}!\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <ul className=\"space-y-3 mb-6\">\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>120-day active job listing</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Priority placement in job board</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Advanced application analytics</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Resume download & management</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Direct student messaging</span>\n                        </li>\n                        <li className=\"flex items-center space-x-2\">\n                          <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                          <span>Priority support</span>\n                        </li>\n                      </ul>\n                      <Button \n                        className=\"w-full bg-primary hover:bg-primary/90\" \n                        onClick={() => {\n                          setSelectedPlan('premium');\n                          setStep('employer');\n                        }}\n                        data-testid=\"select-premium-plan\"\n                      >\n                        Select Premium Plan\n                      </Button>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Bulk Discount Information */}\n                <div className=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                  <h4 className=\"font-semibold text-blue-900 mb-2\">ðŸ’° Volume Discounts Available</h4>\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-blue-700\">\n                    <div>ðŸ“¦ 3-4 postings: <strong>10% off</strong></div>\n                    <div>ðŸ“¦ 5-9 postings: <strong>15% off</strong></div>\n                    <div>ðŸ“¦ 10+ postings: <strong>25% off</strong></div>\n                  </div>\n                </div>\n\n                <div className=\"text-center text-sm text-muted-foreground\">\n                  <p>All plans include access to apprentice plumbers actively enrolled in Louisiana Plumbing Code training.</p>\n                  <p className=\"mt-2\">Payment will be processed after job posting approval.</p>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {step === 'job' && (\n            <div className=\"grid lg:grid-cols-2 gap-8\">\n              {/* Job Form */}\n              <Card data-testid=\"job-form\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <MapPin className=\"w-6 h-6\" />\n                    <span>Job Details</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <Form {...jobForm}>\n                    <form onSubmit={jobForm.handleSubmit(onSubmitJob)} className=\"space-y-6\">\n                    <FormField\n                      control={jobForm.control}\n                      name=\"title\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Job Title *</FormLabel>\n                          <FormControl>\n                            <Input {...field} placeholder=\"e.g., Journeyman Plumber\" data-testid=\"input-job-title\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={jobForm.control}\n                        name=\"location\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Job Location *</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., Baton Rouge, LA\" data-testid=\"input-job-location\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={jobForm.control}\n                        name=\"type\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Employment Type *</FormLabel>\n                            <Select onValueChange={field.onChange} defaultValue={field.value}>\n                              <FormControl>\n                                <SelectTrigger data-testid=\"select-job-type\">\n                                  <SelectValue placeholder=\"Select type\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                <SelectItem value=\"full_time\">Full-time</SelectItem>\n                                <SelectItem value=\"part_time\">Part-time</SelectItem>\n                                <SelectItem value=\"contract\">Contract</SelectItem>\n                                <SelectItem value=\"temporary\">Temporary</SelectItem>\n                              </SelectContent>\n                            </Select>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={jobForm.control}\n                        name=\"salaryMin\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Minimum Hourly Rate ($)</FormLabel>\n                            <FormControl>\n                              <Input {...field} type=\"number\" placeholder=\"25\" data-testid=\"input-salary-min\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={jobForm.control}\n                        name=\"salaryMax\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Maximum Hourly Rate ($)</FormLabel>\n                            <FormControl>\n                              <Input {...field} type=\"number\" placeholder=\"35\" data-testid=\"input-salary-max\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={jobForm.control}\n                      name=\"description\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Job Description *</FormLabel>\n                          <FormControl>\n                            <Textarea \n                              {...field} \n                              rows={6}\n                              placeholder=\"Describe the role, responsibilities, and what makes this position attractive...\"\n                              data-testid=\"input-job-description\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={jobForm.control}\n                      name=\"requirements\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Requirements *</FormLabel>\n                          <FormControl>\n                            <Textarea \n                              {...field} \n                              rows={4}\n                              placeholder=\"List each requirement on a new line (e.g., Louisiana plumbing license, 5+ years experience, etc.)\"\n                              data-testid=\"input-job-requirements\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={jobForm.control}\n                      name=\"benefits\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Benefits</FormLabel>\n                          <FormControl>\n                            <Textarea \n                              {...field} \n                              rows={3}\n                              placeholder=\"List each benefit on a new line (e.g., Health insurance, Paid time off, etc.)\"\n                              data-testid=\"input-job-benefits\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Alert>\n                      <CheckCircle className=\"h-4 w-4\" />\n                      <AlertDescription>\n                        Your job posting will be reviewed by our team before going live. \n                        This ensures quality and helps maintain our platform's reputation.\n                      </AlertDescription>\n                    </Alert>\n\n                    <div className=\"flex space-x-4\">\n                      <Button \n                        type=\"button\" \n                        variant=\"outline\" \n                        onClick={() => setStep('employer')}\n                        data-testid=\"button-back\"\n                      >\n                        Back\n                      </Button>\n                      <Button \n                        type=\"submit\" \n                        size=\"lg\" \n                        className=\"flex-1\"\n                        disabled={createJobMutation.isPending}\n                        data-testid=\"button-submit-job\"\n                      >\n                        {createJobMutation.isPending ? \"Submitting...\" : \"Submit Job Posting\"}\n                      </Button>\n                    </div>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n\n            {/* Live Preview */}\n            <div className=\"lg:sticky lg:top-8\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <CheckCircle className=\"w-6 h-6\" />\n                    <span>Preview - How Students See Your Job</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {/* Job Card Preview */}\n                  <div className=\"border rounded-lg p-6 bg-card hover:bg-accent/50 transition-colors\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-lg font-semibold mb-2\">\n                          {jobForm.watch(\"title\") || \"Job Title\"}\n                        </h3>\n                        <p className=\"text-muted-foreground mb-2\">\n                          {employerForm.getValues(\"companyName\") || \"Company Name\"}\n                        </p>\n                        <div className=\"flex items-center space-x-4 text-sm text-muted-foreground mb-4\">\n                          <span className=\"flex items-center space-x-1\">\n                            <MapPin className=\"w-4 h-4\" />\n                            <span>{jobForm.watch(\"location\") || \"Location\"}</span>\n                          </span>\n                          <span className=\"capitalize\">\n                            {jobForm.watch(\"type\")?.replace(\"_\", \"-\") || \"Job Type\"}\n                          </span>\n                          {(jobForm.watch(\"salaryMin\") || jobForm.watch(\"salaryMax\")) && (\n                            <span className=\"flex items-center space-x-1\">\n                              <DollarSign className=\"w-4 h-4\" />\n                              <span>\n                                {jobForm.watch(\"salaryMin\") && `$${jobForm.watch(\"salaryMin\")}`}\n                                {jobForm.watch(\"salaryMin\") && jobForm.watch(\"salaryMax\") && \"-\"}\n                                {jobForm.watch(\"salaryMax\") && `$${jobForm.watch(\"salaryMax\")}`}\n                                /hr\n                              </span>\n                            </span>\n                          )}\n                        </div>\n                        <p className=\"text-sm line-clamp-3\">\n                          {jobForm.watch(\"description\") || \"Job description will appear here...\"}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"mt-4 pt-4 border-t\">\n                      <Button className=\"w-full\" disabled>\n                        Apply Now\n                      </Button>\n                    </div>\n                  </div>\n\n                  {/* Full Job Detail Preview */}\n                  <div className=\"mt-6 p-4 border rounded-lg bg-muted/50\">\n                    <h4 className=\"font-semibold mb-3\">Full Job Details Preview</h4>\n                    \n                    {jobForm.watch(\"description\") && (\n                      <div className=\"mb-4\">\n                        <h5 className=\"font-medium mb-2\">Description</h5>\n                        <p className=\"text-sm whitespace-pre-wrap\">\n                          {jobForm.watch(\"description\")}\n                        </p>\n                      </div>\n                    )}\n\n                    {jobForm.watch(\"requirements\") && (\n                      <div className=\"mb-4\">\n                        <h5 className=\"font-medium mb-2\">Requirements</h5>\n                        <ul className=\"text-sm space-y-1\">\n                          {jobForm.watch(\"requirements\").split('\\n').filter(req => req.trim()).map((req, idx) => (\n                            <li key={idx} className=\"flex items-start space-x-2\">\n                              <CheckCircle className=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                              <span>{req.trim()}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      </div>\n                    )}\n\n                    {jobForm.watch(\"benefits\") && (\n                      <div className=\"mb-4\">\n                        <h5 className=\"font-medium mb-2\">Benefits</h5>\n                        <ul className=\"text-sm space-y-1\">\n                          {jobForm.watch(\"benefits\").split('\\n').filter(benefit => benefit.trim()).map((benefit, idx) => (\n                            <li key={idx} className=\"flex items-start space-x-2\">\n                              <CheckCircle className=\"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0\" />\n                              <span>{benefit.trim()}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n          )}\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":50652},"client/src/pages/employer/job-analytics.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { \n  Users, \n  Eye, \n  Download, \n  Mail, \n  Calendar,\n  TrendingUp,\n  FileText,\n  Clock,\n  CheckCircle,\n  UserCheck\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Job, JobApplication } from \"@/../../shared/schema\";\n\ninterface JobWithApplications extends Job {\n  applications: (JobApplication & {\n    user: {\n      firstName: string;\n      lastName: string;\n      email: string;\n      phone?: string;\n    };\n  })[];\n}\n\nexport default function JobAnalytics() {\n  const [selectedJobId, setSelectedJobId] = useState<string>(\"\");\n  const { toast } = useToast();\n\n  // This would typically require authentication to get employer's jobs\n  const { data: employerJobs = [], isLoading } = useQuery<JobWithApplications[]>({\n    queryKey: [\"/api/employer/jobs\"],\n    enabled: false, // Disable for now since we need employer auth\n  });\n\n  const selectedJob = employerJobs.find(job => job.id === selectedJobId);\n\n  const getApplicationStats = (applications: JobApplication[]) => {\n    const total = applications.length;\n    const pending = applications.filter(app => app.status === \"pending\").length;\n    const reviewed = applications.filter(app => app.status === \"reviewed\").length;\n    const hired = applications.filter(app => app.status === \"hired\").length;\n    \n    return { total, pending, reviewed, hired };\n  };\n\n  const handleDownloadResume = (resumeUrl: string, applicantName: string) => {\n    if (!resumeUrl) {\n      toast({\n        title: \"No Resume Available\",\n        description: \"This applicant hasn't uploaded a resume yet.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    // Create download link\n    const link = document.createElement('a');\n    link.href = resumeUrl;\n    link.download = `${applicantName.replace(/\\s+/g, '_')}_resume.pdf`;\n    link.click();\n    \n    toast({\n      title: \"Resume Downloaded\",\n      description: `Downloaded resume for ${applicantName}`,\n    });\n  };\n\n  const formatDate = (date: Date | null) => {\n    if (!date) return \"Unknown\";\n    return new Date(date).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-8\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"flex items-center justify-center py-16\">\n            <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <div className=\"bg-white border-b\">\n        <div className=\"max-w-6xl mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold\" data-testid=\"analytics-title\">\n                Job Application Analytics\n              </h1>\n              <p className=\"text-muted-foreground mt-1\">\n                Track applications and download resumes from apprentice plumbers\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-6xl mx-auto px-4 py-8\">\n        {employerJobs.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-16 text-center\">\n              <Users className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"text-xl font-semibold mb-2\">No Job Postings Yet</h3>\n              <p className=\"text-muted-foreground mb-6\">\n                Create your first job posting to start receiving applications from apprentice plumbers.\n              </p>\n              <Button onClick={() => window.location.href = \"/employer-portal\"}>\n                Post Your First Job\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-6\">\n            {/* Job Selector */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Select Job Posting</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Select value={selectedJobId} onValueChange={setSelectedJobId}>\n                  <SelectTrigger className=\"w-full max-w-md\">\n                    <SelectValue placeholder=\"Choose a job posting to view analytics\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {employerJobs.map((job) => (\n                      <SelectItem key={job.id} value={job.id}>\n                        {job.title} - {job.applications.length} applications\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </CardContent>\n            </Card>\n\n            {selectedJob && (\n              <div className=\"space-y-6\">\n                {/* Analytics Overview */}\n                <div className=\"grid md:grid-cols-4 gap-6\">\n                  {(() => {\n                    const stats = getApplicationStats(selectedJob.applications);\n                    return (\n                      <>\n                        <Card>\n                          <CardContent className=\"p-6\">\n                            <div className=\"flex items-center space-x-2\">\n                              <Users className=\"w-8 h-8 text-blue-500\" />\n                              <div>\n                                <p className=\"text-2xl font-bold\">{stats.total}</p>\n                                <p className=\"text-sm text-muted-foreground\">Total Applications</p>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                        \n                        <Card>\n                          <CardContent className=\"p-6\">\n                            <div className=\"flex items-center space-x-2\">\n                              <Clock className=\"w-8 h-8 text-orange-500\" />\n                              <div>\n                                <p className=\"text-2xl font-bold\">{stats.pending}</p>\n                                <p className=\"text-sm text-muted-foreground\">Pending Review</p>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                        \n                        <Card>\n                          <CardContent className=\"p-6\">\n                            <div className=\"flex items-center space-x-2\">\n                              <Eye className=\"w-8 h-8 text-blue-500\" />\n                              <div>\n                                <p className=\"text-2xl font-bold\">{stats.reviewed}</p>\n                                <p className=\"text-sm text-muted-foreground\">Reviewed</p>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                        \n                        <Card>\n                          <CardContent className=\"p-6\">\n                            <div className=\"flex items-center space-x-2\">\n                              <UserCheck className=\"w-8 h-8 text-green-500\" />\n                              <div>\n                                <p className=\"text-2xl font-bold\">{stats.hired}</p>\n                                <p className=\"text-sm text-muted-foreground\">Hired</p>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      </>\n                    );\n                  })()}\n                </div>\n\n                {/* Applications List */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <FileText className=\"w-5 h-5\" />\n                      <span>Applications for: {selectedJob.title}</span>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {selectedJob.applications.length === 0 ? (\n                      <div className=\"text-center py-8\">\n                        <Users className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                        <p className=\"text-muted-foreground\">No applications yet for this job posting.</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-4\">\n                        {selectedJob.applications.map((application) => (\n                          <div \n                            key={application.id} \n                            className=\"border rounded-lg p-4 hover:bg-muted/50 transition-colors\"\n                            data-testid={`application-${application.id}`}\n                          >\n                            <div className=\"flex items-start justify-between\">\n                              <div className=\"space-y-2 flex-1\">\n                                <div className=\"flex items-center space-x-3\">\n                                  <h4 className=\"font-semibold text-lg\">\n                                    {application.user.firstName} {application.user.lastName}\n                                  </h4>\n                                  <Badge \n                                    variant={\n                                      application.status === 'hired' ? 'default' :\n                                      application.status === 'reviewed' ? 'secondary' :\n                                      'outline'\n                                    }\n                                  >\n                                    {application.status}\n                                  </Badge>\n                                </div>\n                                \n                                <div className=\"grid md:grid-cols-2 gap-4 text-sm text-muted-foreground\">\n                                  <div className=\"flex items-center space-x-2\">\n                                    <Mail className=\"w-4 h-4\" />\n                                    <span>{application.user.email}</span>\n                                  </div>\n                                  {application.user.phone && (\n                                    <div className=\"flex items-center space-x-2\">\n                                      <span>ðŸ“ž</span>\n                                      <span>{application.user.phone}</span>\n                                    </div>\n                                  )}\n                                  <div className=\"flex items-center space-x-2\">\n                                    <Calendar className=\"w-4 h-4\" />\n                                    <span>Applied: {formatDate(application.appliedAt)}</span>\n                                  </div>\n                                </div>\n\n                                {application.coverLetter && (\n                                  <div className=\"mt-3\">\n                                    <p className=\"text-sm font-medium mb-1\">Cover Letter:</p>\n                                    <p className=\"text-sm text-muted-foreground bg-muted/50 p-3 rounded\">\n                                      {application.coverLetter}\n                                    </p>\n                                  </div>\n                                )}\n                              </div>\n                              \n                              <div className=\"flex flex-col space-y-2 ml-4\">\n                                {application.resumeUrl ? (\n                                  <Button\n                                    size=\"sm\"\n                                    onClick={() => handleDownloadResume(\n                                      application.resumeUrl!, \n                                      `${application.user.firstName}_${application.user.lastName}`\n                                    )}\n                                    data-testid={`download-resume-${application.id}`}\n                                  >\n                                    <Download className=\"w-4 h-4 mr-2\" />\n                                    Download Resume\n                                  </Button>\n                                ) : (\n                                  <Badge variant=\"outline\" className=\"text-xs\">\n                                    No Resume\n                                  </Badge>\n                                )}\n                                \n                                <Button\n                                  size=\"sm\"\n                                  variant=\"outline\"\n                                  onClick={() => window.location.href = `mailto:${application.user.email}?subject=Re: ${selectedJob.title} Application`}\n                                  data-testid={`contact-applicant-${application.id}`}\n                                >\n                                  <Mail className=\"w-4 h-4 mr-2\" />\n                                  Contact\n                                </Button>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":13852},"client/src/components/beta-banner.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Clock, Users, Zap, Star } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\ninterface BetaBannerProps {\n  className?: string;\n  showCTA?: boolean;\n}\n\nexport default function BetaBanner({ className = \"\", showCTA = true }: BetaBannerProps) {\n  // Mock beta tester count - in real app this would come from API\n  const [betaSignups, setBetaSignups] = useState(23); // Current beta signups\n  const maxBetaSignups = 100;\n  const remainingSpots = maxBetaSignups - betaSignups;\n\n  // Timer for urgency effect (resets every 24 hours)\n  const [timeLeft, setTimeLeft] = useState({\n    hours: 23,\n    minutes: 45,\n    seconds: 30\n  });\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setTimeLeft(prev => {\n        if (prev.seconds > 0) {\n          return { ...prev, seconds: prev.seconds - 1 };\n        } else if (prev.minutes > 0) {\n          return { ...prev, minutes: prev.minutes - 1, seconds: 59 };\n        } else if (prev.hours > 0) {\n          return { hours: prev.hours - 1, minutes: 59, seconds: 59 };\n        }\n        return { hours: 23, minutes: 59, seconds: 59 }; // Reset daily\n      });\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  // Simulate occasional signup updates for demo\n  useEffect(() => {\n    const signupTimer = setInterval(() => {\n      if (Math.random() < 0.1 && betaSignups < maxBetaSignups) { // 10% chance every 30 seconds\n        setBetaSignups(prev => Math.min(prev + 1, maxBetaSignups));\n      }\n    }, 30000);\n\n    return () => clearInterval(signupTimer);\n  }, [betaSignups, maxBetaSignups]);\n\n  if (betaSignups >= maxBetaSignups) {\n    return null; // Hide banner when beta is full\n  }\n\n  return (\n    <Card className={`border-2 border-primary/20 bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 ${className}`} data-testid=\"beta-banner\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex flex-col lg:flex-row items-center justify-between gap-4\">\n          {/* Left side - Beta info */}\n          <div className=\"flex-1 text-center lg:text-left\">\n            <div className=\"flex items-center justify-center lg:justify-start gap-2 mb-2\">\n              <Badge className=\"bg-primary text-primary-foreground font-bold px-3 py-1\">\n                <Star className=\"w-4 h-4 mr-1\" />\n                BETA EXCLUSIVE\n              </Badge>\n              <Badge variant=\"outline\" className=\"border-orange-500 text-orange-600 font-semibold\">\n                <Users className=\"w-4 h-4 mr-1\" />\n                {remainingSpots} spots left\n              </Badge>\n            </div>\n            \n            <h3 className=\"text-xl lg:text-2xl font-bold text-foreground mb-2\" data-testid=\"beta-title\">\n              First 100 Beta Testers Get <span className=\"text-primary\">Extra 25% Off</span>\n            </h3>\n            \n            <div className=\"flex flex-wrap items-center justify-center lg:justify-start gap-4 text-sm text-muted-foreground\">\n              <div className=\"flex items-center gap-1\">\n                <Zap className=\"w-4 h-4 text-primary\" />\n                <span><strong>50% off first month</strong></span>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <Zap className=\"w-4 h-4 text-primary\" />\n                <span><strong>25% off for full year</strong></span>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <Zap className=\"w-4 h-4 text-primary\" />\n                <span><strong>Stacks with annual discount</strong></span>\n              </div>\n            </div>\n          </div>\n\n          {/* Middle - Progress & Timer */}\n          <div className=\"flex flex-col items-center gap-3\">\n            {/* Progress bar */}\n            <div className=\"w-48\">\n              <div className=\"flex justify-between text-xs text-muted-foreground mb-1\">\n                <span>{betaSignups} signed up</span>\n                <span>{maxBetaSignups} total</span>\n              </div>\n              <div className=\"w-full bg-muted rounded-full h-2\">\n                <div \n                  className=\"bg-primary h-2 rounded-full transition-all duration-1000\"\n                  style={{ width: `${(betaSignups / maxBetaSignups) * 100}%` }}\n                  data-testid=\"beta-progress\"\n                />\n              </div>\n            </div>\n\n            {/* Countdown timer */}\n            <div className=\"flex items-center gap-2 bg-background/50 rounded-lg px-3 py-2\" data-testid=\"beta-timer\">\n              <Clock className=\"w-4 h-4 text-primary\" />\n              <div className=\"flex gap-1 font-mono text-sm\">\n                <span className=\"bg-primary text-primary-foreground px-2 py-1 rounded text-xs font-bold\">\n                  {timeLeft.hours.toString().padStart(2, '0')}\n                </span>\n                <span className=\"text-muted-foreground\">:</span>\n                <span className=\"bg-primary text-primary-foreground px-2 py-1 rounded text-xs font-bold\">\n                  {timeLeft.minutes.toString().padStart(2, '0')}\n                </span>\n                <span className=\"text-muted-foreground\">:</span>\n                <span className=\"bg-primary text-primary-foreground px-2 py-1 rounded text-xs font-bold\">\n                  {timeLeft.seconds.toString().padStart(2, '0')}\n                </span>\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground text-center\">\n              Beta pricing expires soon\n            </p>\n          </div>\n\n          {/* Right side - CTA */}\n          {showCTA && (\n            <div className=\"flex flex-col gap-2\">\n              <Link href=\"/pricing\">\n                <Button size=\"lg\" className=\"bg-primary hover:bg-primary/90 text-primary-foreground font-bold px-8\" data-testid=\"beta-cta-button\">\n                  Claim Beta Discount\n                </Button>\n              </Link>\n              <p className=\"text-xs text-muted-foreground text-center\">\n                No commitment â€¢ Cancel anytime\n              </p>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6303},"client/src/pages/accessibility.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft } from \"lucide-react\";\n\nexport default function Accessibility() {\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"accessibility-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"accessibility-title\">\n            Accessibility Statement\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"accessibility-subtitle\">\n            Last updated: January 2024\n          </p>\n        </div>\n\n        <div className=\"space-y-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Our Commitment</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                LA Plumb Prep is committed to ensuring digital accessibility for people with disabilities. We are continually improving the user experience for everyone and applying the relevant accessibility standards.\n              </p>\n              <p>\n                We strive to conform to the Web Content Accessibility Guidelines (WCAG) 2.1 AA standards to ensure our platform is accessible to all users.\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Accessibility Features</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>Our platform includes the following accessibility features:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Keyboard navigation support throughout the platform</li>\n                <li>Screen reader compatibility with proper ARIA labels</li>\n                <li>High contrast color schemes for better visibility</li>\n                <li>Resizable text that scales up to 200% without loss of functionality</li>\n                <li>Alternative text for all images and visual content</li>\n                <li>Captions and transcripts for video content</li>\n                <li>Clear and consistent navigation structure</li>\n                <li>Form labels and error messages that are clearly associated</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Assistive Technologies</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>Our platform is designed to work with:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Screen readers (JAWS, NVDA, VoiceOver, TalkBack)</li>\n                <li>Voice recognition software</li>\n                <li>Keyboard-only navigation</li>\n                <li>Switch navigation devices</li>\n                <li>Magnification software</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Known Limitations</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                While we strive for full accessibility, we acknowledge that some areas may still need improvement:\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Some third-party embedded content may not meet accessibility standards</li>\n                <li>Complex interactive tools may require additional keyboard shortcuts</li>\n                <li>PDF documents are being updated to meet accessibility requirements</li>\n              </ul>\n              <p>\n                We are actively working to address these limitations in future updates.\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Feedback and Support</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                We welcome your feedback on the accessibility of LA Plumb Prep. Please let us know if you encounter accessibility barriers:\n              </p>\n              <div className=\"mt-4\">\n                <p><strong>Email:</strong> support@laplumbprep.com</p>\n                <p><strong>Response Time:</strong> We aim to respond within 2 business days</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Accessibility Training</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                Our development team regularly receives training on accessibility best practices to ensure we continue to improve our platform for all users.\n              </p>\n              <p>\n                We also conduct regular accessibility audits and user testing with people with disabilities to identify and address potential barriers.\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Alternative Formats</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                If you need course materials or other content in an alternative format, please contact us. We can provide:\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Large print materials</li>\n                <li>Audio recordings of written content</li>\n                <li>Braille versions upon request</li>\n                <li>Plain text versions of complex documents</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Contact Us</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p>\n                For accessibility concerns or requests for assistance:\n              </p>\n              <div className=\"mt-4\">\n                <p><strong>Email:</strong> support@laplumbprep.com</p>\n                <p><strong>Address:</strong> LA Plumb Prep, Louisiana, USA</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":6621},"client/src/pages/contact.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Mail, Phone, MapPin, Clock, Send } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function Contact() {\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    subject: \"\",\n    message: \"\"\n  });\n  const { toast } = useToast();\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Create mailto link with form data\n    const subject = formData.subject || \"Contact - LA Plumb Prep\";\n    const body = `Name: ${formData.name}\\nEmail: ${formData.email}\\n\\nMessage:\\n${formData.message}`;\n    const mailtoUrl = `mailto:support@laplumbprep.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;\n    \n    window.open(mailtoUrl, '_blank');\n    \n    toast({\n      title: \"Email Client Opened\",\n      description: \"Your default email client should open with the message pre-filled.\",\n    });\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"contact-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"contact-title\">\n            Contact Us\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"contact-subtitle\">\n            Get in touch with our team. We're here to help with your certification journey.\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          {/* Contact Form */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Send className=\"w-5 h-5 text-primary\" />\n                <span>Send us a message</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div>\n                  <label htmlFor=\"name\" className=\"block text-sm font-medium mb-2\">\n                    Full Name *\n                  </label>\n                  <Input\n                    id=\"name\"\n                    name=\"name\"\n                    type=\"text\"\n                    required\n                    value={formData.name}\n                    onChange={handleChange}\n                    placeholder=\"Your full name\"\n                    data-testid=\"contact-name-input\"\n                  />\n                </div>\n                \n                <div>\n                  <label htmlFor=\"email\" className=\"block text-sm font-medium mb-2\">\n                    Email Address *\n                  </label>\n                  <Input\n                    id=\"email\"\n                    name=\"email\"\n                    type=\"email\"\n                    required\n                    value={formData.email}\n                    onChange={handleChange}\n                    placeholder=\"your.email@example.com\"\n                    data-testid=\"contact-email-input\"\n                  />\n                </div>\n                \n                <div>\n                  <label htmlFor=\"subject\" className=\"block text-sm font-medium mb-2\">\n                    Subject\n                  </label>\n                  <Input\n                    id=\"subject\"\n                    name=\"subject\"\n                    type=\"text\"\n                    value={formData.subject}\n                    onChange={handleChange}\n                    placeholder=\"What can we help you with?\"\n                    data-testid=\"contact-subject-input\"\n                  />\n                </div>\n                \n                <div>\n                  <label htmlFor=\"message\" className=\"block text-sm font-medium mb-2\">\n                    Message *\n                  </label>\n                  <Textarea\n                    id=\"message\"\n                    name=\"message\"\n                    required\n                    value={formData.message}\n                    onChange={handleChange}\n                    placeholder=\"Tell us how we can help you...\"\n                    rows={6}\n                    data-testid=\"contact-message-input\"\n                  />\n                </div>\n                \n                <Button type=\"submit\" className=\"w-full\" data-testid=\"contact-submit-button\">\n                  <Send className=\"w-4 h-4 mr-2\" />\n                  Send Message\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n\n          {/* Contact Information */}\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Mail className=\"w-5 h-5 text-primary\" />\n                  <span>Email Support</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground mb-4\">\n                  For all inquiries, support requests, and general questions.\n                </p>\n                <div className=\"space-y-2\">\n                  <p className=\"font-medium\">support@laplumbprep.com</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    We typically respond within 2 business days\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Clock className=\"w-5 h-5 text-primary\" />\n                  <span>Support Hours</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span>Monday - Friday:</span>\n                    <span className=\"font-medium\">9:00 AM - 5:00 PM CST</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Saturday - Sunday:</span>\n                    <span className=\"text-muted-foreground\">Closed</span>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground mt-4\">\n                    Emergency technical issues will be addressed as soon as possible.\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <MapPin className=\"w-5 h-5 text-primary\" />\n                  <span>Location</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground mb-2\">\n                  Proudly serving Louisiana plumbers statewide\n                </p>\n                <p className=\"font-medium\">Louisiana, USA</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Online platform available 24/7\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\">\n              <CardContent className=\"pt-6\">\n                <h3 className=\"font-semibold mb-2\">Quick Links</h3>\n                <div className=\"space-y-2 text-sm\">\n                  <div>\n                    <Link href=\"/help\" className=\"text-primary hover:underline\">\n                      Help Center\n                    </Link>\n                    <span className=\"text-muted-foreground\"> - FAQs and guides</span>\n                  </div>\n                  <div>\n                    <Link href=\"/pricing\" className=\"text-primary hover:underline\">\n                      Pricing\n                    </Link>\n                    <span className=\"text-muted-foreground\"> - Subscription plans</span>\n                  </div>\n                  <div>\n                    <Link href=\"/courses\" className=\"text-primary hover:underline\">\n                      Courses\n                    </Link>\n                    <span className=\"text-muted-foreground\"> - Certification prep</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8989},"client/src/pages/help.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Search, MessageCircle, BookOpen, Users, Mail, FileText, CreditCard } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport default function Help() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const helpCategories = [\n    {\n      icon: BookOpen,\n      title: \"Getting Started\",\n      description: \"Learn the basics of LA Plumb Prep\",\n      articles: [\n        \"How to create your account\",\n        \"Choosing the right certification track\",\n        \"Navigating your dashboard\",\n        \"Understanding course structure\",\n        \"Setting up your study schedule\"\n      ]\n    },\n    {\n      icon: CreditCard,\n      title: \"Billing & Subscriptions\",\n      description: \"Manage your subscription and payments\",\n      articles: [\n        \"Subscription plans and pricing\",\n        \"How to cancel your subscription\",\n        \"Pro-rated billing explained\",\n        \"Payment methods and security\",\n        \"Refund policy\"\n      ]\n    },\n    {\n      icon: Users,\n      title: \"Job Board\",\n      description: \"Find jobs and manage applications\",\n      articles: [\n        \"How to search for jobs\",\n        \"Creating an effective profile\",\n        \"Applying for positions\",\n        \"Employer portal guide\",\n        \"Application tracking\"\n      ]\n    },\n    {\n      icon: MessageCircle,\n      title: \"AI Tools & Features\",\n      description: \"Get help with our professional tools\",\n      articles: [\n        \"Using the AI mentor\",\n        \"Photo code analysis tool\",\n        \"Plan review features\",\n        \"Calculator tools guide\",\n        \"Pipe sizing recommendations\"\n      ]\n    }\n  ];\n\n  const popularQuestions = [\n    {\n      question: \"How do I cancel my subscription?\",\n      answer: \"You can cancel anytime from your account settings. You'll only be charged for the days you actually used the service.\"\n    },\n    {\n      question: \"Are the courses Louisiana state approved?\",\n      answer: \"Currently, only our Journeyman Plumber certification prep is active. Other tracks are coming soon and will meet all state requirements.\"\n    },\n    {\n      question: \"How does the AI mentor work?\",\n      answer: \"Our AI mentor uses advanced technology to answer your plumbing questions, review photos for code compliance, and provide personalized guidance.\"\n    },\n    {\n      question: \"Can I access courses on mobile?\",\n      answer: \"Yes! Our platform is fully responsive and works on all devices including phones, tablets, and computers.\"\n    },\n    {\n      question: \"What if I need additional help?\",\n      answer: \"Contact our support team at support@laplumbprep.com. We typically respond within 2 business days.\"\n    }\n  ];\n\n  const filteredQuestions = popularQuestions.filter(\n    q => q.question.toLowerCase().includes(searchQuery.toLowerCase()) ||\n         q.answer.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"help-page\">\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"help-title\">\n            Help Center\n          </h1>\n          <p className=\"text-muted-foreground text-lg mb-8\" data-testid=\"help-subtitle\">\n            Get answers to your questions and learn how to make the most of LA Plumb Prep\n          </p>\n\n          {/* Search */}\n          <div className=\"relative max-w-md\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4\" />\n            <Input\n              placeholder=\"Search help articles...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"help-search\"\n            />\n          </div>\n        </div>\n\n        {/* Popular Questions */}\n        <div className=\"mb-12\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Popular Questions</h2>\n          <div className=\"space-y-4\">\n            {filteredQuestions.map((item, index) => (\n              <Card key={index}>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg\">{item.question}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground\">{item.answer}</p>\n                </CardContent>\n              </Card>\n            ))}\n            {filteredQuestions.length === 0 && searchQuery && (\n              <p className=\"text-muted-foreground text-center py-8\">\n                No results found for \"{searchQuery}\". Try a different search term.\n              </p>\n            )}\n          </div>\n        </div>\n\n        {/* Help Categories */}\n        <div className=\"mb-12\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Browse by Category</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {helpCategories.map((category, index) => (\n              <Card key={index} className=\"hover:shadow-lg transition-shadow\">\n                <CardHeader>\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center\">\n                      <category.icon className=\"w-5 h-5 text-primary\" />\n                    </div>\n                    <div>\n                      <CardTitle className=\"text-xl\">{category.title}</CardTitle>\n                      <p className=\"text-muted-foreground text-sm\">{category.description}</p>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-2\">\n                    {category.articles.map((article, articleIndex) => (\n                      <li key={articleIndex}>\n                        <button className=\"text-primary hover:underline text-left\">\n                          {article}\n                        </button>\n                      </li>\n                    ))}\n                  </ul>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n\n        {/* Contact Support */}\n        <Card className=\"bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\">\n          <CardHeader className=\"text-center\">\n            <div className=\"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Mail className=\"w-8 h-8 text-primary\" />\n            </div>\n            <CardTitle className=\"text-2xl\">Still Need Help?</CardTitle>\n            <p className=\"text-muted-foreground\">\n              Can't find what you're looking for? Our support team is here to help.\n            </p>\n          </CardHeader>\n          <CardContent className=\"text-center\">\n            <div className=\"space-y-4\">\n              <div>\n                <p className=\"font-medium text-foreground mb-2\">Email Support</p>\n                <p className=\"text-muted-foreground mb-4\">\n                  Get detailed help from our support team. We typically respond within 2 business days.\n                </p>\n                <a href=\"mailto:support@laplumbprep.com\">\n                  <Button size=\"lg\" data-testid=\"contact-support-button\">\n                    <Mail className=\"w-4 h-4 mr-2\" />\n                    Contact Support\n                  </Button>\n                </a>\n              </div>\n              \n              <div className=\"border-t pt-4\">\n                <p className=\"text-sm text-muted-foreground\">\n                  <strong>Response Time:</strong> 2 business days<br />\n                  <strong>Support Hours:</strong> Monday - Friday, 9 AM - 5 PM CST\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Quick Links */}\n        <div className=\"mt-12 grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Card className=\"text-center\">\n            <CardContent className=\"pt-6\">\n              <FileText className=\"w-8 h-8 text-primary mx-auto mb-3\" />\n              <h3 className=\"font-semibold mb-2\">Documentation</h3>\n              <p className=\"text-muted-foreground text-sm mb-4\">\n                Detailed guides and tutorials\n              </p>\n              <Link href=\"/courses\">\n                <Button variant=\"outline\" size=\"sm\">\n                  View Courses\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardContent className=\"pt-6\">\n              <Users className=\"w-8 h-8 text-primary mx-auto mb-3\" />\n              <h3 className=\"font-semibold mb-2\">Job Board</h3>\n              <p className=\"text-muted-foreground text-sm mb-4\">\n                Find plumbing opportunities\n              </p>\n              <Link href=\"/jobs\">\n                <Button variant=\"outline\" size=\"sm\">\n                  Browse Jobs\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardContent className=\"pt-6\">\n              <MessageCircle className=\"w-8 h-8 text-primary mx-auto mb-3\" />\n              <h3 className=\"font-semibold mb-2\">AI Tools</h3>\n              <p className=\"text-muted-foreground text-sm mb-4\">\n                Professional plumbing tools\n              </p>\n              <Link href=\"/tools\">\n                <Button variant=\"outline\" size=\"sm\">\n                  Try Tools\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":10116},"client/src/pages/louisiana-board.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, ExternalLink, Building, FileText, Calendar, Users } from \"lucide-react\";\n\nexport default function LouisianaBoard() {\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"louisiana-board-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"board-title\">\n            Louisiana State Board of Examiners of Plumbers\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"board-subtitle\">\n            Official information and resources from the Louisiana State Plumbing Board\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Building className=\"w-5 h-5 text-primary\" />\n                <span>Board Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div>\n                  <h4 className=\"font-semibold mb-2\">Official Website</h4>\n                  <a \n                    href=\"https://www.lsbep.org\" \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className=\"flex items-center space-x-2 text-primary hover:underline\"\n                    data-testid=\"board-website-link\"\n                  >\n                    <span>www.lsbep.org</span>\n                    <ExternalLink className=\"w-4 h-4\" />\n                  </a>\n                </div>\n                \n                <div>\n                  <h4 className=\"font-semibold mb-2\">Contact Information</h4>\n                  <div className=\"text-muted-foreground space-y-1\">\n                    <p>Louisiana State Board of Examiners of Plumbers</p>\n                    <p>9800 Airline Highway, Suite 104</p>\n                    <p>Baton Rouge, LA 70815</p>\n                    <p>Phone: (225) 925-6291</p>\n                    <p>Fax: (225) 925-6292</p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <FileText className=\"w-5 h-5 text-primary\" />\n                <span>Licensing Requirements</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div>\n                  <h4 className=\"font-semibold mb-2\">Apprentice Plumber</h4>\n                  <ul className=\"text-muted-foreground text-sm space-y-1 list-disc list-inside\">\n                    <li>Must be 18 years or older</li>\n                    <li>High school diploma or equivalent</li>\n                    <li>Pass written examination</li>\n                    <li>Register with licensed master plumber</li>\n                  </ul>\n                </div>\n                \n                <div>\n                  <h4 className=\"font-semibold mb-2\">Journeyman Plumber</h4>\n                  <ul className=\"text-muted-foreground text-sm space-y-1 list-disc list-inside\">\n                    <li>4 years apprentice experience</li>\n                    <li>Pass written and practical examination</li>\n                    <li>Complete required training hours</li>\n                  </ul>\n                </div>\n                \n                <div>\n                  <h4 className=\"font-semibold mb-2\">Master Plumber</h4>\n                  <ul className=\"text-muted-foreground text-sm space-y-1 list-disc list-inside\">\n                    <li>2 years journeyman experience</li>\n                    <li>Pass comprehensive examination</li>\n                    <li>Business and law requirements</li>\n                  </ul>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Calendar className=\"w-5 h-5 text-primary\" />\n                <span>Examination Schedule</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                Plumbing examinations are held regularly throughout the year.\n              </p>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span>Written Exams:</span>\n                  <span className=\"font-medium\">Monthly</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Practical Exams:</span>\n                  <span className=\"font-medium\">Quarterly</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Application Deadline:</span>\n                  <span className=\"font-medium\">30 days prior</span>\n                </div>\n              </div>\n              <a \n                href=\"https://www.lsbep.org/examinations\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className=\"inline-flex items-center space-x-2 text-primary hover:underline mt-4\"\n                data-testid=\"exam-schedule-link\"\n              >\n                <span>View Current Schedule</span>\n                <ExternalLink className=\"w-4 h-4\" />\n              </a>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Users className=\"w-5 h-5 text-primary\" />\n                <span>Continuing Education</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                Louisiana requires continuing education to maintain your license.\n              </p>\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span>Journeyman:</span>\n                  <span className=\"font-medium\">8 hours/year</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Master:</span>\n                  <span className=\"font-medium\">8 hours/year</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Renewal:</span>\n                  <span className=\"font-medium\">Annually</span>\n                </div>\n              </div>\n              <p className=\"text-sm text-muted-foreground mt-4\">\n                * LA Plumb Prep courses can count toward continuing education requirements\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card className=\"bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\">\n          <CardHeader>\n            <CardTitle>Important Resources</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <h4 className=\"font-semibold mb-2\">Official Forms & Applications</h4>\n                <ul className=\"space-y-2 text-sm\">\n                  <li>\n                    <a \n                      href=\"https://www.lsbep.org/forms\" \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                      className=\"text-primary hover:underline flex items-center space-x-1\"\n                    >\n                      <span>License Applications</span>\n                      <ExternalLink className=\"w-3 h-3\" />\n                    </a>\n                  </li>\n                  <li>\n                    <a \n                      href=\"https://www.lsbep.org/renewals\" \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                      className=\"text-primary hover:underline flex items-center space-x-1\"\n                    >\n                      <span>License Renewals</span>\n                      <ExternalLink className=\"w-3 h-3\" />\n                    </a>\n                  </li>\n                </ul>\n              </div>\n              \n              <div>\n                <h4 className=\"font-semibold mb-2\">Code & Regulations</h4>\n                <ul className=\"space-y-2 text-sm\">\n                  <li>\n                    <a \n                      href=\"https://www.lsbep.org/codes\" \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                      className=\"text-primary hover:underline flex items-center space-x-1\"\n                    >\n                      <span>Louisiana Plumbing Code</span>\n                      <ExternalLink className=\"w-3 h-3\" />\n                    </a>\n                  </li>\n                  <li>\n                    <a \n                      href=\"https://www.lsbep.org/regulations\" \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                      className=\"text-primary hover:underline flex items-center space-x-1\"\n                    >\n                      <span>Board Regulations</span>\n                      <ExternalLink className=\"w-3 h-3\" />\n                    </a>\n                  </li>\n                </ul>\n              </div>\n            </div>\n            \n            <div className=\"mt-6 pt-4 border-t\">\n              <p className=\"text-sm text-muted-foreground\">\n                <strong>Disclaimer:</strong> This information is provided for reference only. \n                Always verify current requirements and procedures with the official Louisiana State Board website.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":10414},"client/src/pages/privacy.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft } from \"lucide-react\";\n\nexport default function Privacy() {\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"privacy-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"privacy-title\">\n            Privacy Policy\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"privacy-subtitle\">\n            Last updated: January 2024\n          </p>\n        </div>\n\n        <div className=\"space-y-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Information We Collect</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                At LA Plumb Prep, we collect information that you provide directly to us, such as when you:\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Create an account or enroll in our courses</li>\n                <li>Contact us for support or information</li>\n                <li>Subscribe to our newsletters or updates</li>\n                <li>Use our AI mentor and photo analysis tools</li>\n                <li>Apply for jobs through our job board</li>\n              </ul>\n              <p>\n                This information may include your name, email address, phone number, professional certifications, and payment information.\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>How We Use Your Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>We use the information we collect to:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Provide and improve our educational services</li>\n                <li>Process payments and manage subscriptions</li>\n                <li>Send course updates and important notifications</li>\n                <li>Provide customer support</li>\n                <li>Personalize your learning experience</li>\n                <li>Connect job seekers with employers through our job board</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Information Sharing</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy:\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>With service providers who assist in operating our platform</li>\n                <li>When required by law or to protect our rights</li>\n                <li>With employers when you apply for jobs (with your explicit consent)</li>\n                <li>In connection with a business transfer or acquisition</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Data Security</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction. This includes:\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Encryption of sensitive data in transit and at rest</li>\n                <li>Regular security audits and updates</li>\n                <li>Limited access to personal information on a need-to-know basis</li>\n                <li>Secure payment processing through trusted providers</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Your Rights</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>You have the right to:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Access and update your personal information</li>\n                <li>Delete your account and associated data</li>\n                <li>Opt out of marketing communications</li>\n                <li>Request a copy of your data</li>\n                <li>Withdraw consent for data processing</li>\n              </ul>\n              <p>\n                To exercise these rights, please contact us at{\" \"}\n                <a href=\"mailto:support@laplumbprep.com\" className=\"text-primary hover:underline\">\n                  support@laplumbprep.com\n                </a>\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Contact Us</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p>\n                If you have questions about this Privacy Policy, please contact us at:\n              </p>\n              <div className=\"mt-4\">\n                <p><strong>Email:</strong> support@laplumbprep.com</p>\n                <p><strong>Address:</strong> LA Plumb Prep, Louisiana, USA</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5798},"client/src/pages/referrals.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { DollarSign, Users, Copy, TrendingUp, Info, MessageSquare, Instagram, Facebook, Twitter, Settings, Mail } from \"lucide-react\";\nimport { SiLinkedin, SiWhatsapp } from \"react-icons/si\";\nimport { Link } from \"wouter\";\n\ninterface ReferralStats {\n  referralCode: string;\n  planTier: \"basic\" | \"professional\" | \"master\";\n  totalReferrals: number;\n  earnings: {\n    total: number;\n    unpaid: number;\n    paid: number;\n  };\n  recentReferrals: any[];\n}\n\ninterface CommissionPreview {\n  referrerTier: string;\n  commissionPreviews: {\n    basic: { eligibleTier: string; eligiblePrice: number; commissionAmount: number };\n    professional: { eligibleTier: string; eligiblePrice: number; commissionAmount: number };\n    master: { eligibleTier: string; eligiblePrice: number; commissionAmount: number };\n  };\n  note: string;\n}\n\nexport default function Referrals() {\n  const { toast } = useToast();\n  const [referralUrl, setReferralUrl] = useState(\"\");\n\n  // Fetch referral stats\n  const { data: stats, isLoading: statsLoading, refetch: refetchStats } = useQuery<ReferralStats>({\n    queryKey: [\"/api/referrals/stats\"],\n    retry: (failureCount, error: any) => {\n      // Retry 401 errors up to 5 times in case user just logged in\n      if (error?.message?.includes('401') && failureCount < 5) {\n        return true;\n      }\n      return false;\n    },\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 3000),\n    staleTime: 0, // Always consider data stale to force refresh\n    gcTime: 0, // Don't cache failed responses\n  });\n\n  // Fetch commission preview\n  const { data: preview, isLoading: previewLoading, refetch: refetchPreview } = useQuery<CommissionPreview>({\n    queryKey: [\"/api/referrals/commission-preview\"],\n    retry: (failureCount, error: any) => {\n      // Retry 401 errors up to 5 times in case user just logged in\n      if (error?.message?.includes('401') && failureCount < 5) {\n        return true;\n      }\n      return false;\n    },\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 3000),\n    staleTime: 0, // Always consider data stale to force refresh\n    gcTime: 0, // Don't cache failed responses\n  });\n\n  // Fetch monthly earnings summary\n  const { data: monthlyEarnings, isLoading: monthlyLoading, refetch: refetchMonthly } = useQuery({\n    queryKey: [\"/api/referrals/monthly-earnings-summary\"],\n    retry: (failureCount, error: any) => {\n      // Retry 401 errors up to 5 times in case user just logged in\n      if (error?.message?.includes('401') && failureCount < 5) {\n        return true;\n      }\n      return false;\n    },\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 3000),\n    staleTime: 0, // Always consider data stale to force refresh\n    gcTime: 0, // Don't cache failed responses\n  });\n\n  useEffect(() => {\n    if (stats?.referralCode) {\n      setReferralUrl(`${window.location.origin}?ref=${stats.referralCode}`);\n    }\n  }, [stats]);\n\n  // Add a manual refresh function for when data is missing\n  const refreshAllData = () => {\n    refetchStats();\n    refetchPreview();\n    refetchMonthly();\n  };\n\n  const copyReferralUrl = async () => {\n    try {\n      await navigator.clipboard.writeText(referralUrl);\n      toast({\n        title: \"Copied!\",\n        description: \"Referral link copied to clipboard\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy referral link\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const shareReferralUrl = async () => {\n    // Force use of the custom email template instead of Web Share API for email\n    const template = {\n      text: `ðŸ”§ Just passed my Louisiana plumbing exam with LA Plumb Prep! Their practice tests and AI mentor were game-changers. \\n\\nIf you're studying for your Louisiana plumbing certification, check them out: ${referralUrl} \\n\\n#LouisianaPlumber #PlumbingCertification #StudySuccess`\n    };\n    \n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: \"LA Plumb Prep - Louisiana Plumbing Certification\",\n          text: \"Join me on LA Plumb Prep for Louisiana plumbing certification prep!\",\n          url: referralUrl,\n        });\n      } catch (error) {\n        // User cancelled or error occurred, fallback to copy\n        copyReferralUrl();\n      }\n    } else {\n      copyReferralUrl();\n    }\n  };\n\n  const getTierBadgeColor = (tier: string) => {\n    switch (tier) {\n      case \"basic\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"professional\":\n        return \"bg-purple-100 text-purple-800\";\n      case \"master\":\n        return \"bg-orange-100 text-orange-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getTierDisplayName = (tier: string) => {\n    return tier.charAt(0).toUpperCase() + tier.slice(1);\n  };\n\n  // Social media post templates\n  const getPostTemplates = (referralCode: string, referralUrl: string) => [\n    {\n      id: \"success-story\",\n      title: \"Success Story\",\n      platform: \"General\",\n      icon: MessageSquare,\n      text: `ðŸ”§ Just passed my Louisiana plumbing exam with LA Plumb Prep! Their practice tests and AI mentor were game-changers. \\n\\nIf you're studying for your Louisiana plumbing certification, check them out: ${referralUrl} \\n\\n#LouisianaPlumber #PlumbingCertification #StudySuccess`,\n      hashtags: \"#LouisianaPlumber #PlumbingCertification #StudySuccess\"\n    },\n    {\n      id: \"professional-tip\",\n      title: \"Professional Tip\",\n      platform: \"LinkedIn\",\n      icon: MessageSquare,\n      text: `ðŸ’¡ Pro tip for Louisiana plumbers: LA Plumb Prep's AI-powered tools have revolutionized how I prepare for certifications and handle code compliance on job sites.\\n\\nTheir platform covers everything from Journeyman prep to specialized certifications. Worth checking out: ${referralUrl}\\n\\n#PlumbingProfessional #LouisianaPlumbing #ContinuingEducation`,\n      hashtags: \"#PlumbingProfessional #LouisianaPlumbing #ContinuingEducation\"\n    },\n    {\n      id: \"recommendation\",\n      title: \"Colleague Recommendation\",\n      platform: \"Facebook\",\n      icon: MessageSquare,\n      text: `ðŸš° Fellow plumbers! I've been using LA Plumb Prep for my Louisiana certifications and it's been incredible. The practice tests mirror the real exams perfectly, and their AI mentor answers any code questions instantly.\\n\\nDefinitely recommend checking it out if you're serious about advancing your plumbing career: ${referralUrl}`,\n      hashtags: \"\"\n    },\n    {\n      id: \"quick-tip\",\n      title: \"Quick Study Tip\",\n      platform: \"Twitter/X\",\n      icon: MessageSquare,\n      text: `ðŸ”§ Louisiana plumbers: LA Plumb Prep's AI mentor is like having a master plumber available 24/7 for code questions! Game changer for exam prep ðŸ’¯\\n\\n${referralUrl}\\n\\n#PlumbingLife #LouisianaPlumber #ExamPrep`,\n      hashtags: \"#PlumbingLife #LouisianaPlumber #ExamPrep\"\n    }\n  ];\n\n  const shareToSocialMedia = (template: any, platform: string) => {\n    const baseUrls = {\n      facebook: 'https://www.facebook.com/sharer/sharer.php?u=',\n      twitter: 'https://twitter.com/intent/tweet?text=',\n      linkedin: 'https://www.linkedin.com/sharing/share-offsite/?url=',\n      whatsapp: 'https://wa.me/?text='\n    };\n\n    let shareUrl = '';\n    \n    switch (platform.toLowerCase()) {\n      case 'facebook':\n        shareUrl = `${baseUrls.facebook}${encodeURIComponent(referralUrl)}&quote=${encodeURIComponent(template.text)}`;\n        break;\n      case 'twitter':\n        shareUrl = `${baseUrls.twitter}${encodeURIComponent(template.text)}`;\n        break;\n      case 'linkedin':\n        shareUrl = `${baseUrls.linkedin}${encodeURIComponent(referralUrl)}&summary=${encodeURIComponent(template.text)}`;\n        break;\n      case 'whatsapp':\n        shareUrl = `${baseUrls.whatsapp}${encodeURIComponent(template.text)}`;\n        break;\n      case 'email':\n        const emailSubject = `Check out LA Plumb Prep - Louisiana Plumbing Certification`;\n        const emailBody = `Hi there!\n\nI wanted to share something that's been really helpful for my plumbing career:\n\nðŸ”§ I've been using LA Plumb Prep for my Louisiana plumbing certification studies, and their practice tests and AI mentor have been game-changers.\n\nIf you're studying for your Louisiana plumbing certification, check them out: ${referralUrl}\n\nLA Plumb Prep is Louisiana's premier plumbing certification platform with:\nâ€¢ Complete Louisiana Plumbing Code preparation courses\nâ€¢ AI-powered mentor and code checker  \nâ€¢ Practice exams that mirror the real tests\nâ€¢ Professional tools and calculators\nâ€¢ Job placement assistance\n\nðŸŽ¯ BETA TESTER BENEFITS - Limited Time:\nAs a beta tester, you'll get:\nâ€¢ 60% OFF regular pricing (Basic $19.99 vs $49.99, Professional $29.99 vs $79.99, Master $49.99 vs $99.99)\nâ€¢ Priority access to new features as they're released\nâ€¢ Direct input on platform improvements and new course content\nâ€¢ Lifetime grandfathered pricing - your beta rate stays locked in forever\nâ€¢ Exclusive beta tester community and networking opportunities\n\nThis beta pricing won't last long, so it's a great time to join!\n\nBest regards,\n[Your name]`;\n        const mailtoUrl = `mailto:?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;\n        \n        // Try to open email client\n        window.location.href = mailtoUrl;\n        \n        // Show success message and copy as backup\n        setTimeout(() => {\n          navigator.clipboard.writeText(`Subject: ${emailSubject}\\n\\n${emailBody}`);\n          toast({\n            title: \"Email Template Ready\",\n            description: \"If your email client didn't open automatically, the content has been copied to your clipboard.\",\n          });\n        }, 1000);\n        return;\n      default:\n        // Copy to clipboard as fallback\n        navigator.clipboard.writeText(template.text);\n        toast({\n          title: \"Copied!\",\n          description: \"Post template copied to clipboard\",\n        });\n        return;\n    }\n\n    window.open(shareUrl, '_blank', 'width=600,height=400');\n  };\n\n  const copyTemplate = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n      title: \"Copied!\",\n      description: \"Post template copied to clipboard\",\n    });\n  };\n\n  if (statsLoading || previewLoading || monthlyLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <section className=\"py-12 bg-gradient-to-br from-primary/10 to-accent/10\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <h1 className=\"text-4xl lg:text-5xl font-bold text-foreground mb-4\" data-testid=\"referral-header\">\n              Referral Program\n            </h1>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\">\n              Earn money by referring plumbers to LA Plumb Prep. Commission is capped at your plan tier or lower.\n            </p>\n          </div>\n        </div>\n      </section>\n\n      {/* Main Content */}\n      <section className=\"py-12\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            \n            {/* Stats Cards */}\n            <div className=\"lg:col-span-2 space-y-6\">\n              \n              {/* Overview Stats */}\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center\">\n                      <DollarSign className=\"h-8 w-8 text-green-600\" />\n                      <div className=\"ml-4\">\n                        <p className=\"text-sm font-medium text-muted-foreground\">Total Earnings</p>\n                        <p className=\"text-2xl font-bold text-foreground\" data-testid=\"total-earnings\">\n                          ${stats?.earnings.total.toFixed(2) || \"0.00\"}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center\">\n                      <Users className=\"h-8 w-8 text-blue-600\" />\n                      <div className=\"ml-4\">\n                        <p className=\"text-sm font-medium text-muted-foreground\">Total Referrals</p>\n                        <p className=\"text-2xl font-bold text-foreground\" data-testid=\"total-referrals\">\n                          {stats?.totalReferrals || 0}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center\">\n                      <TrendingUp className=\"h-8 w-8 text-purple-600\" />\n                      <div className=\"ml-4\">\n                        <p className=\"text-sm font-medium text-muted-foreground\">Unpaid</p>\n                        <p className=\"text-2xl font-bold text-foreground\" data-testid=\"unpaid-earnings\">\n                          ${stats?.earnings.unpaid.toFixed(2) || \"0.00\"}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Commission Rates */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Info className=\"h-5 w-5\" />\n                    Your Commission Rates\n                    <Badge className={getTierBadgeColor(stats?.planTier || \"basic\")}>\n                      {getTierDisplayName(stats?.planTier || \"basic\")} Plan\n                    </Badge>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"text-sm text-muted-foreground mb-4\">\n                      {preview?.note}\n                    </div>\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                      {preview && Object.entries(preview.commissionPreviews).map(([tier, commission]) => (\n                        <div key={tier} className=\"p-4 border rounded-lg\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"font-medium\">{getTierDisplayName(tier)}</span>\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              ${commission.commissionAmount.toFixed(2)}\n                            </Badge>\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            10% of ${commission.eligiblePrice}/month\n                          </div>\n                          {commission.eligibleTier !== tier && (\n                            <div className=\"text-xs text-orange-600 mt-1\">\n                              Capped at {getTierDisplayName(commission.eligibleTier)} tier\n                            </div>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Monthly Recurring Earnings */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"h-5 w-5 text-green-600\" />\n                    Monthly Recurring Earnings\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"p-4 bg-green-50 rounded-lg\">\n                        <div className=\"text-sm text-muted-foreground\">Total Monthly</div>\n                        <div className=\"text-2xl font-bold text-green-600\">\n                          ${(monthlyEarnings as any)?.totalMonthlyEarnings?.toFixed(2) || \"0.00\"}\n                        </div>\n                      </div>\n                      <div className=\"p-4 bg-orange-50 rounded-lg\">\n                        <div className=\"text-sm text-muted-foreground\">Unpaid Monthly</div>\n                        <div className=\"text-2xl font-bold text-orange-600\">\n                          ${(monthlyEarnings as any)?.unpaidMonthlyEarnings?.toFixed(2) || \"0.00\"}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    {(monthlyEarnings as any)?.monthlyBreakdown && (monthlyEarnings as any).monthlyBreakdown.length > 0 ? (\n                      <div className=\"space-y-3\">\n                        <div className=\"text-sm font-medium text-muted-foreground\">Monthly Breakdown:</div>\n                        {(monthlyEarnings as any).monthlyBreakdown.slice(0, 6).map((month: any) => (\n                          <div key={month.month} className=\"flex justify-between items-center p-3 border rounded-lg\">\n                            <div>\n                              <div className=\"font-medium\">\n                                {new Date(month.month + '-01').toLocaleDateString('en-US', { \n                                  year: 'numeric', \n                                  month: 'long' \n                                })}\n                              </div>\n                              <div className=\"text-sm text-muted-foreground\">\n                                {month.count} commission{month.count !== 1 ? 's' : ''}\n                              </div>\n                            </div>\n                            <div className=\"text-right\">\n                              <div className=\"font-bold text-green-600\">\n                                ${month.total.toFixed(2)}\n                              </div>\n                              <div className=\"text-xs text-muted-foreground\">\n                                {month.unpaid > 0 ? `$${month.unpaid.toFixed(2)} unpaid` : 'All paid'}\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-6 text-muted-foreground\">\n                        <div className=\"text-sm\">\n                          ðŸš€ <strong>Recurring Monthly Earnings!</strong>\n                        </div>\n                        <div className=\"text-xs mt-1\">\n                          When your referrals upgrade their plans, you earn monthly commissions based on your tier!\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Recent Referrals */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Recent Referrals</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {stats?.recentReferrals && stats.recentReferrals.length > 0 ? (\n                    <div className=\"space-y-4\">\n                      {stats.recentReferrals.map((referral, index) => (\n                        <div key={index} className=\"flex justify-between items-center p-3 border rounded-lg\">\n                          <div>\n                            <div className=\"font-medium\">\n                              {getTierDisplayName(referral.referredPlanTier)} Plan Referral\n                            </div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {new Date(referral.createdAt).toLocaleDateString()}\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className=\"font-bold text-green-600\">\n                              +${Number(referral.commissionAmount).toFixed(2)}\n                            </div>\n                            <div className=\"text-xs text-muted-foreground\">\n                              {referral.isPaid ? \"Paid\" : \"Pending\"}\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No referrals yet. Start sharing your link to earn commissions!\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Share Section */}\n            <div className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Share Your Link</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <Label htmlFor=\"referral-code\">Your Referral Code</Label>\n                    <Input\n                      id=\"referral-code\"\n                      value={stats?.referralCode || \"\"}\n                      readOnly\n                      className=\"font-mono\"\n                      data-testid=\"referral-code\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"referral-url\">Referral Link</Label>\n                    <Input\n                      id=\"referral-url\"\n                      value={referralUrl}\n                      readOnly\n                      className=\"font-mono text-sm\"\n                      data-testid=\"referral-url\"\n                    />\n                  </div>\n\n                  <div className=\"flex gap-2\">\n                    <Button onClick={copyReferralUrl} variant=\"outline\" className=\"flex-1\" data-testid=\"copy-link\">\n                      <Copy className=\"h-4 w-4 mr-2\" />\n                      Copy Link\n                    </Button>\n                    <Button onClick={() => {\n                      shareToSocialMedia({\n                        text: `ðŸ”§ I've been using LA Plumb Prep for my Louisiana plumbing certification studies, and their practice tests and AI mentor have been game-changers. \\n\\nIf you're studying for your Louisiana plumbing certification, check them out: ${referralUrl} \\n\\n#LouisianaPlumber #PlumbingCertification #StudySuccess`\n                      }, 'email');\n                    }} className=\"flex-1\" data-testid=\"email-link\">\n                      <Mail className=\"h-4 w-4 mr-2\" />\n                      Email\n                    </Button>\n                    {!stats?.referralCode && (\n                      <Button\n                        variant=\"secondary\"\n                        onClick={refreshAllData}\n                        data-testid=\"refresh-data\"\n                      >\n                        <TrendingUp className=\"w-4 h-4 mr-2\" />\n                        Load Data\n                      </Button>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Social Media Post Templates */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <MessageSquare className=\"h-5 w-5\" />\n                    Social Media Templates\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <p className=\"text-sm text-muted-foreground\">\n                      Ready-to-share posts with your referral link embedded. Click to share or copy!\n                    </p>\n                    \n                    {getPostTemplates(stats?.referralCode || \"DEMO123\", referralUrl).map((template) => (\n                      <div key={template.id} className=\"border rounded-lg p-4 space-y-3\">\n                        <div className=\"flex justify-between items-start\">\n                          <div>\n                            <h4 className=\"font-medium text-sm\">{template.title}</h4>\n                            <p className=\"text-xs text-muted-foreground\">{template.platform}</p>\n                          </div>\n                          <template.icon className=\"h-4 w-4 text-muted-foreground\" />\n                        </div>\n                        \n                        <div className=\"bg-gray-50 p-3 rounded text-xs\">\n                          <div className=\"whitespace-pre-wrap line-clamp-4\">{template.text}</div>\n                        </div>\n                        \n                        <div className=\"flex gap-2\">\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\" \n                            onClick={() => copyTemplate(template.text)}\n                            className=\"flex-1\"\n                            data-testid={`copy-template-${template.id}`}\n                          >\n                            <Copy className=\"h-3 w-3 mr-1\" />\n                            Copy\n                          </Button>\n                          \n                          <div className=\"flex gap-1\">\n                            <Button \n                              size=\"sm\" \n                              onClick={() => shareToSocialMedia(template, 'email')}\n                              className=\"px-2\"\n                              data-testid={`share-email-${template.id}`}\n                              title=\"Share via Email\"\n                            >\n                              <Mail className=\"h-3 w-3\" />\n                            </Button>\n                            <Button \n                              size=\"sm\" \n                              onClick={() => shareToSocialMedia(template, 'facebook')}\n                              className=\"px-2\"\n                              data-testid={`share-facebook-${template.id}`}\n                            >\n                              <Facebook className=\"h-3 w-3\" />\n                            </Button>\n                            <Button \n                              size=\"sm\" \n                              onClick={() => shareToSocialMedia(template, 'twitter')}\n                              className=\"px-2\"\n                              data-testid={`share-twitter-${template.id}`}\n                            >\n                              <Twitter className=\"h-3 w-3\" />\n                            </Button>\n                            <Button \n                              size=\"sm\" \n                              onClick={() => shareToSocialMedia(template, 'linkedin')}\n                              className=\"px-2\"\n                              data-testid={`share-linkedin-${template.id}`}\n                            >\n                              <SiLinkedin className=\"h-3 w-3\" />\n                            </Button>\n                            <Button \n                              size=\"sm\" \n                              onClick={() => shareToSocialMedia(template, 'whatsapp')}\n                              className=\"px-2\"\n                              data-testid={`share-whatsapp-${template.id}`}\n                            >\n                              <SiWhatsapp className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Payment Settings */}\n              <Card className=\"border-blue-200 bg-blue-50\">\n                <CardHeader>\n                  <CardTitle className=\"text-blue-800 flex items-center gap-2\">\n                    <Settings className=\"h-5 w-5\" />\n                    Payment Settings\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-blue-700 mb-4\">\n                    Configure your payment method, set minimum payout amounts, and manage your earnings.\n                  </p>\n                  <Link href=\"/payment-settings\">\n                    <Button className=\"w-full bg-blue-600 hover:bg-blue-700\" data-testid=\"payment-settings\">\n                      Manage Payments\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n\n              {/* Upgrade CTA */}\n              {stats?.planTier === \"basic\" && (\n                <Card className=\"border-purple-200 bg-purple-50\">\n                  <CardHeader>\n                    <CardTitle className=\"text-purple-800\">Increase Your Earnings</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-sm text-purple-700 mb-4\">\n                      Upgrade to Professional or Master to earn higher commissions on referrals!\n                    </p>\n                    <Link href=\"/pricing\">\n                      <Button className=\"w-full bg-purple-600 hover:bg-purple-700\" data-testid=\"upgrade-plan\">\n                        Upgrade Plan\n                      </Button>\n                    </Link>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* How It Works */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>How It Works</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div className=\"flex gap-3\">\n                    <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold\">1</div>\n                    <div>Share your referral link with other plumbers</div>\n                  </div>\n                  <div className=\"flex gap-3\">\n                    <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold\">2</div>\n                    <div>They sign up using your link</div>\n                  </div>\n                  <div className=\"flex gap-3\">\n                    <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold\">3</div>\n                    <div>Earn 10% commission (capped at your plan tier)</div>\n                  </div>\n                  <div className=\"flex gap-3\">\n                    <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold\">4</div>\n                    <div>Get paid monthly via your preferred method</div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":31690},"client/src/pages/system-status.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, CheckCircle, AlertTriangle, XCircle, Clock, Server, Database, Wifi, Shield } from \"lucide-react\";\n\nexport default function SystemStatus() {\n  // Mock status data - in a real app this would come from an API\n  const systemStatus = {\n    overall: \"operational\", // operational, degraded, outage\n    lastUpdated: new Date().toLocaleString(),\n    services: [\n      {\n        name: \"Website & Platform\",\n        status: \"operational\",\n        description: \"Main website and learning platform\",\n        icon: Server,\n        uptime: \"99.9%\"\n      },\n      {\n        name: \"Video Streaming\",\n        status: \"operational\", \n        description: \"Course videos and content delivery\",\n        icon: Wifi,\n        uptime: \"99.8%\"\n      },\n      {\n        name: \"User Authentication\",\n        status: \"operational\",\n        description: \"Login and account management\",\n        icon: Shield,\n        uptime: \"100%\"\n      },\n      {\n        name: \"Database Services\",\n        status: \"operational\",\n        description: \"User data and course progress\",\n        icon: Database,\n        uptime: \"99.9%\"\n      }\n    ],\n    recentIncidents: [\n      {\n        id: 1,\n        title: \"Brief video streaming interruption\",\n        description: \"Some users experienced slow video loading\",\n        status: \"resolved\",\n        date: \"2024-01-15\",\n        duration: \"15 minutes\"\n      },\n      {\n        id: 2,\n        title: \"Scheduled maintenance\",\n        description: \"Database optimization and security updates\",\n        status: \"completed\",\n        date: \"2024-01-10\", \n        duration: \"2 hours\"\n      }\n    ]\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"operational\":\n        return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\n      case \"degraded\":\n        return <AlertTriangle className=\"w-5 h-5 text-yellow-500\" />;\n      case \"outage\":\n        return <XCircle className=\"w-5 h-5 text-red-500\" />;\n      default:\n        return <Clock className=\"w-5 h-5 text-gray-500\" />;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"operational\":\n        return <Badge className=\"bg-green-100 text-green-800 border-green-200\">Operational</Badge>;\n      case \"degraded\":\n        return <Badge className=\"bg-yellow-100 text-yellow-800 border-yellow-200\">Degraded</Badge>;\n      case \"outage\":\n        return <Badge className=\"bg-red-100 text-red-800 border-red-200\">Outage</Badge>;\n      case \"resolved\":\n        return <Badge className=\"bg-green-100 text-green-800 border-green-200\">Resolved</Badge>;\n      case \"completed\":\n        return <Badge className=\"bg-blue-100 text-blue-800 border-blue-200\">Completed</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"system-status-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"status-title\">\n            System Status\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"status-subtitle\">\n            Real-time status of LA Plumb Prep services and infrastructure\n          </p>\n        </div>\n\n        {/* Overall Status */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center space-x-2\">\n                {getStatusIcon(systemStatus.overall)}\n                <span>Overall System Status</span>\n              </CardTitle>\n              {getStatusBadge(systemStatus.overall)}\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <p className=\"text-muted-foreground\">\n                All systems are operating normally\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                Last updated: {systemStatus.lastUpdated}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Service Status */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Service Status</h2>\n          <div className=\"space-y-4\">\n            {systemStatus.services.map((service, index) => (\n              <Card key={index}>\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center\">\n                        <service.icon className=\"w-5 h-5 text-primary\" />\n                      </div>\n                      <div>\n                        <h3 className=\"font-semibold\">{service.name}</h3>\n                        <p className=\"text-muted-foreground text-sm\">{service.description}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"text-right\">\n                        <p className=\"text-sm font-medium\">{service.uptime} uptime</p>\n                        <p className=\"text-xs text-muted-foreground\">Last 30 days</p>\n                      </div>\n                      {getStatusBadge(service.status)}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n\n        {/* Recent Incidents */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Recent Incidents</h2>\n          {systemStatus.recentIncidents.length > 0 ? (\n            <div className=\"space-y-4\">\n              {systemStatus.recentIncidents.map((incident) => (\n                <Card key={incident.id}>\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-lg\">{incident.title}</CardTitle>\n                      {getStatusBadge(incident.status)}\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-muted-foreground mb-2\">{incident.description}</p>\n                    <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\n                      <span>Date: {incident.date}</span>\n                      <span>Duration: {incident.duration}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"text-center py-8\">\n                  <CheckCircle className=\"w-12 h-12 text-green-500 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">No Recent Incidents</h3>\n                  <p className=\"text-muted-foreground\">\n                    All services have been running smoothly with no reported issues.\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n\n        {/* Status History & Info */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Performance Metrics</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"flex justify-between\">\n                  <span>Average Response Time:</span>\n                  <span className=\"font-medium\">&lt; 200ms</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Overall Uptime (30 days):</span>\n                  <span className=\"font-medium\">99.9%</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Active Users:</span>\n                  <span className=\"font-medium\">1,200+</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Data Centers:</span>\n                  <span className=\"font-medium\">2 (Primary + Backup)</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Need Help?</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                If you're experiencing issues not reflected here, please contact our support team.\n              </p>\n              <div className=\"space-y-2\">\n                <Link href=\"/technical-support\">\n                  <Button variant=\"outline\" className=\"w-full justify-start\">\n                    Technical Support\n                  </Button>\n                </Link>\n                <Link href=\"/contact\">\n                  <Button variant=\"outline\" className=\"w-full justify-start\">\n                    Contact Support\n                  </Button>\n                </Link>\n                <Link href=\"/help\">\n                  <Button variant=\"outline\" className=\"w-full justify-start\">\n                    Help Center\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Footer Info */}\n        <Card className=\"mt-8 bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <h3 className=\"font-semibold mb-2\">Stay Updated</h3>\n              <p className=\"text-muted-foreground text-sm\">\n                This page is automatically updated every 5 minutes. For real-time notifications of any service disruptions, \n                you can contact support@laplumbprep.com to be added to our status notification list.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":10604},"client/src/pages/technical-support.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Monitor, Smartphone, Wifi, RefreshCw, AlertTriangle, CheckCircle, HelpCircle } from \"lucide-react\";\n\nexport default function TechnicalSupport() {\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"technical-support-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"tech-support-title\">\n            Technical Support\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"tech-support-subtitle\">\n            Get help with technical issues and platform troubleshooting\n          </p>\n        </div>\n\n        {/* Quick Fixes */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Quick Fixes</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <RefreshCw className=\"w-5 h-5 text-primary\" />\n                  <span>Clear Cache & Refresh</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground mb-4\">\n                  Solves most loading and display issues\n                </p>\n                <div className=\"space-y-2 text-sm\">\n                  <p><strong>Chrome/Edge:</strong> Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)</p>\n                  <p><strong>Firefox:</strong> Ctrl+F5 (Windows) or Cmd+Shift+R (Mac)</p>\n                  <p><strong>Safari:</strong> Cmd+Option+R</p>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Wifi className=\"w-5 h-5 text-primary\" />\n                  <span>Check Internet Connection</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground mb-4\">\n                  Ensure stable internet for best performance\n                </p>\n                <div className=\"space-y-2 text-sm\">\n                  <p>â€¢ Test with other websites</p>\n                  <p>â€¢ Restart your router if needed</p>\n                  <p>â€¢ Try switching to mobile data temporarily</p>\n                  <p>â€¢ Contact your ISP if issues persist</p>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* System Requirements */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">System Requirements</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Monitor className=\"w-5 h-5 text-primary\" />\n                  <span>Desktop/Laptop</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <h4 className=\"font-semibold mb-2\">Supported Browsers</h4>\n                    <ul className=\"text-muted-foreground text-sm space-y-1\">\n                      <li>â€¢ Chrome 90+ (Recommended)</li>\n                      <li>â€¢ Firefox 88+</li>\n                      <li>â€¢ Safari 14+</li>\n                      <li>â€¢ Edge 90+</li>\n                    </ul>\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold mb-2\">Minimum Requirements</h4>\n                    <ul className=\"text-muted-foreground text-sm space-y-1\">\n                      <li>â€¢ 4GB RAM</li>\n                      <li>â€¢ Stable internet connection</li>\n                      <li>â€¢ JavaScript enabled</li>\n                      <li>â€¢ Cookies enabled</li>\n                    </ul>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Smartphone className=\"w-5 h-5 text-primary\" />\n                  <span>Mobile Devices</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <h4 className=\"font-semibold mb-2\">iOS</h4>\n                    <ul className=\"text-muted-foreground text-sm space-y-1\">\n                      <li>â€¢ iOS 14+ (Safari)</li>\n                      <li>â€¢ Chrome for iOS</li>\n                      <li>â€¢ iPhone 8+ recommended</li>\n                    </ul>\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold mb-2\">Android</h4>\n                    <ul className=\"text-muted-foreground text-sm space-y-1\">\n                      <li>â€¢ Android 9+ (Chrome)</li>\n                      <li>â€¢ Firefox for Android</li>\n                      <li>â€¢ 3GB RAM recommended</li>\n                    </ul>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* Common Issues */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-6\">Common Issues & Solutions</h2>\n          <div className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n                  <span>Videos Won't Load or Play</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 text-sm\">\n                  <p><strong>Solutions:</strong></p>\n                  <ul className=\"list-disc list-inside space-y-1 text-muted-foreground\">\n                    <li>Check your internet speed (minimum 5 Mbps recommended)</li>\n                    <li>Clear browser cache and cookies</li>\n                    <li>Disable browser extensions temporarily</li>\n                    <li>Try a different browser or incognito/private mode</li>\n                    <li>Update your browser to the latest version</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n                  <span>Login Issues</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 text-sm\">\n                  <p><strong>Solutions:</strong></p>\n                  <ul className=\"list-disc list-inside space-y-1 text-muted-foreground\">\n                    <li>Verify your email and password are correct</li>\n                    <li>Use \"Forgot Password\" to reset if needed</li>\n                    <li>Clear browser data and try again</li>\n                    <li>Check if Caps Lock is on</li>\n                    <li>Try logging in from a different device or browser</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n                  <span>Payment or Subscription Issues</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 text-sm\">\n                  <p><strong>Solutions:</strong></p>\n                  <ul className=\"list-disc list-inside space-y-1 text-muted-foreground\">\n                    <li>Verify your payment method is valid and has sufficient funds</li>\n                    <li>Check if your billing address matches your card</li>\n                    <li>Try a different payment method</li>\n                    <li>Contact your bank if the card is being declined</li>\n                    <li>Email support@laplumbprep.com for billing assistance</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n                  <span>Slow Performance</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 text-sm\">\n                  <p><strong>Solutions:</strong></p>\n                  <ul className=\"list-disc list-inside space-y-1 text-muted-foreground\">\n                    <li>Close other browser tabs and applications</li>\n                    <li>Clear browser cache and restart browser</li>\n                    <li>Check for browser updates</li>\n                    <li>Restart your computer</li>\n                    <li>Test internet speed (minimum 5 Mbps recommended)</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* Still Need Help */}\n        <Card className=\"bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <HelpCircle className=\"w-6 h-6 text-primary\" />\n              <span>Still Need Help?</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground mb-6\">\n              If these solutions don't resolve your issue, our technical support team is here to help.\n            </p>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div>\n                <h4 className=\"font-semibold mb-3\">When Contacting Support, Include:</h4>\n                <ul className=\"text-sm space-y-1 text-muted-foreground\">\n                  <li>â€¢ Your browser and version</li>\n                  <li>â€¢ Operating system (Windows, Mac, etc.)</li>\n                  <li>â€¢ Description of the problem</li>\n                  <li>â€¢ Steps you've already tried</li>\n                  <li>â€¢ Screenshots if applicable</li>\n                </ul>\n              </div>\n              \n              <div>\n                <h4 className=\"font-semibold mb-3\">Contact Information</h4>\n                <div className=\"space-y-2 text-sm\">\n                  <p><strong>Email:</strong> support@laplumbprep.com</p>\n                  <p><strong>Response Time:</strong> 2 business days</p>\n                  <p><strong>Priority:</strong> Technical issues receive high priority</p>\n                </div>\n                <Link href=\"/contact\">\n                  <Button className=\"mt-4\" data-testid=\"contact-support-button\">\n                    Contact Technical Support\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":11750},"client/src/pages/terms.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft } from \"lucide-react\";\n\nexport default function Terms() {\n  return (\n    <div className=\"min-h-screen bg-background py-12\" data-testid=\"terms-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" className=\"mb-4\" data-testid=\"back-button\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Home\n            </Button>\n          </Link>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\" data-testid=\"terms-title\">\n            Terms of Service\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"terms-subtitle\">\n            Last updated: January 2024\n          </p>\n        </div>\n\n        <div className=\"space-y-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Acceptance of Terms</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                By accessing and using LA Plumb Prep's services, you accept and agree to be bound by the terms and provision of this agreement. These Terms of Service govern your use of our platform, including all courses, tools, and services provided.\n              </p>\n              <p>\n                If you do not agree to abide by the above, please do not use this service.\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Description of Service</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>LA Plumb Prep provides:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Louisiana plumbing certification preparation courses</li>\n                <li>Professional tools including calculators and AI analysis</li>\n                <li>Job board services for plumbing professionals</li>\n                <li>AI-powered mentoring and support</li>\n                <li>Photo analysis for code compliance</li>\n                <li>Career advancement resources</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>User Accounts and Responsibilities</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>To access certain features, you must create an account. You agree to:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Provide accurate, current, and complete information</li>\n                <li>Maintain the security of your password and account</li>\n                <li>Accept responsibility for all activities under your account</li>\n                <li>Notify us immediately of any unauthorized use</li>\n                <li>Use the service only for lawful purposes</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Payment Terms</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>For paid services:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Subscription fees are billed in advance on a monthly or annual basis</li>\n                <li>You may cancel your subscription at any time</li>\n                <li>Pro-rated refunds are provided for unused time when you cancel</li>\n                <li>All payments are processed securely through Stripe</li>\n                <li>Prices may change with 30 days advance notice</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Intellectual Property</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                All content, features, and functionality on LA Plumb Prep are owned by us, our licensors, or other providers and are protected by copyright, trademark, and other intellectual property laws.\n              </p>\n              <p>You may not:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Reproduce, distribute, or create derivative works</li>\n                <li>Reverse engineer or attempt to extract source code</li>\n                <li>Share your account credentials with others</li>\n                <li>Use the service for commercial purposes without permission</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Job Board Terms</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>For job board services:</p>\n              <ul className=\"list-disc pl-6 space-y-2\">\n                <li>Employers must provide accurate job postings</li>\n                <li>Job seekers must provide truthful information</li>\n                <li>We are not responsible for employment decisions or outcomes</li>\n                <li>All interactions between employers and candidates are at their own risk</li>\n                <li>We reserve the right to remove inappropriate postings</li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Limitation of Liability</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                LA Plumb Prep shall not be liable for any indirect, incidental, special, consequential, or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses.\n              </p>\n              <p>\n                Our total liability shall not exceed the amount paid by you for the service during the twelve months preceding the claim.\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Termination</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p>\n                We may terminate or suspend your account immediately, without prior notice, for conduct that we believe violates these Terms or is harmful to other users, us, or third parties.\n              </p>\n              <p>\n                Upon termination, your right to use the service will cease immediately.\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Contact Information</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p>\n                Questions about the Terms of Service should be sent to:\n              </p>\n              <div className=\"mt-4\">\n                <p><strong>Email:</strong> support@laplumbprep.com</p>\n                <p><strong>Address:</strong> LA Plumb Prep, Louisiana, USA</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":7260},"shared/referral-utils.ts":{"content":"import { subscriptionTierEnum } from \"./schema\";\n\n// Plan tier pricing (monthly)\nexport const PLAN_PRICING = {\n  basic: 49.99,\n  professional: 59.99,\n  master: 74.99,\n} as const;\n\n// Plan tier hierarchy (higher number = higher tier)\nexport const PLAN_TIER_LEVELS = {\n  basic: 1,\n  professional: 2,\n  master: 3,\n} as const;\n\nexport type SubscriptionTier = \"basic\" | \"professional\" | \"master\";\n\n/**\n * Calculate referral commission based on referrer's plan tier cap\n * \n * Rule: Referrers can only earn commission for their plan tier or lower\n * - Basic referrer: gets Basic commission even if referral buys Professional/Master\n * - Professional referrer: gets Professional commission for Professional/Master, Basic for Basic\n * - Master referrer: gets full commission for any tier\n */\nexport function calculateReferralCommission(\n  referrerTier: SubscriptionTier,\n  referredTier: SubscriptionTier,\n  commissionRate: number = 0.10 // 10% default\n): {\n  eligibleTier: SubscriptionTier;\n  eligiblePrice: number;\n  commissionAmount: number;\n} {\n  // Commission logic: referrer gets commission based on the lower of:\n  // 1. Their own tier (cap)\n  // 2. The tier the referred user actually bought\n  const referrerLevel = PLAN_TIER_LEVELS[referrerTier];\n  const referredLevel = PLAN_TIER_LEVELS[referredTier];\n  \n  // If referred user buys lower tier, use that tier\n  // If referred user buys higher tier, cap at referrer's tier\n  const eligibleLevel = Math.min(referrerLevel, referredLevel);\n  \n  // Map back to tier name\n  const eligibleTier = Object.entries(PLAN_TIER_LEVELS).find(\n    ([_, level]) => level === eligibleLevel\n  )?.[0] as SubscriptionTier;\n  \n  if (!eligibleTier) {\n    throw new Error(\"Invalid tier calculation\");\n  }\n  \n  const eligiblePrice = PLAN_PRICING[eligibleTier];\n  const commissionAmount = Math.round(eligiblePrice * commissionRate * 100) / 100; // Round to 2 decimals\n  \n  return {\n    eligibleTier,\n    eligiblePrice,\n    commissionAmount,\n  };\n}\n\n/**\n * Examples of commission calculations:\n * \n * Basic referrer (tier 1):\n * - Refers Basic user â†’ Gets $5.00 (10% of $49.99)\n * - Refers Professional user â†’ Gets $5.00 (10% of $49.99, capped at Basic)\n * - Refers Master user â†’ Gets $5.00 (10% of $49.99, capped at Basic)\n * \n * Professional referrer (tier 2):\n * - Refers Basic user â†’ Gets $5.00 (10% of $49.99)\n * - Refers Professional user â†’ Gets $6.00 (10% of $59.99)\n * - Refers Master user â†’ Gets $6.00 (10% of $59.99, capped at Professional)\n * \n * Master referrer (tier 3):\n * - Refers Basic user â†’ Gets $5.00 (10% of $49.99)\n * - Refers Professional user â†’ Gets $6.00 (10% of $59.99)\n * - Refers Master user â†’ Gets $7.50 (10% of $74.99)\n */\n\n/**\n * Get monthly earnings potential for each referrer tier\n */\nexport function getReferralEarningsPotential(referrerTier: SubscriptionTier) {\n  const maxCommission = calculateReferralCommission(referrerTier, referrerTier);\n  \n  return {\n    tier: referrerTier,\n    maxMonthlyCommission: maxCommission.commissionAmount,\n    cappedAt: maxCommission.eligibleTier,\n    description: `Earn up to $${maxCommission.commissionAmount}/month per referral (capped at ${maxCommission.eligibleTier} plan tier)`,\n  };\n}\n\n/**\n * Validate subscription tier\n */\nexport function isValidSubscriptionTier(tier: string): tier is SubscriptionTier {\n  return tier in PLAN_PRICING;\n}\n\n/**\n * Format commission amount for display\n */\nexport function formatCommission(amount: number): string {\n  return `$${amount.toFixed(2)}`;\n}\n\n/**\n * Get tier display name\n */\nexport function getTierDisplayName(tier: SubscriptionTier): string {\n  return tier.charAt(0).toUpperCase() + tier.slice(1);\n}","size_bytes":3658},"server/email-automation.ts":{"content":"import { db } from \"./db\";\nimport { emailCampaigns, emailQueue, emailUnsubscribes } from \"@shared/schema\";\nimport { emailService } from \"./email\";\nimport { eq, and, lte } from \"drizzle-orm\";\n\n// Email templates for automated campaigns\nexport const EMAIL_TEMPLATES = {\n  // Employer onboarding sequence\n  employer_onboarding: [\n    {\n      sequenceOrder: 1,\n      delayDays: 0,\n      subject: \"Welcome to LA Plumb Prep's Employer Network\",\n      content: `Hi {{name}},\n\nThank you for joining Louisiana Plumbing Prep's employer network! You're now connected to Louisiana's most qualified plumbing professionals.\n\n**Why post jobs with us:**\n- Direct access to certified Louisiana plumbers\n- Students actively seeking employment opportunities\n- Pre-screened candidates with current code knowledge\n- Reduced hiring time and training costs\n\n**Your next step:** Post your first job listing for FREE this month.\n\nReady to find your next great hire?\n[Post a Job Now - {{website_url}}/employer/post-job]\n\nBest regards,\nLA Plumb Prep Team`\n    },\n    {\n      sequenceOrder: 2,\n      delayDays: 3,\n      subject: \"How ABC Plumbing Found 3 Qualified Techs in 2 Weeks\",\n      content: `Hi {{name}},\n\nSee how local employers are finding great hires through our platform:\n\n**ABC Plumbing - Baton Rouge**\n\"We hired 3 certified plumbers within 2 weeks. The candidates were already trained on Louisiana code - saved us months of training time!\"\n\n**Gulf Coast Mechanical - New Orleans** \n\"Best investment we made. These graduates hit the ground running with real Louisiana code knowledge.\"\n\n**Your turn:** Post a job this week and connect with ready-to-work plumbers.\n\n[Post Your Job Opening - {{website_url}}/employer/post-job]\n\nQuestions? Reply to this email.\n\nBest,\nLA Plumb Prep Team`\n    },\n    {\n      sequenceOrder: 3,\n      delayDays: 7,\n      subject: \"Last Chance: Free Premium Job Posting (Expires Tomorrow)\",\n      content: `Hi {{name}},\n\nThis is your final reminder - your FREE premium job posting expires tomorrow.\n\n**Premium features include:**\n- Featured placement (3x more views)\n- Direct candidate contact information\n- Priority in student job alerts\n- 30-day posting duration\n\n**Don't miss out** - our students are actively looking for work NOW.\n\n[Claim Your Free Premium Posting - {{website_url}}/employer/post-job]\n\nQuestions? Email us at support@laplumbprep.com\n\nTalk soon,\nLA Plumb Prep Team`\n    }\n  ],\n\n  // Student enrollment sequence\n  student_enrollment: [\n    {\n      sequenceOrder: 1,\n      delayDays: 0,\n      subject: \"Your Louisiana Plumbing Career Starts Here\",\n      content: `Hi {{name}},\n\nThanks for your interest in Louisiana Plumbing Prep! You're one step closer to advancing your plumbing career.\n\n**What makes us different:**\n- Louisiana-specific code training\n- Real-world scenarios and examples\n- Job placement assistance included\n- Professional AI tools for licensed plumbers\n\n**Limited Time:** First 100 students get 25% extra discount + 50% off first month.\n\nReady to get certified?\n[Start Your Journey Today - {{website_url}}/courses]\n\nQuestions? We're here to help.\n\nBest,\nLA Plumb Prep Team`\n    },\n    {\n      sequenceOrder: 2,\n      delayDays: 3,\n      subject: \"From Student to $75K/Year in 6 Months\",\n      content: `Hi {{name}},\n\nMeet Marcus from Shreveport:\n\n\"Before LA Plumb Prep, I was stuck doing basic repairs. After completing the Journeyman course, I passed my state exam on the first try and got hired at $75K/year. The Louisiana-specific training made all the difference.\"\n\n**Marcus's results:**\n- Passed state exam first try\n- 40% salary increase\n- Promoted to lead plumber in 3 months\n\n**Your success story starts today.**\n\n[Enroll in Journeyman Prep - $39.99 - {{website_url}}/courses]\n\nReady to level up your career?\n\nBest,\nLA Plumb Prep Team`\n    },\n    {\n      sequenceOrder: 3,\n      delayDays: 6,\n      subject: \"387 Students Enrolled This Month (Special Ends Soon)\",\n      content: `Hi {{name}},\n\n**Hot Update:** 387 Louisiana plumbers enrolled this month!\n\nHere's what they're saying:\nâ­â­â­â­â­ \"Best investment I've made in my career\" - James K.\nâ­â­â­â­â­ \"Passed the exam on first try!\" - Sarah M.  \nâ­â­â­â­â­ \"Got hired before I even finished the course\" - Mike R.\n\n**Special pricing ends in 48 hours:**\n- 25% extra discount for early birds\n- 50% off first month\n- FREE job board access\n- Professional AI tools included\n\n[Secure Your Spot Now - $39.99 - {{website_url}}/courses]\n\nDon't let another month pass without advancing your career.\n\nBest,\nLA Plumb Prep Team`\n    },\n    {\n      sequenceOrder: 4,\n      delayDays: 10,\n      subject: \"Last Chance: Special Pricing Expires Tonight\",\n      content: `Hi {{name}},\n\nThis is it - your special pricing expires at midnight tonight.\n\n**What you're missing:**\nâŒ Louisiana-specific code training\nâŒ Professional AI mentoring tools  \nâŒ Exclusive job board access\nâŒ Certification preparation\nâŒ Career advancement opportunities\n\n**What you could gain:**\nâœ… Higher paying positions\nâœ… State certification confidence\nâœ… Professional tools for life\nâœ… Direct employer connections\n\n**Final call:** [Enroll Now - Last 6 Hours - {{website_url}}/courses]\n\nAfter tonight, prices return to full rate.\n\nYour future self will thank you.\n\nBest,\nLA Plumb Prep Team`\n    }\n  ],\n\n  // Bulk enrollment follow-up sequence\n  bulk_enrollment: [\n    {\n      sequenceOrder: 1,\n      delayDays: 0,\n      subject: \"Transform Your Team with Louisiana's Premier Plumbing Certification\",\n      content: `Hi {{name}},\n\nThank you for your interest in bulk enrollment at Louisiana Plumbing Prep! You're about to give your team the competitive edge they need.\n\n**Why Choose LA Plumb Prep for Your Team:**\n\nðŸŽ¯ **Louisiana Code Expertise**\n- State-specific regulations and requirements\n- Real Louisiana plumbing scenarios and examples\n- Current 2024 Louisiana code updates\n\nðŸ’° **Massive Bulk Savings**\n- ALL employer enrollments: 25% discount ($37/student vs $49)\n- Any number of students qualifies for the discount\n- Simple, fair pricing for all employers\n\nðŸš€ **Complete Professional Toolkit**\n- AI Mentor for instant code questions\n- Photo Code Checker for job site compliance\n- Pipe Sizing Calculator and professional tools\n- Plan Review and analysis capabilities\n\nðŸ“š **Comprehensive Training**\n- 5 certification tracks available\n- Interactive lessons with real-world scenarios\n- Practice tests and progress tracking\n- Job placement assistance\n\nðŸ‘¨â€ðŸ’¼ **Perfect for Your Business**\n- Reduce training time and costs\n- Ensure code compliance on all jobs\n- Boost your team's credentials and value\n- Attract better clients with certified staff\n\n**Next Steps:**\n1. Submit your bulk enrollment request\n2. We'll create custom pricing for your team size\n3. Students receive individual access within 24 hours\n4. Track progress through our employer dashboard\n\n[Get Your Custom Quote - {{website_url}}/bulk-enrollment]\n\nQuestions? Contact our bulk enrollment specialists:\nðŸ“§ bulk@laplumbprep.com\nðŸ“ž (555) 123-4567\n\nBest regards,\nLA Plumb Prep Team`\n    },\n    {\n      sequenceOrder: 2,\n      delayDays: 3,\n      subject: \"How Regional Plumbing Saved $15,000 on Training Costs\",\n      content: `Hi {{name}},\n\nSee how smart contractors are maximizing their training budgets:\n\n**Regional Plumbing Services - Lafayette**\n\"We enrolled 25 technicians through LA Plumb Prep's bulk program. Not only did we save $1,875 on enrollment costs, but our team became Louisiana code experts overnight. We're now winning bigger contracts because clients trust our certified expertise.\"\n\n**Results achieved:**\nâœ… 25 technicians certified in 60 days\nâœ… $3,063 saved on training costs (25% bulk discount)\nâœ… 40% increase in high-value commercial contracts\nâœ… Zero code violations in the past 6 months\n\n**Gulf Coast Construction - New Orleans**\n\"The AI tools alone are worth the investment. Our crews use the Photo Code Checker on every job. We've caught compliance issues before inspectors even arrive. It's like having a code expert on every job site.\"\n\n**Your team deserves the same success.**\n\n**Special Limited Offer for This Week:**\n- Additional 5% discount on top of bulk rates\n- Free employer dashboard access\n- Priority student onboarding (24-hour activation)\n\n[Claim Your Additional Discount - {{website_url}}/bulk-enrollment]\n\nReady to level up your entire team?\n\nBest,\nLA Plumb Prep Team\nP.S. This additional discount expires in 4 days - don't let your team miss out.`\n    },\n    {\n      sequenceOrder: 3,\n      delayDays: 7,\n      subject: \"Complete Professional Toolkit Awaits Your Team\",\n      content: `Hi {{name}},\n\nYour competition is already using AI-powered plumbing tools. Here's what your team is missing:\n\n**ðŸ¤– AI Mentor Support**\n- Instant answers to complex code questions\n- Available 24/7 for job site challenges\n- Louisiana-specific expertise at your fingertips\n\n**ðŸ“¸ Photo Code Checker**\n- Snap a photo, get instant compliance feedback\n- Prevent costly rework and violations\n- Boost client confidence in your work\n\n**ðŸ“ Professional Calculators**\n- Pipe sizing for complex systems\n- Material estimators and cost calculators\n- Load calculations and capacity planning\n\n**ðŸ“‹ Plan Review System**\n- AI-powered plan analysis\n- Code compliance checking before construction\n- Risk identification and mitigation\n\n**Real Results from Real Contractors:**\n\n\"The Photo Code Checker caught a gas line issue that would have cost us $8,000 to fix during inspection. The tool paid for itself on day one.\" - Mike's Plumbing, Baton Rouge\n\n\"Our estimating accuracy improved by 30% using the professional calculators. We're winning more bids and maintaining better margins.\" - Acadiana Mechanical\n\n**Your Investment vs Your Returns:**\n- Bulk enrollment: $37 per student (25% discount)\n- Prevent one $5,000 code violation = 135+ students covered\n- Win one additional $50,000 contract = 1,350+ students covered\n\n**The math is simple. The results are proven.**\n\n[Start Your Team's Transformation - {{website_url}}/bulk-enrollment]\n\nStill have questions? I'm here to help:\nðŸ“§ bulk@laplumbprep.com\nðŸ“ž (555) 123-4567\n\nBest,\nSarah Thompson\nBulk Enrollment Specialist\nLA Plumb Prep`\n    },\n    {\n      sequenceOrder: 4,\n      delayDays: 14,\n      subject: \"Final Notice: Louisiana's Top Contractors Are Moving Fast\",\n      content: `Hi {{name}},\n\nI wanted to reach out one final time about your team's professional development.\n\n**The landscape is changing fast:**\n- Louisiana code updates are more frequent\n- Clients demand certified, knowledgeable teams\n- Insurance companies reward certified contractors\n- Competition is investing in professional development\n\n**Don't let your team fall behind.**\n\n**What You Get with Bulk Enrollment:**\nâœ… Up to 25% savings on professional certification\nâœ… Complete AI-powered professional toolkit\nâœ… Louisiana code expertise for your entire team\nâœ… Employer dashboard to track progress\nâœ… Job placement assistance for new hires\nâœ… 24/7 support and resources\n\n**What You Risk by Waiting:**\nâŒ Code violations and costly rework\nâŒ Lost contracts to certified competitors\nâŒ Higher insurance premiums\nâŒ Difficulty attracting quality workers\nâŒ Full-price individual enrollments\n\n**This is my last email about bulk enrollment.**\n\nIf you're ready to invest in your team's future (and your company's success), I'm here to help make it happen.\n\nIf not, I understand - we'll remove you from this sequence and wish you the best.\n\n[Yes, I Want to Enroll My Team - {{website_url}}/bulk-enrollment]\n\n[No Thanks, Remove Me from This List - {{website_url}}/api/unsubscribe?email={{email}}&campaignType=bulk_enrollment]\n\nThank you for your time and consideration.\n\nBest regards,\nSarah Thompson\nBulk Enrollment Specialist\nLA Plumb Prep\n\nP.S. Our most successful contractors started with bulk enrollment. They're now industry leaders in Louisiana. Your team could be next.`\n    }\n  ]\n};\n\nexport class EmailAutomationService {\n  // Initialize email campaigns in database\n  async initializeCampaigns() {\n    try {\n      // Check if campaigns already exist\n      const existingCampaigns = await db.select().from(emailCampaigns);\n      \n      if (existingCampaigns.length > 0) {\n        console.log(\"Email campaigns already initialized\");\n        return;\n      }\n\n      // Insert employer campaigns\n      for (const template of EMAIL_TEMPLATES.employer_onboarding) {\n        await db.insert(emailCampaigns).values({\n          name: `Employer Onboarding - Email ${template.sequenceOrder}`,\n          type: \"employer_onboarding\",\n          subject: template.subject,\n          content: template.content,\n          sequenceOrder: template.sequenceOrder,\n          delayDays: template.delayDays,\n          isActive: true\n        });\n      }\n\n      // Insert student campaigns\n      for (const template of EMAIL_TEMPLATES.student_enrollment) {\n        await db.insert(emailCampaigns).values({\n          name: `Student Enrollment - Email ${template.sequenceOrder}`,\n          type: \"student_enrollment\",\n          subject: template.subject,\n          content: template.content,\n          sequenceOrder: template.sequenceOrder,\n          delayDays: template.delayDays,\n          isActive: true\n        });\n      }\n\n      // Insert bulk enrollment campaigns\n      for (const template of EMAIL_TEMPLATES.bulk_enrollment) {\n        await db.insert(emailCampaigns).values({\n          name: `Bulk Enrollment - Email ${template.sequenceOrder}`,\n          type: \"bulk_enrollment\",\n          subject: template.subject,\n          content: template.content,\n          sequenceOrder: template.sequenceOrder,\n          delayDays: template.delayDays,\n          isActive: true\n        });\n      }\n\n      console.log(\"Email campaigns initialized successfully\");\n    } catch (error) {\n      console.error(\"Error initializing email campaigns:\", error);\n    }\n  }\n\n  // Queue email sequence for a new subscriber\n  async queueEmailSequence(\n    email: string, \n    name: string, \n    campaignType: \"employer_onboarding\" | \"student_enrollment\" | \"bulk_enrollment\"\n  ) {\n    try {\n      // Check if user has unsubscribed\n      const unsubscribed = await db.select()\n        .from(emailUnsubscribes)\n        .where(and(\n          eq(emailUnsubscribes.email, email),\n          eq(emailUnsubscribes.campaignType, campaignType)\n        ));\n\n      if (unsubscribed.length > 0) {\n        console.log(`User ${email} has unsubscribed from ${campaignType}`);\n        return;\n      }\n\n      // Get all campaigns for this type\n      const campaigns = await db.select()\n        .from(emailCampaigns)\n        .where(and(\n          eq(emailCampaigns.type, campaignType),\n          eq(emailCampaigns.isActive, true)\n        ))\n        .orderBy(emailCampaigns.sequenceOrder);\n\n      // Queue each email in the sequence\n      for (const campaign of campaigns) {\n        const scheduledFor = new Date();\n        scheduledFor.setDate(scheduledFor.getDate() + campaign.delayDays);\n\n        // Replace template variables\n        const personalizedSubject = this.replaceTemplateVars(campaign.subject, { name, email });\n        const personalizedContent = this.replaceTemplateVars(campaign.content, { \n          name, \n          email,\n          website_url: process.env.WEBSITE_URL || \"https://laplumbprep.com\"\n        });\n\n        await db.insert(emailQueue).values({\n          recipientEmail: email,\n          recipientName: name,\n          campaignId: campaign.id,\n          campaignType: campaignType,\n          subject: personalizedSubject,\n          content: personalizedContent,\n          scheduledFor: scheduledFor,\n          status: \"pending\"\n        });\n      }\n\n      console.log(`Queued ${campaigns.length} emails for ${email} (${campaignType})`);\n    } catch (error) {\n      console.error(\"Error queueing email sequence:\", error);\n    }\n  }\n\n  // Process email queue and send pending emails\n  async processEmailQueue() {\n    try {\n      const now = new Date();\n      \n      // Get all pending emails that are due to be sent\n      const pendingEmails = await db.select()\n        .from(emailQueue)\n        .where(and(\n          eq(emailQueue.status, \"pending\"),\n          lte(emailQueue.scheduledFor, now)\n        ))\n        .limit(50); // Process in batches\n\n      console.log(`Processing ${pendingEmails.length} pending emails`);\n\n      for (const email of pendingEmails) {\n        try {\n          // Check if user unsubscribed since this was queued\n          const unsubscribed = await db.select()\n            .from(emailUnsubscribes)\n            .where(and(\n              eq(emailUnsubscribes.email, email.recipientEmail),\n              eq(emailUnsubscribes.campaignType, email.campaignType)\n            ));\n\n          if (unsubscribed.length > 0) {\n            // Mark as cancelled\n            await db.update(emailQueue)\n              .set({ \n                status: \"cancelled\",\n                errorMessage: \"User unsubscribed\"\n              })\n              .where(eq(emailQueue.id, email.id));\n            continue;\n          }\n\n          // Send the email\n          const success = await emailService.sendEmail({\n            to: email.recipientEmail,\n            subject: email.subject,\n            html: this.formatEmailHtml(email.content),\n            text: email.content\n          });\n\n          if (success) {\n            // Mark as sent\n            await db.update(emailQueue)\n              .set({ \n                status: \"sent\",\n                sentAt: new Date()\n              })\n              .where(eq(emailQueue.id, email.id));\n            \n            console.log(`Sent email to ${email.recipientEmail}: ${email.subject}`);\n          } else {\n            // Mark as failed\n            await db.update(emailQueue)\n              .set({ \n                status: \"failed\",\n                errorMessage: \"Email service failed\"\n              })\n              .where(eq(emailQueue.id, email.id));\n          }\n\n          // Small delay between emails to avoid overwhelming the service\n          await new Promise(resolve => setTimeout(resolve, 1000));\n\n        } catch (error) {\n          console.error(`Error sending email to ${email.recipientEmail}:`, error);\n          \n          // Mark as failed with error message\n          await db.update(emailQueue)\n            .set({ \n              status: \"failed\",\n              errorMessage: error instanceof Error ? error.message : \"Unknown error\"\n            })\n            .where(eq(emailQueue.id, email.id));\n        }\n      }\n\n    } catch (error) {\n      console.error(\"Error processing email queue:\", error);\n    }\n  }\n\n  // Replace template variables in email content\n  private replaceTemplateVars(content: string, vars: Record<string, string>): string {\n    let result = content;\n    for (const [key, value] of Object.entries(vars)) {\n      result = result.replace(new RegExp(`{{${key}}}`, 'g'), value);\n    }\n    return result;\n  }\n\n  // Format email content as HTML\n  private formatEmailHtml(content: string): string {\n    return content\n      .replace(/\\n\\n/g, '</p><p>')\n      .replace(/\\n/g, '<br>')\n      .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n      .replace(/\\[(.*?)\\]/g, '<a href=\"$1\" style=\"color: #2563eb; text-decoration: none;\">$1</a>')\n      .replace(/^/, '<p>')\n      .replace(/$/, '</p>');\n  }\n\n  // Unsubscribe user from campaign type\n  async unsubscribe(email: string, campaignType?: \"employer_onboarding\" | \"student_enrollment\") {\n    try {\n      // Add to unsubscribe list\n      await db.insert(emailUnsubscribes).values({\n        email: email,\n        campaignType: campaignType\n      }).onConflictDoNothing();\n\n      // Cancel any pending emails\n      let query = db.update(emailQueue)\n        .set({ status: \"cancelled\", errorMessage: \"User unsubscribed\" })\n        .where(and(\n          eq(emailQueue.recipientEmail, email),\n          eq(emailQueue.status, \"pending\")\n        ));\n\n      if (campaignType) {\n        query = query.where(eq(emailQueue.campaignType, campaignType));\n      }\n\n      await query;\n\n      console.log(`Unsubscribed ${email} from ${campaignType || 'all campaigns'}`);\n    } catch (error) {\n      console.error(\"Error unsubscribing user:\", error);\n    }\n  }\n}\n\nexport const emailAutomation = new EmailAutomationService();","size_bytes":20239},"client/src/pages/bulk-enrollment.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Plus, Trash2, Calculator, Users, DollarSign, Percent } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nconst studentSchema = z.object({\n  email: z.string().email(\"Please enter a valid email address\"),\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().optional(),\n});\n\nconst bulkEnrollmentSchema = z.object({\n  employerId: z.string().min(1, \"Employer ID is required\"),\n  contactEmail: z.string().email(\"Please enter a valid email address\"),\n  contactPhone: z.string().optional(),\n  notes: z.string().optional(),\n  requestedStartDate: z.string().optional(),\n  students: z.array(studentSchema).min(1, \"Minimum 1 student required for bulk enrollment\"),\n});\n\ntype BulkEnrollmentForm = z.infer<typeof bulkEnrollmentSchema>;\n\ninterface BulkPricingTier {\n  id: string;\n  tierName: string;\n  minStudents: number;\n  maxStudents: number | null;\n  discountPercent: string;\n  basePrice: string;\n}\n\ninterface PricingCalculation {\n  studentCount: number;\n  basePricePerStudent: number;\n  totalBasePrice: number;\n  appliedTier: BulkPricingTier | null;\n  discountPercent: number;\n  discountAmount: number;\n  finalPrice: number;\n  pricePerStudent: number;\n}\n\nexport default function BulkEnrollment() {\n  const { toast } = useToast();\n  const [pricingTiers, setPricingTiers] = useState<BulkPricingTier[]>([]);\n  const [pricingCalculation, setPricingCalculation] = useState<PricingCalculation | null>(null);\n  const [isCalculating, setIsCalculating] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const form = useForm<BulkEnrollmentForm>({\n    resolver: zodResolver(bulkEnrollmentSchema),\n    defaultValues: {\n      employerId: \"\",\n      contactEmail: \"\",\n      contactPhone: \"\",\n      notes: \"\",\n      requestedStartDate: \"\",\n      students: [\n        { email: \"\", firstName: \"\", lastName: \"\" },\n        { email: \"\", firstName: \"\", lastName: \"\" },\n        { email: \"\", firstName: \"\", lastName: \"\" },\n        { email: \"\", firstName: \"\", lastName: \"\" },\n        { email: \"\", firstName: \"\", lastName: \"\" },\n      ],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"students\",\n  });\n\n  // Load pricing tiers on component mount\n  useEffect(() => {\n    const fetchPricingTiers = async () => {\n      try {\n        const response = await apiRequest(\"GET\", \"/api/bulk-pricing/tiers\");\n        const data = await response.json();\n        setPricingTiers(data.tiers);\n      } catch (error) {\n        console.error(\"Error fetching pricing tiers:\", error);\n      }\n    };\n\n    fetchPricingTiers();\n  }, []);\n\n  // Calculate pricing when student count changes\n  useEffect(() => {\n    const subscription = form.watch((value) => {\n      const studentCount = value.students?.filter(s => s.email && s.firstName).length || 0;\n      if (studentCount >= 1) {\n        calculatePricing(studentCount);\n      } else {\n        setPricingCalculation(null);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, [form.watch]);\n\n  const calculatePricing = async (studentCount: number) => {\n    setIsCalculating(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/bulk-pricing/calculate\", {\n        studentCount,\n        courseIds: [\"journeyman\"]\n      });\n      const data = await response.json();\n      setPricingCalculation(data.pricing);\n    } catch (error) {\n      console.error(\"Error calculating pricing:\", error);\n    } finally {\n      setIsCalculating(false);\n    }\n  };\n\n  const onSubmit = async (data: BulkEnrollmentForm) => {\n    setIsSubmitting(true);\n    try {\n      const validStudents = data.students.filter(s => s.email && s.firstName);\n      \n      const response = await apiRequest(\"POST\", \"/api/bulk-enrollment/request\", {\n        ...data,\n        studentEmails: validStudents,\n        courseIds: [\"journeyman\"]\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Request Submitted Successfully!\",\n          description: \"We'll review your bulk enrollment request and get back to you within 24 hours.\",\n        });\n        \n        // Reset form\n        form.reset();\n        setPricingCalculation(null);\n      } else {\n        throw new Error(\"Failed to submit request\");\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to submit bulk enrollment request.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const addStudent = () => {\n    append({ email: \"\", firstName: \"\", lastName: \"\" });\n  };\n\n  const removeStudent = (index: number) => {\n    if (fields.length > 1) {\n      remove(index);\n    }\n  };\n\n  const validStudentCount = form.watch(\"students\")?.filter(s => s.email && s.firstName).length || 0;\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6 space-y-8\">\n      <div className=\"text-center space-y-4\">\n        <h1 className=\"text-4xl font-bold text-foreground\" data-testid=\"page-title\">\n          Bulk Student Enrollment\n        </h1>\n        <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n          Enroll multiple apprentices or students at discounted rates. Perfect for construction companies, \n          plumbing contractors, and training programs.\n        </p>\n      </div>\n\n      {/* Pricing Tiers Overview */}\n      <div className=\"grid md:grid-cols-3 gap-4\">\n        {pricingTiers.map((tier) => (\n          <Card key={tier.id} className=\"relative\">\n            <CardHeader className=\"text-center\">\n              <CardTitle className=\"text-lg\">{tier.tierName}</CardTitle>\n              <CardDescription>\n                {tier.minStudents}\n                {tier.maxStudents ? `-${tier.maxStudents}` : \"+\"} students\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"text-center space-y-2\">\n              <div className=\"text-2xl font-bold text-green-600\">\n                {tier.discountPercent}% OFF\n              </div>\n              <div className=\"text-sm text-muted-foreground\">\n                ${(49 * (1 - parseFloat(tier.discountPercent) / 100)).toFixed(0)}/student\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Pricing Calculator */}\n      {pricingCalculation && (\n        <Card className=\"bg-green-50 border-green-200\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Calculator className=\"w-5 h-5\" />\n              Your Bulk Pricing Quote\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid md:grid-cols-4 gap-4 text-center\">\n              <div>\n                <div className=\"flex items-center justify-center gap-1 mb-2\">\n                  <Users className=\"w-4 h-4 text-blue-600\" />\n                  <span className=\"text-sm font-medium\">Students</span>\n                </div>\n                <div className=\"text-2xl font-bold\">{pricingCalculation.studentCount}</div>\n              </div>\n              <div>\n                <div className=\"flex items-center justify-center gap-1 mb-2\">\n                  <Percent className=\"w-4 h-4 text-green-600\" />\n                  <span className=\"text-sm font-medium\">Discount</span>\n                </div>\n                <div className=\"text-2xl font-bold text-green-600\">\n                  {pricingCalculation.discountPercent}%\n                </div>\n              </div>\n              <div>\n                <div className=\"flex items-center justify-center gap-1 mb-2\">\n                  <DollarSign className=\"w-4 h-4 text-orange-600\" />\n                  <span className=\"text-sm font-medium\">You Save</span>\n                </div>\n                <div className=\"text-2xl font-bold text-orange-600\">\n                  ${pricingCalculation.discountAmount.toFixed(0)}\n                </div>\n              </div>\n              <div>\n                <div className=\"flex items-center justify-center gap-1 mb-2\">\n                  <DollarSign className=\"w-4 h-4 text-blue-600\" />\n                  <span className=\"text-sm font-medium\">Total</span>\n                </div>\n                <div className=\"text-2xl font-bold text-blue-600\">\n                  ${pricingCalculation.finalPrice.toFixed(0)}\n                </div>\n              </div>\n            </div>\n            \n            {pricingCalculation.appliedTier && (\n              <div className=\"text-center\">\n                <Badge className=\"bg-green-100 text-green-800\">\n                  {pricingCalculation.appliedTier.tierName} - \n                  ${pricingCalculation.pricePerStudent.toFixed(0)} per student\n                </Badge>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Enrollment Form */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Bulk Enrollment Request</CardTitle>\n          <CardDescription>\n            Complete the form below to request bulk enrollment for your students.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              {/* Company Information */}\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"employerId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Company/Employer ID</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Your company ID\" {...field} data-testid=\"input-employer-id\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"contactEmail\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Contact Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"company@example.com\" {...field} data-testid=\"input-contact-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"contactPhone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Contact Phone (Optional)</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"(555) 123-4567\" {...field} data-testid=\"input-contact-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"requestedStartDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Requested Start Date (Optional)</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-start-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Student List */}\n              <div className=\"space-y-4\">\n                <div className=\"flex justify-between items-center\">\n                  <h3 className=\"text-lg font-semibold\">Student Information</h3>\n                  <div className=\"text-sm text-muted-foreground\">\n                    {validStudentCount} valid students ({validStudentCount >= 5 ? \"âœ“\" : \"âš ï¸\"} Min: 5)\n                  </div>\n                </div>\n\n                {fields.map((field, index) => (\n                  <div key={field.id} className=\"grid md:grid-cols-4 gap-2 items-end\">\n                    <FormField\n                      control={form.control}\n                      name={`students.${index}.email`}\n                      render={({ field }) => (\n                        <FormItem>\n                          {index === 0 && <FormLabel>Email</FormLabel>}\n                          <FormControl>\n                            <Input placeholder=\"student@email.com\" {...field} data-testid={`input-student-email-${index}`} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name={`students.${index}.firstName`}\n                      render={({ field }) => (\n                        <FormItem>\n                          {index === 0 && <FormLabel>First Name</FormLabel>}\n                          <FormControl>\n                            <Input placeholder=\"John\" {...field} data-testid={`input-student-firstname-${index}`} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name={`students.${index}.lastName`}\n                      render={({ field }) => (\n                        <FormItem>\n                          {index === 0 && <FormLabel>Last Name (Optional)</FormLabel>}\n                          <FormControl>\n                            <Input placeholder=\"Doe\" {...field} data-testid={`input-student-lastname-${index}`} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <div>\n                      {fields.length > 5 && (\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => removeStudent(index)}\n                          data-testid={`button-remove-student-${index}`}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                ))}\n\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={addStudent}\n                  className=\"w-full\"\n                  data-testid=\"button-add-student\"\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Add Another Student\n                </Button>\n              </div>\n\n              {/* Notes */}\n              <FormField\n                control={form.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Additional Notes (Optional)</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        placeholder=\"Any special requirements or notes about your enrollment request...\"\n                        rows={3}\n                        {...field}\n                        data-testid=\"textarea-notes\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Submit Button */}\n              <Button\n                type=\"submit\"\n                size=\"lg\"\n                className=\"w-full\"\n                disabled={isSubmitting || validStudentCount < 5}\n                data-testid=\"button-submit-request\"\n              >\n                {isSubmitting ? \"Submitting Request...\" : \"Submit Bulk Enrollment Request\"}\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n\n      {/* Contact Information */}\n      <Card className=\"bg-blue-50 border-blue-200\">\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center space-y-2\">\n            <h3 className=\"font-semibold\">Need Help?</h3>\n            <p className=\"text-sm text-muted-foreground\">\n              Contact our team at <a href=\"mailto:bulk@laplumbprep.com\" className=\"text-blue-600 hover:underline\">bulk@laplumbprep.com</a> or \n              call <a href=\"tel:+15551234567\" className=\"text-blue-600 hover:underline\">(555) 123-4567</a> for assistance with bulk enrollments.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":17453},"client/src/pages/lead-magnet.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Download, Shield, AlertTriangle, FileText, Zap } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst leadMagnetSchema = z.object({\n  email: z.string().email(\"Please enter a valid email address\"),\n  firstName: z.string().min(2, \"First name must be at least 2 characters\"),\n  lastName: z.string().min(2, \"Last name must be at least 2 characters\"),\n  companyName: z.string().min(2, \"Company name must be at least 2 characters\"),\n  position: z.string().optional(),\n});\n\ntype LeadMagnetForm = z.infer<typeof leadMagnetSchema>;\n\nexport default function LeadMagnet() {\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<LeadMagnetForm>({\n    resolver: zodResolver(leadMagnetSchema),\n    defaultValues: {\n      email: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      companyName: \"\",\n      position: \"\",\n    },\n  });\n\n  const onSubmit = async (data: LeadMagnetForm) => {\n    setIsSubmitting(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/lead-magnet/download\", data);\n      \n      if (response.ok) {\n        setIsSuccess(true);\n        toast({\n          title: \"Success!\",\n          description: \"Check your email for the download link and bonus materials.\",\n        });\n      } else {\n        throw new Error(\"Failed to process request\");\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send download link. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isSuccess) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-green-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl w-full\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mb-4\">\n              <CheckCircle className=\"w-8 h-8 text-green-600 dark:text-green-400\" />\n            </div>\n            <CardTitle className=\"text-2xl text-green-700 dark:text-green-300\">Check Your Email!</CardTitle>\n            <CardDescription className=\"text-lg\">\n              Your Louisiana Plumbing Code Guide is on its way, plus exclusive bonus materials.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\n              <h3 className=\"font-semibold text-yellow-800 dark:text-yellow-200 mb-2\">ðŸ“§ What's Coming Next:</h3>\n              <ul className=\"text-sm text-yellow-700 dark:text-yellow-300 space-y-1\">\n                <li>â€¢ Instant download link for your Louisiana Code Guide</li>\n                <li>â€¢ Exclusive plumbing calculator tools (bonus)</li>\n                <li>â€¢ Weekly Louisiana code updates and tips</li>\n                <li>â€¢ Early access to new certification courses</li>\n              </ul>\n            </div>\n            \n            <div className=\"text-center\">\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                While you're here, explore our complete certification platform:\n              </p>\n              <Button asChild className=\"bg-blue-600 hover:bg-blue-700\">\n                <a href=\"/courses\">View All Courses</a>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-green-50 dark:from-gray-900 dark:to-gray-800\">\n      {/* Hero Section */}\n      <div className=\"container mx-auto px-6 py-12\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center mb-12\">\n            <Badge className=\"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 mb-4\">\n              ðŸš¨ FREE LOUISIANA RESOURCE\n            </Badge>\n            <h1 className=\"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6\">\n              Louisiana Plumbing Code\n              <br />\n              <span className=\"text-blue-600 dark:text-blue-400\">Quick Reference Guide</span>\n            </h1>\n            <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8\">\n              The essential code violations every Louisiana plumber needs to avoid. \n              <strong>Download this 15-page guide and save thousands on your next inspection.</strong>\n            </p>\n          </div>\n\n          <div className=\"grid lg:grid-cols-2 gap-12 items-center\">\n            {/* Left Side - Benefits */}\n            <div className=\"space-y-8\">\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-lg\">\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-6\">\n                  What You'll Get (FREE):\n                </h2>\n                \n                <div className=\"space-y-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <FileText className=\"w-6 h-6 text-blue-600 dark:text-blue-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">15-Page Louisiana Code Guide</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">Most common violations and how to avoid them</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <AlertTriangle className=\"w-6 h-6 text-yellow-600 dark:text-yellow-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">Top 10 Costly Mistakes</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">Real violations that cost contractors $5,000+</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <Shield className=\"w-6 h-6 text-green-600 dark:text-green-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">2024 Code Updates</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">Latest Louisiana-specific changes and requirements</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <Zap className=\"w-6 h-6 text-purple-600 dark:text-purple-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">BONUS: Pipe Sizing Calculator</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">Professional tool for accurate estimates (Value: $97)</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6\">\n                <h3 className=\"font-bold text-green-800 dark:text-green-200 mb-3\">\n                  ðŸŽ¯ Perfect for Louisiana Contractors Who:\n                </h3>\n                <ul className=\"text-green-700 dark:text-green-300 space-y-2 text-sm\">\n                  <li>âœ… Want to avoid costly code violations</li>\n                  <li>âœ… Need quick reference for job sites</li>\n                  <li>âœ… Are preparing for journeyman certification</li>\n                  <li>âœ… Want to stay current with 2024 changes</li>\n                  <li>âœ… Need professional credibility with clients</li>\n                </ul>\n              </div>\n            </div>\n\n            {/* Right Side - Lead Capture Form */}\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8\">\n              <div className=\"text-center mb-6\">\n                <Download className=\"w-12 h-12 text-blue-600 dark:text-blue-400 mx-auto mb-4\" />\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n                  Get Your FREE Guide\n                </h2>\n                <p className=\"text-gray-600 dark:text-gray-300\">\n                  Enter your details below for instant access\n                </p>\n              </div>\n\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"firstName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>First Name *</FormLabel>\n                          <FormControl>\n                            <Input \n                              placeholder=\"John\" \n                              {...field} \n                              data-testid=\"input-first-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={form.control}\n                      name=\"lastName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Last Name *</FormLabel>\n                          <FormControl>\n                            <Input \n                              placeholder=\"Smith\" \n                              {...field} \n                              data-testid=\"input-last-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email Address *</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"email\" \n                            placeholder=\"john@smithplumbing.com\" \n                            {...field} \n                            data-testid=\"input-email\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"companyName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Company Name *</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Smith Plumbing LLC\" \n                            {...field} \n                            data-testid=\"input-company\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"position\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Position (Optional)</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Owner, Journeyman, etc.\" \n                            {...field} \n                            data-testid=\"input-position\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 text-lg\"\n                    disabled={isSubmitting}\n                    data-testid=\"button-download\"\n                  >\n                    {isSubmitting ? \"Sending...\" : \"ðŸš€ Download FREE Guide Now\"}\n                  </Button>\n                </form>\n              </Form>\n              \n              <div className=\"mt-6 text-center\">\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  ðŸ“§ No spam, ever. Unsubscribe with one click.<br />\n                  ðŸ”’ Your email is safe and secure with us.\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Social Proof Section */}\n      <div className=\"bg-white dark:bg-gray-800 py-16\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <h2 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-8\">\n              Join 500+ Louisiana Contractors Already Using Our Resources\n            </h2>\n            \n            <div className=\"grid md:grid-cols-3 gap-8\">\n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-6\">\n                <div className=\"text-4xl mb-4\">â­â­â­â­â­</div>\n                <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                  \"This guide saved me $3,000 on my last inspection. Caught issues before the inspector did.\"\n                </p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">- Mike T., Baton Rouge</p>\n              </div>\n              \n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-6\">\n                <div className=\"text-4xl mb-4\">â­â­â­â­â­</div>\n                <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                  \"Finally, Louisiana-specific information that actually helps. Keep it on every job site.\"\n                </p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">- Sarah K., New Orleans</p>\n              </div>\n              \n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-6\">\n                <div className=\"text-4xl mb-4\">â­â­â­â­â­</div>\n                <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                  \"The bonus calculator tool alone is worth hundreds. Professional and accurate.\"\n                </p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">- Robert L., Lafayette</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":15508},"client/src/pages/student-lead-magnet.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Download, Target, TrendingUp, Award, BookOpen, DollarSign } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst studentLeadMagnetSchema = z.object({\n  email: z.string().email(\"Please enter a valid email address\"),\n  firstName: z.string().min(2, \"First name must be at least 2 characters\"),\n  lastName: z.string().min(2, \"Last name must be at least 2 characters\"),\n  currentLevel: z.string().min(2, \"Please specify your current level\"),\n  goals: z.string().optional(),\n});\n\ntype StudentLeadMagnetForm = z.infer<typeof studentLeadMagnetSchema>;\n\nexport default function StudentLeadMagnet() {\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<StudentLeadMagnetForm>({\n    resolver: zodResolver(studentLeadMagnetSchema),\n    defaultValues: {\n      email: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      currentLevel: \"\",\n      goals: \"\",\n    },\n  });\n\n  const onSubmit = async (data: StudentLeadMagnetForm) => {\n    setIsSubmitting(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/student-lead-magnet/download\", data);\n      \n      if (response.ok) {\n        setIsSuccess(true);\n        toast({\n          title: \"Success!\",\n          description: \"Check your email for your career roadmap and exclusive study materials.\",\n        });\n      } else {\n        throw new Error(\"Failed to process request\");\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send career guide. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isSuccess) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl w-full\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-16 h-16 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center mb-4\">\n              <CheckCircle className=\"w-8 h-8 text-purple-600 dark:text-purple-400\" />\n            </div>\n            <CardTitle className=\"text-2xl text-purple-700 dark:text-purple-300\">Check Your Email!</CardTitle>\n            <CardDescription className=\"text-lg\">\n              Your Louisiana Plumbing Career Roadmap is on its way, plus exclusive bonus materials.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\n              <h3 className=\"font-semibold text-blue-800 dark:text-blue-200 mb-2\">ðŸ“§ What's Coming Next:</h3>\n              <ul className=\"text-sm text-blue-700 dark:text-blue-300 space-y-1\">\n                <li>â€¢ Complete Louisiana plumbing career roadmap</li>\n                <li>â€¢ Salary progression guide with real numbers</li>\n                <li>â€¢ Free practice tests and study materials</li>\n                <li>â€¢ Weekly career tips and industry updates</li>\n                <li>â€¢ Early access to certification courses</li>\n              </ul>\n            </div>\n            \n            <div className=\"text-center\">\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Ready to start your plumbing career journey?\n              </p>\n              <Button asChild className=\"bg-purple-600 hover:bg-purple-700\">\n                <a href=\"/courses\">Explore Certification Courses</a>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 dark:from-gray-900 dark:to-gray-800\">\n      {/* Hero Section */}\n      <div className=\"container mx-auto px-6 py-12\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center mb-12\">\n            <Badge className=\"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 mb-4\">\n              ðŸŽ† FREE CAREER GUIDE\n            </Badge>\n            <h1 className=\"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6\">\n              Louisiana Plumbing\n              <br />\n              <span className=\"text-purple-600 dark:text-purple-400\">Career Roadmap 2024</span>\n            </h1>\n            <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8\">\n              The complete guide to building a $75,000+ plumbing career in Louisiana. \n              <strong>Download this roadmap and start earning more within 12 months.</strong>\n            </p>\n          </div>\n\n          <div className=\"grid lg:grid-cols-2 gap-12 items-center\">\n            {/* Left Side - Benefits */}\n            <div className=\"space-y-8\">\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-lg\">\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-6\">\n                  What You'll Get (FREE):\n                </h2>\n                \n                <div className=\"space-y-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <Target className=\"w-6 h-6 text-purple-600 dark:text-purple-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">Complete Career Roadmap</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">Step-by-step path from beginner to master plumber</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <DollarSign className=\"w-6 h-6 text-green-600 dark:text-green-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">Salary Progression Guide</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">Real Louisiana wages from $35K to $85K+ per year</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <Award className=\"w-6 h-6 text-blue-600 dark:text-blue-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">Certification Timeline</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">When to get apprentice, journeyman, and master licenses</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <BookOpen className=\"w-6 h-6 text-orange-600 dark:text-orange-400 mt-0.5\" />\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white\">BONUS: Study Materials Pack</h3>\n                      <p className=\"text-gray-600 dark:text-gray-300 text-sm\">Practice tests, flashcards, and study guides (Value: $127)</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6\">\n                <h3 className=\"font-bold text-green-800 dark:text-green-200 mb-3\">\n                  ðŸŽ¯ Perfect for You If:\n                </h3>\n                <ul className=\"text-green-700 dark:text-green-300 space-y-2 text-sm\">\n                  <li>âœ… New to plumbing and want a clear career path</li>\n                  <li>âœ… Current apprentice ready for journeyman level</li>\n                  <li>âœ… Want to maximize your earning potential</li>\n                  <li>âœ… Planning to start your own plumbing business</li>\n                  <li>âœ… Need Louisiana-specific licensing information</li>\n                </ul>\n              </div>\n              \n              <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6\">\n                <h3 className=\"font-bold text-yellow-800 dark:text-yellow-200 mb-3\">\n                  ðŸ’° Louisiana Plumber Salaries:\n                </h3>\n                <ul className=\"text-yellow-700 dark:text-yellow-300 space-y-1 text-sm\">\n                  <li>â€¢ <strong>Apprentice:</strong> $35,000 - $42,000/year</li>\n                  <li>â€¢ <strong>Journeyman:</strong> $55,000 - $68,000/year</li>\n                  <li>â€¢ <strong>Master Plumber:</strong> $70,000 - $85,000+/year</li>\n                  <li>â€¢ <strong>Business Owner:</strong> $90,000 - $150,000+/year</li>\n                </ul>\n              </div>\n            </div>\n\n            {/* Right Side - Lead Capture Form */}\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8\">\n              <div className=\"text-center mb-6\">\n                <Download className=\"w-12 h-12 text-purple-600 dark:text-purple-400 mx-auto mb-4\" />\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n                  Get Your FREE Career Guide\n                </h2>\n                <p className=\"text-gray-600 dark:text-gray-300\">\n                  Start building your $75K+ plumbing career today\n                </p>\n              </div>\n\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"firstName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>First Name *</FormLabel>\n                          <FormControl>\n                            <Input \n                              placeholder=\"John\" \n                              {...field} \n                              data-testid=\"input-first-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={form.control}\n                      name=\"lastName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Last Name *</FormLabel>\n                          <FormControl>\n                            <Input \n                              placeholder=\"Smith\" \n                              {...field} \n                              data-testid=\"input-last-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email Address *</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"email\" \n                            placeholder=\"john.smith@email.com\" \n                            {...field} \n                            data-testid=\"input-email\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"currentLevel\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Current Level *</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"New to plumbing, Apprentice, etc.\" \n                            {...field} \n                            data-testid=\"input-level\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"goals\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Career Goals (Optional)</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Get journeyman license, start business, etc.\" \n                            {...field} \n                            data-testid=\"input-goals\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 text-lg\"\n                    disabled={isSubmitting}\n                    data-testid=\"button-download\"\n                  >\n                    {isSubmitting ? \"Sending...\" : \"ðŸš€ Download FREE Career Guide\"}\n                  </Button>\n                </form>\n              </Form>\n              \n              <div className=\"mt-6 text-center\">\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  ðŸ“§ No spam, ever. Unsubscribe with one click.<br />\n                  ðŸ”’ Your email is safe and secure with us.\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Success Stories Section */}\n      <div className=\"bg-white dark:bg-gray-800 py-16\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <h2 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-8\">\n              Join 1,200+ Louisiana Plumbers Who've Advanced Their Careers\n            </h2>\n            \n            <div className=\"grid md:grid-cols-3 gap-8\">\n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-6\">\n                <div className=\"text-4xl mb-4\">ðŸŽ‰</div>\n                <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                  \"Went from $38K to $62K in 18 months following this roadmap. The certification prep was spot-on.\"\n                </p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">- Marcus R., New Orleans</p>\n                <p className=\"text-sm text-gray-500\">Apprentice â†’ Journeyman</p>\n              </div>\n              \n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-6\">\n                <div className=\"text-4xl mb-4\">ðŸ’¼</div>\n                <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                  \"Started my own business at 28. Now earning $120K/year. This guide showed me exactly when and how.\"\n                </p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">- Jennifer K., Baton Rouge</p>\n                <p className=\"text-sm text-gray-500\">Journeyman â†’ Business Owner</p>\n              </div>\n              \n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-6\">\n                <div className=\"text-4xl mb-4\">ðŸŽ¯</div>\n                <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                  \"Passed my journeyman exam on the first try. The study materials made all the difference.\"\n                </p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">- David M., Lafayette</p>\n                <p className=\"text-sm text-gray-500\">Recent Certification Success</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Career Progression Visual */}\n      <div className=\"bg-gradient-to-r from-purple-600 to-blue-600 py-16\">\n        <div className=\"container mx-auto px-6\">\n          <div className=\"max-w-4xl mx-auto text-center text-white\">\n            <h2 className=\"text-3xl font-bold mb-8\">\n              Your Louisiana Plumbing Career Journey\n            </h2>\n            \n            <div className=\"grid md:grid-cols-4 gap-6\">\n              <div className=\"bg-white/10 backdrop-blur rounded-lg p-6\">\n                <div className=\"text-3xl mb-3\">ðŸ”¨</div>\n                <h3 className=\"font-bold mb-2\">Apprentice</h3>\n                <p className=\"text-sm mb-2\">$35K - $42K/year</p>\n                <p className=\"text-xs opacity-90\">Learn the basics</p>\n              </div>\n              \n              <div className=\"bg-white/10 backdrop-blur rounded-lg p-6\">\n                <div className=\"text-3xl mb-3\">âš™ï¸</div>\n                <h3 className=\"font-bold mb-2\">Journeyman</h3>\n                <p className=\"text-sm mb-2\">$55K - $68K/year</p>\n                <p className=\"text-xs opacity-90\">Work independently</p>\n              </div>\n              \n              <div className=\"bg-white/10 backdrop-blur rounded-lg p-6\">\n                <div className=\"text-3xl mb-3\">ðŸ†</div>\n                <h3 className=\"font-bold mb-2\">Master</h3>\n                <p className=\"text-sm mb-2\">$70K - $85K/year</p>\n                <p className=\"text-xs opacity-90\">Supervise others</p>\n              </div>\n              \n              <div className=\"bg-white/10 backdrop-blur rounded-lg p-6\">\n                <div className=\"text-3xl mb-3\">ðŸ¢</div>\n                <h3 className=\"font-bold mb-2\">Business Owner</h3>\n                <p className=\"text-sm mb-2\">$90K - $150K+/year</p>\n                <p className=\"text-xs opacity-90\">Own your future</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":18675},"server/bulk-pricing.ts":{"content":"import { db } from \"./db\";\nimport { \n  bulkEnrollmentTiers, \n  bulkEnrollmentRequests, \n  bulkStudentEnrollments,\n  courses,\n  type BulkEnrollmentTier,\n  type InsertBulkEnrollmentRequest,\n  type InsertBulkStudentEnrollment\n} from \"@shared/schema\";\nimport { eq, and, gte, lte, or, isNull } from \"drizzle-orm\";\n\nexport interface BulkPricingCalculation {\n  studentCount: number;\n  courseIds: string[];\n  basePricePerStudent: number;\n  totalBasePrice: number;\n  appliedTier: BulkEnrollmentTier | null;\n  discountPercent: number;\n  discountAmount: number;\n  finalPrice: number;\n  pricePerStudent: number;\n}\n\nexport interface StudentEnrollmentData {\n  email: string;\n  firstName: string;\n  lastName?: string;\n}\n\nexport class BulkPricingService {\n  \n  /**\n   * Initialize default bulk enrollment tiers\n   */\n  async initializeBulkTiers() {\n    try {\n      // Check if tiers already exist\n      const existingTiers = await db.select().from(bulkEnrollmentTiers).limit(1);\n      if (existingTiers.length > 0) {\n        return; // Already initialized\n      }\n\n      // Create tiered discount structure for bulk enrollments\n      const defaultTiers = [\n        {\n          tierName: \"Small Team\",\n          minStudents: 5,\n          maxStudents: 19,\n          discountPercent: \"10.00\", // 10% discount for small teams\n          basePrice: \"49.00\" // Base price per student (results in $44/student)\n        },\n        {\n          tierName: \"Medium Team\", \n          minStudents: 20,\n          maxStudents: 49,\n          discountPercent: \"15.00\", // 15% discount for medium teams\n          basePrice: \"49.00\" // Base price per student (results in $42/student)\n        },\n        {\n          tierName: \"Large Company\",\n          minStudents: 50,\n          maxStudents: null, // No upper limit\n          discountPercent: \"25.00\", // 25% discount for large companies\n          basePrice: \"49.00\" // Base price per student (results in $37/student)\n        }\n      ];\n\n      await db.insert(bulkEnrollmentTiers).values(defaultTiers);\n      console.log(\"Bulk enrollment tiers initialized\");\n    } catch (error) {\n      console.error(\"Error initializing bulk enrollment tiers:\", error);\n    }\n  }\n\n  /**\n   * Calculate bulk pricing for a given number of students\n   */\n  async calculateBulkPricing(\n    studentCount: number, \n    courseIds: string[] = [\"journeyman\"] // Default to journeyman course\n  ): Promise<BulkPricingCalculation> {\n    \n    // Get available pricing tiers\n    const tiers = await db\n      .select()\n      .from(bulkEnrollmentTiers)\n      .where(eq(bulkEnrollmentTiers.isActive, true));\n\n    // Find applicable tier\n    const applicableTier = tiers.find(tier => {\n      const meetsMin = studentCount >= tier.minStudents;\n      const meetsMax = tier.maxStudents === null || studentCount <= tier.maxStudents;\n      return meetsMin && meetsMax;\n    });\n\n    // Base pricing calculation\n    const basePricePerStudent = 49; // Basic tier price\n    const totalBasePrice = basePricePerStudent * studentCount * courseIds.length;\n    \n    // Apply bulk discount if applicable\n    const discountPercent = applicableTier ? parseFloat(applicableTier.discountPercent) : 0;\n    const discountAmount = totalBasePrice * (discountPercent / 100);\n    const finalPrice = totalBasePrice - discountAmount;\n    const pricePerStudent = finalPrice / studentCount;\n\n    return {\n      studentCount,\n      courseIds,\n      basePricePerStudent,\n      totalBasePrice,\n      appliedTier: applicableTier || null,\n      discountPercent,\n      discountAmount,\n      finalPrice,\n      pricePerStudent\n    };\n  }\n\n  /**\n   * Get all active bulk pricing tiers\n   */\n  async getBulkPricingTiers() {\n    return await db\n      .select()\n      .from(bulkEnrollmentTiers)\n      .where(eq(bulkEnrollmentTiers.isActive, true));\n  }\n\n  /**\n   * Create a bulk enrollment request\n   */\n  async createBulkEnrollmentRequest(\n    employerId: string,\n    studentEmails: StudentEnrollmentData[],\n    courseIds: string[],\n    contactEmail: string,\n    contactPhone?: string,\n    notes?: string,\n    requestedStartDate?: Date\n  ) {\n    try {\n      const studentCount = studentEmails.length;\n      \n      // Calculate pricing\n      const pricing = await this.calculateBulkPricing(studentCount, courseIds);\n\n      // Create bulk enrollment request\n      const [bulkRequest] = await db\n        .insert(bulkEnrollmentRequests)\n        .values({\n          employerId,\n          studentCount,\n          courseIds,\n          totalPrice: pricing.totalBasePrice.toString(),\n          discountPercent: pricing.discountPercent.toString(),\n          finalPrice: pricing.finalPrice.toString(),\n          contactEmail,\n          contactPhone,\n          notes,\n          requestedStartDate,\n        })\n        .returning();\n\n      // Create individual student enrollment records\n      const studentEnrollments = studentEmails.map(student => ({\n        bulkRequestId: bulkRequest.id,\n        studentEmail: student.email,\n        studentFirstName: student.firstName,\n        studentLastName: student.lastName || null,\n      }));\n\n      await db.insert(bulkStudentEnrollments).values(studentEnrollments);\n\n      return {\n        bulkRequest,\n        pricing,\n        studentCount\n      };\n    } catch (error) {\n      console.error(\"Error creating bulk enrollment request:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get bulk enrollment requests for an employer\n   */\n  async getBulkEnrollmentRequests(employerId: string) {\n    return await db\n      .select()\n      .from(bulkEnrollmentRequests)\n      .where(eq(bulkEnrollmentRequests.employerId, employerId));\n  }\n\n  /**\n   * Get student enrollments for a bulk request\n   */\n  async getBulkStudentEnrollments(bulkRequestId: string) {\n    return await db\n      .select()\n      .from(bulkStudentEnrollments)\n      .where(eq(bulkStudentEnrollments.bulkRequestId, bulkRequestId));\n  }\n\n  /**\n   * Approve a bulk enrollment request\n   */\n  async approveBulkEnrollmentRequest(requestId: string, approvedBy: string) {\n    try {\n      // Update request status\n      const [updatedRequest] = await db\n        .update(bulkEnrollmentRequests)\n        .set({\n          status: \"approved\",\n          approvedBy,\n          approvedAt: new Date(),\n          updatedAt: new Date()\n        })\n        .where(eq(bulkEnrollmentRequests.id, requestId))\n        .returning();\n\n      // TODO: Send enrollment invites to students\n      // This would trigger email invitations to each student\n\n      return updatedRequest;\n    } catch (error) {\n      console.error(\"Error approving bulk enrollment request:\", error);\n      throw error;\n    }\n  }\n}\n\nexport const bulkPricingService = new BulkPricingService();","size_bytes":6671},"client/src/components/content-viewer-old.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  BookOpen, \n  Play, \n  Pause,\n  Square,\n  Volume2,\n  VolumeX, \n  MessageSquare, \n  CheckCircle, \n  ExternalLink,\n  RefreshCw,\n  Loader2,\n  Settings,\n  Clock,\n  Timer,\n  RotateCcw\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useStudySession } from \"@/hooks/use-study-session\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport PodcastPlayer from \"@/components/podcast-player\";\n\ninterface ContentViewerProps {\n  contentId: string;\n  contentType: string;\n  title: string;\n  courseId: string;\n  sectionId?: string;\n  onComplete?: () => void;\n}\n\ninterface ExtractedContent {\n  id: string;\n  title: string;\n  type: string;\n  content: {\n    extracted?: {\n      html?: string;\n      text?: string;\n      content?: string;\n      questions?: any[];\n      cards?: any[];\n      keyPoints?: string[];\n      audioUrl?: string;\n      transcript?: string;\n      chatContent?: string;\n      passingScore?: number;\n    };\n    chatContent?: string;\n    extractedAt?: string;\n  };\n  quizgeckoUrl?: string;\n}\n\nexport default function ContentViewer({ contentId, contentType, title, courseId, sectionId, onComplete }: ContentViewerProps) {\n  const [audioPlaying, setAudioPlaying] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n  const [speechSynthesis, setSpeechSynthesis] = useState<SpeechSynthesis | null>(null);\n  const [currentUtterance, setCurrentUtterance] = useState<SpeechSynthesisUtterance | null>(null);\n  const [currentSentence, setCurrentSentence] = useState('');\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  \n  // Initialize study session tracking\n  const studySession = useStudySession({\n    contentId,\n    contentType: contentType as 'lesson' | 'quiz' | 'flashcards' | 'chat' | 'podcast' | 'notes' | 'tools',\n    autoStart: true\n  });\n  \n  // Chat state\n  const [chatMessages, setChatMessages] = useState<Array<{role: 'user' | 'assistant', content: string, id?: string}>>([]);\n  const [chatInputMessage, setChatInputMessage] = useState('');\n  const [isChatLoading, setIsChatLoading] = useState(false);\n  const [autoPlayEnabled, setAutoPlayEnabled] = useState(true);\n  const [currentPlayingId, setCurrentPlayingId] = useState<string | null>(null);\n  const [selectedVoice, setSelectedVoice] = useState<string>('auto');\n  const [availableVoices, setAvailableVoices] = useState<SpeechSynthesisVoice[]>([]);\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [userAnswers, setUserAnswers] = useState<Record<number, string>>({});\n  const [selectedQuizAnswer, setSelectedQuizAnswer] = useState<string | null>(null);\n  const [showQuizResults, setShowQuizResults] = useState(false);\n  const [quizScore, setQuizScore] = useState(0);\n  const [incorrectQuizAnswers, setIncorrectQuizAnswers] = useState<any[]>([]);\n  const [isSubmittingQuiz, setIsSubmittingQuiz] = useState(false);\n  const [quizAttempt, setQuizAttempt] = useState<any>(null);\n\n  const { data: content, isLoading, error } = useQuery<ExtractedContent>({\n    queryKey: [`/api/content/${contentId}/display`],\n  });\n  \n  const { toast } = useToast();\n\n  useEffect(() => {\n    if (typeof window !== 'undefined' && 'speechSynthesis' in window) {\n      setSpeechSynthesis(window.speechSynthesis);\n      \n      // Load available voices\n      const loadVoices = () => {\n        const voices = window.speechSynthesis.getVoices();\n        const englishVoices = voices.filter(voice => \n          voice.lang.startsWith('en') && !voice.name.includes('eSpeak')\n        );\n        setAvailableVoices(englishVoices);\n        \n        // Load saved voice preference\n        const savedVoice = localStorage.getItem('ai-mentor-voice');\n        if (savedVoice) {\n          setSelectedVoice(savedVoice);\n        }\n      };\n      \n      loadVoices();\n      // Voices might not be loaded immediately, so listen for the voiceschanged event\n      window.speechSynthesis.addEventListener('voiceschanged', loadVoices);\n      \n      // Load voices if they're not ready yet\n      if (window.speechSynthesis.getVoices().length === 0) {\n        window.speechSynthesis.addEventListener('voiceschanged', () => {\n          // Voices are now loaded\n        });\n      }\n    }\n  }, []);\n\n  // Parse text-based quiz questions into structured format\n  const parseQuestionsFromText = (text: string): any[] => {\n    const questions: any[] = [];\n    \n    // Clean up text by removing escaped newlines and extra formatting\n    const cleanText = text\n      .replace(/\\\\n/g, ' ')\n      .replace(/\\\\t/g, ' ')\n      .replace(/\\n+/g, '\\n')\n      .replace(/\\s+/g, ' ')\n      .trim();\n    \n    // Split by **number. pattern to get question blocks\n    const questionBlocks = cleanText.split(/\\*\\*\\d+\\./).filter(block => block.trim().length > 0);\n    \n    questionBlocks.forEach((block, index) => {\n      // Clean the block text\n      let cleanBlock = block.replace(/\\*\\*/g, '').trim();\n      \n      // Extract question text (until first option A.)\n      const questionMatch = cleanBlock.match(/^([^A]*?)(?=[A-D]\\.)/s);\n      if (!questionMatch) return;\n      \n      const questionText = questionMatch[1].trim();\n      if (questionText.length < 10) return;\n      \n      // Extract individual options using more precise pattern\n      const optionPattern = /([A-D])\\.\\s*([^A-D]*?)(?=\\s*[A-D]\\.|$)/gs;\n      const optionMatches = [...cleanBlock.matchAll(optionPattern)];\n      \n      if (optionMatches.length < 2) return;\n      \n      const options: any[] = [];\n      const seenTexts = new Set(); // Track duplicate options\n      \n      optionMatches.forEach((match, optIndex) => {\n        const [, letter, optionText] = match;\n        let cleanOptionText = optionText.trim();\n        \n        // Remove checkmarks and other symbols\n        const isCorrect = cleanOptionText.includes('âœ“');\n        cleanOptionText = cleanOptionText\n          .replace(/âœ“/g, '')\n          .replace(/\\s+/g, ' ')\n          .trim();\n        \n        // Only add if text is meaningful and not duplicate\n        if (cleanOptionText.length > 3 && !seenTexts.has(cleanOptionText)) {\n          seenTexts.add(cleanOptionText);\n          options.push({\n            id: `${index}-${letter}`,\n            text: cleanOptionText,\n            isCorrect: isCorrect\n          });\n        }\n      });\n      \n      // Only add question if we have valid options and at least one correct answer\n      if (options.length >= 2 && options.some(opt => opt.isCorrect)) {\n        questions.push({\n          id: `q-${index}`,\n          question: questionText,\n          options: options,\n          type: 'multiple-choice',\n          explanation: `Reference: Louisiana State Plumbing Code`,\n          reference: 'Louisiana State Plumbing Code'\n        });\n      }\n    });\n    \n    return questions.slice(0, 20);\n  };\n\n  // Auto-start podcast audio for immediate playback\n  useEffect(() => {\n    if (contentType === 'podcast' && content?.content?.extracted) {\n      if (content?.content?.extracted?.audioUrl) {\n        // If AI audio exists, play it\n        setTimeout(() => {\n          const audioElement = document.querySelector('audio') as HTMLAudioElement;\n          if (audioElement) {\n            audioElement.play().catch(error => {\n              console.log('Auto-play prevented by browser:', error);\n            });\n          }\n        }, 100);\n      } else if (content?.content?.extracted?.transcript || content?.content?.extracted?.content || content?.content?.extracted?.text) {\n        // Stop any existing speech before starting new one\n        if (speechSynthesis) {\n          speechSynthesis.cancel();\n        }\n        \n        // Reset states\n        setIsPlaying(false);\n        setIsPaused(false);\n        setCurrentUtterance(null);\n        setCurrentSentence('');\n        \n        // Otherwise use TTS with clean text\n        const getCleanTextForAutoStart = () => {\n          const extracted = content?.content?.extracted;\n          let text = extracted?.transcript || extracted?.content || extracted?.html || extracted?.text || '';\n          \n          if (text) {\n            text = text\n              .replace(/\\*\\[This would be.*?\\]\\*/g, '')\n              .replace(/\\\\n\\\\n/g, '. ')\n              .replace(/\\\\n/g, '. ')\n              .replace(/\\*\\*(.*?)\\*\\*/g, '$1')\n              .replace(/### (.*$)/gm, '$1. ')\n              .replace(/## (.*$)/gm, '$1. ')\n              .replace(/# (.*$)/gm, '$1. ')\n              .replace(/\\(\\d{1,2}:\\d{2}-\\d{1,2}:\\d{2}\\)/g, '')\n              .replace(/###\\s*/g, '')\n              .replace(/\\?\\s+/g, '? ')\n              .replace(/\\.\\s*\\./g, '.')\n              .replace(/\\s+/g, ' ')\n              .replace(/([a-z])([A-Z])/g, '$1. $2')\n              .trim();\n          }\n          \n          return text;\n        };\n        \n        // Removed auto-start - will only start when user clicks Review button\n      }\n    }\n    \n    // Cleanup: stop audio when component unmounts or content type changes\n    return () => {\n      if (speechSynthesis) {\n        speechSynthesis.cancel();\n      }\n      setIsPlaying(false);\n      setIsPaused(false);\n      setCurrentUtterance(null);\n      setCurrentSentence('');\n    };\n  }, [contentType, content?.content?.extracted?.transcript, content?.content?.extracted?.content, content?.content?.extracted?.text, content?.content?.extracted?.audioUrl, speechSynthesis]);\n\n  const extractMutation = useMutation({\n    mutationFn: () => fetch(`/api/extract-content/${contentId}`, { \n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(res => res.json()),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/content/${contentId}/display`] });\n    }\n  });\n\n  const generateAudioMutation = useMutation({\n    mutationFn: () => fetch(`/api/generate-audio/${contentId}`, { \n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(res => res.json()),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/content/${contentId}/display`] });\n    }\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"w-8 h-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (error || !content) {\n    return (\n      <div className=\"text-center p-8\">\n        <p className=\"text-red-600 mb-4\">Failed to load content</p>\n        <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n          {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n          Try Again\n        </Button>\n      </div>\n    );\n  }\n\n  // All content is pre-extracted and stored in the database\n  const hasExtractedContent = !!content?.content?.extracted;\n  \n  // Helper function to get content text from various possible locations\n  const getContentText = () => {\n    const extracted = content?.content?.extracted;\n    let text = extracted?.transcript || extracted?.content || extracted?.html || extracted?.text || '';\n    \n    // Convert literal \\n characters to actual HTML formatting\n    if (text) {\n      text = text\n        .replace(/\\\\n\\\\n/g, '</p><p class=\"mb-4\">')\n        .replace(/\\\\n/g, '<br/>')\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n        .replace(/### (.*$)/gm, '<h3 class=\"text-lg font-semibold mt-6 mb-3\">$1</h3>')\n        .replace(/## (.*$)/gm, '<h2 class=\"text-xl font-bold mt-8 mb-4\">$1</h2>')\n        .replace(/# (.*$)/gm, '<h1 class=\"text-2xl font-bold mt-8 mb-6\">$1</h1>');\n      \n      // Wrap in paragraph tags if not already HTML\n      if (!text.includes('<')) {\n        text = '<p class=\"mb-4\">' + text + '</p>';\n      }\n    }\n    \n    return text;\n  };\n\n  // Helper function to get clean text for audio (no HTML/markdown)\n  const getCleanTextForAudio = () => {\n    const extracted = content?.content?.extracted;\n    let text = extracted?.transcript || extracted?.content || extracted?.html || extracted?.text || '';\n    \n    // Clean up all formatting for audio reading and display\n    if (text) {\n      text = text\n        .replace(/\\*\\[This would be.*?\\]\\*/g, '')  // Remove placeholder instructions\n        .replace(/\\\\n\\\\n/g, '. ')  // Convert paragraph breaks to sentences with periods\n        .replace(/\\\\n/g, '. ')  // Convert line breaks to sentence breaks with periods\n        .replace(/\\*\\*(.*?)\\*\\*/g, '$1')  // Remove bold markers **text**\n        .replace(/### (.*$)/gm, '$1. ')  // Remove ### headers and add periods\n        .replace(/## (.*$)/gm, '$1. ')   // Remove ## headers and add periods\n        .replace(/# (.*$)/gm, '$1. ')    // Remove # headers and add periods\n        .replace(/\\(\\d{1,2}:\\d{2}-\\d{1,2}:\\d{2}\\)/g, '')  // Remove timestamps (0:00-1:30)\n        .replace(/###\\s*/g, '')  // Remove any remaining ###\n        .replace(/\\?\\s+/g, '? ')  // Clean up question marks\n        .replace(/\\.\\s*\\./g, '.')  // Remove double periods\n        .replace(/\\s+/g, ' ')  // Replace multiple spaces with single space\n        .replace(/([a-z])([A-Z])/g, '$1. $2')  // Add periods between sentences that run together\n        .trim();\n    }\n    \n    return text;\n  };\n\n  const handleComplete = async () => {\n    // Stop any playing audio before completing\n    if (speechSynthesis) {\n      speechSynthesis.cancel();\n      setIsPlaying(false);\n      setIsPaused(false);\n      setCurrentUtterance(null);\n      setCurrentSentence('');\n    }\n    \n    // End the study session tracking\n    if (studySession.session && studySession.isActive) {\n      await studySession.endSession();\n    }\n    \n    onComplete?.();\n    \n    // Navigate back to lesson page\n    const lessonPath = sectionId \n      ? `/course/${courseId}/lesson/${sectionId}`\n      : `/course/${courseId}/lesson`;\n    setLocation(lessonPath);\n  };\n\n  const renderLessonContent = () => {\n    const extracted = content.content?.extracted;\n    \n    const lessonContent = getContentText();\n    if (!lessonContent) {\n      return (\n        <div className=\"text-center p-6\">\n          <p className=\"mb-4\">No content available.</p>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"space-y-6\">\n        <div \n          className=\"prose max-w-none\"\n          dangerouslySetInnerHTML={{ __html: lessonContent }}\n        />\n        {extracted.text && !extracted.html && (\n          <div className=\"whitespace-pre-wrap text-foreground\">\n            {extracted.text}\n          </div>\n        )}\n        \n      </div>\n    );\n  };\n\n  const renderQuizContent = () => {\n    let questions = content.content?.extracted?.questions || [];\n    \n    // If no structured questions exist, try to parse from text content\n    if (questions.length === 0 && content.content?.extracted?.content) {\n      questions = parseQuestionsFromText(content.content.extracted.content);\n    }\n    \n    // Chapter Review sections require 80%, all others require 70%\n    const isChapterReview = content.title?.toLowerCase().includes('chapter review') || \n                           content.title?.toLowerCase().includes('review') && content.title?.toLowerCase().includes('chapter');\n    const passingScore = isChapterReview ? 80 : (content.content?.extracted?.passingScore || 70);\n    \n    \n    if (questions.length === 0) {\n      return (\n        <div className=\"text-center p-6\">\n          <p className=\"mb-4\">No quiz content available.</p>\n          <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n            {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n            Extract Quiz\n          </Button>\n        </div>\n      );\n    }\n\n    const handleAnswerSelect = (optionId: string) => {\n      setSelectedQuizAnswer(optionId);\n      setUserAnswers(prev => ({\n        ...prev,\n        [currentQuestion]: optionId\n      }));\n    };\n\n    const nextQuestion = () => {\n      if (currentQuestion < questions.length - 1) {\n        setCurrentQuestion(prev => prev + 1);\n        setSelectedQuizAnswer(userAnswers[currentQuestion + 1] ?? null);\n      }\n    };\n\n    const prevQuestion = () => {\n      setCurrentQuestion(prev => prev - 1);\n      setSelectedQuizAnswer(userAnswers[currentQuestion - 1] || null);\n    };\n\n    const submitQuiz = async () => {\n      setIsSubmittingQuiz(true);\n      // Chapter Review sections require 80%, all others require 70%\n      const isChapterReview = content.title?.toLowerCase().includes('chapter review') || \n                             content.title?.toLowerCase().includes('review') && content.title?.toLowerCase().includes('chapter');\n      const passingScore = isChapterReview ? 80 : (content?.content?.extracted?.passingScore || 70);\n      \n      try {\n        // Record the last answer if not already saved\n        const finalAnswers = {\n          ...userAnswers,\n          [currentQuestion]: selectedQuizAnswer || ''\n        };\n\n        // Prepare questions with user answers\n        const questionsWithAnswers = questions.map((question: any, index: number) => ({\n          id: question.id,\n          question: question.question,\n          options: question.options,\n          userAnswer: finalAnswers[index] || null,\n          correctAnswer: question.options?.find((opt: any) => opt.isCorrect)?.id,\n          isCorrect: finalAnswers[index] === question.options?.find((opt: any) => opt.isCorrect)?.id,\n          explanation: question.explanation,\n          reference: question.reference\n        }));\n\n        // Calculate score\n        const correctAnswers = questionsWithAnswers.filter(q => q.isCorrect).length;\n        const score = Math.round((correctAnswers / questions.length) * 100);\n        const passed = score >= passingScore;\n\n        // Submit to backend\n        const response = await apiRequest('POST', '/api/quiz-attempts', {\n          contentId,\n          courseId,\n          section: content?.section || 1,\n          chapter: content?.chapter || 1,\n          questions: questionsWithAnswers,\n          totalQuestions: questions.length,\n          correctAnswers,\n          score,\n          passed\n        });\n\n        const attempt = await response.json();\n        setQuizAttempt(attempt);\n        setQuizScore(score);\n        \n        // Prepare incorrect answers for review\n        const incorrect = questionsWithAnswers.filter(q => !q.isCorrect).map(q => ({\n          question: q.question,\n          userAnswer: q.userAnswer ? q.options.find((opt: any) => opt.id === q.userAnswer)?.text || 'No answer' : 'No answer',\n          correctAnswer: q.options.find((opt: any) => opt.id === q.correctAnswer)?.text,\n          explanation: q.explanation,\n          reference: q.reference\n        }));\n        \n        setIncorrectQuizAnswers(incorrect);\n        setShowQuizResults(true);\n        \n        // Invalidate queries to refresh progress\n        queryClient.invalidateQueries({ queryKey: ['/api/section-progress'] });\n        \n      } catch (error) {\n        console.error('Failed to submit quiz:', error);\n        toast({\n          title: \"Error\",\n          description: \"Failed to submit quiz. Please try again.\",\n          variant: \"destructive\"\n        });\n      } finally {\n        setIsSubmittingQuiz(false);\n      }\n    };\n\n    const restartQuiz = () => {\n      setCurrentQuestion(0);\n      setUserAnswers({});\n      setSelectedQuizAnswer(null);\n      setShowQuizResults(false);\n      setQuizScore(0);\n      setIncorrectQuizAnswers([]);\n      setQuizAttempt(null);\n    };\n\n    if (showQuizResults) {\n      return (\n        <div className=\"space-y-6\">\n          <div className=\"text-center\">\n            <h3 className=\"text-2xl font-bold mb-2\">Quiz Results</h3>\n            <div className={`text-4xl font-bold mb-4 ${quizScore >= passingScore ? 'text-green-600' : 'text-red-600'}`}>\n              {quizScore}%\n            </div>\n            <p className=\"text-lg mb-4\">\n              You got {questions.length - incorrectQuizAnswers.length} out of {questions.length} questions correct\n            </p>\n            <p className={`text-lg font-semibold ${quizScore >= passingScore ? 'text-green-600' : 'text-red-600'}`}>\n              {quizScore >= passingScore ? 'ðŸŽ‰ PASSED!' : `âŒ FAILED - Need ${passingScore}% to pass`}\n            </p>\n            {isChapterReview && (\n              <p className=\"text-sm text-blue-600 font-medium mt-2\">\n                ðŸ“š Chapter Review - Higher passing score required (80%)\n              </p>\n            )}\n          </div>\n\n          {incorrectQuizAnswers.length > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-red-600\">Review Incorrect Answers</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {incorrectQuizAnswers.map((item, index) => (\n                  <div key={index} className=\"border-l-4 border-red-500 pl-4 space-y-2\">\n                    <p className=\"font-semibold\">{item.question}</p>\n                    <div className=\"space-y-1\">\n                      <p><span className=\"text-red-600 font-medium\">Your answer:</span> {item.userAnswer}</p>\n                      <p><span className=\"text-green-600 font-medium\">Correct answer:</span> {item.correctAnswer}</p>\n                      <p className=\"text-muted-foreground italic\">{item.explanation}</p>\n                      <p className=\"text-sm font-medium text-blue-600\">ðŸ“š Reference: {item.reference}</p>\n                    </div>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          )}\n\n          <div className=\"flex gap-4\">\n            <Button onClick={restartQuiz} variant=\"outline\" className=\"flex-1\">\n              <RefreshCw className=\"w-4 h-4 mr-2\" />\n              Retake Quiz\n            </Button>\n            {quizScore >= passingScore ? (\n              <Button onClick={handleComplete} className=\"flex-1\">\n                Continue to Next Lesson\n              </Button>\n            ) : (\n              <Button disabled className=\"flex-1 opacity-50\">\n                ðŸ”’ Must Pass to Continue\n              </Button>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    const currentQ = questions[currentQuestion];\n    const isLastQuestion = currentQuestion === questions.length - 1;\n\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <div className=\"flex items-center gap-3\">\n            <h3 className=\"text-xl font-semibold\">Louisiana Plumbing Code Quiz</h3>\n            {isChapterReview && (\n              <Badge className=\"bg-blue-100 text-blue-800\">\n                ðŸ“š Chapter Review - 80% Required\n              </Badge>\n            )}\n          </div>\n          <Badge variant=\"outline\">\n            Question {currentQuestion + 1} of {questions.length}\n          </Badge>\n        </div>\n\n        <Progress value={(currentQuestion / questions.length) * 100} />\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Question {currentQuestion + 1}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-lg mb-6\">{currentQ.question}</p>\n            <div className=\"space-y-3\">\n              {currentQ.options?.map((option: any, optIndex: number) => (\n                <div\n                  key={optIndex}\n                  onClick={() => handleAnswerSelect(option.id)}\n                  className={`p-4 rounded-lg border cursor-pointer transition-colors ${\n                    selectedQuizAnswer === option.id\n                      ? 'border-primary bg-primary/10 text-primary'\n                      : 'border-border hover:bg-muted'\n                  }`}\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${\n                      selectedQuizAnswer === option.id ? 'border-primary bg-primary' : 'border-muted-foreground'\n                    }`}>\n                      {selectedQuizAnswer === option.id && (\n                        <div className=\"w-2 h-2 rounded-full bg-white\"></div>\n                      )}\n                    </div>\n                    <span className=\"text-base\">{option.text}</span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"flex justify-between\">\n          <Button\n            variant=\"outline\"\n            onClick={prevQuestion}\n            disabled={currentQuestion === 0}\n          >\n            Previous\n          </Button>\n          \n          {isLastQuestion ? (\n            <Button\n              onClick={submitQuiz}\n              disabled={selectedQuizAnswer === null || isSubmittingQuiz}\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n              {isSubmittingQuiz ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  Submitting...\n                </>\n              ) : (\n                'Submit Quiz'\n              )}\n            </Button>\n          ) : (\n            <Button\n              onClick={nextQuestion}\n              disabled={selectedQuizAnswer === null}\n            >\n              Next Question\n            </Button>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  const playAudio = (transcript: string) => {\n    if (!speechSynthesis || !transcript) return;\n    \n    if (isPaused && currentUtterance) {\n      speechSynthesis.resume();\n      setIsPaused(false);\n      setIsPlaying(true);\n      return;\n    }\n\n    // Stop any existing speech\n    speechSynthesis.cancel();\n    setCurrentSentence('');\n    \n    // Split transcript into sentences - improved parsing\n    console.log('Full transcript length:', transcript.length);\n    console.log('Transcript preview:', transcript.substring(0, 200));\n    \n    // More comprehensive sentence splitting\n    const sentences = transcript\n      .split(/[.!?]+(?:\\s|$)/) // Split on punctuation followed by space or end\n      .map(s => s.trim())\n      .filter(s => s.length > 10) // Filter out very short fragments\n      .map(s => s.replace(/^\\W+/, '')) // Remove leading punctuation\n      .filter(s => s.length > 0);\n    \n    console.log('Total sentences found:', sentences.length);\n    console.log('First few sentences:', sentences.slice(0, 3));\n    let currentSentenceIndex = 0;\n\n    const speakNextSentence = () => {\n      if (currentSentenceIndex >= sentences.length) {\n        setIsPlaying(false);\n        setIsPaused(false);\n        setCurrentUtterance(null);\n        setCurrentSentence('');\n        return;\n      }\n\n      const sentence = sentences[currentSentenceIndex].trim();\n      if (!sentence) {\n        currentSentenceIndex++;\n        speakNextSentence();\n        return;\n      }\n\n      // Display current sentence\n      setCurrentSentence(sentence);\n      \n      // Keep playing state true throughout the entire sequence\n      setIsPlaying(true);\n\n      const utterance = new SpeechSynthesisUtterance(sentence);\n      \n      // Get available voices and select the best one\n      const voices = speechSynthesis.getVoices();\n      let selectedVoice = null;\n      \n      // Prefer high-quality voices in this order\n      const preferredVoices = [\n        'Microsoft Zira - English (United States)',\n        'Microsoft David - English (United States)', \n        'Google US English Female',\n        'Google US English Male',\n        'Samantha',\n        'Alex',\n        'Victoria',\n        'Daniel'\n      ];\n      \n      for (const voiceName of preferredVoices) {\n        selectedVoice = voices.find(voice => voice.name.includes(voiceName) || voice.name === voiceName);\n        if (selectedVoice) break;\n      }\n      \n      // Fallback to first English voice if no preferred voice found\n      if (!selectedVoice) {\n        selectedVoice = voices.find(voice => voice.lang.includes('en')) || voices[0];\n      }\n      \n      if (selectedVoice) {\n        utterance.voice = selectedVoice;\n      }\n      \n      // Optimize speech settings for educational content\n      utterance.rate = 0.85; // Slightly slower for better comprehension\n      utterance.pitch = 1.1; // Slightly higher pitch for engagement\n      utterance.volume = 1;\n      \n      utterance.onend = () => {\n        console.log(`Finished sentence ${currentSentenceIndex + 1}/${sentences.length}: \"${sentence.substring(0, 50)}...\"`);\n        currentSentenceIndex++;\n        \n        if (currentSentenceIndex < sentences.length) {\n          console.log(`Moving to sentence ${currentSentenceIndex + 1}`);\n          // Clear current sentence and move to next\n          setTimeout(() => {\n            setCurrentSentence('');\n            setTimeout(() => speakNextSentence(), 300);\n          }, 500);\n        } else {\n          console.log('Reached end of all sentences - podcast complete!');\n          setTimeout(() => {\n            setCurrentSentence('');\n            setIsPlaying(false);\n            setIsPaused(false);\n            setCurrentUtterance(null);\n          }, 500);\n        }\n      };\n      \n      utterance.onerror = () => {\n        setIsPlaying(false);\n        setIsPaused(false);\n        setCurrentUtterance(null);\n        setCurrentSentence('');\n      };\n      \n      setCurrentUtterance(utterance);\n      speechSynthesis.speak(utterance);\n    };\n\n    setIsPlaying(true);\n    setIsPaused(false);\n    speakNextSentence();\n  };\n\n  const pauseAudio = () => {\n    if (speechSynthesis && isPlaying) {\n      speechSynthesis.pause();\n      setIsPlaying(false);\n      setIsPaused(true);\n    }\n  };\n\n  const stopAudio = () => {\n    if (speechSynthesis) {\n      speechSynthesis.cancel();\n      setIsPlaying(false);\n      setIsPaused(false);\n      setCurrentUtterance(null);\n    }\n  };\n\n  // Rewind functionality will be implemented with proper sentence tracking\n\n  const renderPodcastContent = () => {\n    const extracted = content.content?.extracted;\n    const podcastContent = extracted?.transcript || extracted?.content || extracted?.text || '';\n    \n    if (!podcastContent) {\n      return (\n        <div className=\"text-center p-6\">\n          <p className=\"mb-4\">No podcast content available.</p>\n          <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n            {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n            Generate Podcast\n          </Button>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"space-y-6\">\n        <PodcastPlayer \n          content={podcastContent} \n          autoStart={false} \n        />\n        \n        <Button onClick={handleComplete} className=\"w-full\">\n          Complete Podcast\n        </Button>\n      </div>\n    );\n  };\n\n  const renderPodcastContent_OLD_DISABLED = () => {\n    const extracted = content.content?.extracted;\n    const podcastContent = getContentText();\n\n    const handlePlayAudio = () => {\n      // Use the same text processing as auto-start to ensure consistency\n      const getCleanTextForManualStart = () => {\n        const extracted = content?.content?.extracted;\n        let text = extracted?.transcript || extracted?.content || extracted?.html || extracted?.text || '';\n        \n        if (text) {\n          text = text\n            .replace(/\\*\\[This would be.*?\\]\\*/g, '')\n            .replace(/\\\\n\\\\n/g, '. ')\n            .replace(/\\\\n/g, '. ')\n            .replace(/\\*\\*(.*?)\\*\\*/g, '$1')\n            .replace(/### (.*$)/gm, '$1. ')\n            .replace(/## (.*$)/gm, '$1. ')\n            .replace(/# (.*$)/gm, '$1. ')\n            .replace(/\\(\\d{1,2}:\\d{2}-\\d{1,2}:\\d{2}\\)/g, '')\n            .replace(/###\\s*/g, '')\n            .replace(/\\?\\s+/g, '? ')\n            .replace(/\\.\\s*\\./g, '.')\n            .replace(/\\s+/g, ' ')\n            .replace(/([a-z])([A-Z])/g, '$1. $2')\n            .trim();\n        }\n        \n        return text;\n      };\n      \n      const cleanText = getCleanTextForManualStart();\n      console.log('Manual start - cleanText length:', cleanText?.length);\n      if (cleanText) {\n        playAudio(cleanText);\n      }\n    };\n\n    // Force TTS path - skip audio player completely for now\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center\">\n          <h3 className=\"text-xl font-semibold mb-4\">ðŸŽ§ Audio Lesson</h3>\n          \n          {podcastContent ? (\n            <div className=\"space-y-6\">\n              {/* Scrolling sentence display */}\n              {currentSentence && (\n                <Card className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200\">\n                  <CardContent className=\"p-8\">\n                    <div className=\"text-center\">\n                      <div className=\"text-sm text-gray-600 mb-4\">ðŸ“– Now Reading:</div>\n                      <div className=\"text-xl font-medium text-gray-800 leading-relaxed animate-in slide-in-from-bottom-4 duration-500\">\n                        {currentSentence}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Audio controls - simplified for auto-start experience */}\n              <div className=\"flex justify-center space-x-4\">\n                <Button\n                  onClick={isPaused ? () => {\n                    if (speechSynthesis && currentUtterance) {\n                      speechSynthesis.resume();\n                      setIsPaused(false);\n                      setIsPlaying(true);\n                    }\n                  } : pauseAudio}\n                  disabled={!speechSynthesis}\n                  variant={isPlaying && !isPaused ? \"outline\" : \"default\"}\n                  className=\"flex items-center gap-2\"\n                >\n                  {isPlaying && !isPaused ? <Pause className=\"w-5 h-5\" /> : <Play className=\"w-5 h-5\" />}\n                  {isPlaying && !isPaused ? 'Pause' : 'Resume'}\n                </Button>\n                \n                <Button\n                  onClick={stopAudio}\n                  disabled={!speechSynthesis || (!isPlaying && !isPaused)}\n                  variant=\"outline\"\n                  className=\"flex items-center gap-2\"\n                >\n                  <Square className=\"w-5 h-5\" />\n                  Stop\n                </Button>\n              </div>\n\n              {/* Display content text for reference */}\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div \n                    className=\"prose prose-sm max-w-none text-gray-700\"\n                    dangerouslySetInnerHTML={{ __html: podcastContent }}\n                  />\n                </CardContent>\n              </Card>\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <p className=\"text-gray-500 mb-4\">No podcast content available</p>\n              <Button\n                onClick={() => extractMutation.mutate()}\n                disabled={extractMutation.isPending}\n                variant=\"outline\"\n              >\n                {extractMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Generating...\n                  </>\n                ) : (\n                  <>\n                    <RefreshCw className=\"w-4 h-4 mr-2\" />\n                    Generate Content\n                  </>\n                )}\n              </Button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // REMOVED: Old podcast content function - delete this entire function\n  const renderOldPodcastContent_DELETED = () => {\n    const extracted = content.content?.extracted;\n    const podcastContent = getContentText();\n\n    const handlePlayAudio = () => {\n      const cleanText = getCleanTextForAudio();\n      if (cleanText) {\n        playAudio(cleanText);\n      }\n    };\n\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center\">\n          <h3 className=\"text-xl font-semibold mb-4\">ðŸŽ§ Audio Lesson</h3>\n          \n          {podcastContent ? (\n            <div className=\"space-y-4\">\n              {false ? (\n                <div className=\"space-y-4\">\n                  <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"text-center mb-4\">\n                        <div className=\"inline-flex items-center space-x-2 text-green-600 mb-2\">\n                          <div className=\"w-3 h-3 bg-green-600 rounded-full\"></div>\n                          <span className=\"text-sm font-medium\">ðŸŽ§ AI-Generated Audio Ready</span>\n                        </div>\n                      </div>\n                      <audio \n                        controls \n                        className=\"w-full\"\n                        autoPlay\n                        onPlay={() => setAudioPlaying(true)}\n                        onPause={() => setAudioPlaying(false)}\n                        onLoadedData={(e) => {\n                          // Ensure auto-play starts when audio loads\n                          const audio = e.target as HTMLAudioElement;\n                          audio.play().catch(error => {\n                            console.log('Auto-play prevented by browser:', error);\n                          });\n                        }}\n                      >\n                        <source src={extracted.audioUrl} type=\"audio/mpeg\" />\n                        Your browser does not support the audio element.\n                      </audio>\n                    </CardContent>\n                  </Card>\n                </div>\n              ) : podcastContent ? (\n                <div className=\"space-y-6\">\n                  {/* Scrolling sentence display */}\n                  {currentSentence && (\n                    <Card className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200\">\n                      <CardContent className=\"p-8\">\n                        <div className=\"text-center\">\n                          <div className=\"text-sm text-gray-600 mb-4\">ðŸ“– Now Reading:</div>\n                          <div className=\"text-xl font-medium text-gray-800 leading-relaxed animate-in slide-in-from-bottom-4 duration-500\">\n                            {currentSentence}\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  )}\n\n                  {/* Audio controls - always show when content is available */}\n                  <div className=\"flex justify-center space-x-4\">\n                    <Button\n                      onClick={isPaused ? () => {\n                        if (speechSynthesis && currentUtterance) {\n                          speechSynthesis.resume();\n                          setIsPaused(false);\n                          setIsPlaying(true);\n                        }\n                      } : pauseAudio}\n                      disabled={!isPlaying && !isPaused}\n                      size=\"lg\"\n                      className=\"flex items-center space-x-2\"\n                    >\n                      {isPaused ? (\n                        <>\n                          <Play className=\"w-5 h-5\" />\n                          <span>Resume</span>\n                        </>\n                      ) : (\n                        <>\n                          <Pause className=\"w-5 h-5\" />\n                          <span>Pause</span>\n                        </>\n                      )}\n                    </Button>\n                    \n                    <Button\n                      onClick={stopAudio}\n                      variant=\"outline\"\n                      size=\"lg\"\n                      className=\"flex items-center space-x-2\"\n                    >\n                      <Square className=\"w-5 h-5\" />\n                      <span>Stop</span>\n                    </Button>\n                  </div>\n\n                  {/* Auto-start is enabled, no manual start button needed */}\n                </div>\n              ) : null}\n              \n            </div>\n          ) : (\n            <div className=\"text-center p-6\">\n              <p className=\"mb-4\">No audio content available.</p>\n              <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n                {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n                Extract Audio\n              </Button>\n            </div>\n          )}\n        </div>\n        \n        <Button onClick={handleComplete} className=\"w-full\">\n          Complete Podcast\n        </Button>\n      </div>\n    );\n  };\n\n  const renderFlashcardsContent = () => {\n    // Parse flashcards from text content\n    const extractedContent = content.content?.extracted?.content || '';\n    const cards = [];\n    \n    // Extract flashcards from the text using Front/Back pattern\n    const flashcardMatches = extractedContent.match(/\\*\\*Front:\\*\\*\\s*(.*?)\\s*\\*\\*Back:\\*\\*\\s*(.*?)(?=\\*\\*Front:|$)/gs);\n    \n    if (flashcardMatches) {\n      flashcardMatches.forEach((match) => {\n        const frontMatch = match.match(/\\*\\*Front:\\*\\*\\s*(.*?)(?=\\*\\*Back:)/s);\n        const backMatch = match.match(/\\*\\*Back:\\*\\*\\s*(.*?)$/s);\n        \n        if (frontMatch && backMatch) {\n          cards.push({\n            front: frontMatch[1].trim().replace(/\\\\n/g, ' ').replace(/\\n/g, ' '),\n            back: backMatch[1].trim().replace(/\\\\n/g, ' ').replace(/\\n/g, ' ')\n          });\n        }\n      });\n    }\n    \n    const [currentCard, setCurrentCard] = useState(0);\n    const [showAnswer, setShowAnswer] = useState(false);\n    \n    if (cards.length === 0) {\n      return (\n        <div className=\"text-center p-6\">\n          <p className=\"mb-4\">No flashcards available.</p>\n          <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n            {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n            Extract Flashcards\n          </Button>\n        </div>\n      );\n    }\n\n    const nextCard = () => {\n      setCurrentCard((prev) => (prev + 1) % cards.length);\n      setShowAnswer(false);\n    };\n\n    const prevCard = () => {\n      setCurrentCard((prev) => (prev - 1 + cards.length) % cards.length);\n      setShowAnswer(false);\n    };\n\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center\">\n          <h3 className=\"text-xl font-semibold\">Flashcards</h3>\n          <p className=\"text-muted-foreground\">Card {currentCard + 1} of {cards.length}</p>\n        </div>\n        \n        <Card className=\"min-h-[200px] cursor-pointer\" onClick={() => setShowAnswer(!showAnswer)}>\n          <CardContent className=\"flex items-center justify-center h-full p-8\">\n            <div className=\"text-center\">\n              <p className=\"text-lg mb-4\">\n                {showAnswer ? cards[currentCard]?.back : cards[currentCard]?.front}\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                Click to {showAnswer ? 'show question' : 'reveal answer'}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <div className=\"flex justify-between\">\n          <Button variant=\"outline\" onClick={prevCard}>Previous</Button>\n          <Button variant=\"outline\" onClick={nextCard}>Next</Button>\n        </div>\n        \n        <Progress value={(currentCard + 1) / cards.length * 100} />\n        \n        <Button onClick={handleComplete} className=\"w-full\">\n          Complete Flashcards\n        </Button>\n      </div>\n    );\n  };\n\n  const renderStudyNotesContent = () => {\n    const extracted = content.content?.extracted;\n    \n    if (!extracted?.keyPoints && !extracted?.html) {\n      return (\n        <div className=\"text-center p-6\">\n          <p className=\"mb-4\">No study notes available.</p>\n          <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n            {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n            Extract Notes\n          </Button>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"space-y-6\">\n        <h3 className=\"text-xl font-semibold\">Study Notes</h3>\n        \n        {extracted.keyPoints && extracted.keyPoints.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Key Points</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ul className=\"space-y-2\">\n                {extracted.keyPoints.map((point: string, index: number) => (\n                  <li key={index} className=\"flex items-start space-x-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-600 mt-1 flex-shrink-0\" />\n                    <span>{point}</span>\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n        )}\n        \n        <div \n          className=\"prose max-w-none\"\n          dangerouslySetInnerHTML={{ __html: lessonContent }}\n        />\n        \n        <Button onClick={handleComplete} className=\"w-full\">\n          Complete Study Session\n        </Button>\n      </div>\n    );\n  };\n\n  const renderStudyPlanContent = () => {\n    if (!content?.content?.extracted) {\n      return (\n        <div className=\"text-center p-6\">\n          <p className=\"mb-4\">No study plan available.</p>\n          <Button onClick={() => extractMutation.mutate()} disabled={extractMutation.isPending}>\n            {extractMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <RefreshCw className=\"w-4 h-4 mr-2\" />}\n            Extract Study Plan\n          </Button>\n        </div>\n      );\n    }\n\n    const text = content.content.extracted.content || content.content.extracted.text;\n    \n    const parseMarkdownToHtml = (markdownText: string) => {\n      return markdownText\n        // First normalize line breaks\n        .replace(/\\\\n/g, '\\n')  // Convert \\n literals to actual newlines\n        .replace(/### (.*$)/gm, '<h3 class=\"text-lg font-semibold mt-6 mb-3 text-blue-700\">$1</h3>')\n        .replace(/## (.*$)/gm, '<h2 class=\"text-xl font-bold mt-8 mb-4 text-blue-800\">$1</h2>')\n        .replace(/# (.*$)/gm, '<h1 class=\"text-2xl font-bold mt-8 mb-6 text-blue-900\">$1</h1>')\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<strong class=\"font-semibold text-gray-800\">$1</strong>')\n        .replace(/\\*(.*?)\\*/g, '<em class=\"italic text-gray-700\">$1</em>')\n        // Handle bullet points with proper spacing\n        .replace(/^- (.*)$/gm, '<div class=\"flex items-start my-2\"><span class=\"text-blue-600 mr-2\">â€¢</span><span class=\"text-gray-700\">$1</span></div>')\n        // Handle emojis\n        .replace(/ðŸ•|ðŸ••/g, '<span class=\"text-2xl mr-2\">â°</span>')\n        .replace(/âœ…/g, '<span class=\"text-green-500 font-bold text-lg\">âœ“</span>')\n        .replace(/ðŸŽ¯/g, '<span class=\"text-yellow-600 text-lg\">ðŸŽ¯</span>')\n        // Convert double newlines to paragraph breaks\n        .replace(/\\n\\n/g, '</p><p class=\"mb-4\">')\n        // Convert single newlines to line breaks\n        .replace(/\\n/g, '<br/>')\n        // Wrap in paragraph tags\n        .replace(/^(.*)/, '<p class=\"mb-4\">$1</p>');\n    };\n\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center\">\n          <Clock className=\"w-16 h-16 mx-auto text-primary mb-4\" />\n          <h3 className=\"text-xl font-semibold mb-2\">Time-Based Study Plans</h3>\n          <p className=\"text-muted-foreground\">Choose your available study time for a customized learning path</p>\n        </div>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div \n              className=\"prose prose-sm max-w-none study-plans-content\"\n              dangerouslySetInnerHTML={{ \n                __html: parseMarkdownToHtml(text || 'No study plan available.') \n              }}\n            />\n          </CardContent>\n        </Card>\n\n        <Button onClick={handleComplete} className=\"w-full\">\n          Complete Study Planning Session\n        </Button>\n      </div>\n    );\n  };\n\n  // Initialize chat with welcome message\n  useEffect(() => {\n    if (contentType === 'chat' && chatMessages.length === 0 && content?.content) {\n      const extracted = content.content?.extracted || content.content;\n      const chatContent = extracted?.chatContent || extracted?.content || extracted?.text || '';\n      \n      let welcomeMessage = `Welcome to the interactive chat for ${title}!\\n\\nI'm your AI tutor and I can help answer questions about Louisiana Plumbing Code Section 101 - Administration.`;\n      \n      if (chatContent) {\n        // Extract key topics from the content\n        welcomeMessage += `\\n\\nBased on the lesson content, here are the key areas we can discuss:\\n\\nâ€¢ Who enforces the Louisiana State Plumbing Code (LSPC)\\nâ€¢ Legal basis and statutory authority (R.S. 36:258(B) and Title 40)\\nâ€¢ Historical notes (promulgated June 2002, amended November 2012)\\nâ€¢ Enforcement authority and delegation\\nâ€¢ Code violations and penalties\\n\\nWhat would you like to learn about?`;\n      } else {\n        welcomeMessage += `\\n\\nThis covers:\\n\\nâ€¢ Code purpose and enforcement authority\\nâ€¢ Permit requirements and processes\\nâ€¢ Louisiana State Uniform Construction Code Council\\nâ€¢ Local jurisdiction requirements\\nâ€¢ Code violations and stop-work orders\\n\\nWhat would you like to learn about?`;\n      }\n      \n      const initialMessage = {\n        role: 'assistant' as const,\n        content: welcomeMessage,\n        id: 'welcome-' + Date.now()\n      };\n      setChatMessages([initialMessage]);\n      \n      // Auto-play welcome message after a brief delay\n      setTimeout(() => {\n        if (autoPlayEnabled) {\n          playMessageWithSpeech(welcomeMessage, initialMessage.id!);\n        }\n      }, 1000);\n    }\n  }, [contentType, chatMessages.length, title, content]);\n\n  const sendChatMessage = async () => {\n    if (!chatInputMessage.trim()) return;\n    \n    const userMessage = { role: 'user' as const, content: chatInputMessage };\n    setChatMessages(prev => [...prev, userMessage]);\n    setChatInputMessage('');\n    setIsChatLoading(true);\n\n    try {\n      const extracted = content?.content?.extracted || content?.content;\n      const chatContent = extracted?.chatContent || extracted?.content || extracted?.text || '';\n      \n      const response = await fetch('/api/mentor/chat', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          message: chatInputMessage,\n          context: `Louisiana Plumbing Code lesson context: ${title}. Detailed lesson content: ${chatContent.substring(0, 1500)}. Student is learning about Section 101 Administration including enforcement authority (state health officer and delegation), legal basis (R.S. 36:258(B) and Title 40), historical notes (promulgated June 2002, amended November 2012), and code administration. Please provide educational responses focused on Louisiana plumbing code administration using the specific details from the lesson content.`\n        })\n      });\n      \n      const data = await response.json();\n      const assistantMessage = { role: 'assistant' as const, content: data.response, id: 'msg-' + Date.now() };\n      setChatMessages(prev => [...prev, assistantMessage]);\n      \n      // Auto-play the response after a brief delay\n      setTimeout(() => {\n        if (autoPlayEnabled) {\n          playMessageWithSpeech(data.response, assistantMessage.id!);\n        }\n      }, 500);\n    } catch (error) {\n      console.error('Chat error:', error);\n      const errorMessage = { role: 'assistant' as const, content: 'Sorry, I encountered an error. Please try again or ask a different question about Louisiana Plumbing Code administration.', id: 'error-' + Date.now() };\n      setChatMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsChatLoading(false);\n    }\n  };\n\n  const suggestedQuestions = [\n    \"Who enforces the Louisiana State Plumbing Code?\",\n    \"What is the legal basis for the LSPC?\",\n    \"Tell me about the historical notes and amendments\",\n    \"How does enforcement authority delegation work?\",\n    \"What happens if the code is violated?\",\n    \"When was the code first promulgated?\",\n    \"What are the key responsibilities of the state health officer?\",\n    \"Can local jurisdictions add their own requirements?\"\n  ];\n\n  const handleSuggestedQuestion = (question: string) => {\n    setChatInputMessage(question);\n    // Auto-send the question\n    setTimeout(() => {\n      const event = new KeyboardEvent('keypress', { key: 'Enter' });\n      document.querySelector('input[type=\"text\"]')?.dispatchEvent(event);\n      sendChatMessage();\n    }, 100);\n  };\n\n  const playMessageWithSpeech = (text: string, messageId: string) => {\n    if (!speechSynthesis || !autoPlayEnabled) return;\n\n    // Stop any currently playing speech\n    speechSynthesis.cancel();\n    \n    // Enhanced text cleaning for more natural speech\n    const cleanText = text\n      .replace(/\\*\\*(.*?)\\*\\*/g, '$1') // Remove bold markdown\n      .replace(/â€¢/g, '. ') // Replace bullet points with pauses\n      .replace(/[ðŸŽ“ðŸ“…âš–ï¸ðŸ›ï¸â¬‡ï¸ðŸ“‹ðŸ”ðŸ“ðŸ‘¨â€âš–ï¸ðŸ¤âš ï¸ðŸ”Š]/g, '') // Remove emojis including speaker\n      .replace(/\\n\\n/g, '. ') // Replace double newlines with periods\n      .replace(/\\n/g, ', ') // Replace single newlines with commas for natural pauses\n      .replace(/R\\.S\\./g, 'Revised Statute') // Make abbreviations readable\n      .replace(/LSPC/g, 'Louisiana State Plumbing Code')\n      .replace(/:/g, ', ') // Replace colons with commas for better flow\n      .replace(/;/g, ', and ') // Replace semicolons for more natural speech\n      .replace(/\\.\\s*\\./g, '.') // Remove double periods\n      .trim();\n\n    // Split into sentences for more dynamic delivery\n    const sentences = cleanText.split(/[.!?]+/).filter(s => s.trim().length > 0);\n    \n    let currentSentenceIndex = 0;\n    \n    const speakNextSentence = () => {\n      if (currentSentenceIndex >= sentences.length) {\n        setCurrentPlayingId(null);\n        return;\n      }\n      \n      const sentence = sentences[currentSentenceIndex].trim();\n      if (!sentence) {\n        currentSentenceIndex++;\n        speakNextSentence();\n        return;\n      }\n      \n      const utterance = new SpeechSynthesisUtterance(sentence);\n      \n      // Select voice based on user preference\n      let preferredVoice = null;\n      \n      if (selectedVoice === 'auto') {\n        // Auto-select best voice\n        preferredVoice = availableVoices.find(voice => \n          voice.name.includes('Google') || \n          voice.name.includes('Microsoft') ||\n          voice.name.includes('Alex') || \n          voice.name.includes('Samantha') || \n          voice.name.includes('Daniel') || \n          voice.quality === 'high' ||\n          voice.localService === true\n        ) || availableVoices[0];\n      } else {\n        // Use user-selected voice\n        preferredVoice = availableVoices.find(voice => voice.name === selectedVoice) || availableVoices[0];\n      }\n      \n      if (preferredVoice) {\n        utterance.voice = preferredVoice;\n      }\n      \n      // Dynamic speech parameters based on sentence content\n      if (sentence.includes('Key') || sentence.includes('Important') || sentence.includes('Primary')) {\n        utterance.rate = 0.8; // Slower for important points\n        utterance.pitch = 1.1; // Slightly higher pitch for emphasis\n      } else if (sentence.includes('?')) {\n        utterance.rate = 0.9; // Normal speed for questions\n        utterance.pitch = 1.2; // Higher pitch for questions\n      } else {\n        utterance.rate = 0.85; // Good educational pace\n        utterance.pitch = 1.05; // Slightly varied pitch\n      }\n      \n      utterance.volume = 0.85;\n      \n      utterance.onend = () => {\n        currentSentenceIndex++;\n        // Small pause between sentences\n        setTimeout(speakNextSentence, 200);\n      };\n      \n      utterance.onerror = () => {\n        setCurrentPlayingId(null);\n      };\n      \n      speechSynthesis.speak(utterance);\n    };\n    \n    setCurrentPlayingId(messageId);\n    setCurrentUtterance(null); // We'll manage multiple utterances\n    speakNextSentence();\n  };\n\n  const stopSpeech = () => {\n    if (speechSynthesis) {\n      speechSynthesis.cancel();\n      setCurrentPlayingId(null);\n    }\n  };\n\n  const handleVoiceChange = (voiceName: string) => {\n    setSelectedVoice(voiceName);\n    localStorage.setItem('ai-mentor-voice', voiceName);\n    \n    // Preview the voice with a sample message\n    setTimeout(() => {\n      previewVoice(voiceName);\n    }, 100);\n  };\n\n  const previewVoice = (voiceName: string) => {\n    if (!speechSynthesis) return;\n    \n    speechSynthesis.cancel(); // Stop any current speech\n    \n    const previewText = \"Hello! I'm your AI mentor for Louisiana Plumbing Code. I'm here to help you learn.\";\n    const utterance = new SpeechSynthesisUtterance(previewText);\n    \n    let voice = null;\n    if (voiceName === 'auto') {\n      voice = availableVoices.find(v => \n        v.name.includes('Google') || \n        v.name.includes('Microsoft') ||\n        v.name.includes('Alex') || \n        v.localService === true\n      ) || availableVoices[0];\n    } else {\n      voice = availableVoices.find(v => v.name === voiceName);\n    }\n    \n    if (voice) {\n      utterance.voice = voice;\n    }\n    \n    utterance.rate = 0.85;\n    utterance.pitch = 1.05;\n    utterance.volume = 0.85;\n    \n    speechSynthesis.speak(utterance);\n  };\n\n  const renderChatContent = () => {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center\">\n          <MessageSquare className=\"w-16 h-16 mx-auto text-primary mb-4\" />\n          <h3 className=\"text-xl font-semibold\">Interactive Learning Chat</h3>\n          <p className=\"text-muted-foreground mb-4\">Ask questions about {title}</p>\n          \n          {/* Audio controls */}\n          <div className=\"space-y-4 mb-6\">\n            <div className=\"flex items-center justify-center gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setAutoPlayEnabled(!autoPlayEnabled)}\n                className=\"flex items-center gap-2\"\n              >\n                {autoPlayEnabled ? <Volume2 className=\"w-4 h-4\" /> : <VolumeX className=\"w-4 h-4\" />}\n                {autoPlayEnabled ? 'Auto-play ON' : 'Auto-play OFF'}\n              </Button>\n              {currentPlayingId && (\n                <Button variant=\"outline\" size=\"sm\" onClick={stopSpeech}>\n                  <Pause className=\"w-4 h-4 mr-1\" />\n                  Stop\n                </Button>\n              )}\n            </div>\n            \n            {/* Voice selection */}\n            <div className=\"flex items-center justify-center gap-2\">\n              <Settings className=\"w-4 h-4 text-muted-foreground\" />\n              <span className=\"text-sm text-muted-foreground\">AI Mentor Voice:</span>\n              <Select value={selectedVoice} onValueChange={handleVoiceChange}>\n                <SelectTrigger className=\"w-52\">\n                  <SelectValue placeholder=\"Select voice\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"auto\">ðŸ¤– Auto (Best Quality)</SelectItem>\n                  {availableVoices.map((voice) => {\n                    const genderIcon = voice.name.includes('Samantha') || voice.name.includes('Victoria') ? 'ðŸ‘©' : \n                                     voice.name.includes('Alex') || voice.name.includes('Daniel') ? 'ðŸ‘¨' : 'ðŸŽ™ï¸';\n                    const qualityLabel = voice.name.includes('Google') || voice.name.includes('Microsoft') || voice.localService ? ' â­' : '';\n                    return (\n                      <SelectItem key={voice.name} value={voice.name}>\n                        {genderIcon} {voice.name.replace(' (Enhanced)', '')}{qualityLabel}\n                      </SelectItem>\n                    );\n                  })}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n        \n        <Card className=\"h-96 flex flex-col\">\n          <CardContent className=\"flex-1 p-4 overflow-y-auto\">\n            <div className=\"space-y-4\">\n              {chatMessages.map((message, index) => (\n                <div\n                  key={index}\n                  className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div className=\"w-full\">\n                    <div\n                      className={`p-3 rounded-lg w-full ${\n                        message.role === 'user'\n                          ? 'bg-blue-500 text-white'\n                          : 'bg-gray-100 text-gray-900'\n                      }`}\n                    >\n                      <p className=\"whitespace-pre-wrap\">{message.content}</p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n              {isChatLoading && (\n                <div className=\"flex justify-start\">\n                  <div className=\"bg-gray-100 p-3 rounded-lg w-full\">\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n          <div className=\"p-4 border-t\">\n            <div className=\"flex space-x-2\">\n              <input\n                type=\"text\"\n                value={chatInputMessage}\n                onChange={(e) => setChatInputMessage(e.target.value)}\n                onKeyPress={(e) => e.key === 'Enter' && sendChatMessage()}\n                placeholder=\"Ask a question about Louisiana Plumbing Code administration...\"\n                className=\"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                disabled={isChatLoading}\n              />\n              <Button onClick={sendChatMessage} disabled={isChatLoading || !chatInputMessage.trim()}>\n                Send\n              </Button>\n            </div>\n          </div>\n        </Card>\n        \n        {/* Suggested Questions */}\n        <Card>\n          <CardContent className=\"p-4\">\n            <h4 className=\"font-semibold mb-3 text-sm text-muted-foreground\">Suggested Questions to Explore:</h4>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n              {suggestedQuestions.map((question, index) => (\n                <Button\n                  key={index}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => handleSuggestedQuestion(question)}\n                  disabled={isChatLoading}\n                  className=\"text-left justify-start h-auto p-3 text-xs\"\n                >\n                  {question}\n                </Button>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Button onClick={handleComplete} className=\"w-full\">\n          Complete Session\n        </Button>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">{title}</h1>\n            <div className=\"flex items-center gap-2 mt-2\">\n              <Badge variant=\"outline\">\n                {contentType.charAt(0).toUpperCase() + contentType.slice(1)}\n              </Badge>\n              {studySession.isActive && (\n                <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n                  <Timer className=\"w-3 h-3\" />\n                  {studySession.formattedTime}\n                </Badge>\n              )}\n            </div>\n          </div>\n          \n          {hasExtractedContent && (\n            <div className=\"text-right\">\n              <p className=\"text-sm text-muted-foreground\">\n                Extracted {content.content?.extractedAt ? \n                  new Date(content.content.extractedAt).toLocaleDateString() : \n                  'recently'\n                }\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-6\">\n          {contentType === 'lesson' && renderLessonContent()}\n          {contentType === 'quiz' && renderQuizContent()}\n          {contentType === 'podcast' && renderPodcastContent()}\n          {contentType === 'flashcards' && renderFlashcardsContent()}\n          {contentType === 'study-notes' && renderStudyNotesContent()}\n          {contentType === 'study-plan' && renderStudyPlanContent()}\n          {contentType === 'chat' && renderChatContent()}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":65603},"client/src/components/podcast-player.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Play, Pause, Square, RotateCcw } from \"lucide-react\";\n\ninterface PodcastPlayerProps {\n  content: string;\n  autoStart?: boolean;\n  initialProgress?: number;\n  onProgressUpdate?: (sentenceIndex: number, totalSentences: number) => void;\n}\n\nexport default function PodcastPlayer({ content, autoStart = false, initialProgress = 0, onProgressUpdate }: PodcastPlayerProps) {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n  const [currentSentence, setCurrentSentence] = useState('');\n  const [currentUtterance, setCurrentUtterance] = useState<SpeechSynthesisUtterance | null>(null);\n  const [speechSynthesis, setSpeechSynthesis] = useState<SpeechSynthesis | null>(null);\n  const [sentences, setSentences] = useState<string[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(initialProgress);\n  const [hasAutoStarted, setHasAutoStarted] = useState(false);\n\n  useEffect(() => {\n    if (typeof window !== 'undefined' && 'speechSynthesis' in window) {\n      setSpeechSynthesis(window.speechSynthesis);\n    }\n  }, []);\n\n  // Auto-start only when autoStart prop is true (when user clicked Review)\n  useEffect(() => {\n    if (autoStart && content && speechSynthesis && !hasAutoStarted) {\n      console.log('Auto-starting podcast because autoStart=true from Review button');\n      setHasAutoStarted(true);\n      // Give time for component to mount and speech synthesis to initialize\n      setTimeout(() => {\n        const processedText = cleanText(content);\n        const sentenceArray = processedText\n          .split(/(?<=[.!?])\\s+/)\n          .map(s => s.trim())\n          .filter(s => s.length > 10);\n        \n        setSentences(sentenceArray);\n        const startIndex = initialProgress < sentenceArray.length ? initialProgress : 0;\n        setCurrentIndex(startIndex);\n        setIsPlaying(true);\n        setIsPaused(false);\n        speakSentence(startIndex);\n      }, 1000);\n    }\n  }, [autoStart, content, speechSynthesis]); // Simplified dependencies\n\n  const cleanText = (text: string) => {\n    return text\n      .replace(/\\*\\[This would be.*?\\]\\*/g, '')\n      .replace(/\\\\n\\\\n/g, '. ')\n      .replace(/\\\\n/g, '. ')\n      .replace(/\\*\\*(.*?)\\*\\*/g, '$1')\n      .replace(/### (.*$)/gm, '$1. ')\n      .replace(/## (.*$)/gm, '$1. ')\n      .replace(/# (.*$)/gm, '$1. ')\n      .replace(/\\(\\d{1,2}:\\d{2}-\\d{1,2}:\\d{2}\\)/g, '')\n      .replace(/###\\s*/g, '')\n      .replace(/\\?\\s+/g, '? ')\n      .replace(/\\.\\s*\\./g, '.')\n      .replace(/\\s+/g, ' ')\n      .replace(/([a-z])([A-Z])/g, '$1. $2')\n      .trim();\n  };\n\n  const speakSentence = (index: number) => {\n    if (!speechSynthesis || !sentences.length || index >= sentences.length) return;\n\n    const sentence = sentences[index].trim();\n    if (!sentence) return;\n\n    setCurrentSentence(sentence);\n    setCurrentIndex(index);\n    console.log(`Speaking sentence ${index + 1}/${sentences.length}: \"${sentence.substring(0, 50)}...\"`);\n    \n    // Report progress to parent component\n    if (onProgressUpdate) {\n      onProgressUpdate(index, sentences.length);\n    }\n    \n    const utterance = new SpeechSynthesisUtterance(sentence);\n    utterance.rate = 0.85;\n    utterance.pitch = 1.05;\n    utterance.volume = 0.85;\n\n    utterance.onend = () => {\n      console.log(`Moving to sentence ${index + 2}`);\n      if (index + 1 < sentences.length) {\n        setTimeout(() => speakSentence(index + 1), 300);\n      } else {\n        console.log('Reached end of all sentences - podcast complete!');\n        setIsPlaying(false);\n        setIsPaused(false);\n        setCurrentUtterance(null);\n        setCurrentSentence('');\n      }\n    };\n\n    utterance.onerror = () => {\n      setIsPlaying(false);\n      setCurrentUtterance(null);\n    };\n\n    setCurrentUtterance(utterance);\n    speechSynthesis.speak(utterance);\n  };\n\n  const startPodcast = () => {\n    if (!speechSynthesis || !content) return;\n\n    const processedText = cleanText(content);\n    // Better sentence splitting that preserves meaningful content\n    const sentenceArray = processedText\n      .split(/(?<=[.!?])\\s+/)\n      .map(s => s.trim())\n      .filter(s => s.length > 10); // Filter out very short fragments\n    \n    setSentences(sentenceArray);\n    const startIndex = initialProgress < sentenceArray.length ? initialProgress : 0;\n    setCurrentIndex(startIndex);\n    console.log('Total sentences found:', sentenceArray.length);\n    console.log('Starting from sentence:', startIndex + 1);\n\n    setIsPlaying(true);\n    setIsPaused(false);\n    speakSentence(startIndex);\n  };\n\n  const pausePodcast = () => {\n    if (speechSynthesis && isPlaying) {\n      speechSynthesis.pause();\n      setIsPlaying(false);\n      setIsPaused(true);\n    }\n  };\n\n  const resumePodcast = () => {\n    if (speechSynthesis && currentUtterance) {\n      speechSynthesis.resume();\n      setIsPaused(false);\n      setIsPlaying(true);\n    }\n  };\n\n  const stopPodcast = () => {\n    if (speechSynthesis) {\n      speechSynthesis.cancel();\n      setIsPlaying(false);\n      setIsPaused(false);\n      setCurrentUtterance(null);\n      setCurrentSentence('');\n      setCurrentIndex(0);\n    }\n  };\n\n  const rewindSentence = () => {\n    if (!speechSynthesis || !sentences.length) return;\n    \n    // Stop current playback\n    speechSynthesis.cancel();\n    \n    // Go back one sentence (or stay at 0 if already at beginning)\n    const newIndex = Math.max(0, currentIndex - 1);\n    \n    if (isPlaying) {\n      // If currently playing, start from the previous sentence\n      speakSentence(newIndex);\n    } else {\n      // If paused/stopped, just update the current sentence display\n      setCurrentIndex(newIndex);\n      if (sentences[newIndex]) {\n        setCurrentSentence(sentences[newIndex].trim());\n      }\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <h3 className=\"text-xl font-semibold mb-4\">ðŸŽ§ Audio Lesson</h3>\n        \n        {/* Scrolling sentence display */}\n        {currentSentence && (\n          <Card className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200\">\n            <CardContent className=\"p-8\">\n              <div className=\"text-center\">\n                <div className=\"text-sm text-gray-600 mb-4\">ðŸ“– Now Reading:</div>\n                <div className=\"text-xl font-medium text-gray-800 leading-relaxed animate-in slide-in-from-bottom-4 duration-500\">\n                  {currentSentence}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Progress indicator */}\n        {sentences.length > 0 && (\n          <div className=\"text-sm text-gray-600 mb-4\">\n            Progress: {currentIndex + 1} of {sentences.length} sentences\n          </div>\n        )}\n\n        {/* Audio controls */}\n        <div className=\"flex justify-center space-x-4 mt-6\">\n          {!isPlaying && !isPaused && (\n            <Button\n              onClick={startPodcast}\n              size=\"lg\"\n              className=\"flex items-center space-x-2\"\n              data-testid=\"button-start-podcast\"\n            >\n              <Play className=\"w-5 h-5\" />\n              <span>Start Podcast</span>\n            </Button>\n          )}\n          \n          {(isPlaying || isPaused) && (\n            <>\n              <Button\n                onClick={isPaused ? resumePodcast : pausePodcast}\n                size=\"lg\"\n                className=\"flex items-center space-x-2\"\n                data-testid=\"button-pause-resume\"\n              >\n                {isPaused ? (\n                  <>\n                    <Play className=\"w-5 h-5\" />\n                    <span>Resume</span>\n                  </>\n                ) : (\n                  <>\n                    <Pause className=\"w-5 h-5\" />\n                    <span>Pause</span>\n                  </>\n                )}\n              </Button>\n              \n              <Button\n                onClick={rewindSentence}\n                variant=\"outline\"\n                size=\"lg\"\n                className=\"flex items-center space-x-2\"\n                data-testid=\"button-rewind\"\n                disabled={!sentences.length}\n              >\n                <RotateCcw className=\"w-5 h-5\" />\n                <span>Rewind</span>\n              </Button>\n              \n              <Button\n                onClick={stopPodcast}\n                variant=\"outline\"\n                size=\"lg\"\n                className=\"flex items-center space-x-2\"\n                data-testid=\"button-stop\"\n              >\n                <Square className=\"w-5 h-5\" />\n                <span>Stop</span>\n              </Button>\n            </>\n          )}\n        </div>\n\n      </div>\n    </div>\n  );\n}","size_bytes":8854},"emergency-stop.js":{"content":"\n// Emergency stop for Web Speech API\nif (typeof window !== 'undefined' && window.speechSynthesis) {\n  window.speechSynthesis.cancel();\n  console.log('Emergency stop: All speech synthesis canceled');\n}\n\n","size_bytes":203},"stop-audio.js":{"content":"if (typeof window !== 'undefined' && window.speechSynthesis) { window.speechSynthesis.cancel(); console.log('All speech stopped'); }\n","size_bytes":133},"server/seed-data.ts":{"content":"import { db } from \"./db\";\nimport { courses, courseContent, products } from \"@shared/schema\";\n\nexport async function seedDatabase() {\n  try {\n    console.log('Checking if database needs seeding...');\n    \n    // Check if courses already exist\n    const existingCourses = await db.select().from(courses);\n    if (existingCourses.length > 0) {\n      console.log('Database already seeded');\n      return;\n    }\n\n    console.log('Seeding database with course data...');\n\n    // Insert your courses\n    const courseData = [\n      {\n        id: 1,\n        title: \"Louisiana Journeyman Prep\",\n        description: \"Comprehensive preparation for Louisiana Journeyman Plumber certification exam. Covers all essential topics including codes, regulations, and practical applications.\",\n        price: 49.99,\n        duration: \"2 months\",\n        lessons: 24,\n        practiceQuestions: 150,\n        level: \"Intermediate\",\n        category: \"certification\",\n        isActive: true,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      },\n      {\n        id: 2,\n        title: \"Backflow Prevention Training\",\n        description: \"Learn testing, repairs, and field report completion for backflow prevention systems. Essential for maintaining water safety standards.\",\n        price: 79.99,\n        duration: \"1 month\",\n        lessons: 16,\n        practiceQuestions: 75,\n        level: \"Advanced\",\n        category: \"training course\",\n        isActive: false,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      },\n      {\n        id: 3,\n        title: \"Natural Gas Certification\",\n        description: \"Complete certification program for natural gas installation and safety. Covers regulations, safety protocols, and installation techniques.\",\n        price: 89.99,\n        duration: \"1.5 months\",\n        lessons: 20,\n        practiceQuestions: 100,\n        level: \"Advanced\", \n        category: \"certification\",\n        isActive: false,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      },\n      {\n        id: 4,\n        title: \"Medical Gas Installer Certification\",\n        description: \"Specialized training for medical gas systems in healthcare facilities. Critical safety and regulatory compliance training.\",\n        price: 99.99,\n        duration: \"2 months\",\n        lessons: 28,\n        practiceQuestions: 125,\n        level: \"Expert\",\n        category: \"certification\",\n        isActive: false,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      },\n      {\n        id: 5,\n        title: \"Master Plumber Prep\",\n        description: \"Advanced preparation for Master Plumber license exam. Comprehensive coverage of advanced plumbing concepts and business practices.\",\n        price: 129.99,\n        duration: \"3 months\",\n        lessons: 36,\n        practiceQuestions: 200,\n        level: \"Expert\",\n        category: \"certification\", \n        isActive: false,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      }\n    ];\n\n    await db.insert(courses).values(courseData);\n    console.log(`Seeded ${courseData.length} courses successfully`);\n\n    // Check if products already exist\n    const existingProducts = await db.select().from(products);\n    if (existingProducts.length === 0) {\n      // Insert sample products for the store\n      const productData = [\n        {\n          id: \"1\",\n          name: \"Digital Gas Detector Pro\",\n          description: \"Professional-grade gas leak detector with advanced sensors for natural gas, propane, and methane detection. Essential for plumbing professionals working with gas lines.\",\n          shortDescription: \"Professional gas leak detector for plumbers\",\n          category: \"gas_detection\" as const,\n          price: \"199.99\",\n          originalPrice: \"249.99\",\n          amazonUrl: \"https://amazon.com/dp/example1\",\n          affiliateTag: \"laplumbprep-20\",\n          imageUrl: \"/api/placeholder/300/200\",\n          brand: \"ProDetect\",\n          rating: \"4.7\",\n          reviewCount: 156,\n          isFeatured: true,\n          isActive: true,\n          sortOrder: 1,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        },\n        {\n          id: \"2\", \n          name: \"Professional Pipe Threading Set\",\n          description: \"Complete pipe threading set with dies for 1/8\\\" to 2\\\" pipes. Includes ratchet handle, dies, and carrying case. Perfect for plumbing installations and repairs.\",\n          shortDescription: \"Complete pipe threading set with dies\",\n          category: \"pipe_tools\" as const,\n          price: \"299.99\",\n          originalPrice: \"399.99\", \n          amazonUrl: \"https://amazon.com/dp/example2\",\n          affiliateTag: \"laplumbprep-20\",\n          imageUrl: \"/api/placeholder/300/200\",\n          brand: \"RidgidPro\",\n          rating: \"4.5\",\n          reviewCount: 89,\n          isFeatured: true,\n          isActive: true,\n          sortOrder: 2,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        },\n        {\n          id: \"3\",\n          name: \"Digital Pipe Locator\",\n          description: \"Advanced digital pipe locator for finding buried pipes and utilities. Features depth measurement, signal strength indicators, and multiple frequency modes.\",\n          shortDescription: \"Digital pipe locator with depth measurement\",\n          category: \"measuring\" as const,\n          price: \"449.99\",\n          amazonUrl: \"https://amazon.com/dp/example3\",\n          affiliateTag: \"laplumbprep-20\",\n          imageUrl: \"/api/placeholder/300/200\",\n          brand: \"PipeFind\",\n          rating: \"4.6\",\n          reviewCount: 67,\n          isFeatured: false,\n          isActive: true,\n          sortOrder: 3,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        },\n        {\n          id: \"4\",\n          name: \"Safety Glasses Kit\",\n          description: \"ANSI Z87.1 certified safety glasses kit with multiple lens options. Includes clear, tinted, and anti-fog lenses. Essential PPE for plumbing work.\",\n          shortDescription: \"ANSI certified safety glasses with multiple lenses\",\n          category: \"safety\" as const,\n          price: \"39.99\",\n          originalPrice: \"49.99\",\n          amazonUrl: \"https://amazon.com/dp/example4\",\n          affiliateTag: \"laplumbprep-20\",\n          imageUrl: \"/api/placeholder/300/200\",\n          brand: \"SafeWork\",\n          rating: \"4.4\",\n          reviewCount: 234,\n          isFeatured: false,\n          isActive: true,\n          sortOrder: 4,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        },\n        {\n          id: \"5\",\n          name: \"Louisiana Plumbing Code Book 2025\",\n          description: \"Official 2025 Louisiana State Plumbing Code book with latest updates and amendments. Essential reference for plumbers and contractors.\",\n          shortDescription: \"Official 2025 Louisiana plumbing code book\",\n          category: \"books\" as const,\n          price: \"79.99\",\n          amazonUrl: \"https://amazon.com/dp/example5\",\n          affiliateTag: \"laplumbprep-20\",\n          imageUrl: \"/api/placeholder/300/200\",\n          brand: \"Louisiana Board\",\n          rating: \"4.8\",\n          reviewCount: 45,\n          isFeatured: true,\n          isActive: true,\n          sortOrder: 5,\n          createdAt: new Date(),\n          updatedAt: new Date()\n        }\n      ];\n\n      await db.insert(products).values(productData);\n      console.log(`Seeded ${productData.length} products successfully`);\n    }\n\n  } catch (error) {\n    console.error('Error seeding database:', error);\n  }\n}","size_bytes":7553},"client/src/pages/ai-tools-pricing.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { CheckCircle, Camera, FileText, Wand2, Brain, Zap, ArrowRight, Lock } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport BetaBanner from \"@/components/beta-banner\";\n\nexport default function AIToolsPricing() {\n  const [isAnnual, setIsAnnual] = useState(false);\n  const [isBetaTester] = useState(true); // Would come from user session/API in real app\n\n  const calculatePrice = (basePrice: number, isAnnual: boolean) => {\n    let price = basePrice;\n    \n    if (isAnnual) {\n      price = price * 12 * 0.8; // 20% annual discount on 12 months\n    }\n    \n    return parseFloat(price.toFixed(2)); // Round to 2 decimals\n  };\n\n  const aiToolsFeatures = [\n    {\n      icon: Camera,\n      title: \"Photo Code Checker\",\n      description: \"Upload photos of plumbing installations and get instant AI-powered code compliance analysis. Our advanced computer vision technology identifies potential code violations, safety hazards, and installation issues with 95% accuracy.\",\n      details: [\n        \"Identifies pipe sizing violations\",\n        \"Detects improper joint connections\", \n        \"Checks clearance requirements\",\n        \"Validates installation angles\",\n        \"Generates detailed violation reports\",\n        \"Provides corrective recommendations\"\n      ],\n      plans: [\"Professional\", \"Master\"]\n    },\n    {\n      icon: Wand2,\n      title: \"AI Mentor Support\",\n      description: \"24/7 AI-powered plumbing mentor that answers technical questions, provides code interpretations, and offers installation guidance. Trained on Louisiana plumbing codes and industry best practices.\",\n      details: [\n        \"Instant answers to plumbing questions\",\n        \"Louisiana code interpretations\", \n        \"Installation step-by-step guidance\",\n        \"Troubleshooting assistance\",\n        \"Material recommendations\",\n        \"Career advancement advice\"\n      ],\n      plans: [\"Professional\", \"Master\"]\n    }\n  ];\n\n  const pricingPlans = [\n    {\n      id: \"pay-per-use\",\n      name: \"Pay Per Use\",\n      basePrice: 0,\n      tier: \"pay_per_use\",\n      description: \"Perfect for occasional use\",\n      payPerUse: true,\n      aiFeatures: [\n        \"Photo Analysis: $2.99 per photo\",\n        \"AI Mentor: $0.99 per question\",\n        \"No subscription required\",\n        \"Pay only for what you use\"\n      ],\n      additionalFeatures: [\n        \"Instant results\",\n        \"No monthly commitment\",\n        \"Pay only for what you use\",\n        \"Perfect for contractors\"\n      ]\n    },\n    {\n      id: \"ai-tools-monthly\",\n      name: \"Monthly\",\n      basePrice: 29.99,\n      tier: \"ai_tools_monthly\",\n      description: \"AI tools subscription\",\n      popular: true,\n      aiFeatures: [\n        \"Photo Code Checker\",\n        \"AI Mentor Support\", \n        \"Unlimited AI analysis\",\n        \"Priority support\"\n      ],\n      additionalFeatures: [\n        \"Cancel anytime\",\n        \"No course content\",\n        \"API access available\",\n        \"Business support\"\n      ]\n    },\n    {\n      id: \"ai-tools-annual\",\n      name: \"Annual\",\n      basePrice: 29.99,\n      tier: \"ai_tools_annual\", \n      description: \"AI tools yearly plan\",\n      aiFeatures: [\n        \"Photo Code Checker\",\n        \"AI Mentor Support\",\n        \"Unlimited AI analysis\",\n        \"Priority support\"\n      ],\n      additionalFeatures: [\n        \"20% annual savings\",\n        \"No course content\",\n        \"API access available\", \n        \"Business support\"\n      ]\n    }\n  ];\n\n  const getPriceId = (planId: string, isAnnual: boolean, isBeta: boolean) => {\n    const priceMapping = {\n      \"ai-tools-only\": {\n        monthly: {\n          regular: \"price_ai_tools_monthly_reg\",\n          beta: \"price_ai_tools_monthly_beta\"\n        },\n        annual: {\n          regular: \"price_ai_tools_annual_reg\", \n          beta: \"price_ai_tools_annual_beta\"\n        }\n      },\n      professional: {\n        monthly: {\n          regular: \"price_1S1xriByFL1L8uV2cKXSxmwV\",\n          beta: \"price_1S1xuaByFL1L8uV2sfIJs3Hz\"\n        },\n        annual: {\n          regular: \"price_1S1xuqByFL1L8uV2vPEtWkmX\", \n          beta: \"price_1S1xv9ByFL1L8uV2F8u5czkc\"\n        }\n      },\n      master: {\n        monthly: {\n          regular: \"price_1S1xrjByFL1L8uV2iwBxqPG8\",\n          beta: \"price_1S1xucByFL1L8uV2axdk2dL9\"\n        },\n        annual: {\n          regular: \"price_1S1xurByFL1L8uV2IQuts2h2\",\n          beta: \"price_1S1xvAByFL1L8uV2iuNDyfN7\"\n        }\n      }\n    };\n\n    const cycle = isAnnual ? 'annual' : 'monthly';\n    const type = isBeta ? 'beta' : 'regular';\n    return priceMapping[planId as keyof typeof priceMapping]?.[cycle]?.[type] || \"\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-primary/10 to-accent/10\" data-testid=\"ai-tools-hero\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <div className=\"flex items-center justify-center gap-3 mb-6\">\n            <Brain className=\"w-12 h-12 text-primary\" />\n            <h1 className=\"text-4xl lg:text-5xl font-bold text-foreground\" data-testid=\"ai-tools-title\">\n              AI-Powered Plumbing Tools\n            </h1>\n          </div>\n          <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto mb-8\" data-testid=\"ai-tools-description\">\n            Professional AI tools for Louisiana plumbers. Get unlimited photo analysis and AI mentor support with our subscription plans.\n          </p>\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 max-w-2xl mx-auto\">\n            <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n              <strong>ðŸ“‹ Looking for Plan Analysis?</strong> Visit our dedicated <a href=\"/tools/plan-analysis\" className=\"underline font-semibold\">Plan Analysis Tool</a> page for pay-per-use pricing ($4.99 - $39.99).\n            </p>\n          </div>\n          <div className=\"flex flex-col items-center space-y-6\">\n            <div className=\"flex items-center justify-center space-x-8 text-sm text-muted-foreground\">\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>GPT-5 Powered Analysis</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Louisiana Code Trained</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>95% Accuracy Rate</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* AI Tools Features */}\n      <section className=\"py-20\" data-testid=\"ai-features\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-foreground mb-12\">\n            Powerful AI Tools at Your Fingertips\n          </h2>\n          \n          <div className=\"space-y-12\">\n            {aiToolsFeatures.map((feature, index) => (\n              <Card key={feature.title} className={`p-8 ${index % 2 === 1 ? 'bg-muted/50' : ''}`}>\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 items-center\">\n                  <div className=\"space-y-6\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"p-3 bg-primary/10 rounded-lg\">\n                        <feature.icon className=\"w-8 h-8 text-primary\" />\n                      </div>\n                      <div>\n                        <h3 className=\"text-2xl font-bold text-foreground\">{feature.title}</h3>\n                        <div className=\"flex gap-2 mt-1\">\n                          {feature.plans.map(plan => (\n                            <Badge key={plan} variant=\"secondary\" className=\"text-xs\">\n                              {plan}\n                            </Badge>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <p className=\"text-muted-foreground text-lg leading-relaxed\">\n                      {feature.description}\n                    </p>\n                  </div>\n                  \n                  <div className=\"space-y-3\">\n                    {feature.details.map((detail, idx) => (\n                      <div key={idx} className=\"flex items-start space-x-3\">\n                        <CheckCircle className=\"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0\" />\n                        <span className=\"text-muted-foreground\">{detail}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Plans */}\n      <section className=\"py-20 bg-muted/30\" data-testid=\"ai-pricing-plans\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold text-foreground mb-4\">\n              Choose Your AI Power Level\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n              Choose unlimited access to photo analysis and AI mentor support, or pay per use for occasional needs.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto\">\n            {pricingPlans.map((plan) => (\n              <Card \n                key={plan.id}\n                className={`p-8 hover:shadow-lg transition-all relative ${\n                  plan.popular ? 'border-2 border-primary ring-4 ring-primary/20' : ''\n                }`}\n                data-testid={`ai-plan-${plan.id}`}\n              >\n                {plan.popular && (\n                  <Badge className=\"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-primary text-primary-foreground px-4 py-1\">\n                    Most Popular\n                  </Badge>\n                )}\n                \n                <CardContent className=\"p-0\">\n                  <div className=\"text-center mb-8\">\n                    <h3 className=\"text-2xl font-bold text-card-foreground mb-2\">\n                      {plan.name}\n                    </h3>\n                    <div className=\"text-4xl font-bold text-primary mb-2\">\n                      {plan.payPerUse ? (\n                        <>\n                          <span className=\"text-2xl\">Pay Per Use</span>\n                          <div className=\"text-base font-normal text-muted-foreground mt-2\">\n                            Starting at $0.99\n                          </div>\n                        </>\n                      ) : plan.id === \"ai-tools-annual\" ? (\n                        <>\n                          ${calculatePrice(plan.basePrice, true)}\n                          <span className=\"text-xl font-normal text-muted-foreground\">/year</span>\n                        </>\n                      ) : (\n                        <>\n                          ${calculatePrice(plan.basePrice, false)}\n                          <span className=\"text-xl font-normal text-muted-foreground\">/month</span>\n                        </>\n                      )}\n                      {!plan.payPerUse && plan.id === \"ai-tools-annual\" && (\n                        <div className=\"text-sm space-y-1\">\n                          <div className=\"text-muted-foreground line-through\">\n                            ${(plan.basePrice * 12).toFixed(2)}/year\n                          </div>\n                          <div className=\"text-green-600 font-normal\">\n                            Save ${((plan.basePrice * 12) - calculatePrice(plan.basePrice, true)).toFixed(2)} per year (20% off)\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                    <p className=\"text-muted-foreground\">\n                      {plan.description}\n                    </p>\n                  </div>\n                  \n                  <div className=\"space-y-6 mb-8\">\n                    <div>\n                      <h4 className=\"font-semibold text-foreground mb-3 flex items-center gap-2\">\n                        <Zap className=\"w-4 h-4 text-primary\" />\n                        AI-Powered Features\n                      </h4>\n                      <div className=\"space-y-2\">\n                        {plan.aiFeatures.map((feature, index) => (\n                          <div key={index} className=\"flex items-center space-x-3\">\n                            <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\n                            <span className=\"text-card-foreground font-medium\">{feature}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <h4 className=\"font-semibold text-foreground mb-3\">Additional Features</h4>\n                      <div className=\"space-y-2\">\n                        {plan.additionalFeatures.map((feature, index) => (\n                          <div key={index} className=\"flex items-center space-x-3\">\n                            <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\n                            <span className=\"text-card-foreground\">{feature}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n                  \n                  {plan.payPerUse ? (\n                    <Link href=\"/tools\">\n                      <Button \n                        className=\"w-full\"\n                        size=\"lg\"\n                        variant=\"outline\"\n                      >\n                        Start Using Tools\n                        <ArrowRight className=\"w-4 h-4 ml-2\" />\n                      </Button>\n                    </Link>\n                  ) : (\n                    <Link href={`/subscribe?plan=${plan.id}&priceId=${getPriceId(plan.id, plan.id === \"ai-tools-annual\", false)}&tier=${plan.tier}&isAnnual=${plan.id === \"ai-tools-annual\"}&isBeta=false`}>\n                      <Button \n                        className={`w-full ${plan.popular ? 'bg-primary hover:bg-primary/90' : ''}`}\n                        size=\"lg\"\n                      >\n                        Get AI Tools Now\n                        <ArrowRight className=\"w-4 h-4 ml-2\" />\n                      </Button>\n                    </Link>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n          \n          <div className=\"text-center mt-12\">\n            <div className=\"space-y-4\">\n              <p className=\"text-muted-foreground\">\n                Need course materials? Check out our learning plans with AI tools included.\n              </p>\n              <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                <Link href=\"/pricing\">\n                  <Button variant=\"outline\">\n                    View Learning Plans\n                  </Button>\n                </Link>\n                <Link href=\"/tools/plan-analysis\">\n                  <Button variant=\"outline\">\n                    Plan Analysis Tool\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-20 gradient-hero text-white\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl lg:text-4xl font-bold mb-6\">\n            Ready to Revolutionize Your Plumbing Work?\n          </h2>\n          <p className=\"text-xl text-blue-100 mb-8\">\n            Join hundreds of Louisiana plumbers already using AI to improve their work quality, speed up inspections, and reduce code violations.\n          </p>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":16416},"client/src/pages/employer-dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { \n  Building2, \n  MapPin, \n  Edit, \n  Pause, \n  Play, \n  CheckCircle, \n  XCircle, \n  Clock,\n  Users,\n  Eye,\n  AlertTriangle\n} from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst editJobSchema = z.object({\n  title: z.string().min(3, \"Job title is required\"),\n  description: z.string().min(50, \"Please provide a detailed job description (min 50 characters)\"),\n  location: z.string().min(3, \"Location is required\"),\n  type: z.enum([\"full_time\", \"part_time\", \"contract\", \"temporary\"]),\n  salaryMin: z.string().optional(),\n  salaryMax: z.string().optional(),\n  requirements: z.string().min(10, \"Please list job requirements\"),\n  benefits: z.string().optional(),\n});\n\ntype EditJobData = z.infer<typeof editJobSchema>;\n\ninterface JobListing {\n  id: string;\n  title: string;\n  description: string;\n  location: string;\n  type: string;\n  salaryMin?: string;\n  salaryMax?: string;\n  requirements: string;\n  benefits?: string;\n  status: 'active' | 'paused' | 'filled' | 'expired';\n  planType: 'basic' | 'premium';\n  daysRemaining: number;\n  applicationsCount: number;\n  createdAt: string;\n}\n\nexport default function EmployerDashboard() {\n  const [selectedJob, setSelectedJob] = useState<JobListing | null>(null);\n  const [isEditing, setIsEditing] = useState(false);\n  const { toast } = useToast();\n\n  // Fetch employer's job listings\n  const { data: jobListings, isLoading } = useQuery({\n    queryKey: ['/api/employer/jobs'],\n    retry: false,\n  });\n\n  const editForm = useForm<EditJobData>({\n    resolver: zodResolver(editJobSchema),\n  });\n\n  // Edit job mutation\n  const editJobMutation = useMutation({\n    mutationFn: (data: EditJobData) => \n      apiRequest(\"PUT\", `/api/jobs/${selectedJob?.id}`, data),\n    onSuccess: () => {\n      setIsEditing(false);\n      setSelectedJob(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/employer/jobs'] });\n      toast({\n        title: \"Job Updated Successfully\",\n        description: \"Your job listing has been updated.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update job listing\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Change job status mutation\n  const changeStatusMutation = useMutation({\n    mutationFn: ({ jobId, status }: { jobId: string; status: string }) => \n      apiRequest(\"PATCH\", `/api/jobs/${jobId}/status`, { status }),\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/employer/jobs'] });\n      const statusMessages = {\n        'paused': 'Job listing has been paused',\n        'active': 'Job listing has been reactivated',\n        'filled': 'Job listing marked as filled',\n      };\n      toast({\n        title: \"Status Updated\",\n        description: statusMessages[variables.status as keyof typeof statusMessages],\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update job status\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmitEdit = (data: EditJobData) => {\n    const processedData = {\n      ...data,\n      requirements: data.requirements.split('\\n').filter(req => req.trim()).join('\\n'),\n      benefits: data.benefits ? data.benefits.split('\\n').filter(benefit => benefit.trim()).join('\\n') : undefined,\n    };\n    editJobMutation.mutate(processedData);\n  };\n\n  const handleStatusChange = (jobId: string, newStatus: string) => {\n    changeStatusMutation.mutate({ jobId, status: newStatus });\n  };\n\n  const handleEditJob = (job: JobListing) => {\n    setSelectedJob(job);\n    setIsEditing(true);\n    editForm.reset({\n      title: job.title,\n      description: job.description,\n      location: job.location,\n      type: job.type as any,\n      salaryMin: job.salaryMin || \"\",\n      salaryMax: job.salaryMax || \"\",\n      requirements: job.requirements,\n      benefits: job.benefits || \"\",\n    });\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active': return 'bg-green-100 text-green-700';\n      case 'paused': return 'bg-yellow-100 text-yellow-700';\n      case 'filled': return 'bg-blue-100 text-blue-700';\n      case 'expired': return 'bg-red-100 text-red-700';\n      default: return 'bg-gray-100 text-gray-700';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'active': return <CheckCircle className=\"w-4 h-4\" />;\n      case 'paused': return <Pause className=\"w-4 h-4\" />;\n      case 'filled': return <Users className=\"w-4 h-4\" />;\n      case 'expired': return <XCircle className=\"w-4 h-4\" />;\n      default: return <Clock className=\"w-4 h-4\" />;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <div className=\"max-w-6xl mx-auto px-4 py-16\">\n          <div className=\"animate-pulse space-y-4\">\n            <div className=\"h-8 bg-gray-200 rounded w-1/4\"></div>\n            <div className=\"h-64 bg-gray-200 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <section className=\"border-b bg-white\">\n        <div className=\"max-w-6xl mx-auto px-4 py-8\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold\" data-testid=\"dashboard-title\">\n                Manage Job Listings\n              </h1>\n              <p className=\"text-muted-foreground mt-2\">\n                Update, pause, or mark your job listings as filled\n              </p>\n            </div>\n            <Button \n              onClick={() => window.location.href = \"/employer-portal\"}\n              data-testid=\"new-job-button\"\n            >\n              <Building2 className=\"w-4 h-4 mr-2\" />\n              Post New Job\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      <div className=\"max-w-6xl mx-auto px-4 py-8\">\n        {/* Job Listings Grid */}\n        {!jobListings || jobListings.length === 0 ? (\n          <Card>\n            <CardContent className=\"text-center py-16\">\n              <Building2 className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"text-xl font-semibold mb-2\">No Job Listings Yet</h3>\n              <p className=\"text-muted-foreground mb-6\">\n                Create your first job listing to start hiring apprentice plumbers\n              </p>\n              <Button onClick={() => window.location.href = \"/employer-portal\"}>\n                Post Your First Job\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid gap-6\">\n            {jobListings.map((job: JobListing) => (\n              <Card key={job.id} className=\"hover:shadow-md transition-shadow\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-3 mb-2\">\n                        <h3 className=\"text-xl font-semibold\">{job.title}</h3>\n                        <Badge className={getStatusColor(job.status)}>\n                          {getStatusIcon(job.status)}\n                          <span className=\"ml-1 capitalize\">{job.status}</span>\n                        </Badge>\n                        <Badge variant=\"outline\">\n                          {job.planType.charAt(0).toUpperCase() + job.planType.slice(1)}\n                        </Badge>\n                      </div>\n                      <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\n                        <span className=\"flex items-center\">\n                          <MapPin className=\"w-4 h-4 mr-1\" />\n                          {job.location}\n                        </span>\n                        <span className=\"flex items-center\">\n                          <Users className=\"w-4 h-4 mr-1\" />\n                          {job.applicationsCount} applications\n                        </span>\n                        <span className=\"flex items-center\">\n                          <Clock className=\"w-4 h-4 mr-1\" />\n                          {job.daysRemaining} days left\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n\n                  <p className=\"text-muted-foreground mb-4 line-clamp-2\">\n                    {job.description}\n                  </p>\n\n                  {job.daysRemaining <= 7 && job.status === 'active' && (\n                    <Alert className=\"mb-4\">\n                      <AlertTriangle className=\"h-4 w-4\" />\n                      <AlertDescription>\n                        This listing expires in {job.daysRemaining} days. Edit to extend or mark as filled.\n                      </AlertDescription>\n                    </Alert>\n                  )}\n\n                  <div className=\"flex flex-wrap gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => handleEditJob(job)}\n                      data-testid={`edit-job-${job.id}`}\n                    >\n                      <Edit className=\"w-4 h-4 mr-1\" />\n                      Edit Details\n                    </Button>\n                    \n                    {job.status === 'active' && (\n                      <>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => handleStatusChange(job.id, 'paused')}\n                        >\n                          <Pause className=\"w-4 h-4 mr-1\" />\n                          Pause\n                        </Button>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => handleStatusChange(job.id, 'filled')}\n                          className=\"bg-green-50 hover:bg-green-100\"\n                        >\n                          <CheckCircle className=\"w-4 h-4 mr-1\" />\n                          Mark as Filled\n                        </Button>\n                      </>\n                    )}\n                    \n                    {job.status === 'paused' && (\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => handleStatusChange(job.id, 'active')}\n                        className=\"bg-blue-50 hover:bg-blue-100\"\n                      >\n                        <Play className=\"w-4 h-4 mr-1\" />\n                        Reactivate\n                      </Button>\n                    )}\n                    \n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => window.location.href = `/employer/applications/${job.id}`}\n                    >\n                      <Eye className=\"w-4 h-4 mr-1\" />\n                      View Applications\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n\n        {/* Edit Job Modal/Form */}\n        {isEditing && selectedJob && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n            <Card className=\"w-full max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Edit className=\"w-5 h-5\" />\n                  <span>Edit Job Listing</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Form {...editForm}>\n                  <form onSubmit={editForm.handleSubmit(onSubmitEdit)} className=\"space-y-6\">\n                    <FormField\n                      control={editForm.control}\n                      name=\"title\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Job Title *</FormLabel>\n                          <FormControl>\n                            <Input {...field} placeholder=\"e.g., Journeyman Plumber\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid md:grid-cols-2 gap-4\">\n                      <FormField\n                        control={editForm.control}\n                        name=\"location\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Location *</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"City, LA\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={editForm.control}\n                        name=\"type\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Employment Type *</FormLabel>\n                            <Select onValueChange={field.onChange} defaultValue={field.value}>\n                              <FormControl>\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"Select type\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                <SelectItem value=\"full_time\">Full Time</SelectItem>\n                                <SelectItem value=\"part_time\">Part Time</SelectItem>\n                                <SelectItem value=\"contract\">Contract</SelectItem>\n                                <SelectItem value=\"temporary\">Temporary</SelectItem>\n                              </SelectContent>\n                            </Select>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-4\">\n                      <FormField\n                        control={editForm.control}\n                        name=\"salaryMin\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Minimum Salary (optional)</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"$45,000\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={editForm.control}\n                        name=\"salaryMax\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Maximum Salary (optional)</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"$65,000\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={editForm.control}\n                      name=\"description\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Job Description *</FormLabel>\n                          <FormControl>\n                            <Textarea \n                              {...field} \n                              rows={6}\n                              placeholder=\"Describe the position, responsibilities, and work environment...\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={editForm.control}\n                      name=\"requirements\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Requirements *</FormLabel>\n                          <FormControl>\n                            <Textarea \n                              {...field} \n                              rows={4}\n                              placeholder=\"List requirements (one per line)&#10;Louisiana plumbing license required&#10;2+ years experience&#10;Reliable transportation\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={editForm.control}\n                      name=\"benefits\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Benefits (optional)</FormLabel>\n                          <FormControl>\n                            <Textarea \n                              {...field} \n                              rows={3}\n                              placeholder=\"List benefits (one per line)&#10;Health insurance&#10;401k matching&#10;Paid time off\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"flex space-x-4\">\n                      <Button \n                        type=\"submit\" \n                        disabled={editJobMutation.isPending}\n                        className=\"flex-1\"\n                      >\n                        {editJobMutation.isPending ? \"Updating...\" : \"Update Job Listing\"}\n                      </Button>\n                      <Button \n                        type=\"button\" \n                        variant=\"outline\"\n                        onClick={() => {\n                          setIsEditing(false);\n                          setSelectedJob(null);\n                        }}\n                        className=\"flex-1\"\n                      >\n                        Cancel\n                      </Button>\n                    </div>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":19762},"client/src/pages/admin/beta-feedback-dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  MessageSquare, \n  Send, \n  Users, \n  CheckCircle, \n  Clock,\n  TrendingUp,\n  Mail,\n  Calendar\n} from \"lucide-react\";\n\ninterface FeedbackStats {\n  totalSent: number;\n  completed: number;\n  completionRate: number;\n  totalBetaTesters: number;\n}\n\ninterface FeedbackCampaign {\n  id: string;\n  title: string;\n  monthYear: string;\n  emailSentAt: string | null;\n  dueDate: string;\n}\n\ninterface FeedbackAnalytics {\n  campaign: FeedbackCampaign | null;\n  stats: FeedbackStats | null;\n  responses: any[];\n}\n\nexport default function BetaFeedbackDashboard() {\n  const [analytics, setAnalytics] = useState<FeedbackAnalytics | null>(null);\n  const [selectedMonth, setSelectedMonth] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSending, setIsSending] = useState(false);\n  const [isMonitoring, setIsMonitoring] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    // Default to current month\n    const now = new Date();\n    const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n    setSelectedMonth(currentMonth);\n    loadAnalytics(currentMonth);\n  }, []);\n\n  const loadAnalytics = async (monthYear?: string) => {\n    setIsLoading(true);\n    try {\n      const url = monthYear \n        ? `/api/admin/beta-feedback/analytics?monthYear=${monthYear}`\n        : '/api/admin/beta-feedback/analytics';\n      const response = await apiRequest(\"GET\", url);\n      const data = await response.json();\n      setAnalytics(data);\n    } catch (error: any) {\n      console.error(\"Error loading analytics:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load feedback analytics\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const sendMonthlyFeedback = async () => {\n    setIsSending(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/admin/beta-feedback/send-monthly\");\n      const result = await response.json();\n      \n      toast({\n        title: \"Feedback Emails Sent!\",\n        description: `Sent to ${result.emailsSent} beta testers`,\n      });\n      \n      // Reload analytics\n      loadAnalytics(selectedMonth);\n    } catch (error: any) {\n      console.error(\"Error sending feedback:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to send monthly feedback emails\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  const runMonitoring = async () => {\n    setIsMonitoring(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/admin/beta-feedback/run-monitoring\");\n      const result = await response.json();\n      \n      if (result.criticalIssues?.length > 0 || result.alerts?.length > 0) {\n        toast({\n          title: \"Monitoring Complete\",\n          description: `Found ${result.criticalIssues?.length || 0} critical issues and ${result.alerts?.length || 0} warnings`,\n          variant: result.criticalIssues?.length > 0 ? \"destructive\" : \"default\",\n        });\n      } else {\n        toast({\n          title: \"Monitoring Complete\",\n          description: \"No issues detected in recent feedback\",\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Error running monitoring:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to run feedback monitoring\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsMonitoring(false);\n    }\n  };\n\n  const handleMonthChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const monthYear = e.target.value;\n    setSelectedMonth(monthYear);\n    if (monthYear) {\n      loadAnalytics(monthYear);\n    }\n  };\n\n  if (isLoading && !analytics) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\" data-testid=\"feedback-dashboard-title\">\n            Beta Feedback Dashboard\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Manage monthly feedback campaigns for beta testers\n          </p>\n        </div>\n        <div className=\"flex gap-3\">\n          <Button \n            onClick={runMonitoring}\n            disabled={isMonitoring}\n            variant=\"outline\"\n            data-testid=\"run-monitoring-button\"\n          >\n            {isMonitoring ? (\n              <>\n                <div className=\"animate-spin w-4 h-4 border-2 border-current border-t-transparent rounded-full mr-2\"></div>\n                Analyzing...\n              </>\n            ) : (\n              <>\n                <TrendingUp className=\"w-4 h-4 mr-2\" />\n                Run Monitoring\n              </>\n            )}\n          </Button>\n          <Button \n            onClick={sendMonthlyFeedback}\n            disabled={isSending}\n            data-testid=\"send-feedback-button\"\n          >\n            {isSending ? (\n              <>\n                <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\"></div>\n                Sending...\n              </>\n            ) : (\n              <>\n                <Send className=\"w-4 h-4 mr-2\" />\n                Send Monthly Feedback\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n\n      {/* Month selector */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"w-5 h-5\" />\n            Select Month\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center gap-4\">\n            <div className=\"flex-1\">\n              <Label htmlFor=\"month-input\">Month & Year</Label>\n              <Input\n                id=\"month-input\"\n                type=\"month\"\n                value={selectedMonth}\n                onChange={handleMonthChange}\n                data-testid=\"month-selector\"\n              />\n            </div>\n            <Button \n              onClick={() => loadAnalytics(selectedMonth)}\n              variant=\"outline\"\n              data-testid=\"load-analytics\"\n            >\n              Load Analytics\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Stats Overview */}\n      {analytics?.stats && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Total Beta Testers</p>\n                  <p className=\"text-2xl font-bold\" data-testid=\"total-testers\">\n                    {analytics.stats.totalBetaTesters}\n                  </p>\n                </div>\n                <Users className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Emails Sent</p>\n                  <p className=\"text-2xl font-bold\" data-testid=\"emails-sent\">\n                    {analytics.stats.totalSent}\n                  </p>\n                </div>\n                <Mail className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Responses</p>\n                  <p className=\"text-2xl font-bold\" data-testid=\"responses-count\">\n                    {analytics.stats.completed}\n                  </p>\n                </div>\n                <MessageSquare className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Completion Rate</p>\n                  <p className=\"text-2xl font-bold\" data-testid=\"completion-rate\">\n                    {analytics.stats.completionRate.toFixed(1)}%\n                  </p>\n                </div>\n                <TrendingUp className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Campaign Status */}\n      {analytics?.campaign && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Calendar className=\"w-5 h-5\" />\n              Campaign Status\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"font-semibold\" data-testid=\"campaign-title\">\n                    {analytics.campaign.title}\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Due: {new Date(analytics.campaign.dueDate).toLocaleDateString()}\n                  </p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {analytics.campaign.emailSentAt ? (\n                    <Badge variant=\"default\" className=\"bg-green-100 text-green-800\">\n                      <CheckCircle className=\"w-3 h-3 mr-1\" />\n                      Sent\n                    </Badge>\n                  ) : (\n                    <Badge variant=\"secondary\">\n                      <Clock className=\"w-3 h-3 mr-1\" />\n                      Pending\n                    </Badge>\n                  )}\n                </div>\n              </div>\n              \n              {analytics.campaign.emailSentAt && (\n                <p className=\"text-sm text-muted-foreground\">\n                  Emails sent on: {new Date(analytics.campaign.emailSentAt).toLocaleString()}\n                </p>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Recent Responses */}\n      {analytics?.responses && analytics.responses.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Recent Responses</CardTitle>\n            <CardDescription>\n              Latest feedback submissions from beta testers\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {analytics.responses.slice(0, 5).map((response, index) => (\n                <div key={index} className=\"border-b last:border-b-0 pb-4 last:pb-0\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <p className=\"font-medium\">\n                      {response.userName || 'Anonymous'}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {new Date(response.completedAt).toLocaleString()}\n                    </p>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {response.userEmail}\n                  </p>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* No Data State */}\n      {analytics && !analytics.campaign && !analytics.stats && (\n        <Card>\n          <CardContent className=\"p-12 text-center\">\n            <MessageSquare className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No Campaign Found</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              No feedback campaign exists for the selected month.\n            </p>\n            <Button onClick={sendMonthlyFeedback} disabled={isSending}>\n              Create & Send Campaign\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":12834},"client/src/pages/beta-feedback.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { CheckCircle, Star, MessageSquare, Building2 } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\n\ninterface FeedbackQuestion {\n  id: string;\n  questionText: string;\n  questionType: string;\n  options?: string[];\n  isRequired: boolean;\n}\n\ninterface FeedbackCampaign {\n  id: string;\n  title: string;\n  description: string;\n  monthYear: string;\n  dueDate: string;\n}\n\nexport default function BetaFeedback() {\n  const [location] = useLocation();\n  const [campaign, setCampaign] = useState<FeedbackCampaign | null>(null);\n  const [questions, setQuestions] = useState<FeedbackQuestion[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const { toast } = useToast();\n  const { register, handleSubmit, formState: { errors }, setValue, watch } = useForm();\n\n  const token = new URLSearchParams(location.split('?')[1] || '').get('token');\n\n  useEffect(() => {\n    if (!token) {\n      toast({\n        title: \"Invalid Link\",\n        description: \"This feedback link is invalid or expired\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    loadFeedbackForm();\n  }, [token]);\n\n  const loadFeedbackForm = async () => {\n    try {\n      const response = await apiRequest(\"GET\", `/api/beta-feedback/${token}`);\n      const data = await response.json();\n      setCampaign(data.campaign);\n      setQuestions(data.questions);\n    } catch (error: any) {\n      console.error(\"Error loading feedback form:\", error);\n      toast({\n        title: \"Error Loading Form\",\n        description: \"Unable to load the feedback form. Please try again later.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const onSubmit = async (data: any) => {\n    if (!token || !campaign) return;\n    \n    setIsSubmitting(true);\n    try {\n      const responses: Record<string, any> = {};\n      \n      // Process form data into responses object\n      Object.keys(data).forEach(key => {\n        if (key.startsWith('question_')) {\n          const questionId = key.replace('question_', '');\n          responses[questionId] = data[key];\n        }\n      });\n\n      await apiRequest(\"POST\", `/api/beta-feedback/${token}/submit`, {\n        responses\n      });\n\n      setIsSubmitted(true);\n      toast({\n        title: \"Feedback Submitted!\",\n        description: \"Thank you for helping us improve LA Plumb Prep\",\n      });\n    } catch (error: any) {\n      console.error(\"Error submitting feedback:\", error);\n      toast({\n        title: \"Submission Error\",\n        description: \"There was an error submitting your feedback. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const renderQuestion = (question: FeedbackQuestion, index: number) => {\n    const fieldName = `question_${question.id}`;\n    \n    switch (question.questionType) {\n      case 'text':\n        return (\n          <div key={question.id} className=\"space-y-2\">\n            <Label htmlFor={fieldName} className=\"text-sm font-medium\">\n              {question.questionText}\n              {question.isRequired && <span className=\"text-red-500 ml-1\">*</span>}\n            </Label>\n            <Input\n              id={fieldName}\n              {...register(fieldName, { required: question.isRequired })}\n              placeholder=\"Type your answer here...\"\n              data-testid={`feedback-input-${index}`}\n            />\n            {errors[fieldName] && (\n              <p className=\"text-sm text-red-500\">This field is required</p>\n            )}\n          </div>\n        );\n        \n      case 'textarea':\n        return (\n          <div key={question.id} className=\"space-y-2\">\n            <Label htmlFor={fieldName} className=\"text-sm font-medium\">\n              {question.questionText}\n              {question.isRequired && <span className=\"text-red-500 ml-1\">*</span>}\n            </Label>\n            <Textarea\n              id={fieldName}\n              {...register(fieldName, { required: question.isRequired })}\n              placeholder=\"Please share your detailed thoughts...\"\n              rows={4}\n              data-testid={`feedback-textarea-${index}`}\n            />\n            {errors[fieldName] && (\n              <p className=\"text-sm text-red-500\">This field is required</p>\n            )}\n          </div>\n        );\n        \n      case 'rating':\n        return (\n          <div key={question.id} className=\"space-y-3\">\n            <Label className=\"text-sm font-medium\">\n              {question.questionText}\n              {question.isRequired && <span className=\"text-red-500 ml-1\">*</span>}\n            </Label>\n            <RadioGroup \n              onValueChange={(value) => setValue(fieldName, value)}\n              data-testid={`feedback-rating-${index}`}\n            >\n              {[1, 2, 3, 4, 5].map((rating) => (\n                <div key={rating} className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value={rating.toString()} id={`${fieldName}_${rating}`} />\n                  <Label htmlFor={`${fieldName}_${rating}`} className=\"flex items-center cursor-pointer\">\n                    <div className=\"flex items-center space-x-1\">\n                      {[1, 2, 3, 4, 5].map((star) => (\n                        <Star\n                          key={star}\n                          className={`w-4 h-4 ${star <= rating ? 'text-yellow-400 fill-current' : 'text-gray-300'}`}\n                        />\n                      ))}\n                    </div>\n                    <span className=\"ml-2 text-sm\">\n                      {rating === 1 && \"Poor\"}\n                      {rating === 2 && \"Fair\"}\n                      {rating === 3 && \"Good\"}\n                      {rating === 4 && \"Very Good\"}\n                      {rating === 5 && \"Excellent\"}\n                    </span>\n                  </Label>\n                </div>\n              ))}\n            </RadioGroup>\n            {errors[fieldName] && (\n              <p className=\"text-sm text-red-500\">Please select a rating</p>\n            )}\n          </div>\n        );\n        \n      case 'multiple_choice':\n        return (\n          <div key={question.id} className=\"space-y-3\">\n            <Label className=\"text-sm font-medium\">\n              {question.questionText}\n              {question.isRequired && <span className=\"text-red-500 ml-1\">*</span>}\n            </Label>\n            <RadioGroup \n              onValueChange={(value) => setValue(fieldName, value)}\n              data-testid={`feedback-choice-${index}`}\n            >\n              {question.options?.map((option, optionIndex) => (\n                <div key={optionIndex} className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value={option} id={`${fieldName}_${optionIndex}`} />\n                  <Label htmlFor={`${fieldName}_${optionIndex}`} className=\"cursor-pointer\">\n                    {option}\n                  </Label>\n                </div>\n              ))}\n            </RadioGroup>\n            {errors[fieldName] && (\n              <p className=\"text-sm text-red-500\">Please select an option</p>\n            )}\n          </div>\n        );\n        \n      case 'boolean':\n        return (\n          <div key={question.id} className=\"space-y-3\">\n            <Label className=\"text-sm font-medium\">\n              {question.questionText}\n              {question.isRequired && <span className=\"text-red-500 ml-1\">*</span>}\n            </Label>\n            <RadioGroup \n              onValueChange={(value) => setValue(fieldName, value === 'true')}\n              data-testid={`feedback-boolean-${index}`}\n            >\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"true\" id={`${fieldName}_yes`} />\n                <Label htmlFor={`${fieldName}_yes`} className=\"cursor-pointer\">Yes</Label>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"false\" id={`${fieldName}_no`} />\n                <Label htmlFor={`${fieldName}_no`} className=\"cursor-pointer\">No</Label>\n              </div>\n            </RadioGroup>\n            {errors[fieldName] && (\n              <p className=\"text-sm text-red-500\">Please select an option</p>\n            )}\n          </div>\n        );\n        \n      default:\n        return null;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4\"></div>\n            <h2 className=\"text-2xl font-bold mb-2\">Loading Feedback Form...</h2>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (isSubmitted) {\n    return (\n      <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-2xl mx-auto text-center\">\n          <div className=\"flex items-center justify-center space-x-2 mb-6\">\n            <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n              <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n            </div>\n            <div className=\"text-left\">\n              <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n              <p className=\"text-xs text-muted-foreground\">Beta Feedback Program</p>\n            </div>\n          </div>\n          \n          <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <CheckCircle className=\"w-8 h-8 text-green-600\" />\n          </div>\n          \n          <h2 className=\"text-3xl font-bold text-foreground mb-4\">Thank You!</h2>\n          <p className=\"text-muted-foreground mb-8\">\n            Your feedback has been submitted successfully. Your insights help us improve LA Plumb Prep for all users.\n          </p>\n          \n          <Card className=\"bg-blue-50 border-blue-200\">\n            <CardContent className=\"p-6\">\n              <p className=\"text-blue-800\">\n                <strong>Remember:</strong> As long as you continue as an active student and complete these monthly feedback surveys, your beta pricing is locked in for all current and future courses.\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (!campaign) {\n    return (\n      <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-2xl mx-auto text-center\">\n          <h2 className=\"text-2xl font-bold mb-4\">Feedback Form Not Found</h2>\n          <p className=\"text-muted-foreground\">This feedback link may be invalid or expired.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center space-x-2 mb-6\">\n            <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n              <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n            </div>\n            <div className=\"text-left\">\n              <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n              <p className=\"text-xs text-muted-foreground\">Beta Feedback Program</p>\n            </div>\n          </div>\n          \n          <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <MessageSquare className=\"w-6 h-6 text-blue-600\" />\n          </div>\n          \n          <h2 className=\"text-3xl font-bold text-foreground mb-2\" data-testid=\"feedback-title\">\n            {campaign.title}\n          </h2>\n          {campaign.description && (\n            <p className=\"text-muted-foreground mb-4\">\n              {campaign.description}\n            </p>\n          )}\n          <p className=\"text-sm text-muted-foreground\">\n            Due Date: {new Date(campaign.dueDate).toLocaleDateString()}\n          </p>\n        </div>\n\n        {/* Beta Info Card */}\n        <Card className=\"mb-8 border-orange-200 bg-orange-50\">\n          <CardHeader>\n            <CardTitle className=\"text-orange-800 text-lg\">Beta Tester Benefits</CardTitle>\n          </CardHeader>\n          <CardContent className=\"text-orange-700\">\n            <ul className=\"space-y-2 text-sm\">\n              <li className=\"flex items-start gap-2\">\n                <CheckCircle className=\"w-4 h-4 text-orange-600 mt-0.5 flex-shrink-0\" />\n                <span>Keep your discounted beta pricing forever</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <CheckCircle className=\"w-4 h-4 text-orange-600 mt-0.5 flex-shrink-0\" />\n                <span>Help shape the future of plumbing education</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <CheckCircle className=\"w-4 h-4 text-orange-600 mt-0.5 flex-shrink-0\" />\n                <span>Access to new features before anyone else</span>\n              </li>\n            </ul>\n            <div className=\"mt-4 p-3 bg-orange-100 rounded border border-orange-300\">\n              <p className=\"text-xs font-medium\">\n                <strong>Important:</strong> Complete this monthly survey to maintain your beta status and locked pricing.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Feedback Form */}\n        <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Your Feedback</CardTitle>\n              <CardDescription>\n                Your responses help us improve the platform for all users.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {questions.map((question, index) => renderQuestion(question, index))}\n            </CardContent>\n          </Card>\n          \n          <Button \n            type=\"submit\" \n            className=\"w-full\" \n            size=\"lg\"\n            disabled={isSubmitting}\n            data-testid=\"submit-feedback\"\n          >\n            {isSubmitting ? \"Submitting...\" : \"Submit Feedback\"}\n          </Button>\n        </form>\n      </div>\n    </div>\n  );\n}","size_bytes":15132},"server/betaFeedbackSystem.ts":{"content":"import { db } from \"./db\";\nimport { \n  users, \n  betaFeedbackQuestions, \n  betaFeedbackCampaigns, \n  betaFeedbackResponses,\n  emailQueue \n} from \"@shared/schema\";\nimport { eq, and, isNull, lt } from \"drizzle-orm\";\nimport { randomUUID } from \"crypto\";\nimport { emailAutomation } from './email-automation';\n\nexport class BetaFeedbackService {\n  // Initialize default feedback questions\n  static async initializeDefaultQuestions() {\n    const existingQuestions = await db.select().from(betaFeedbackQuestions).where(eq(betaFeedbackQuestions.isActive, true));\n    \n    if (existingQuestions.length === 0) {\n      const defaultQuestions = [\n        {\n          questionText: \"How would you rate your overall experience with LA Plumb Prep this month?\",\n          questionType: \"rating\",\n          isRequired: true,\n          displayOrder: 1,\n        },\n        {\n          questionText: \"Which courses or features did you use most frequently?\",\n          questionType: \"multiple_choice\",\n          options: JSON.stringify([\n            \"Louisiana Journeyman Prep\",\n            \"Calculator Tools\", \n            \"AI Mentor\",\n            \"Photo Code Checker\",\n            \"Practice Tests\",\n            \"Job Board\"\n          ]),\n          isRequired: true,\n          displayOrder: 2,\n        },\n        {\n          questionText: \"What features or improvements would you like to see added?\",\n          questionType: \"textarea\",\n          isRequired: true,\n          displayOrder: 3,\n        },\n        {\n          questionText: \"Did you encounter any technical issues or bugs?\",\n          questionType: \"boolean\",\n          isRequired: true,\n          displayOrder: 4,\n        },\n        {\n          questionText: \"If yes, please describe the technical issues you experienced:\",\n          questionType: \"textarea\",\n          isRequired: false,\n          displayOrder: 5,\n        },\n        {\n          questionText: \"How helpful was our customer support (if you contacted us)?\",\n          questionType: \"multiple_choice\",\n          options: JSON.stringify([\n            \"Very Helpful\",\n            \"Helpful\", \n            \"Somewhat Helpful\",\n            \"Not Helpful\",\n            \"Didn't Contact Support\"\n          ]),\n          isRequired: false,\n          displayOrder: 6,\n        },\n        {\n          questionText: \"Would you recommend LA Plumb Prep to other plumbing professionals?\",\n          questionType: \"boolean\",\n          isRequired: true,\n          displayOrder: 7,\n        },\n        {\n          questionText: \"Any additional comments or suggestions?\",\n          questionType: \"textarea\",\n          isRequired: false,\n          displayOrder: 8,\n        }\n      ];\n\n      for (const question of defaultQuestions) {\n        await db.insert(betaFeedbackQuestions).values(question);\n      }\n\n      console.log(\"Default feedback questions initialized\");\n    }\n  }\n\n  // Create monthly feedback campaign\n  static async createMonthlyCampaign(monthYear: string) {\n    const existingCampaign = await db.select()\n      .from(betaFeedbackCampaigns)\n      .where(eq(betaFeedbackCampaigns.monthYear, monthYear))\n      .limit(1);\n\n    if (existingCampaign.length > 0) {\n      console.log(`Campaign for ${monthYear} already exists`);\n      return existingCampaign[0];\n    }\n\n    const dueDate = new Date();\n    dueDate.setMonth(dueDate.getMonth() + 1);\n    dueDate.setDate(0); // Last day of current month\n\n    const campaign = await db.insert(betaFeedbackCampaigns).values({\n      title: `Monthly Feedback - ${this.formatMonthYear(monthYear)}`,\n      description: \"Help us improve LA Plumb Prep with your monthly feedback\",\n      monthYear,\n      dueDate,\n    }).returning();\n\n    return campaign[0];\n  }\n\n  // Send feedback emails to all beta testers\n  static async sendMonthlyFeedbackEmails() {\n    const currentMonthYear = this.getCurrentMonthYear();\n    \n    // Create or get current month's campaign\n    const campaign = await this.createMonthlyCampaign(currentMonthYear);\n\n    // Get all beta testers who haven't responded yet\n    const betaTesters = await db.select({\n      id: users.id,\n      email: users.email,\n      firstName: users.firstName,\n      lastName: users.lastName\n    })\n    .from(users)\n    .where(\n      and(\n        eq(users.isBetaTester, true),\n        eq(users.isActive, true)\n      )\n    );\n\n    // Check who hasn't responded yet\n    const existingResponses = await db.select({ userId: betaFeedbackResponses.userId })\n      .from(betaFeedbackResponses)\n      .where(eq(betaFeedbackResponses.campaignId, campaign.id));\n\n    const respondedUserIds = new Set(existingResponses.map(r => r.userId));\n    const unrespondedTesters = betaTesters.filter(user => !respondedUserIds.has(user.id));\n\n    console.log(`Sending feedback emails to ${unrespondedTesters.length} beta testers for ${currentMonthYear}`);\n\n    // Send emails to unresponded beta testers\n    for (const tester of unrespondedTesters) {\n      const submissionToken = randomUUID();\n      \n      // Create response record with token\n      await db.insert(betaFeedbackResponses).values({\n        campaignId: campaign.id,\n        userId: tester.id,\n        responses: {},\n        submissionToken,\n        completedAt: null, // Will be set when submitted\n      });\n\n      // Queue email\n      const feedbackUrl = `${process.env.BASE_URL || 'http://localhost:5000'}/beta-feedback?token=${submissionToken}`;\n      \n      await db.insert(emailQueue).values({\n        recipientEmail: tester.email,\n        recipientName: tester.firstName || 'Beta Tester',\n        campaignId: campaign.id,\n        campaignType: 'bulk_enrollment',\n        subject: `ðŸ”§ Monthly Beta Feedback Required - Keep Your Discount!`,\n        content: this.generateFeedbackEmail(tester.firstName || 'Beta Tester', feedbackUrl, campaign.dueDate.toLocaleDateString()),\n        scheduledFor: new Date(),\n      });\n    }\n\n    // Mark campaign as email sent\n    await db.update(betaFeedbackCampaigns)\n      .set({ emailSentAt: new Date() })\n      .where(eq(betaFeedbackCampaigns.id, campaign.id));\n\n    return {\n      campaignId: campaign.id,\n      emailsSent: unrespondedTesters.length,\n      totalBetaTesters: betaTesters.length\n    };\n  }\n\n  // Get feedback campaign and questions by token\n  static async getFeedbackByToken(token: string) {\n    const response = await db.select({\n      campaignId: betaFeedbackResponses.campaignId,\n      userId: betaFeedbackResponses.userId,\n      completed: betaFeedbackResponses.completedAt,\n    })\n    .from(betaFeedbackResponses)\n    .where(eq(betaFeedbackResponses.submissionToken, token))\n    .limit(1);\n\n    if (response.length === 0) {\n      throw new Error(\"Invalid feedback token\");\n    }\n\n    const responseRecord = response[0];\n    \n    if (responseRecord.completed) {\n      throw new Error(\"Feedback already submitted\");\n    }\n\n    // Get campaign details\n    const campaign = await db.select()\n      .from(betaFeedbackCampaigns)\n      .where(eq(betaFeedbackCampaigns.id, responseRecord.campaignId))\n      .limit(1);\n\n    if (campaign.length === 0) {\n      throw new Error(\"Campaign not found\");\n    }\n\n    // Get questions\n    const questions = await db.select()\n      .from(betaFeedbackQuestions)\n      .where(eq(betaFeedbackQuestions.isActive, true))\n      .orderBy(betaFeedbackQuestions.displayOrder);\n\n    return {\n      campaign: campaign[0],\n      questions: questions.map(q => ({\n        ...q,\n        options: q.options ? JSON.parse(q.options as string) : undefined\n      }))\n    };\n  }\n\n  // Submit feedback response\n  static async submitFeedback(token: string, responses: Record<string, any>) {\n    const responseRecord = await db.select()\n      .from(betaFeedbackResponses)\n      .where(eq(betaFeedbackResponses.submissionToken, token))\n      .limit(1);\n\n    if (responseRecord.length === 0) {\n      throw new Error(\"Invalid feedback token\");\n    }\n\n    if (responseRecord[0].completedAt) {\n      throw new Error(\"Feedback already submitted\");\n    }\n\n    // Update response with answers and completion time\n    await db.update(betaFeedbackResponses)\n      .set({ \n        responses: responses,\n        completedAt: new Date()\n      })\n      .where(eq(betaFeedbackResponses.submissionToken, token));\n\n    console.log(`Feedback submitted for token: ${token}`);\n    return true;\n  }\n\n  // Get feedback analytics for admin\n  static async getFeedbackAnalytics(monthYear?: string) {\n    const targetMonth = monthYear || this.getCurrentMonthYear();\n    \n    const campaign = await db.select()\n      .from(betaFeedbackCampaigns)\n      .where(eq(betaFeedbackCampaigns.monthYear, targetMonth))\n      .limit(1);\n\n    if (campaign.length === 0) {\n      return { campaign: null, stats: null, responses: [] };\n    }\n\n    // Get response stats\n    const allResponses = await db.select({\n      userId: betaFeedbackResponses.userId,\n      responses: betaFeedbackResponses.responses,\n      completedAt: betaFeedbackResponses.completedAt,\n      userEmail: users.email,\n      userName: users.firstName\n    })\n    .from(betaFeedbackResponses)\n    .leftJoin(users, eq(betaFeedbackResponses.userId, users.id))\n    .where(eq(betaFeedbackResponses.campaignId, campaign[0].id));\n\n    const completedResponses = allResponses.filter(r => r.completedAt);\n    const totalBetaTesters = await db.select({ count: users.id })\n      .from(users)\n      .where(and(eq(users.isBetaTester, true), eq(users.isActive, true)));\n\n    return {\n      campaign: campaign[0],\n      stats: {\n        totalSent: allResponses.length,\n        completed: completedResponses.length,\n        completionRate: allResponses.length > 0 ? (completedResponses.length / allResponses.length) * 100 : 0,\n        totalBetaTesters: totalBetaTesters.length\n      },\n      responses: completedResponses\n    };\n  }\n\n  // Helper methods\n  private static getCurrentMonthYear(): string {\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n  }\n\n  private static formatMonthYear(monthYear: string): string {\n    const [year, month] = monthYear.split('-');\n    const date = new Date(parseInt(year), parseInt(month) - 1);\n    return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });\n  }\n\n  private static generateFeedbackEmail(firstName: string, feedbackUrl: string, dueDate: string): string {\n    return `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <title>Monthly Beta Feedback - LA Plumb Prep</title>\n        <style>\n          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n          .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n          .header { background: #1a365d; color: white; padding: 20px; text-align: center; }\n          .content { padding: 30px 20px; }\n          .warning-box { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 20px 0; border-radius: 5px; }\n          .cta-button { display: inline-block; background: #3182ce; color: white; text-decoration: none; padding: 15px 30px; border-radius: 5px; font-weight: bold; margin: 20px 0; }\n          .footer { background: #f8f9fa; padding: 15px; text-align: center; font-size: 12px; color: #666; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>ðŸ”§ LA Plumb Prep</h1>\n            <p>Beta Feedback Program</p>\n          </div>\n          \n          <div class=\"content\">\n            <h2>Hi ${firstName}!</h2>\n            \n            <p>It's that time of the month again! As one of our valued beta testers, we need your feedback to continue improving LA Plumb Prep.</p>\n            \n            <div class=\"warning-box\">\n              <strong>âš ï¸ Action Required:</strong> Complete this feedback survey by <strong>${dueDate}</strong> to maintain your beta status and locked-in pricing for all courses.\n            </div>\n            \n            <h3>Why Your Feedback Matters:</h3>\n            <ul>\n              <li>Help shape new features and improvements</li>\n              <li>Report bugs and technical issues</li>\n              <li>Guide our development roadmap</li>\n              <li>Improve the experience for all users</li>\n            </ul>\n            \n            <h3>Beta Tester Benefits (Reminder):</h3>\n            <ul>\n              <li>âœ… Keep your discounted pricing forever</li>\n              <li>âœ… Early access to new features</li>\n              <li>âœ… Direct influence on product development</li>\n              <li>âœ… Priority customer support</li>\n            </ul>\n            \n            <div style=\"text-align: center; margin: 30px 0;\">\n              <a href=\"${feedbackUrl}\" class=\"cta-button\">Complete Monthly Feedback</a>\n            </div>\n            \n            <p><strong>Important:</strong> This survey should only take 3-5 minutes to complete. Your continued participation as a beta tester ensures you maintain your special pricing on all current and future courses.</p>\n            \n            <p>Thank you for being part of our beta program and helping us build the best plumbing education platform!</p>\n            \n            <p>Best regards,<br>The LA Plumb Prep Team</p>\n          </div>\n          \n          <div class=\"footer\">\n            <p>LA Plumb Prep - Official Louisiana Plumbing Certification Preparation</p>\n            <p>This email was sent to beta program participants only.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n  }\n\n  // Monitor and analyze feedback for concerning patterns\n  static async analyzeFeedbackPatterns() {\n    try {\n      // Get recent feedback responses\n      const recentResponses = await db.select({\n        id: betaFeedbackResponses.id,\n        userId: betaFeedbackResponses.userId,\n        campaignId: betaFeedbackResponses.campaignId,\n        responses: betaFeedbackResponses.responses,\n        completedAt: betaFeedbackResponses.completedAt,\n        user: {\n          firstName: users.firstName,\n          lastName: users.lastName,\n          email: users.email\n        }\n      })\n      .from(betaFeedbackResponses)\n      .leftJoin(users, eq(betaFeedbackResponses.userId, users.id))\n      .where(eq(betaFeedbackResponses.campaignId, betaFeedbackResponses.campaignId));\n\n      const alerts: string[] = [];\n      const criticalIssues: string[] = [];\n\n      // Analyze satisfaction scores (Question 1 - Overall experience rating)\n      const satisfactionScores = recentResponses\n        .map(r => {\n          if (typeof r.responses === 'object' && r.responses) {\n            const responses = r.responses as any;\n            return responses['1'] ? parseInt(responses['1']) : null;\n          }\n          return null;\n        })\n        .filter(score => score !== null);\n\n      if (satisfactionScores.length > 0) {\n        const avgSatisfaction = satisfactionScores.reduce((a, b) => a + b, 0) / satisfactionScores.length;\n        const lowScores = satisfactionScores.filter(score => score <= 2).length;\n        const lowScorePercentage = (lowScores / satisfactionScores.length) * 100;\n\n        // Alert thresholds\n        if (avgSatisfaction < 3.0) {\n          criticalIssues.push(`ðŸš¨ CRITICAL: Average satisfaction score is ${avgSatisfaction.toFixed(1)}/5 - Immediate attention required`);\n        } else if (avgSatisfaction < 3.5) {\n          alerts.push(`âš ï¸ Warning: Average satisfaction score declining to ${avgSatisfaction.toFixed(1)}/5`);\n        }\n\n        if (lowScorePercentage > 25) {\n          criticalIssues.push(`ðŸš¨ CRITICAL: ${lowScorePercentage.toFixed(1)}% of users rated experience 2/5 or lower`);\n        } else if (lowScorePercentage > 15) {\n          alerts.push(`âš ï¸ Warning: ${lowScorePercentage.toFixed(1)}% of users giving low satisfaction scores`);\n        }\n      }\n\n      // Check completion rates\n      const campaigns = await db.select()\n        .from(betaFeedbackCampaigns)\n        .where(eq(betaFeedbackCampaigns.isActive, true));\n\n      const latestCampaign = campaigns[campaigns.length - 1];\n      if (latestCampaign) {\n        const campaignResponses = recentResponses.filter(r => r.campaignId === latestCampaign.id);\n        const totalBetaTesters = await db.select().from(users).where(eq(users.isBetaTester, true));\n        const completionRate = (campaignResponses.length / totalBetaTesters.length) * 100;\n\n        if (completionRate < 30) {\n          criticalIssues.push(`ðŸš¨ CRITICAL: Only ${completionRate.toFixed(1)}% feedback completion rate - System may have issues`);\n        } else if (completionRate < 50) {\n          alerts.push(`âš ï¸ Warning: Low feedback completion rate at ${completionRate.toFixed(1)}%`);\n        }\n      }\n\n      // Analyze common improvement requests for bug reports\n      const improvementRequests = recentResponses\n        .map(r => {\n          if (typeof r.responses === 'object' && r.responses) {\n            const responses = r.responses as any;\n            return responses['3'] || ''; // Question 3 - improvement requests\n          }\n          return '';\n        })\n        .filter(text => text.length > 10);\n\n      const problemKeywords = ['bug', 'error', 'broken', 'not working', 'slow', 'crash', 'issue', 'problem'];\n      const bugReports = improvementRequests.filter(text => \n        problemKeywords.some(keyword => text.toLowerCase().includes(keyword))\n      );\n\n      if (bugReports.length > improvementRequests.length * 0.3) {\n        criticalIssues.push(`ðŸš¨ CRITICAL: ${bugReports.length} users reporting bugs or technical issues`);\n      } else if (bugReports.length > 2) {\n        alerts.push(`âš ï¸ Warning: ${bugReports.length} users mentioning technical problems`);\n      }\n\n      return {\n        alerts,\n        criticalIssues,\n        totalResponses: recentResponses.length,\n        avgSatisfaction: satisfactionScores.length > 0 ? satisfactionScores.reduce((a, b) => a + b, 0) / satisfactionScores.length : 0,\n        bugReports: bugReports.length,\n        satisfactionScores\n      };\n    } catch (error) {\n      console.error('Error analyzing feedback patterns:', error);\n      return { alerts: [], criticalIssues: ['ðŸš¨ Error analyzing feedback patterns'], totalResponses: 0, avgSatisfaction: 0, bugReports: 0, satisfactionScores: [] };\n    }\n  }\n\n  // Send alert emails to admin\n  static async sendAdminAlerts(alerts: string[], criticalIssues: string[]) {\n    if (alerts.length === 0 && criticalIssues.length === 0) return;\n\n    const adminEmail = process.env.SUPPORT_EMAIL || 'admin@laplumbprep.com';\n    const subject = criticalIssues.length > 0 \n      ? 'ðŸš¨ CRITICAL: Beta Feedback Alerts Requiring Immediate Attention'\n      : 'âš ï¸ Beta Feedback Monitoring Alerts';\n\n    const content = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n        <h2 style=\"color: #1e40af; margin-bottom: 30px;\">Beta Feedback System Alert</h2>\n        \n        ${criticalIssues.length > 0 ? `\n          <div style=\"background: #fee2e2; border: 2px solid #dc2626; border-radius: 8px; padding: 20px; margin-bottom: 20px;\">\n            <h3 style=\"color: #dc2626; margin-top: 0;\">ðŸš¨ Critical Issues Requiring Immediate Action</h3>\n            <ul style=\"margin: 0;\">\n              ${criticalIssues.map(issue => `<li style=\"color: #7f1d1d; margin-bottom: 8px;\">${issue}</li>`).join('')}\n            </ul>\n          </div>\n        ` : ''}\n        \n        ${alerts.length > 0 ? `\n          <div style=\"background: #fef3c7; border: 2px solid #d97706; border-radius: 8px; padding: 20px; margin-bottom: 20px;\">\n            <h3 style=\"color: #d97706; margin-top: 0;\">âš ï¸ Warning Alerts</h3>\n            <ul style=\"margin: 0;\">\n              ${alerts.map(alert => `<li style=\"color: #92400e; margin-bottom: 8px;\">${alert}</li>`).join('')}\n            </ul>\n          </div>\n        ` : ''}\n        \n        <div style=\"background: #f3f4f6; border-radius: 8px; padding: 20px; margin-top: 20px;\">\n          <h4 style=\"margin-top: 0; color: #374151;\">Recommended Actions:</h4>\n          <ul style=\"color: #6b7280;\">\n            <li>Review detailed feedback responses in the admin dashboard</li>\n            <li>Prioritize fixes for critical issues affecting user satisfaction</li>\n            <li>Consider reaching out directly to users with low satisfaction scores</li>\n            <li>Monitor completion rates for technical issues</li>\n          </ul>\n        </div>\n      </div>\n    `;\n\n    // Queue admin alert email - temporarily disabled to prevent errors\n    console.log(\"Beta feedback admin alert would be sent:\", subject);\n    // TODO: Fix email queue schema issues before re-enabling\n    // await db.insert(emailQueue).values({\n    //   recipientEmail: adminEmail,\n    //   subject,\n    //   content,\n    //   scheduledFor: new Date(),\n    // });\n  }\n\n  // Run automated monitoring and send alerts if needed\n  static async runAutomatedMonitoring() {\n    try {\n      const analysis = await this.analyzeFeedbackPatterns();\n      \n      if (analysis.alerts.length > 0 || analysis.criticalIssues.length > 0) {\n        await this.sendAdminAlerts(analysis.alerts, analysis.criticalIssues);\n        console.log(`Beta feedback monitoring: ${analysis.criticalIssues.length} critical issues, ${analysis.alerts.length} warnings`);\n      }\n      \n      return analysis;\n    } catch (error) {\n      console.error('Error running feedback monitoring:', error);\n      return null;\n    }\n  }\n}\n\n// Initialize the feedback system\nexport const initializeBetaFeedbackSystem = async () => {\n  try {\n    await BetaFeedbackService.initializeDefaultQuestions();\n    console.log(\"Beta feedback system initialized\");\n  } catch (error) {\n    console.error(\"Error initializing beta feedback system:\", error);\n  }\n};","size_bytes":21785},"client/src/pages/admin/admin-dashboard.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\nimport { Users, MessageSquare, BarChart3, Settings, BookOpen, Upload, Clock, FileText, Package } from \"lucide-react\";\n\nexport default function AdminDashboard() {\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Admin Dashboard</h1>\n          <p className=\"text-muted-foreground\">\n            Manage your LA Plumb Prep platform\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BookOpen className=\"h-5 w-5\" />\n                Content Management\n              </CardTitle>\n              <CardDescription>\n                Create and manage course lessons, chapters, and practice questions\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Link href=\"/admin/content\">\n                <Button className=\"w-full\">\n                  Manage Content\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MessageSquare className=\"h-5 w-5\" />\n                Beta Feedback Dashboard\n              </CardTitle>\n              <CardDescription>\n                Monitor beta tester feedback, satisfaction scores, and system alerts\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Link href=\"/admin/beta-feedback\">\n                <Button className=\"w-full\">\n                  View Feedback Dashboard\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                Job Approval\n              </CardTitle>\n              <CardDescription>\n                Review and approve job postings from employers\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Link href=\"/admin/job-approval\">\n                <Button className=\"w-full\">\n                  Review Job Postings\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"h-5 w-5\" />\n                System Analytics\n              </CardTitle>\n              <CardDescription>\n                View platform usage, enrollment metrics, and performance data\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Link href=\"/admin/system-analytics\">\n                <Button className=\"w-full\">\n                  View Analytics Dashboard\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Settings className=\"h-5 w-5\" />\n                System Settings\n              </CardTitle>\n              <CardDescription>\n                Configure platform settings, notifications, and integrations\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Link href=\"/admin/system-settings\">\n                <Button className=\"w-full\">\n                  Configure Settings\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Package className=\"h-5 w-5\" />\n                Store Manager\n              </CardTitle>\n              <CardDescription>\n                Add and manage products for your store by URL\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Link href=\"/admin/store-manager\">\n                <Button className=\"w-full\">\n                  Manage Store Products\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"mt-8 p-4 bg-muted rounded-lg\">\n          <h3 className=\"font-semibold mb-2\">Quick Stats</h3>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n            <div>\n              <div className=\"font-medium\">Beta Testers</div>\n              <div className=\"text-muted-foreground\">Monitoring active</div>\n            </div>\n            <div>\n              <div className=\"font-medium\">Email System</div>\n              <div className=\"text-muted-foreground\">Operational</div>\n            </div>\n            <div>\n              <div className=\"font-medium\">Payment Processing</div>\n              <div className=\"text-muted-foreground\">Active</div>\n            </div>\n            <div>\n              <div className=\"font-medium\">Domain Status</div>\n              <div className=\"text-muted-foreground\">Verified</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5488},"client/src/pages/admin/bulk-flashcard-import.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Upload, FileText, CheckCircle, AlertCircle } from \"lucide-react\";\nimport { PLUMBING_CODE_SECTIONS } from \"@/lib/plumbing-code-sections\";\n\nexport default function BulkFlashcardImport() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [selectedChapter, setSelectedChapter] = useState(\"\");\n  const [selectedSection, setSelectedSection] = useState(\"\");\n  const [selectedDifficulty, setSelectedDifficulty] = useState(\"easy\");\n  const [flashcardsText, setFlashcardsText] = useState(\"\");\n  const [previewFlashcards, setPreviewFlashcards] = useState<any[]>([]);\n  const [importStatus, setImportStatus] = useState<\"idle\" | \"parsing\" | \"previewing\" | \"importing\" | \"success\">(\"idle\");\n\n\n  // Fetch courses\n  const { data: courses } = useQuery({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const bulkImportMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/flashcards/bulk-import\", data),\n    onSuccess: (result: any) => {\n      const { imported, duplicatesSkipped, totalSubmitted } = result;\n      \n      if (duplicatesSkipped > 0) {\n        toast({ \n          title: \"Import completed with duplicates detected\", \n          description: `Added ${imported} new flashcards. Skipped ${duplicatesSkipped} duplicates out of ${totalSubmitted} total.`,\n          variant: \"default\"\n        });\n      } else {\n        toast({ \n          title: \"All flashcards imported successfully!\", \n          description: `Added ${imported} new flashcards to the course.`\n        });\n      }\n      \n      setImportStatus(\"success\");\n      setFlashcardsText(\"\");\n      setPreviewFlashcards([]);\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Import failed\",\n        description: error.message || \"Failed to import flashcards\",\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  });\n\n  const parseFlashcards = () => {\n    if (!flashcardsText.trim()) {\n      toast({\n        title: \"No content\",\n        description: \"Please enter flashcards to parse\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setImportStatus(\"parsing\");\n\n    try {\n      const parsed = parseFlashcardsFromText(flashcardsText);\n      if (parsed.length === 0) {\n        throw new Error(\"No valid flashcards found. Please check the format.\");\n      }\n      \n      setPreviewFlashcards(parsed);\n      setImportStatus(\"previewing\");\n      toast({\n        title: \"Flashcards parsed successfully!\",\n        description: `Found ${parsed.length} flashcards ready for import.`\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Parse error\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  };\n\n  const isSectionValid = selectedSection && selectedSection.trim().length > 0;\n\n  const importFlashcards = () => {\n    if (!selectedCourse) {\n      toast({\n        title: \"No course selected\",\n        description: \"Please select a course first\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!selectedChapter || !selectedSection) {\n      toast({\n        title: \"Chapter and Section required\",\n        description: \"Please select both chapter and section for organization\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!isSectionValid) {\n      toast({\n        title: \"Invalid section number\",\n        description: \"Enter a valid section number (e.g., 101)\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Update flashcards with current chapter and section values to prevent stale data\n    const chapterNumber = parseInt(selectedChapter.match(/\\d+/)?.[0] || '0'); // Extract number from \"Chapter 1\"\n    const sectionNumber = parseInt(selectedSection); // Convert \"101\" to 101\n    \n    const payloadFlashcards = previewFlashcards.map(fc => ({\n      ...fc,\n      chapter: chapterNumber,\n      category: selectedChapter,\n      section: sectionNumber,\n      codeReference: `${selectedChapter} - Section ${selectedSection}`,\n      difficulty: selectedDifficulty\n    }));\n\n    setImportStatus(\"importing\");\n    bulkImportMutation.mutate({\n      courseId: selectedCourse,\n      flashcards: payloadFlashcards\n    });\n  };\n\n  const parseFlashcardsFromText = (text: string) => {\n    const flashcards: any[] = [];\n    \n    // Clean and normalize the text\n    const cleanText = text.trim().replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n    \n    // Split by double blank lines to separate flashcards\n    const cardBlocks = cleanText.split(/\\n\\n\\n+/).filter(block => block.trim());\n    \n    // If no triple blank lines found, try splitting by double blank lines\n    let finalBlocks = cardBlocks;\n    if (cardBlocks.length === 1) {\n      finalBlocks = cleanText.split(/\\n\\n\\n/).filter(block => block.trim());\n    }\n    \n    // If still only one block, try splitting by double newlines and pairing them\n    if (finalBlocks.length === 1) {\n      const singleBlocks = cleanText.split(/\\n\\n/).filter(block => block.trim());\n      finalBlocks = [];\n      // Group every two blocks together (question, answer)\n      for (let i = 0; i < singleBlocks.length; i += 2) {\n        if (singleBlocks[i] && singleBlocks[i + 1]) {\n          finalBlocks.push(`${singleBlocks[i]}\\n\\n${singleBlocks[i + 1]}`);\n        }\n      }\n    }\n    \n    finalBlocks.forEach((block, index) => {\n      const trimmedBlock = block.trim();\n      \n      // Split each block by single blank line to separate question from answer\n      const parts = trimmedBlock.split(/\\n\\n/);\n      \n      if (parts.length >= 2) {\n        const firstPart = parts[0]?.trim();\n        const secondPart = parts.slice(1).join('\\n\\n').trim();\n        \n        // Validate both parts\n        if (firstPart && secondPart && firstPart.length > 2 && secondPart.length > 5) {\n          // Make sure first part looks like a proper question or term\n          const firstPartLines = firstPart.split('\\n').filter(line => line.trim());\n          if (firstPartLines.length <= 3 && firstPart.length < 300) {\n            flashcards.push({\n              id: crypto.randomUUID(),\n              front: firstPart,\n              back: secondPart,\n              createdAt: new Date(),\n            });\n          }\n        }\n      }\n    });\n    \n    return flashcards;\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Bulk Flashcard Import</h1>\n          <p className=\"text-muted-foreground\">\n            Import multiple flashcards at once by copying and pasting terms and definitions\n          </p>\n        </div>\n\n        {/* Course and Chapter/Section Selection */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Course & Louisiana Plumbing Code Organization</CardTitle>\n            <CardDescription>Choose course, chapter, section and difficulty level for all flashcards in this batch</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Label htmlFor=\"course\">Select Course</Label>\n                <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select a course\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {(courses as any[])?.map((course: any) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"chapter\">Chapter</Label>\n                <Select value={selectedChapter} onValueChange={setSelectedChapter}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select chapter\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Chapter 1\">Chapter 1 - Administration</SelectItem>\n                    <SelectItem value=\"Chapter 2\">Chapter 2 - Definitions</SelectItem>\n                    <SelectItem value=\"Chapter 3\">Chapter 3 - General Regulations</SelectItem>\n                    <SelectItem value=\"Chapter 4\">Chapter 4 - Fixtures, Faucets and Fittings</SelectItem>\n                    <SelectItem value=\"Chapter 5\">Chapter 5 - Water Heaters</SelectItem>\n                    <SelectItem value=\"Chapter 6\">Chapter 6 - Water Supply and Distribution</SelectItem>\n                    <SelectItem value=\"Chapter 7\">Chapter 7 - Sanitary Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 8\">Chapter 8 - Indirect/Special Waste</SelectItem>\n                    <SelectItem value=\"Chapter 9\">Chapter 9 - Vents</SelectItem>\n                    <SelectItem value=\"Chapter 10\">Chapter 10 - Traps, Interceptors and Separators</SelectItem>\n                    <SelectItem value=\"Chapter 11\">Chapter 11 - Storm Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 12\">Chapter 12 - Special Piping and Storage Systems</SelectItem>\n                    <SelectItem value=\"Chapter 13\">Chapter 13 - Health Care Facilities and Other Special Occupancies</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"section\">Section</Label>\n                <Input\n                  id=\"section\"\n                  value={selectedSection}\n                  onChange={(e) => setSelectedSection(e.target.value)}\n                  placeholder=\"Enter section number (e.g., 101, 103, 105...)\"\n                  disabled={!selectedChapter}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"difficulty\">Difficulty Level</Label>\n                <Select value={selectedDifficulty} onValueChange={setSelectedDifficulty}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select difficulty\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"easy\">Easy - Basic recall</SelectItem>\n                    <SelectItem value=\"hard\">Hard - Analysis</SelectItem>\n                    <SelectItem value=\"very_hard\">Very Hard - Synthesis</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n\n        {/* Flashcard Input */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Paste Your Flashcards</CardTitle>\n            <CardDescription>Copy and paste multiple flashcards with terms and definitions</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"flashcards\">Flashcards Content</Label>\n                <Textarea\n                  id=\"flashcards\"\n                  value={flashcardsText}\n                  onChange={(e) => setFlashcardsText(e.target.value)}\n                  rows={15}\n                  placeholder={`Paste your flashcards here...\n\nExample:\nLouisiana State Plumbing Code (LSPC)\n\nThis code refers to Part XIV (Plumbing) of the Sanitary Code, State of Louisiana (LAC 51:XIV), which is adopted by the Department of Health and Hospitals, Office of Public Health.\n\n\nWho adopts the LSPC?\n\nThe Department of Health and Hospitals, specifically the Office of Public Health, is responsible for adopting the Louisiana State Plumbing Code.\n\n\nWhen was the LSPC originally promulgated?\n\nThe Louisiana State Plumbing Code was originally promulgated by the Department of Health and Hospitals, Office of Public Health, in June 2002 (LR 28:1383).\n\n\nAuthority for LSPC promulgation\n\nThe primary authority for promulgating the sanitary code, including the LSPC, comes from R.S. 36:258(B) and specific provisions in Chapters 1 and 4 of Title 40 of the Louisiana Revised Statutes.`}\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n              \n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={parseFlashcards}\n                  disabled={!flashcardsText.trim() || importStatus === \"parsing\"}\n                  className=\"flex items-center gap-2\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  {importStatus === \"parsing\" ? \"Parsing...\" : \"Parse Flashcards\"}\n                </Button>\n                \n                {previewFlashcards.length > 0 && (\n                  <Button \n                    onClick={importFlashcards}\n                    disabled={!selectedCourse || importStatus === \"importing\"}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <Upload className=\"h-4 w-4\" />\n                    {importStatus === \"importing\" ? \"Importing...\" : `Import ${previewFlashcards.length} Flashcards`}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Preview */}\n        {previewFlashcards.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                Preview ({previewFlashcards.length} flashcards found)\n              </CardTitle>\n              <CardDescription>Review the parsed flashcards before importing</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                {previewFlashcards.map((card, index) => (\n                  <div key={index} className=\"border rounded-lg p-4\">\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n                      <div>\n                        <h4 className=\"font-semibold text-blue-600 mb-2\">Front (Term)</h4>\n                        <p className=\"text-sm bg-blue-50 p-3 rounded\">\n                          {card.front}\n                        </p>\n                      </div>\n                      <div>\n                        <h4 className=\"font-semibold text-green-600 mb-2\">Back (Definition)</h4>\n                        <p className=\"text-sm bg-green-50 p-3 rounded\">\n                          {card.back}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {importStatus === \"success\" && (\n          <Alert className=\"mt-6\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Flashcards imported successfully! You can now view them in the Content Management section.\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":15986},"client/src/pages/admin/bulk-question-import.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Upload, FileText, CheckCircle, AlertCircle } from \"lucide-react\";\nimport { PLUMBING_CODE_SECTIONS } from \"@/lib/plumbing-code-sections\";\n\nexport default function BulkQuestionImport() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [questionsText, setQuestionsText] = useState(\"\");\n  const [previewQuestions, setPreviewQuestions] = useState<any[]>([]);\n  const [importStatus, setImportStatus] = useState<\"idle\" | \"parsing\" | \"previewing\" | \"importing\" | \"success\">(\"idle\");\n  const [selectedDifficulty, setSelectedDifficulty] = useState(\"easy\");\n  const [selectedChapter, setSelectedChapter] = useState(\"\");\n  const [selectedSection, setSelectedSection] = useState(\"\");\n\n  // Fetch courses\n  const { data: courses } = useQuery({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const bulkImportMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/questions/bulk-import\", data),\n    onSuccess: (result: any) => {\n      const { imported, duplicatesSkipped, totalSubmitted } = result;\n      \n      if (duplicatesSkipped > 0) {\n        toast({ \n          title: \"Import completed with duplicates detected\", \n          description: `Added ${imported} new questions. Skipped ${duplicatesSkipped} duplicates out of ${totalSubmitted} total.`,\n          variant: \"default\"\n        });\n      } else {\n        toast({ \n          title: \"All questions imported successfully!\", \n          description: `Added ${imported} new questions to the course.`\n        });\n      }\n      \n      setImportStatus(\"success\");\n      setQuestionsText(\"\");\n      setPreviewQuestions([]);\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Import failed\",\n        description: error.message || \"Failed to import questions\",\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  });\n\n  const parseQuestions = () => {\n    if (!questionsText.trim()) {\n      toast({\n        title: \"No content\",\n        description: \"Please enter questions to parse\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setImportStatus(\"parsing\");\n\n    try {\n      // Parse the text input into structured questions\n      const parsed = parseQuestionsFromText(questionsText);\n      if (parsed.length === 0) {\n        throw new Error(\"No valid questions found. Please check the format.\");\n      }\n      \n      setPreviewQuestions(parsed);\n      setImportStatus(\"previewing\");\n      toast({\n        title: \"Questions parsed successfully!\",\n        description: `Found ${parsed.length} questions ready for import.`\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Parse error\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  };\n\n  const isSectionValid = selectedSection && selectedSection.trim().length > 0;\n\n  const importQuestions = () => {\n    if (!selectedCourse) {\n      toast({\n        title: \"No course selected\",\n        description: \"Please select a course first\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!selectedChapter || !selectedSection) {\n      toast({\n        title: \"Chapter and Section required\",\n        description: \"Please select both chapter and section for organization\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!isSectionValid) {\n      toast({\n        title: \"Invalid section number\",\n        description: \"Enter a valid section number (e.g., 101)\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Update questions with current chapter and section values to prevent stale data\n    const payloadQuestions = previewQuestions.map(q => ({\n      ...q,\n      chapter: selectedChapter,\n      category: selectedChapter,\n      section: selectedSection,\n      codeReference: `${selectedChapter} - Section ${selectedSection}`\n    }));\n\n    setImportStatus(\"importing\");\n    bulkImportMutation.mutate({\n      courseId: selectedCourse,\n      questions: payloadQuestions\n    });\n  };\n\n  const parseQuestionsFromText = (text: string) => {\n    const questions: any[] = [];\n    \n    // Split by double newlines to separate questions\n    const questionBlocks = text.split(/\\n\\s*\\n/).filter(block => block.trim());\n    \n    questionBlocks.forEach((block, index) => {\n      const lines = block.trim().split('\\n').filter(line => line.trim());\n      if (lines.length < 6) return; // Need question + 4 options + answer line\n      \n      // Extract question text (first line)\n      const questionText = lines[0].trim();\n      if (!questionText) return;\n      \n      // Extract options (A., B., C., D.)\n      const options: string[] = [];\n      let answerLine = '';\n      \n      for (let i = 1; i < lines.length; i++) {\n        const line = lines[i].trim();\n        \n        // Check if this is the ANSWER line\n        if (line.startsWith('ANSWER:')) {\n          answerLine = line;\n          break;\n        }\n        \n        // Match option patterns: A., B., C., D.\n        const optionMatch = line.match(/^([A-D])\\. (.+)$/i);\n        \n        if (optionMatch) {\n          const optionText = optionMatch[2].trim();\n          options.push(optionText);\n        }\n      }\n      \n      // Extract correct answer from ANSWER line\n      let correctAnswer = 0;\n      if (answerLine) {\n        const answerMatch = answerLine.match(/ANSWER:\\s*([A-D])/i);\n        if (answerMatch) {\n          const answerLetter = answerMatch[1].toUpperCase();\n          correctAnswer = answerLetter.charCodeAt(0) - 65; // A=0, B=1, C=2, D=3\n        }\n      }\n      \n      // Only add if we have exactly 4 options\n      if (options.length === 4 && answerLine) {\n        questions.push({\n          question: questionText,  // Use 'question' field to match backend expectations\n          questionText,            // Keep for compatibility\n          options,\n          correctAnswer,\n          difficulty: selectedDifficulty,\n          chapter: selectedChapter,\n          section: selectedSection,\n          category: selectedChapter,\n          codeReference: `${selectedChapter} - ${selectedSection}`,\n          explanation: `Explanation for question ${index + 1}`\n        });\n      }\n    });\n    \n    return questions;\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Bulk Question Import</h1>\n          <p className=\"text-muted-foreground\">\n            Import multiple questions at once by copying and pasting\n          </p>\n        </div>\n\n        {/* Course and Difficulty Selection */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Course & Difficulty Settings</CardTitle>\n            <CardDescription>Choose course and set difficulty level for all questions in this batch</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Label htmlFor=\"course\">Select Course</Label>\n                <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select a course\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {(courses as any[])?.map((course: any) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"chapter\">Chapter</Label>\n                <Select value={selectedChapter} onValueChange={setSelectedChapter}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select chapter\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Chapter 1\">Chapter 1 - Administration</SelectItem>\n                    <SelectItem value=\"Chapter 2\">Chapter 2 - Definitions</SelectItem>\n                    <SelectItem value=\"Chapter 3\">Chapter 3 - General Regulations</SelectItem>\n                    <SelectItem value=\"Chapter 4\">Chapter 4 - Fixtures, Faucets and Fittings</SelectItem>\n                    <SelectItem value=\"Chapter 5\">Chapter 5 - Water Heaters</SelectItem>\n                    <SelectItem value=\"Chapter 6\">Chapter 6 - Water Supply and Distribution</SelectItem>\n                    <SelectItem value=\"Chapter 7\">Chapter 7 - Sanitary Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 8\">Chapter 8 - Indirect/Special Waste</SelectItem>\n                    <SelectItem value=\"Chapter 9\">Chapter 9 - Vents</SelectItem>\n                    <SelectItem value=\"Chapter 10\">Chapter 10 - Traps, Interceptors and Separators</SelectItem>\n                    <SelectItem value=\"Chapter 11\">Chapter 11 - Storm Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 12\">Chapter 12 - Special Piping and Storage Systems</SelectItem>\n                    <SelectItem value=\"Chapter 13\">Chapter 13 - Referenced Standards</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"section\">Section</Label>\n                <Input\n                  id=\"section\"\n                  value={selectedSection}\n                  onChange={(e) => setSelectedSection(e.target.value)}\n                  placeholder=\"Enter section number (e.g., 101, 103, 105...)\"\n                  disabled={!selectedChapter}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"difficulty\">Question Difficulty</Label>\n                <Select value={selectedDifficulty} onValueChange={setSelectedDifficulty}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"easy\">Easy</SelectItem>\n                    <SelectItem value=\"hard\">Hard</SelectItem>\n                    <SelectItem value=\"very_hard\">Very Hard</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n\n        {/* Question Input */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Paste Your Questions</CardTitle>\n            <CardDescription>Copy and paste multiple questions with their answer choices</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"questions\">Questions and Answers</Label>\n                <Textarea\n                  id=\"questions\"\n                  value={questionsText}\n                  onChange={(e) => setQuestionsText(e.target.value)}\n                  rows={15}\n                  placeholder=\"Paste your questions here...\n\nExample:\nWhich specific statutory provision grants the primary authority?\nA. LAC 51:XIV\nB. R.S. 40:5(2)(3)(7)(9)(16)(17)(20)\nC. R.S. 36:258(B)\nD. R.S. 40:4(A)(7)\nANSWER: C\n\nUnder what precise regulatory nomenclature is the code adopted?\nA. Chapters 1 and 4 of Title 40\nB. Louisiana Revised Statutes Title 40\nC. Part XIV (Plumbing) of the Sanitary Code\nD. Louisiana State Plumbing Code (LSPC)\nANSWER: C\"\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n              \n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={parseQuestions}\n                  disabled={!questionsText.trim() || importStatus === \"parsing\"}\n                  className=\"flex items-center gap-2\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  {importStatus === \"parsing\" ? \"Parsing...\" : \"Parse Questions\"}\n                </Button>\n                \n                {previewQuestions.length > 0 && (\n                  <Button \n                    onClick={importQuestions}\n                    disabled={!selectedCourse || !selectedChapter || !isSectionValid || importStatus === \"importing\"}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <Upload className=\"h-4 w-4\" />\n                    {importStatus === \"importing\" ? \"Importing...\" : `Import ${previewQuestions.length} Questions`}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Preview */}\n        {previewQuestions.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                Preview ({previewQuestions.length} questions found)\n              </CardTitle>\n              <CardDescription>\n                Review the parsed questions before importing. Questions will be organized under {selectedChapter} - Section {selectedSection || 'â€”'}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6 max-h-96 overflow-y-auto\">\n                {previewQuestions.map((question, index) => (\n                  <div key={index} className=\"border rounded-lg p-4\">\n                    <div className=\"flex justify-between items-start mb-3\">\n                      <h3 className=\"font-semibold\">\n                        Question {index + 1}: {question.questionText}\n                      </h3>\n                      <div className=\"flex gap-2 text-xs\">\n                        <span className=\"bg-blue-100 text-blue-700 px-2 py-1 rounded\">{selectedChapter}</span>\n                        <span className=\"bg-purple-100 text-purple-700 px-2 py-1 rounded\">Section {selectedSection}</span>\n                        <span className={`px-2 py-1 rounded ${\n                          question.difficulty === 'easy' ? 'bg-green-100 text-green-700' :\n                          question.difficulty === 'hard' ? 'bg-orange-100 text-orange-700' :\n                          'bg-red-100 text-red-700'\n                        }`}>\n                          {question.difficulty}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n                      {question.options.map((option: string, optIndex: number) => (\n                        <div\n                          key={optIndex}\n                          className={`p-2 rounded text-sm ${\n                            optIndex === question.correctAnswer\n                              ? 'bg-green-100 text-green-800 font-semibold'\n                              : 'bg-muted'\n                          }`}\n                        >\n                          {String.fromCharCode(65 + optIndex)}. {option}\n                          {optIndex === question.correctAnswer && ' âœ“'}\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {importStatus === \"success\" && (\n          <Alert className=\"mt-6\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Questions imported successfully! You can now view them in the Content Management section.\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":16541},"client/src/pages/admin/bulk-studynotes-import.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Upload, FileText, CheckCircle, AlertCircle, BookOpen } from \"lucide-react\";\nimport { PLUMBING_CODE_SECTIONS } from \"@/lib/plumbing-code-sections\";\n\nexport default function BulkStudyNotesImport() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [selectedChapter, setSelectedChapter] = useState(\"\");\n  const [selectedSection, setSelectedSection] = useState(\"\");\n  const [selectedDifficulty, setSelectedDifficulty] = useState(\"medium\");\n  const [studyNotesText, setStudyNotesText] = useState(\"\");\n  const [previewNotes, setPreviewNotes] = useState<any[]>([]);\n  const [importStatus, setImportStatus] = useState<\"idle\" | \"parsing\" | \"previewing\" | \"importing\" | \"success\">(\"idle\");\n\n\n  // Fetch courses\n  const { data: courses } = useQuery({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const bulkImportMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/study-notes/bulk-import\", data),\n    onSuccess: (result: any) => {\n      const { imported, duplicatesSkipped, totalSubmitted } = result;\n      \n      if (duplicatesSkipped > 0) {\n        toast({ \n          title: \"Import completed with duplicates detected\", \n          description: `Added ${imported} new study notes. Skipped ${duplicatesSkipped} duplicates out of ${totalSubmitted} total.`,\n          variant: \"default\"\n        });\n      } else {\n        toast({ \n          title: \"All study notes imported successfully!\", \n          description: `Added ${imported} new study notes to the course.`\n        });\n      }\n      \n      setImportStatus(\"success\");\n      setStudyNotesText(\"\");\n      setPreviewNotes([]);\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Import failed\",\n        description: error.message || \"Failed to import study notes\",\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  });\n\n  const parseStudyNotes = () => {\n    if (!studyNotesText.trim()) {\n      toast({\n        title: \"No content\",\n        description: \"Please enter study notes to parse\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setImportStatus(\"parsing\");\n\n    try {\n      const parsed = parseStudyNotesFromText(studyNotesText);\n      if (parsed.length === 0) {\n        throw new Error(\"No valid study notes found. Please check the format.\");\n      }\n      \n      setPreviewNotes(parsed);\n      setImportStatus(\"previewing\");\n      toast({\n        title: \"Study notes parsed successfully!\",\n        description: `Found ${parsed.length} study note sections ready for import.`\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Parse error\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  };\n\n  const isSectionValid = selectedSection && selectedSection.trim().length > 0;\n\n  const importStudyNotes = () => {\n    if (!selectedCourse) {\n      toast({\n        title: \"No course selected\",\n        description: \"Please select a course first\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!selectedChapter || !selectedSection) {\n      toast({\n        title: \"Chapter and Section required\",\n        description: \"Please select both chapter and section for organization\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!isSectionValid) {\n      toast({\n        title: \"Invalid section number\",\n        description: \"Enter a valid section number (e.g., 101)\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Update study notes with current chapter and section values to prevent stale data\n    // Extract chapter number from \"Chapter 1\" format to integer\n    const chapterNumber = parseInt(selectedChapter.replace('Chapter ', ''));\n    const sectionNumber = parseInt(selectedSection);\n    \n    const payloadNotes = previewNotes.map(note => ({\n      ...note,\n      chapter: chapterNumber,\n      category: selectedChapter,\n      section: sectionNumber,\n      codeReference: `${selectedChapter} - Section ${selectedSection}`,\n      difficulty: selectedDifficulty\n    }));\n\n    setImportStatus(\"importing\");\n    bulkImportMutation.mutate({\n      courseId: selectedCourse,\n      studyNotes: payloadNotes\n    });\n  };\n\n  const parseStudyNotesFromText = (text: string) => {\n    const studyNotes: any[] = [];\n    \n    // Split by sections (identified by main headings)\n    const sections = text.split(/\\n(?=[A-Z][a-zA-Z\\s]+\\n)/);\n    \n    sections.forEach((section, index) => {\n      const lines = section.trim().split('\\n').filter(line => line.trim());\n      if (lines.length < 2) return;\n      \n      // First line is typically the main heading\n      const title = lines[0].trim();\n      if (!title || title.length < 3) return;\n      \n      // Collect content (everything after the title)\n      const contentLines = lines.slice(1);\n      const content = contentLines.join('\\n').trim();\n      \n      if (content.length > 10) {\n        studyNotes.push({\n          id: crypto.randomUUID(),\n          title: title,\n          content: content,\n          type: 'study_notes',\n          createdAt: new Date(),\n        });\n      }\n    });\n    \n    // If no clear sections found, try parsing by paragraph structure\n    if (studyNotes.length === 0) {\n      const paragraphs = text.split(/\\n\\s*\\n/).filter(p => p.trim());\n      \n      paragraphs.forEach((paragraph, index) => {\n        const lines = paragraph.trim().split('\\n');\n        if (lines.length < 2) return;\n        \n        // Use first line as title, rest as content\n        const title = lines[0].trim();\n        const content = lines.slice(1).join('\\n').trim();\n        \n        if (title.length > 3 && content.length > 10) {\n          studyNotes.push({\n            id: crypto.randomUUID(),\n            title: title,\n            content: content,\n            type: 'study_notes',\n            createdAt: new Date(),\n          });\n        }\n      });\n    }\n    \n    return studyNotes;\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Bulk Study Notes Import</h1>\n          <p className=\"text-muted-foreground\">\n            Import structured study notes with headings and content sections\n          </p>\n        </div>\n\n        {/* Course and Chapter/Section Selection */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Course & Louisiana Plumbing Code Organization</CardTitle>\n            <CardDescription>Choose course, chapter, section and difficulty level for all study notes in this batch</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Label htmlFor=\"course\">Select Course</Label>\n                <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select a course\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {(courses as any[])?.map((course: any) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"chapter\">Chapter</Label>\n                <Select value={selectedChapter} onValueChange={setSelectedChapter}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select chapter\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Chapter 1\">Chapter 1 - Administration</SelectItem>\n                    <SelectItem value=\"Chapter 2\">Chapter 2 - Definitions</SelectItem>\n                    <SelectItem value=\"Chapter 3\">Chapter 3 - General Regulations</SelectItem>\n                    <SelectItem value=\"Chapter 4\">Chapter 4 - Fixtures, Faucets and Fittings</SelectItem>\n                    <SelectItem value=\"Chapter 5\">Chapter 5 - Water Heaters</SelectItem>\n                    <SelectItem value=\"Chapter 6\">Chapter 6 - Water Supply and Distribution</SelectItem>\n                    <SelectItem value=\"Chapter 7\">Chapter 7 - Sanitary Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 8\">Chapter 8 - Indirect/Special Waste</SelectItem>\n                    <SelectItem value=\"Chapter 9\">Chapter 9 - Vents</SelectItem>\n                    <SelectItem value=\"Chapter 10\">Chapter 10 - Traps, Interceptors and Separators</SelectItem>\n                    <SelectItem value=\"Chapter 11\">Chapter 11 - Storm Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 12\">Chapter 12 - Special Piping and Storage Systems</SelectItem>\n                    <SelectItem value=\"Chapter 13\">Chapter 13 - Health Care Facilities and Other Special Occupancies</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"section\">Section</Label>\n                <Input\n                  id=\"section\"\n                  value={selectedSection}\n                  onChange={(e) => setSelectedSection(e.target.value)}\n                  placeholder=\"Enter section number (e.g., 101, 103, 105...)\"\n                  disabled={!selectedChapter}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"difficulty\">Difficulty Level</Label>\n                <Select value={selectedDifficulty} onValueChange={setSelectedDifficulty}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select difficulty\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"easy\">Easy - Basic recall</SelectItem>\n                    <SelectItem value=\"hard\">Hard - Analysis</SelectItem>\n                    <SelectItem value=\"very_hard\">Very Hard - Synthesis</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n\n        {/* Study Notes Input */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Paste Your Study Notes</CardTitle>\n            <CardDescription>Copy and paste structured study notes with headings and content</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"studynotes\">Study Notes Content</Label>\n                <Textarea\n                  id=\"studynotes\"\n                  value={studyNotesText}\n                  onChange={(e) => setStudyNotesText(e.target.value)}\n                  rows={15}\n                  placeholder={`Paste your study notes here...\n\nExample:\nLouisiana State Plumbing Code (LSPC) Adoption\nThe Louisiana State Plumbing Code (LSPC) is established under Chapter 1, Subchapter A, General, Â§101 of administrative regulations.\nThe Department of Health and Hospitals, Office of Public Health, formally adopts Part XIV (Plumbing) of the Sanitary Code for the state of Louisiana.\n\nAuthority and Promulgation\nThe primary legal authority for establishing the sanitary code is R.S. 36:258(B).\nAdditional provisions concerning the code are detailed in Chapters 1 and 4 of Title 40 of the Louisiana Revised Statutes.\n\nLegal Framework\nThis Part of the code is promulgated following R.S. 40:4(A)(7) and R.S. 40:5(2)(3)(7)(9)(16)(17)(20).\nThe Department of Health and Hospitals, Office of Public Health, initially promulgated this code in June 2002.`}\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n              \n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={parseStudyNotes}\n                  disabled={!studyNotesText.trim() || importStatus === \"parsing\"}\n                  className=\"flex items-center gap-2\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  {importStatus === \"parsing\" ? \"Parsing...\" : \"Parse Study Notes\"}\n                </Button>\n                \n                {previewNotes.length > 0 && (\n                  <Button \n                    onClick={importStudyNotes}\n                    disabled={!selectedCourse || importStatus === \"importing\"}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <Upload className=\"h-4 w-4\" />\n                    {importStatus === \"importing\" ? \"Importing...\" : `Import ${previewNotes.length} Sections`}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Preview */}\n        {previewNotes.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                Preview ({previewNotes.length} study note sections found)\n              </CardTitle>\n              <CardDescription>Review the parsed study notes before importing</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                {previewNotes.map((note, index) => (\n                  <div key={index} className=\"border rounded-lg p-4\">\n                    <div className=\"space-y-3\">\n                      <div>\n                        <h4 className=\"font-semibold text-blue-600 mb-2\">Title</h4>\n                        <p className=\"text-sm bg-blue-50 p-3 rounded font-medium\">\n                          {note.title}\n                        </p>\n                      </div>\n                      <div>\n                        <h4 className=\"font-semibold text-green-600 mb-2\">Content</h4>\n                        <div className=\"text-sm bg-green-50 p-3 rounded whitespace-pre-line\">\n                          {note.content}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {importStatus === \"success\" && (\n          <Alert className=\"mt-6\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Study notes imported successfully! You can now view them in the Content Management section.\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":15596},"client/src/components/StudyPlanSelector.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Clock, Play, BookOpen } from \"lucide-react\";\nimport { StudyPlanTimer } from \"./StudyPlanTimer\";\n\ninterface StudyPlan {\n  id: string;\n  title: string;\n  content: string;\n  duration: number;\n}\n\ninterface StudyPlanSelectorProps {\n  studyPlans: StudyPlan[];\n  lessonTitle: string;\n  onStartSession?: (studyPlan: StudyPlan) => void;\n  onCompleteSession?: () => void;\n}\n\nexport function StudyPlanSelector({ \n  studyPlans, \n  lessonTitle, \n  onStartSession, \n  onCompleteSession \n}: StudyPlanSelectorProps) {\n  const [selectedPlan, setSelectedPlan] = useState<StudyPlan | null>(null);\n  const [isTimerActive, setIsTimerActive] = useState(false);\n\n  // Group study plans by duration for easy selection\n  const groupedPlans = studyPlans.reduce((acc, plan) => {\n    const duration = plan.duration;\n    if (!acc[duration]) acc[duration] = [];\n    acc[duration].push(plan);\n    return acc;\n  }, {} as Record<number, StudyPlan[]>);\n\n  const durations = Object.keys(groupedPlans).map(Number).sort((a, b) => a - b);\n\n  const handleSelectPlan = (plan: StudyPlan) => {\n    setSelectedPlan(plan);\n    setIsTimerActive(true);\n    if (onStartSession) {\n      onStartSession(plan);\n    }\n  };\n\n  const handleTimerComplete = () => {\n    setIsTimerActive(false);\n    setSelectedPlan(null);\n    if (onCompleteSession) {\n      onCompleteSession();\n    }\n  };\n\n  if (isTimerActive && selectedPlan) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold\">Active Study Session</h3>\n          <Button \n            variant=\"outline\" \n            onClick={() => setIsTimerActive(false)}\n            data-testid=\"exit-timer\"\n          >\n            Exit Timer\n          </Button>\n        </div>\n        <StudyPlanTimer\n          studyPlan={selectedPlan}\n          onComplete={handleTimerComplete}\n        />\n      </div>\n    );\n  }\n\n  if (studyPlans.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"text-center py-8\">\n          <BookOpen className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n          <h3 className=\"text-lg font-semibold mb-2\">No Study Plans Available</h3>\n          <p className=\"text-muted-foreground\">\n            Study plans for this lesson haven't been created yet.\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h3 className=\"text-lg font-semibold mb-2\">Choose Your Study Time</h3>\n        <p className=\"text-muted-foreground\">\n          Select how much time you have to study <strong>{lessonTitle}</strong> today\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {durations.map(duration => {\n          const plansForDuration = groupedPlans[duration];\n          const primaryPlan = plansForDuration[0]; // Use first plan as primary\n          \n          return (\n            <Card \n              key={duration}\n              className=\"hover:shadow-lg transition-shadow cursor-pointer\"\n              onClick={() => handleSelectPlan(primaryPlan)}\n              data-testid={`study-plan-${duration}`}\n            >\n              <CardHeader className=\"text-center\">\n                <div className=\"flex items-center justify-center mb-2\">\n                  <Clock className=\"h-8 w-8 text-primary\" />\n                </div>\n                <CardTitle className=\"text-2xl font-bold\">\n                  {duration} minutes\n                </CardTitle>\n                <CardDescription>\n                  Focused study session\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <div className=\"space-y-3\">\n                  <Badge variant=\"outline\" className=\"mb-2\">\n                    {plansForDuration.length} plan{plansForDuration.length > 1 ? 's' : ''} available\n                  </Badge>\n                  \n                  <div className=\"text-sm text-muted-foreground\">\n                    {primaryPlan.title}\n                  </div>\n                  \n                  <Button \n                    className=\"w-full flex items-center justify-center gap-2\"\n                    data-testid={`start-${duration}-min`}\n                  >\n                    <Play className=\"h-4 w-4\" />\n                    Start {duration}-Min Session\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {/* Quick Preview of Available Plans */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Available Study Plans</CardTitle>\n          <CardDescription>\n            Structured learning sessions tailored to your available time\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2\">\n            {studyPlans.map((plan, index) => (\n              <div\n                key={plan.id}\n                className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\"\n                data-testid={`plan-preview-${index}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <Badge variant=\"secondary\">\n                    {plan.duration} min\n                  </Badge>\n                  <span className=\"font-medium text-sm\">{plan.title}</span>\n                </div>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleSelectPlan(plan)}\n                  className=\"flex items-center gap-1\"\n                >\n                  <Play className=\"h-3 w-3\" />\n                  Start\n                </Button>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":6076},"client/src/components/StudyPlanTimer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Clock, Play, Pause, RotateCcw, CheckCircle, AlertCircle, SkipForward } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface StudyPlanTimerProps {\n  studyPlan: {\n    id: string;\n    title: string;\n    content: string;\n    duration: number;\n  };\n  onComplete?: () => void;\n  onTimeUpdate?: (remainingSeconds: number) => void;\n}\n\ninterface StudySection {\n  title: string;\n  content: string;\n  startMinute: number;\n  endMinute: number;\n  completed: boolean;\n}\n\nexport function StudyPlanTimer({ studyPlan, onComplete, onTimeUpdate }: StudyPlanTimerProps) {\n  const { toast } = useToast();\n  const [isActive, setIsActive] = useState(false);\n  const [timeRemaining, setTimeRemaining] = useState(studyPlan.duration * 60); // Convert to seconds\n  const [currentSectionIndex, setCurrentSectionIndex] = useState(0);\n  const [sections, setSections] = useState<StudySection[]>([]);\n  const intervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  // Parse study plan content into timed sections\n  useEffect(() => {\n    const parsedSections = parseStudyPlanSections(studyPlan.content, studyPlan.duration);\n    setSections(parsedSections);\n  }, [studyPlan]);\n\n  // Timer logic\n  useEffect(() => {\n    if (isActive && timeRemaining > 0) {\n      intervalRef.current = setInterval(() => {\n        setTimeRemaining((prevTime) => {\n          const newTime = prevTime - 1;\n          onTimeUpdate?.(newTime);\n          \n          // Check if we should move to next section\n          const currentMinute = studyPlan.duration - Math.floor(newTime / 60);\n          const currentSection = sections.find((section, index) => \n            currentMinute >= section.startMinute && currentMinute < section.endMinute && index === currentSectionIndex\n          );\n          \n          if (!currentSection && currentSectionIndex < sections.length - 1) {\n            const nextSectionIndex = sections.findIndex((section, index) => \n              currentMinute >= section.startMinute && currentMinute < section.endMinute && index > currentSectionIndex\n            );\n            \n            if (nextSectionIndex !== -1) {\n              setCurrentSectionIndex(nextSectionIndex);\n              markSectionComplete(currentSectionIndex);\n              toast({\n                title: \"Section Complete!\",\n                description: `Moving to: ${sections[nextSectionIndex].title}`,\n              });\n            }\n          }\n          \n          return newTime;\n        });\n      }, 1000);\n    } else {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    };\n  }, [isActive, currentSectionIndex, sections, onTimeUpdate, studyPlan.duration, toast]);\n\n  // Handle timer completion\n  useEffect(() => {\n    if (timeRemaining === 0) {\n      setIsActive(false);\n      markSectionComplete(currentSectionIndex);\n      toast({\n        title: \"Study Session Complete!\",\n        description: `You've completed the ${studyPlan.duration}-minute study plan.`,\n        duration: 5000,\n      });\n      onComplete?.();\n    }\n  }, [timeRemaining, currentSectionIndex, studyPlan.duration, toast, onComplete]);\n\n  const parseStudyPlanSections = (content: string, totalDuration: number): StudySection[] => {\n    const lines = content.split('\\n');\n    const sectionMatches: StudySection[] = [];\n    \n    // Look for \"Minutes X-Y:\" patterns\n    lines.forEach((line, index) => {\n      const minuteMatch = line.match(/Minutes?\\s+(\\d+)-(\\d+):\\s*(.+)/i);\n      if (minuteMatch) {\n        const startMinute = parseInt(minuteMatch[1]);\n        const endMinute = parseInt(minuteMatch[2]);\n        const title = minuteMatch[3].trim();\n        \n        // Get content for this section (next few lines until next section or end)\n        let sectionContent = \"\";\n        for (let i = index + 1; i < lines.length; i++) {\n          if (lines[i].match(/Minutes?\\s+\\d+-\\d+:/i)) break;\n          sectionContent += lines[i] + \"\\n\";\n        }\n        \n        sectionMatches.push({\n          title,\n          content: sectionContent.trim(),\n          startMinute,\n          endMinute,\n          completed: false\n        });\n      }\n    });\n    \n    // If no minute patterns found, create sections based on duration\n    if (sectionMatches.length === 0) {\n      const defaultSections = Math.max(3, Math.floor(totalDuration / 5)); // 5-minute sections minimum\n      const sectionDuration = totalDuration / defaultSections;\n      \n      for (let i = 0; i < defaultSections; i++) {\n        sectionMatches.push({\n          title: `Section ${i + 1}`,\n          content: content.substring(i * 100, (i + 1) * 100) + \"...\",\n          startMinute: Math.floor(i * sectionDuration),\n          endMinute: Math.floor((i + 1) * sectionDuration),\n          completed: false\n        });\n      }\n    }\n    \n    return sectionMatches;\n  };\n\n  const markSectionComplete = (sectionIndex: number) => {\n    setSections(prev => prev.map((section, index) => \n      index === sectionIndex ? { ...section, completed: true } : section\n    ));\n  };\n\n  const toggleTimer = () => {\n    setIsActive(!isActive);\n  };\n\n  const resetTimer = () => {\n    setIsActive(false);\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current);\n      intervalRef.current = null;\n    }\n    setTimeRemaining(studyPlan.duration * 60);\n    setCurrentSectionIndex(0);\n    setSections(prev => prev.map(section => ({ ...section, completed: false })));\n  };\n\n  const skipToNextSection = () => {\n    if (currentSectionIndex < sections.length - 1) {\n      markSectionComplete(currentSectionIndex);\n      setCurrentSectionIndex(currentSectionIndex + 1);\n      toast({\n        title: \"Skipped to Next Section\",\n        description: sections[currentSectionIndex + 1]?.title,\n      });\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const currentSection = sections[currentSectionIndex];\n  const progressPercentage = ((studyPlan.duration * 60 - timeRemaining) / (studyPlan.duration * 60)) * 100;\n  const completedSections = sections.filter(s => s.completed).length;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Timer Display */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Clock className=\"h-5 w-5\" />\n            {studyPlan.title}\n          </CardTitle>\n          <CardDescription>\n            {studyPlan.duration}-minute focused study session\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center space-y-4\">\n            <div className=\"text-6xl font-bold text-primary\" data-testid=\"timer-display\">\n              {formatTime(timeRemaining)}\n            </div>\n            \n            <Progress value={progressPercentage} className=\"h-3\" />\n            \n            <div className=\"flex items-center justify-center gap-2 text-sm text-muted-foreground\">\n              <span>{completedSections} of {sections.length} sections completed</span>\n              <Badge variant={isActive ? \"default\" : \"secondary\"}>\n                {isActive ? \"Active\" : \"Paused\"}\n              </Badge>\n            </div>\n            \n            <div className=\"flex justify-center gap-2\">\n              <Button\n                onClick={toggleTimer}\n                variant={isActive ? \"secondary\" : \"default\"}\n                className=\"flex items-center gap-2\"\n                data-testid=\"timer-toggle\"\n              >\n                {isActive ? <Pause className=\"h-4 w-4\" /> : <Play className=\"h-4 w-4\" />}\n                {isActive ? \"Pause\" : \"Start\"}\n              </Button>\n              \n              <Button\n                onClick={resetTimer}\n                variant=\"outline\"\n                className=\"flex items-center gap-2\"\n                data-testid=\"timer-reset\"\n              >\n                <RotateCcw className=\"h-4 w-4\" />\n                Reset\n              </Button>\n              \n              {currentSectionIndex < sections.length - 1 && (\n                <Button\n                  onClick={skipToNextSection}\n                  variant=\"outline\"\n                  className=\"flex items-center gap-2\"\n                  data-testid=\"timer-skip\"\n                >\n                  <SkipForward className=\"h-4 w-4\" />\n                  Skip Section\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Current Section */}\n      {currentSection && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center justify-between\">\n              <span className=\"flex items-center gap-2\">\n                <CheckCircle className={`h-5 w-5 ${currentSection.completed ? 'text-green-600' : 'text-muted-foreground'}`} />\n                Current Focus: {currentSection.title}\n              </span>\n              <Badge variant=\"outline\">\n                Minutes {currentSection.startMinute}-{currentSection.endMinute}\n              </Badge>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"whitespace-pre-line text-sm leading-relaxed\">\n              {currentSection.content}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Section Overview */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Study Plan Sections</CardTitle>\n          <CardDescription>Track your progress through each focus area</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2\">\n            {sections.map((section, index) => (\n              <div\n                key={index}\n                className={`flex items-center justify-between p-3 rounded-lg border ${\n                  index === currentSectionIndex \n                    ? 'border-primary bg-primary/5' \n                    : section.completed \n                      ? 'border-green-200 bg-green-50' \n                      : 'border-gray-200'\n                }`}\n                data-testid={`section-${index}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-semibold ${\n                    section.completed \n                      ? 'bg-green-600 text-white' \n                      : index === currentSectionIndex \n                        ? 'bg-primary text-white' \n                        : 'bg-gray-200 text-gray-600'\n                  }`}>\n                    {section.completed ? <CheckCircle className=\"h-3 w-3\" /> : index + 1}\n                  </div>\n                  <div>\n                    <div className=\"font-medium text-sm\">{section.title}</div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      Minutes {section.startMinute}-{section.endMinute}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {section.completed && (\n                    <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800\">\n                      Complete\n                    </Badge>\n                  )}\n                  {index === currentSectionIndex && !section.completed && (\n                    <Badge variant=\"default\">\n                      Current\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":12155},"client/src/pages/study-plan-item.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Clock, \n  ArrowLeft, \n  CheckCircle, \n  Play, \n  Pause, \n  RotateCcw,\n  ArrowRight,\n  BookOpen\n} from \"lucide-react\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': '5f02238b-afb2-4e7f-a488-96fb471fee56',\n    'backflow-prevention': 'b1f02238b-afb2-4e7f-a488-96fb471fee57',\n    'natural-gas': 'c2f02238b-afb2-4e7f-a488-96fb471fee58',\n    'medical-gas': 'd3f02238b-afb2-4e7f-a488-96fb471fee59',\n    'master-plumber': 'e4f02238b-afb2-4e7f-a488-96fb471fee60'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface StudyPlan {\n  id: string;\n  title: string;\n  content: string;\n  duration: number;\n}\n\ninterface StudySection {\n  title: string;\n  content: string;\n  startMinute: number;\n  endMinute: number;\n  completed: boolean;\n}\n\nexport default function StudyPlanItem() {\n  const [match, params] = useRoute(\"/study-plans/:courseId/:duration/:itemIndex\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  \n  const courseId = params?.courseId;\n  const duration = params?.duration ? parseInt(params.duration) : 0;\n  const itemIndex = params?.itemIndex ? parseInt(params.itemIndex) : 0;\n  \n  // Check if we're in review mode\n  const urlParams = new URLSearchParams(window.location.search);\n  const isReviewMode = urlParams.get('review') === 'true';\n\n  if (!courseId || !duration) {\n    return <div>Study plan not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  const { data: studyPlans } = useQuery<StudyPlan[]>({\n    queryKey: [`/api/courses/${resolvedCourseId}/study-plans`],\n    enabled: !!resolvedCourseId,\n  });\n\n  // Find the study plan for this duration\n  const studyPlan = studyPlans?.find(plan => plan.duration === duration);\n\n  // Parse study plan sections\n  const parseStudyPlanSections = (content: string, totalDuration: number): StudySection[] => {\n    const lines = content.split('\\n');\n    const sectionMatches: StudySection[] = [];\n    \n    let currentTitle = '';\n    let currentContent = '';\n    let currentStartMinute = 0;\n    let currentEndMinute = 0;\n    \n    lines.forEach((line, index) => {\n      const minuteMatch = line.match(/\\*\\*Minutes (\\d+)-(\\d+): (.+)\\*\\*/);\n      \n      if (minuteMatch) {\n        // If we have a previous section, save it\n        if (currentTitle) {\n          sectionMatches.push({\n            title: currentTitle,\n            content: currentContent.trim(),\n            startMinute: currentStartMinute,\n            endMinute: currentEndMinute,\n            completed: false\n          });\n        }\n        \n        // Start new section\n        currentStartMinute = parseInt(minuteMatch[1]);\n        currentEndMinute = parseInt(minuteMatch[2]);\n        currentTitle = minuteMatch[3];\n        currentContent = '';\n      } else if (line.startsWith('**Minutes') && line.includes(':')) {\n        // Handle next section start\n        if (currentTitle) {\n          sectionMatches.push({\n            title: currentTitle,\n            content: currentContent.trim(),\n            startMinute: currentStartMinute,\n            endMinute: currentEndMinute,\n            completed: false\n          });\n        }\n      } else if (currentTitle && line.trim()) {\n        // Add content to current section\n        currentContent += line + '\\n';\n      }\n    });\n    \n    // Add the last section\n    if (currentTitle) {\n      sectionMatches.push({\n        title: currentTitle,\n        content: currentContent.trim(),\n        startMinute: currentStartMinute,\n        endMinute: currentEndMinute,\n        completed: false\n      });\n    }\n    \n    // If no sections found, create default sections\n    if (sectionMatches.length === 0 && content) {\n      const defaultSections = Math.max(3, Math.floor(totalDuration / 5));\n      const sectionDuration = totalDuration / defaultSections;\n      \n      for (let i = 0; i < defaultSections; i++) {\n        sectionMatches.push({\n          title: `Section ${i + 1}`,\n          content: content.substring(i * 100, (i + 1) * 100) + \"...\",\n          startMinute: Math.floor(i * sectionDuration),\n          endMinute: Math.floor((i + 1) * sectionDuration),\n          completed: false\n        });\n      }\n    }\n    \n    return sectionMatches;\n  };\n\n  const [sections, setSections] = useState<StudySection[]>([]);\n  const [currentSectionIndex, setCurrentSectionIndex] = useState(itemIndex);\n  const [timeRemaining, setTimeRemaining] = useState(0);\n  const [isActive, setIsActive] = useState(false);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Initialize sections when study plan loads\n  useEffect(() => {\n    if (studyPlan) {\n      const parsedSections = parseStudyPlanSections(studyPlan.content, studyPlan.duration);\n      setSections(parsedSections);\n      \n      // Set timer for current section\n      if (parsedSections[itemIndex]) {\n        const sectionDuration = (parsedSections[itemIndex].endMinute - parsedSections[itemIndex].startMinute) * 60;\n        setTimeRemaining(sectionDuration);\n      }\n    }\n  }, [studyPlan, itemIndex]);\n\n  // Timer logic\n  useEffect(() => {\n    if (isActive && timeRemaining > 0) {\n      intervalRef.current = setInterval(() => {\n        setTimeRemaining((prevTime) => {\n          const newTime = prevTime - 1;\n          if (newTime <= 0) {\n            setIsActive(false);\n            toast({\n              title: \"Section Complete!\",\n              description: \"Time's up for this section. Great job!\",\n              duration: 3000,\n            });\n          }\n          return newTime;\n        });\n      }, 1000);\n    } else {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    };\n  }, [isActive, timeRemaining, toast]);\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const currentSection = sections[currentSectionIndex];\n  const isLastSection = currentSectionIndex >= sections.length - 1;\n  const nextSectionIndex = currentSectionIndex + 1;\n\n  const handleComplete = () => {\n    if (isLastSection) {\n      // Return to study plans page when finished\n      toast({\n        title: \"Study Plan Complete!\",\n        description: \"Congratulations! You've completed the entire study plan.\",\n        duration: 5000,\n      });\n      navigate(`/study-plans/${courseId}`);\n    } else {\n      // Go to next section\n      navigate(`/study-plans/${courseId}/${duration}/${nextSectionIndex}`);\n    }\n  };\n\n  const toggleTimer = () => {\n    setIsActive(!isActive);\n  };\n\n  const resetTimer = () => {\n    setIsActive(false);\n    if (currentSection) {\n      const sectionDuration = (currentSection.endMinute - currentSection.startMinute) * 60;\n      setTimeRemaining(sectionDuration);\n    }\n  };\n\n  if (!studyPlan || !currentSection) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Study plan section not found</h1>\n          <Button asChild>\n            <Link href={`/study-plans/${courseId}`}>\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Study Plans\n            </Link>\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const progressPercentage = currentSection ? \n    (((currentSection.endMinute - currentSection.startMinute) * 60 - timeRemaining) / \n     ((currentSection.endMinute - currentSection.startMinute) * 60)) * 100 : 0;\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <Button variant=\"outline\" asChild data-testid=\"back-to-study-plans\">\n          <Link href={`/study-plans/${courseId}`}>\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Study Plans\n          </Link>\n        </Button>\n        \n        <div className=\"text-center\">\n          <Badge variant=\"outline\" className=\"bg-primary/10 text-primary\">\n            {isReviewMode ? 'Review: ' : ''}{duration === 60 ? '1 Hour' : `${duration} Minutes`} Study Plan\n          </Badge>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Section {currentSectionIndex + 1} of {sections.length}\n          </p>\n          {isReviewMode && (\n            <Badge variant=\"outline\" className=\"bg-yellow-100 text-yellow-800 mt-1\">\n              Review Mode - No Timer\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      {/* Timer Card or Review Header */}\n      {!isReviewMode ? (\n        <Card className=\"mb-6\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"flex items-center justify-center gap-2\">\n              <Clock className=\"h-5 w-5\" />\n              {currentSection.title}\n            </CardTitle>\n            <p className=\"text-sm text-muted-foreground\">\n              Minutes {currentSection.startMinute}-{currentSection.endMinute}\n            </p>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-center space-y-4\">\n              <div className=\"text-6xl font-bold text-primary\" data-testid=\"timer-display\">\n                {formatTime(timeRemaining)}\n              </div>\n              \n              <Progress value={progressPercentage} className=\"h-3\" />\n              \n              <div className=\"flex items-center justify-center gap-2 text-sm text-muted-foreground\">\n                <Badge variant={isActive ? \"default\" : \"secondary\"}>\n                  {isActive ? \"Active\" : \"Paused\"}\n                </Badge>\n              </div>\n              \n              <div className=\"flex justify-center gap-2\">\n                <Button\n                  onClick={toggleTimer}\n                  variant={isActive ? \"secondary\" : \"default\"}\n                  className=\"flex items-center gap-2\"\n                  data-testid=\"timer-toggle\"\n                >\n                  {isActive ? <Pause className=\"h-4 w-4\" /> : <Play className=\"h-4 w-4\" />}\n                  {isActive ? \"Pause\" : \"Start\"}\n                </Button>\n              \n                <Button\n                  onClick={resetTimer}\n                  variant=\"outline\"\n                  className=\"flex items-center gap-2\"\n                  data-testid=\"timer-reset\"\n                >\n                  <RotateCcw className=\"h-4 w-4\" />\n                  Reset\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card className=\"mb-6\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"flex items-center justify-center gap-2\">\n              <BookOpen className=\"h-5 w-5\" />\n              Review: {currentSection.title}\n            </CardTitle>\n            <p className=\"text-sm text-muted-foreground\">\n              Minutes {currentSection.startMinute}-{currentSection.endMinute} â€¢ Review Mode\n            </p>\n          </CardHeader>\n        </Card>\n      )}\n\n      {/* Content Card */}\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <BookOpen className=\"h-5 w-5\" />\n            Study Content\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"whitespace-pre-line text-sm leading-relaxed\">\n            {currentSection.content || \"Study content for this section is being prepared.\"}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Navigation */}\n      <div className=\"flex justify-between items-center\">\n        <div className=\"text-sm text-muted-foreground\">\n          Progress: {currentSectionIndex + 1} of {sections.length} sections\n        </div>\n        \n        <Button \n          onClick={handleComplete}\n          size=\"lg\"\n          className=\"flex items-center gap-2\"\n          data-testid=\"complete-section-button\"\n        >\n          <CheckCircle className=\"h-4 w-4\" />\n          {isLastSection ? \"Complete Study Plan\" : \"Complete & Continue\"}\n          {!isLastSection && <ArrowRight className=\"h-4 w-4\" />}\n        </Button>\n      </div>\n    </div>\n  );\n}","size_bytes":12885},"client/src/pages/study-plans.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Clock, ArrowLeft, BookOpen, Play } from \"lucide-react\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': '5f02238b-afb2-4e7f-a488-96fb471fee56',\n    'backflow-prevention': 'b1f02238b-afb2-4e7f-a488-96fb471fee57',\n    'natural-gas': 'c2f02238b-afb2-4e7f-a488-96fb471fee58',\n    'medical-gas': 'd3f02238b-afb2-4e7f-a488-96fb471fee59',\n    'master-plumber': 'e4f02238b-afb2-4e7f-a488-96fb471fee60'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface Course {\n  id: string;\n  title: string;\n  description: string;\n}\n\ninterface StudyPlan {\n  id: string;\n  title: string;\n  content: string;\n  duration: number;\n}\n\nexport default function StudyPlans() {\n  const [match, params] = useRoute(\"/study-plans/:courseId\");\n  const courseId = params?.courseId;\n\n  if (!courseId) {\n    return <div>Course not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  const { data: courses } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n  \n  const course = courses?.find(c => c.id === resolvedCourseId);\n\n  const { data: studyPlans, isLoading } = useQuery<StudyPlan[]>({\n    queryKey: [`/api/courses/${resolvedCourseId}/study-plans`],\n    enabled: !!resolvedCourseId,\n  });\n\n  // Group study plans by duration\n  const studyPlansByDuration = studyPlans?.reduce((acc, plan) => {\n    if (!acc[plan.duration]) acc[plan.duration] = [];\n    acc[plan.duration].push(plan);\n    return acc;\n  }, {} as Record<number, StudyPlan[]>) || {};\n\n  // Define the available durations we want to show\n  const availableDurations = [15, 30, 60]; // 15min, 30min, 1 hour\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/2\"></div>\n          <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"h-48 bg-gray-200 rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!course) {\n    return <div>Course not found</div>;\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button variant=\"outline\" asChild data-testid=\"back-to-course\">\n          <Link href={`/course/${courseId}`}>\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Course\n          </Link>\n        </Button>\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\" data-testid=\"study-plans-title\">\n            Study Plans\n          </h1>\n          <p className=\"text-muted-foreground mt-1\" data-testid=\"course-title\">\n            {course.title}\n          </p>\n        </div>\n      </div>\n\n      {/* Study Plan Duration Options */}\n      <div className=\"space-y-6\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-semibold mb-2\">Choose Your Study Time</h2>\n          <p className=\"text-muted-foreground\">\n            Select how much time you have available for focused study today\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto\">\n          {availableDurations.map(duration => {\n            const plansForDuration = studyPlansByDuration[duration];\n            const planExists = plansForDuration && plansForDuration.length > 0;\n            const durationLabel = duration === 60 ? '1 Hour' : `${duration} Minutes`;\n            \n            return (\n              <Card \n                key={duration}\n                className={`hover:shadow-lg transition-all duration-200 ${\n                  planExists ? 'cursor-pointer border-primary/20 hover:border-primary/40' : 'opacity-60'\n                }`}\n                data-testid={`study-plan-${duration}`}\n              >\n                <CardHeader className=\"text-center pb-4\">\n                  <div className=\"flex items-center justify-center mb-4\">\n                    <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\">\n                      <Clock className=\"h-8 w-8 text-primary\" />\n                    </div>\n                  </div>\n                  <CardTitle className=\"text-xl\" data-testid={`duration-title-${duration}`}>\n                    {durationLabel}\n                  </CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {duration === 15 && \"Quick focused review\"}\n                    {duration === 30 && \"Comprehensive study session\"}  \n                    {duration === 60 && \"Deep dive learning\"}\n                  </p>\n                </CardHeader>\n                <CardContent className=\"pt-0\">\n                  <div className=\"space-y-4\">\n                    {planExists ? (\n                      <>\n                        <div className=\"text-center space-y-2\">\n                          <Badge variant=\"outline\" className=\"bg-green-50 text-green-700 border-green-200\">\n                            <BookOpen className=\"w-3 h-3 mr-1\" />\n                            Study Plan Available\n                          </Badge>\n                          <p className=\"text-xs text-muted-foreground\">\n                            Structured content with timed sections\n                          </p>\n                        </div>\n                        <Button \n                          asChild\n                          className=\"w-full\"\n                          size=\"lg\"\n                          data-testid={`start-${duration}-min-plan`}\n                        >\n                          <Link href={`/study-plans/${courseId}/${duration}/0`}>\n                            <Play className=\"h-4 w-4 mr-2\" />\n                            Start {durationLabel} Study\n                          </Link>\n                        </Button>\n                      </>\n                    ) : (\n                      <>\n                        <div className=\"text-center space-y-2\">\n                          <Badge variant=\"outline\" className=\"bg-gray-50 text-gray-600\">\n                            Coming Soon\n                          </Badge>\n                          <p className=\"text-xs text-muted-foreground\">\n                            Study plan for this duration is being prepared\n                          </p>\n                        </div>\n                        <Button \n                          disabled\n                          className=\"w-full\"\n                          size=\"lg\"\n                          variant=\"secondary\"\n                        >\n                          <Clock className=\"h-4 w-4 mr-2\" />\n                          {durationLabel} Plan\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n\n        {/* Study Tips */}\n        <div className=\"max-w-2xl mx-auto mt-12\">\n          <Card className=\"border-primary/20 bg-primary/5\">\n            <CardContent className=\"p-6\">\n              <h3 className=\"font-semibold text-lg mb-3 flex items-center\">\n                <BookOpen className=\"h-5 w-5 mr-2 text-primary\" />\n                Study Plan Features\n              </h3>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li className=\"flex items-start\">\n                  <span className=\"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0\"></span>\n                  <span>Timed sections with automatic progression</span>\n                </li>\n                <li className=\"flex items-start\">\n                  <span className=\"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0\"></span>\n                  <span>Focused content tailored to your available time</span>\n                </li>\n                <li className=\"flex items-start\">\n                  <span className=\"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0\"></span>\n                  <span>Step-by-step progression through study materials</span>\n                </li>\n                <li className=\"flex items-start\">\n                  <span className=\"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0\"></span>\n                  <span>Track your progress and completion status</span>\n                </li>\n              </ul>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8975},"client/src/pages/admin/content-import.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Upload, CheckCircle, AlertCircle, FileText } from \"lucide-react\";\n\ninterface ParsedContent {\n  question: string;\n  answer: string;\n  keywords: string[];\n  contentId?: string;\n}\n\nexport default function ContentImport() {\n  const [rawContent, setRawContent] = useState(\"\");\n  const [contentId, setContentId] = useState(\"\");\n  const [parsedContent, setParsedContent] = useState<ParsedContent[]>([]);\n  const [isProcessing, setIsProcessing] = useState(false);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const importMutation = useMutation({\n    mutationFn: (content: ParsedContent[]) => \n      apiRequest(\"POST\", \"/api/admin/import-chat-content\", { content }),\n    onSuccess: () => {\n      toast({\n        title: \"Content Imported Successfully\",\n        description: `${parsedContent.length} chat answers have been added to the system.`,\n      });\n      setRawContent(\"\");\n      setParsedContent([]);\n      setContentId(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Import Failed\",\n        description: error.message || \"Failed to import content\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const parseContent = () => {\n    setIsProcessing(true);\n    \n    try {\n      const lines = rawContent.split('\\n').filter(line => line.trim());\n      const parsed: ParsedContent[] = [];\n      let currentQuestion = \"\";\n      let currentAnswer = \"\";\n      let isAnswerMode = false;\n\n      for (let i = 0; i < lines.length; i++) {\n        const line = lines[i].trim();\n        \n        // Skip empty lines and emojis/icons\n        if (!line || line.match(/^[ðŸ§ ðŸ’¡ðŸ“š]+/) || line.startsWith('ðŸ§  Key Concept:') || line.startsWith('ðŸ’¡ Key Information:')) {\n          continue;\n        }\n\n        // Detect questions (lines ending with ?)\n        if (line.endsWith('?')) {\n          // Save previous question/answer pair if exists\n          if (currentQuestion && currentAnswer) {\n            const keywords = extractKeywords(currentQuestion, currentAnswer);\n            parsed.push({\n              question: currentQuestion,\n              answer: currentAnswer.trim(),\n              keywords,\n              contentId: contentId || undefined\n            });\n          }\n          \n          currentQuestion = line;\n          currentAnswer = \"\";\n          isAnswerMode = true;\n        } \n        // This is part of an answer\n        else if (isAnswerMode && currentQuestion) {\n          currentAnswer += line + \"\\n\\n\";\n        }\n        // Handle standalone informational content as Q&A\n        else if (!currentQuestion && line.length > 20) {\n          // Create a question from the content\n          const generatedQuestion = generateQuestionFromContent(line);\n          if (generatedQuestion) {\n            const keywords = extractKeywords(generatedQuestion, line);\n            parsed.push({\n              question: generatedQuestion,\n              answer: line,\n              keywords,\n              contentId: contentId || undefined\n            });\n          }\n        }\n      }\n\n      // Handle the last question/answer pair\n      if (currentQuestion && currentAnswer) {\n        const keywords = extractKeywords(currentQuestion, currentAnswer);\n        parsed.push({\n          question: currentQuestion,\n          answer: currentAnswer.trim(),\n          keywords,\n          contentId: contentId || undefined\n        });\n      }\n\n      setParsedContent(parsed);\n      toast({\n        title: \"Content Parsed Successfully\",\n        description: `Found ${parsed.length} question/answer pairs`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Parsing Failed\",\n        description: \"Please check your content format and try again\",\n        variant: \"destructive\",\n      });\n    }\n    \n    setIsProcessing(false);\n  };\n\n  const extractKeywords = (question: string, answer: string): string[] => {\n    const text = `${question} ${answer}`.toLowerCase();\n    const keywords = new Set<string>();\n    \n    // Extract important terms\n    const patterns = [\n      /louisiana state plumbing code|lspc/g,\n      /department of health and hospitals/g,\n      /enforcement|authority|delegat/g,\n      /legal basis|statutory/g,\n      /r\\.s\\. \\d+:\\d+/g,\n      /historical|promulgat|amend/g,\n      /section \\d+|Â§\\d+/g,\n      /state health officer/g,\n      /violation|code/g\n    ];\n    \n    patterns.forEach(pattern => {\n      const matches = text.match(pattern);\n      if (matches) {\n        matches.forEach(match => keywords.add(match.trim()));\n      }\n    });\n    \n    // Add key individual words\n    const importantWords = text.match(/\\b(?:enforcement|authority|legal|basis|delegation|violation|code|plumbing|louisiana|health|officer|section|historical|promulgated|amended)\\b/g);\n    if (importantWords) {\n      importantWords.forEach(word => keywords.add(word));\n    }\n    \n    return Array.from(keywords);\n  };\n\n  const generateQuestionFromContent = (content: string): string | null => {\n    if (content.includes(\"Louisiana State Plumbing Code\")) {\n      return \"What is the Louisiana State Plumbing Code (LSPC)?\";\n    }\n    if (content.includes(\"Department of Health and Hospitals\")) {\n      return \"Who enforces the LSPC?\";\n    }\n    if (content.includes(\"legal foundation\") || content.includes(\"R.S.\")) {\n      return \"What is the legal basis for the LSPC?\";\n    }\n    if (content.includes(\"historical\") || content.includes(\"promulgated\")) {\n      return \"Tell me about the historical notes.\";\n    }\n    if (content.includes(\"enforcement\") || content.includes(\"authority\")) {\n      return \"How is the LSPC enforced?\";\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center space-x-2\">\n        <FileText className=\"w-6 h-6\" />\n        <h1 className=\"text-2xl font-bold\">Import Chat Content</h1>\n      </div>\n      \n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Import Form */}\n        <Card data-testid=\"content-import-form\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Upload className=\"w-5 h-5\" />\n              <span>Import Educational Content</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"content-id\">Content ID (Optional)</Label>\n              <Input\n                id=\"content-id\"\n                placeholder=\"e.g., section-101, lesson-1\"\n                value={contentId}\n                onChange={(e) => setContentId(e.target.value)}\n                data-testid=\"input-content-id\"\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"raw-content\">Paste Your Educational Content</Label>\n              <Textarea\n                id=\"raw-content\"\n                placeholder=\"Paste your formatted content here...\"\n                className=\"h-64\"\n                value={rawContent}\n                onChange={(e) => setRawContent(e.target.value)}\n                data-testid=\"textarea-raw-content\"\n              />\n            </div>\n            \n            <div className=\"flex space-x-2\">\n              <Button\n                onClick={parseContent}\n                disabled={!rawContent.trim() || isProcessing}\n                data-testid=\"button-parse-content\"\n              >\n                <FileText className=\"w-4 h-4 mr-2\" />\n                {isProcessing ? \"Parsing...\" : \"Parse Content\"}\n              </Button>\n              \n              {parsedContent.length > 0 && (\n                <Button\n                  onClick={() => importMutation.mutate(parsedContent)}\n                  disabled={importMutation.isPending}\n                  data-testid=\"button-import-content\"\n                >\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  {importMutation.isPending ? \"Importing...\" : `Import ${parsedContent.length} Items`}\n                </Button>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Preview */}\n        <Card data-testid=\"content-preview\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <CheckCircle className=\"w-5 h-5\" />\n              <span>Parsed Content Preview</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {parsedContent.length === 0 ? (\n              <p className=\"text-muted-foreground text-center py-8\">\n                No content parsed yet. Paste your content and click \"Parse Content\" to preview.\n              </p>\n            ) : (\n              <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                {parsedContent.map((item, index) => (\n                  <div key={index} className=\"border rounded-lg p-4 space-y-2\" data-testid={`parsed-item-${index}`}>\n                    <div className=\"font-medium text-sm text-primary\">\n                      Q: {item.question}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground line-clamp-3\">\n                      {item.answer.substring(0, 150)}...\n                    </div>\n                    <div className=\"flex flex-wrap gap-1\">\n                      {item.keywords.slice(0, 5).map((keyword, i) => (\n                        <Badge key={i} variant=\"outline\" className=\"text-xs\">\n                          {keyword}\n                        </Badge>\n                      ))}\n                      {item.keywords.length > 5 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          +{item.keywords.length - 5} more\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* Instructions */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center space-x-2\">\n            <AlertCircle className=\"w-5 h-5\" />\n            <span>How to Use</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2 text-sm text-muted-foreground\">\n            <p>1. <strong>Paste your educational content</strong> in the text area above</p>\n            <p>2. <strong>Add a Content ID</strong> (optional) to associate with specific lessons</p>\n            <p>3. <strong>Click \"Parse Content\"</strong> to automatically extract questions and answers</p>\n            <p>4. <strong>Review the preview</strong> to ensure content was parsed correctly</p>\n            <p>5. <strong>Click \"Import\"</strong> to add the content to the AI mentor system</p>\n            <p className=\"mt-3 p-3 bg-muted rounded-lg\">\n              <strong>Supported Format:</strong> The parser looks for questions ending with \"?\" and treats the following text as answers. It also automatically generates questions from informational content about the Louisiana Plumbing Code.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":11678},"client/src/pages/admin/content-management.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Plus, BookOpen, HelpCircle, FileText, Video, Headphones, Upload, Mic, Clock, Brain } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function ContentManagement() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n\n  // Fetch courses\n  const { data: courses } = useQuery({\n    queryKey: [\"/api/courses\"],\n  });\n\n  // Fetch course content based on selected course\n  const { data: courseContent } = useQuery({\n    queryKey: [\"/api/admin/course-content\", selectedCourse],\n    enabled: !!selectedCourse,\n  });\n\n  // Fetch course content stats for overview\n  const { data: contentStats } = useQuery({\n    queryKey: [\"/api/admin/course-content\", selectedCourse, \"stats\"],\n    enabled: !!selectedCourse,\n  });\n\n  const safeContent = courseContent || { lessons: [], chapters: [], questions: [] };\n  const safeStats = {\n    questions: (contentStats as any)?.questions || 0,\n    flashcards: (contentStats as any)?.flashcards || 0,\n    studyNotes: (contentStats as any)?.studyNotes || 0,\n    studyPlans: (contentStats as any)?.studyPlans || 0,\n    podcasts: (contentStats as any)?.podcasts || 0,\n    aiChat: (contentStats as any)?.aiChat || 0,\n    lessons: (contentStats as any)?.lessons || 0,\n    breakdowns: {\n      questions: {\n        byChapter: (contentStats as any)?.breakdowns?.questions?.byChapter || [],\n        byDifficulty: (contentStats as any)?.breakdowns?.questions?.byDifficulty || [],\n        bySection: (contentStats as any)?.breakdowns?.questions?.bySection || []\n      },\n      flashcards: {\n        byChapter: (contentStats as any)?.breakdowns?.flashcards?.byChapter || [],\n        byDifficulty: (contentStats as any)?.breakdowns?.flashcards?.byDifficulty || [],\n        bySection: (contentStats as any)?.breakdowns?.flashcards?.bySection || []\n      },\n      lessons: {\n        byChapter: (contentStats as any)?.breakdowns?.lessons?.byChapter || [],\n        byDifficulty: (contentStats as any)?.breakdowns?.lessons?.byDifficulty || [],\n        bySection: (contentStats as any)?.breakdowns?.lessons?.bySection || []\n      },\n      studyNotes: {\n        byChapter: (contentStats as any)?.breakdowns?.studyNotes?.byChapter || [],\n        byDifficulty: (contentStats as any)?.breakdowns?.studyNotes?.byDifficulty || [],\n        bySection: (contentStats as any)?.breakdowns?.studyNotes?.bySection || []\n      },\n      studyPlans: {\n        byChapter: (contentStats as any)?.breakdowns?.studyPlans?.byChapter || [],\n        byDifficulty: (contentStats as any)?.breakdowns?.studyPlans?.byDifficulty || [],\n        bySection: (contentStats as any)?.breakdowns?.studyPlans?.bySection || []\n      },\n      podcasts: {\n        byChapter: (contentStats as any)?.breakdowns?.podcasts?.byChapter || [],\n        byDifficulty: (contentStats as any)?.breakdowns?.podcasts?.byDifficulty || [],\n        bySection: (contentStats as any)?.breakdowns?.podcasts?.bySection || []\n      }\n    }\n  };\n\n  const addLessonMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/lessons\", data),\n    onSuccess: () => {\n      toast({ title: \"Lesson added successfully!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\", selectedCourse] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\", selectedCourse, \"stats\"] });\n    },\n  });\n\n  const addQuestionMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/questions\", data),\n    onSuccess: () => {\n      toast({ title: \"Question added successfully!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\", selectedCourse] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\", selectedCourse, \"stats\"] });\n    },\n  });\n\n  const addChapterMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/chapters\", data),\n    onSuccess: () => {\n      toast({ title: \"Chapter added successfully!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\", selectedCourse] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\", selectedCourse, \"stats\"] });\n    },\n  });\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Content Management</h1>\n          <p className=\"text-muted-foreground\">\n            Create and manage course content, lessons, and questions\n          </p>\n        </div>\n\n        {/* Course Selection */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Select Course</CardTitle>\n            <CardDescription>Choose which course to manage</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n              <SelectTrigger className=\"w-full max-w-md\">\n                <SelectValue placeholder=\"Select a course to manage\" />\n              </SelectTrigger>\n              <SelectContent>\n                {(courses as any[])?.map((course: any) => (\n                  <SelectItem key={course.id} value={course.id}>\n                    {course.title}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </CardContent>\n        </Card>\n\n        {selectedCourse && (\n          <Tabs defaultValue=\"overview\" className=\"space-y-6\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n              <TabsTrigger value=\"imports\">Bulk Imports</TabsTrigger>\n            </TabsList>\n\n\n            <TabsContent value=\"overview\">\n              <div className=\"space-y-6\">\n                {/* Content Statistics */}\n\n                {/* Detailed Breakdowns */}\n                {(safeStats.questions > 0 || safeStats.flashcards > 0 || safeStats.lessons > 0 || safeStats.studyNotes > 0 || safeStats.podcasts > 0) && (\n                  <div className=\"space-y-6\">\n                    <h2 className=\"text-2xl font-bold\">Content Breakdowns</h2>\n                    \n                    {/* Questions Breakdown */}\n                    {safeStats.questions > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <HelpCircle className=\"h-5 w-5\" />\n                            Questions Breakdown ({safeStats.questions} total)\n                          </CardTitle>\n                          <CardDescription>\n                            Distribution of questions by chapter, section, and difficulty level\n                          </CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Chapter</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.questions?.byChapter?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.category}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                            \n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Section</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.questions?.bySection?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.codeReference}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                            \n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Difficulty</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.questions?.byDifficulty?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className={`text-sm px-2 py-1 rounded text-white ${\n                                      item.difficulty === 'easy' ? 'bg-green-500' :\n                                      item.difficulty === 'hard' ? 'bg-orange-500' :\n                                      'bg-red-500'\n                                    }`}>\n                                      {item.difficulty.charAt(0).toUpperCase() + item.difficulty.slice(1)}\n                                    </span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Flashcards Breakdown */}\n                    {safeStats.flashcards > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <Upload className=\"h-5 w-5\" />\n                            Flashcards Breakdown ({safeStats.flashcards} total)\n                          </CardTitle>\n                          <CardDescription>\n                            Distribution of flashcards by chapter, section, and difficulty level\n                          </CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Chapter</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.flashcards?.byChapter?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.category}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                            \n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Section</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.flashcards?.bySection?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.codeReference}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                            \n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Difficulty</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.flashcards?.byDifficulty?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className={`text-sm px-2 py-1 rounded text-white ${\n                                      item.difficulty === 'easy' ? 'bg-green-500' :\n                                      item.difficulty === 'hard' ? 'bg-orange-500' :\n                                      'bg-red-500'\n                                    }`}>\n                                      {item.difficulty ? item.difficulty.charAt(0).toUpperCase() + item.difficulty.slice(1) : 'Unknown'}\n                                    </span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n\n\n                    {/* Study Notes Breakdown */}\n                    {safeStats.studyNotes > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <FileText className=\"h-5 w-5\" />\n                            Study Notes Breakdown ({safeStats.studyNotes} total)\n                          </CardTitle>\n                          <CardDescription>\n                            Distribution of study notes by chapter and section\n                          </CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Chapter</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.studyNotes?.byChapter?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.category}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                            \n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Section</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.studyNotes?.bySection?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.codeReference}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n\n\n                    {/* Podcasts Breakdown */}\n                    {safeStats.podcasts > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <Headphones className=\"h-5 w-5\" />\n                            Podcasts Breakdown ({safeStats.podcasts} total)\n                          </CardTitle>\n                          <CardDescription>\n                            Distribution of podcasts by chapter and section\n                          </CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Chapter</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.podcasts?.byChapter?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.category}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                            \n                            <div>\n                              <h4 className=\"font-semibold mb-3\">By Section</h4>\n                              <div className=\"space-y-2\">\n                                {safeStats.breakdowns?.podcasts?.bySection?.map((item: any, index: number) => (\n                                  <div key={index} className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                                    <span className=\"text-sm\">{item.codeReference}</span>\n                                    <span className=\"font-semibold\">{item.count}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n                )}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"imports\">\n              <div className=\"space-y-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle>Bulk Import Tools</CardTitle>\n                    <CardDescription>\n                      Import multiple pieces of content at once to quickly build your course\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                      <Link href={`/admin/bulk-import?courseId=${selectedCourse}`}>\n                        <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                          <CardHeader>\n                            <CardTitle className=\"flex items-center gap-2 text-base\">\n                              <Upload className=\"h-5 w-5\" />\n                              Bulk Questions\n                            </CardTitle>\n                            <CardDescription>\n                              Import multiple practice questions using text format\n                            </CardDescription>\n                          </CardHeader>\n                        </Card>\n                      </Link>\n\n                      <Link href={`/admin/flashcard-import?courseId=${selectedCourse}`}>\n                        <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                          <CardHeader>\n                            <CardTitle className=\"flex items-center gap-2 text-base\">\n                              <Upload className=\"h-5 w-5\" />\n                              Bulk Flashcards\n                            </CardTitle>\n                            <CardDescription>\n                              Import flashcards with terms and definitions\n                            </CardDescription>\n                          </CardHeader>\n                        </Card>\n                      </Link>\n\n                      <Link href={`/admin/study-notes-import?courseId=${selectedCourse}`}>\n                        <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                          <CardHeader>\n                            <CardTitle className=\"flex items-center gap-2 text-base\">\n                              <BookOpen className=\"h-5 w-5\" />\n                              Study Notes\n                            </CardTitle>\n                            <CardDescription>\n                              Import structured study notes with headings\n                            </CardDescription>\n                          </CardHeader>\n                        </Card>\n                      </Link>\n\n\n                      <Link href={`/admin/podcast-import?courseId=${selectedCourse}`}>\n                        <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                          <CardHeader>\n                            <CardTitle className=\"flex items-center gap-2 text-base\">\n                              <Mic className=\"h-5 w-5\" />\n                              Podcast Episodes\n                            </CardTitle>\n                            <CardDescription>\n                              Import conversation content to create podcast episodes\n                            </CardDescription>\n                          </CardHeader>\n                        </Card>\n                      </Link>\n\n                      <Link href={`/admin/content-import?courseId=${selectedCourse}`}>\n                        <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                          <CardHeader>\n                            <CardTitle className=\"flex items-center gap-2 text-base\">\n                              <Brain className=\"h-5 w-5\" />\n                              AI Chat Content\n                            </CardTitle>\n                            <CardDescription>\n                              Import educational content for the AI mentor chat system\n                            </CardDescription>\n                          </CardHeader>\n                        </Card>\n                      </Link>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n          </Tabs>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction AddLessonDialog({ courseId, onAdd, isPending }: { courseId: string; onAdd: (data: any) => void; isPending: boolean }) {\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    title: \"\",\n    description: \"\",\n    content: \"\",\n    type: \"text\",\n    duration: \"\",\n    chapterNumber: \"1\"\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onAdd({ ...formData, courseId });\n    setOpen(false);\n    setFormData({ title: \"\", description: \"\", content: \"\", type: \"text\", duration: \"\", chapterNumber: \"1\" });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button>\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Lesson\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>Add New Lesson</DialogTitle>\n          <DialogDescription>Create a new lesson for this course</DialogDescription>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"title\">Lesson Title</Label>\n              <Input\n                id=\"title\"\n                value={formData.title}\n                onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"type\">Content Type</Label>\n              <Select value={formData.type} onValueChange={(value) => setFormData({ ...formData, type: value })}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"text\">Text Content</SelectItem>\n                  <SelectItem value=\"video\">Video</SelectItem>\n                  <SelectItem value=\"audio\">Audio</SelectItem>\n                  <SelectItem value=\"pdf\">PDF Document</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"duration\">Duration (minutes)</Label>\n              <Input\n                id=\"duration\"\n                type=\"number\"\n                value={formData.duration}\n                onChange={(e) => setFormData({ ...formData, duration: e.target.value })}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"chapter\">Chapter Number</Label>\n              <Input\n                id=\"chapter\"\n                type=\"number\"\n                value={formData.chapterNumber}\n                onChange={(e) => setFormData({ ...formData, chapterNumber: e.target.value })}\n                required\n              />\n            </div>\n          </div>\n          <div>\n            <Label htmlFor=\"description\">Description</Label>\n            <Textarea\n              id=\"description\"\n              value={formData.description}\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              rows={3}\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"content\">Content</Label>\n            <Textarea\n              id=\"content\"\n              value={formData.content}\n              onChange={(e) => setFormData({ ...formData, content: e.target.value })}\n              rows={8}\n              placeholder=\"Enter the lesson content here...\"\n              required\n            />\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={isPending}>\n              {isPending ? \"Adding...\" : \"Add Lesson\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction AddChapterDialog({ courseId, onAdd, isPending }: { courseId: string; onAdd: (data: any) => void; isPending: boolean }) {\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    title: \"\",\n    description: \"\",\n    number: \"1\"\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onAdd({ ...formData, courseId });\n    setOpen(false);\n    setFormData({ title: \"\", description: \"\", number: \"1\" });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button>\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Chapter\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Add New Chapter</DialogTitle>\n          <DialogDescription>Create a new chapter for this course</DialogDescription>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"number\">Chapter Number</Label>\n            <Input\n              id=\"number\"\n              type=\"number\"\n              value={formData.number}\n              onChange={(e) => setFormData({ ...formData, number: e.target.value })}\n              required\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"title\">Chapter Title</Label>\n            <Input\n              id=\"title\"\n              value={formData.title}\n              onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n              required\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"description\">Description</Label>\n            <Textarea\n              id=\"description\"\n              value={formData.description}\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              rows={3}\n            />\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={isPending}>\n              {isPending ? \"Adding...\" : \"Add Chapter\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction AddQuestionDialog({ courseId, onAdd, isPending }: { courseId: string; onAdd: (data: any) => void; isPending: boolean }) {\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    questionText: \"\",\n    options: [\"\", \"\", \"\", \"\"],\n    correctAnswer: 0,\n    explanation: \"\",\n    difficulty: \"medium\"\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onAdd({ ...formData, courseId });\n    setOpen(false);\n    setFormData({\n      questionText: \"\",\n      options: [\"\", \"\", \"\", \"\"],\n      correctAnswer: 0,\n      explanation: \"\",\n      difficulty: \"medium\"\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button>\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Question\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>Add Practice Question</DialogTitle>\n          <DialogDescription>Create a new practice question for this course</DialogDescription>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"question\">Question Text</Label>\n            <Textarea\n              id=\"question\"\n              value={formData.questionText}\n              onChange={(e) => setFormData({ ...formData, questionText: e.target.value })}\n              rows={3}\n              required\n            />\n          </div>\n          <div>\n            <Label>Answer Options</Label>\n            <div className=\"space-y-2\">\n              {formData.options.map((option, idx) => (\n                <div key={idx} className=\"flex items-center gap-2\">\n                  <input\n                    type=\"radio\"\n                    name=\"correct\"\n                    checked={formData.correctAnswer === idx}\n                    onChange={() => setFormData({ ...formData, correctAnswer: idx })}\n                  />\n                  <Input\n                    placeholder={`Option ${idx + 1}`}\n                    value={option}\n                    onChange={(e) => {\n                      const newOptions = [...formData.options];\n                      newOptions[idx] = e.target.value;\n                      setFormData({ ...formData, options: newOptions });\n                    }}\n                    required\n                  />\n                </div>\n              ))}\n            </div>\n          </div>\n          <div>\n            <Label htmlFor=\"difficulty\">Difficulty</Label>\n            <Select value={formData.difficulty} onValueChange={(value) => setFormData({ ...formData, difficulty: value })}>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"easy\">Easy</SelectItem>\n                <SelectItem value=\"medium\">Medium</SelectItem>\n                <SelectItem value=\"hard\">Hard</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          <div>\n            <Label htmlFor=\"explanation\">Explanation</Label>\n            <Textarea\n              id=\"explanation\"\n              value={formData.explanation}\n              onChange={(e) => setFormData({ ...formData, explanation: e.target.value })}\n              rows={3}\n              placeholder=\"Explain why this is the correct answer...\"\n            />\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={isPending}>\n              {isPending ? \"Adding...\" : \"Add Question\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n","size_bytes":33550},"client/src/pages/admin/podcast-import.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Mic, Upload, Play, User, UserCheck, Save } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function PodcastImport() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [podcastData, setPodcastData] = useState({\n    title: \"\",\n    description: \"\",\n    hostName: \"Host\",\n    guestName: \"Guest\",\n    content: \"\"\n  });\n\n  const [parsedSegments, setParsedSegments] = useState<Array<{\n    speaker: \"host\" | \"guest\";\n    text: string;\n  }>>([]);\n\n  const createPodcastMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return apiRequest(\"POST\", \"/api/admin/podcasts\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Podcast Created\",\n        description: \"Your podcast has been successfully imported and is ready to publish.\",\n      });\n      setPodcastData({\n        title: \"\",\n        description: \"\",\n        hostName: \"Host\",\n        guestName: \"Guest\",\n        content: \"\"\n      });\n      setParsedSegments([]);\n      queryClient.invalidateQueries({ queryKey: [\"/api/podcasts\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create podcast. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const parseContent = () => {\n    if (!podcastData.content.trim()) {\n      toast({\n        title: \"No Content\",\n        description: \"Please paste your podcast content first.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const lines = podcastData.content.split('\\n').filter(line => line.trim());\n    const segments: Array<{ speaker: \"host\" | \"guest\"; text: string }> = [];\n    \n    // Parse alternating host/guest format\n    lines.forEach((line, index) => {\n      const trimmedLine = line.trim();\n      if (trimmedLine) {\n        // Alternate between host (even indices) and guest (odd indices)\n        const speaker = index % 2 === 0 ? \"host\" : \"guest\";\n        segments.push({\n          speaker,\n          text: trimmedLine\n        });\n      }\n    });\n\n    setParsedSegments(segments);\n    \n    toast({\n      title: \"Content Parsed\",\n      description: `Found ${segments.length} segments (${segments.filter(s => s.speaker === 'host').length} host, ${segments.filter(s => s.speaker === 'guest').length} guest)`,\n    });\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!podcastData.title.trim()) {\n      toast({\n        title: \"Missing Title\",\n        description: \"Please enter a podcast title.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (parsedSegments.length === 0) {\n      toast({\n        title: \"No Segments\",\n        description: \"Please parse your content first to create segments.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createPodcastMutation.mutate({\n      title: podcastData.title,\n      description: podcastData.description,\n      hostName: podcastData.hostName,\n      guestName: podcastData.guestName,\n      segments: parsedSegments,\n      totalSegments: parsedSegments.length,\n      duration: Math.round(parsedSegments.length * 15), // Estimate 15 seconds per segment\n      status: \"draft\"\n    });\n  };\n\n  const updateField = (field: string, value: string) => {\n    setPodcastData(prev => ({ ...prev, [field]: value }));\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8 flex items-center gap-4\">\n          <Link href=\"/admin\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Admin\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"podcast-import-title\">\n              Podcast Import\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Import conversation content to create podcast episodes with host and guest segments\n            </p>\n          </div>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Podcast Details */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Mic className=\"h-5 w-5\" />\n                Podcast Details\n              </CardTitle>\n              <CardDescription>\n                Enter the basic information for your podcast episode\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"title\">Episode Title *</Label>\n                <Input\n                  id=\"title\"\n                  value={podcastData.title}\n                  onChange={(e) => updateField(\"title\", e.target.value)}\n                  placeholder=\"e.g., Louisiana State Plumbing Code Â§101 Administration\"\n                  required\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"description\">Episode Description</Label>\n                <Textarea\n                  id=\"description\"\n                  value={podcastData.description}\n                  onChange={(e) => updateField(\"description\", e.target.value)}\n                  placeholder=\"Brief description of what this episode covers...\"\n                  rows={3}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"hostName\">Host Name</Label>\n                  <Input\n                    id=\"hostName\"\n                    value={podcastData.hostName}\n                    onChange={(e) => updateField(\"hostName\", e.target.value)}\n                    placeholder=\"Host\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"guestName\">Guest Name</Label>\n                  <Input\n                    id=\"guestName\"\n                    value={podcastData.guestName}\n                    onChange={(e) => updateField(\"guestName\", e.target.value)}\n                    placeholder=\"Guest\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Content Import */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Upload className=\"h-5 w-5\" />\n                Content Import\n              </CardTitle>\n              <CardDescription>\n                Paste your alternating host/guest conversation content. Each line will alternate between host and guest automatically.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"content\">Conversation Content</Label>\n                <Textarea\n                  id=\"content\"\n                  value={podcastData.content}\n                  onChange={(e) => updateField(\"content\", e.target.value)}\n                  placeholder=\"Paste your conversation content here... First line = Host, Second line = Guest, Third line = Host, etc.\"\n                  rows={12}\n                  className=\"font-mono text-sm\"\n                />\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Format: Line 1 (Host) â†’ Line 2 (Guest) â†’ Line 3 (Host) â†’ Line 4 (Guest)...\n                </p>\n              </div>\n\n              <Button \n                type=\"button\" \n                onClick={parseContent}\n                variant=\"outline\"\n                disabled={!podcastData.content.trim()}\n              >\n                <Play className=\"h-4 w-4 mr-2\" />\n                Parse Content\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Preview Segments */}\n          {parsedSegments.length > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle>Content Preview</CardTitle>\n                <CardDescription>\n                  Review the parsed segments before creating the podcast\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                  {parsedSegments.map((segment, index) => (\n                    <div \n                      key={index}\n                      className={`p-3 rounded-lg border ${\n                        segment.speaker === 'host' \n                          ? 'bg-blue-50 border-blue-200' \n                          : 'bg-green-50 border-green-200'\n                      }`}\n                    >\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        {segment.speaker === 'host' ? (\n                          <User className=\"h-4 w-4 text-blue-600\" />\n                        ) : (\n                          <UserCheck className=\"h-4 w-4 text-green-600\" />\n                        )}\n                        <Badge variant={segment.speaker === 'host' ? 'default' : 'secondary'}>\n                          {segment.speaker === 'host' ? podcastData.hostName : podcastData.guestName}\n                        </Badge>\n                        <span className=\"text-sm text-muted-foreground\">#{index + 1}</span>\n                      </div>\n                      <p className=\"text-sm\">{segment.text}</p>\n                    </div>\n                  ))}\n                </div>\n                \n                <div className=\"mt-4 p-3 bg-muted rounded-lg\">\n                  <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                    <div>\n                      <span className=\"font-medium\">Total Segments:</span>\n                      <p className=\"text-lg\">{parsedSegments.length}</p>\n                    </div>\n                    <div>\n                      <span className=\"font-medium\">Host Lines:</span>\n                      <p className=\"text-lg text-blue-600\">\n                        {parsedSegments.filter(s => s.speaker === 'host').length}\n                      </p>\n                    </div>\n                    <div>\n                      <span className=\"font-medium\">Guest Lines:</span>\n                      <p className=\"text-lg text-green-600\">\n                        {parsedSegments.filter(s => s.speaker === 'guest').length}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Submit */}\n          <div className=\"flex justify-end\">\n            <Button \n              type=\"submit\" \n              disabled={createPodcastMutation.isPending || parsedSegments.length === 0}\n              className=\"w-full sm:w-auto\"\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              {createPodcastMutation.isPending ? \"Creating Podcast...\" : \"Create Podcast\"}\n            </Button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}","size_bytes":11597},"client/src/pages/admin/system-settings.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Settings, Mail, Shield, DollarSign, Users, AlertCircle, Save } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function SystemSettings() {\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Settings state\n  const [settings, setSettings] = useState({\n    // Email Settings\n    emailNotifications: true,\n    marketingEmails: false,\n    betaFeedbackReminders: true,\n    enrollmentNotifications: true,\n    \n    // Platform Settings\n    maintenanceMode: false,\n    newUserRegistration: true,\n    betaProgram: true,\n    referralProgram: true,\n    \n    // Payment Settings\n    stripeTestMode: false,\n    freeTrialDays: 7,\n    cancellationPolicy: \"immediate\",\n    refundPolicy: \"30-days\",\n    \n    // Course Settings\n    coursePreview: true,\n    autoEnrollment: false,\n    courseCertificates: true,\n    aiMentorAccess: true,\n    \n    // Security Settings\n    passwordMinLength: 8,\n    sessionTimeout: 24,\n    twoFactorAuth: false,\n    ipWhitelist: \"\"\n  });\n\n  const handleSave = async () => {\n    setIsLoading(true);\n    try {\n      // Here you would save to your API\n      // await apiRequest(\"POST\", \"/api/admin/settings\", settings);\n      toast({\n        title: \"Settings Saved\",\n        description: \"All system settings have been updated successfully.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save settings. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const updateSetting = (key: string, value: any) => {\n    setSettings(prev => ({\n      ...prev,\n      [key]: value\n    }));\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8 flex items-center gap-4\">\n          <Link href=\"/admin\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Admin\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"settings-title\">System Settings</h1>\n            <p className=\"text-muted-foreground\">\n              Configure platform settings, notifications, and integrations\n            </p>\n          </div>\n        </div>\n\n        <div className=\"space-y-6\">\n          {/* Email Settings */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Mail className=\"h-5 w-5\" />\n                Email & Notifications\n              </CardTitle>\n              <CardDescription>\n                Configure automated emails and notification preferences\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"email-notifications\">System Email Notifications</Label>\n                  <p className=\"text-sm text-muted-foreground\">Send automated system emails to users</p>\n                </div>\n                <Switch\n                  id=\"email-notifications\"\n                  checked={settings.emailNotifications}\n                  onCheckedChange={(checked) => updateSetting(\"emailNotifications\", checked)}\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"marketing-emails\">Marketing Communications</Label>\n                  <p className=\"text-sm text-muted-foreground\">Send promotional and marketing emails</p>\n                </div>\n                <Switch\n                  id=\"marketing-emails\"\n                  checked={settings.marketingEmails}\n                  onCheckedChange={(checked) => updateSetting(\"marketingEmails\", checked)}\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"beta-reminders\">Beta Feedback Reminders</Label>\n                  <p className=\"text-sm text-muted-foreground\">Monthly reminders for beta testers</p>\n                </div>\n                <Switch\n                  id=\"beta-reminders\"\n                  checked={settings.betaFeedbackReminders}\n                  onCheckedChange={(checked) => updateSetting(\"betaFeedbackReminders\", checked)}\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"enrollment-notifications\">Enrollment Notifications</Label>\n                  <p className=\"text-sm text-muted-foreground\">Welcome emails and course access notifications</p>\n                </div>\n                <Switch\n                  id=\"enrollment-notifications\"\n                  checked={settings.enrollmentNotifications}\n                  onCheckedChange={(checked) => updateSetting(\"enrollmentNotifications\", checked)}\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Platform Settings */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Settings className=\"h-5 w-5\" />\n                Platform Configuration\n              </CardTitle>\n              <CardDescription>\n                General platform settings and feature toggles\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"maintenance-mode\">Maintenance Mode</Label>\n                  <p className=\"text-sm text-muted-foreground\">Temporarily disable public access</p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Switch\n                    id=\"maintenance-mode\"\n                    checked={settings.maintenanceMode}\n                    onCheckedChange={(checked) => updateSetting(\"maintenanceMode\", checked)}\n                  />\n                  {settings.maintenanceMode && <Badge variant=\"destructive\">Active</Badge>}\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"new-registration\">New User Registration</Label>\n                  <p className=\"text-sm text-muted-foreground\">Allow new users to create accounts</p>\n                </div>\n                <Switch\n                  id=\"new-registration\"\n                  checked={settings.newUserRegistration}\n                  onCheckedChange={(checked) => updateSetting(\"newUserRegistration\", checked)}\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"beta-program\">Beta Testing Program</Label>\n                  <p className=\"text-sm text-muted-foreground\">Enable beta tester features and feedback collection</p>\n                </div>\n                <Switch\n                  id=\"beta-program\"\n                  checked={settings.betaProgram}\n                  onCheckedChange={(checked) => updateSetting(\"betaProgram\", checked)}\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"referral-program\">Referral Program</Label>\n                  <p className=\"text-sm text-muted-foreground\">Enable user referrals and commission tracking</p>\n                </div>\n                <Switch\n                  id=\"referral-program\"\n                  checked={settings.referralProgram}\n                  onCheckedChange={(checked) => updateSetting(\"referralProgram\", checked)}\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Payment & Billing Settings */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-5 w-5\" />\n                Payment & Billing\n              </CardTitle>\n              <CardDescription>\n                Configure payment processing and billing policies\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"stripe-test\">Stripe Test Mode</Label>\n                  <p className=\"text-sm text-muted-foreground\">Use Stripe test environment for payments</p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Switch\n                    id=\"stripe-test\"\n                    checked={settings.stripeTestMode}\n                    onCheckedChange={(checked) => updateSetting(\"stripeTestMode\", checked)}\n                  />\n                  {settings.stripeTestMode && <Badge variant=\"outline\">Test Mode</Badge>}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"trial-days\">Free Trial Days</Label>\n                  <Input\n                    id=\"trial-days\"\n                    type=\"number\"\n                    value={settings.freeTrialDays}\n                    onChange={(e) => updateSetting(\"freeTrialDays\", parseInt(e.target.value))}\n                    min=\"0\"\n                    max=\"30\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"cancellation-policy\">Cancellation Policy</Label>\n                  <Select \n                    value={settings.cancellationPolicy}\n                    onValueChange={(value) => updateSetting(\"cancellationPolicy\", value)}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"immediate\">Immediate</SelectItem>\n                      <SelectItem value=\"end-of-period\">End of Billing Period</SelectItem>\n                      <SelectItem value=\"30-days\">30 Days Notice</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Security Settings */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5\" />\n                Security & Access\n              </CardTitle>\n              <CardDescription>\n                Configure security policies and access controls\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"password-length\">Minimum Password Length</Label>\n                  <Input\n                    id=\"password-length\"\n                    type=\"number\"\n                    value={settings.passwordMinLength}\n                    onChange={(e) => updateSetting(\"passwordMinLength\", parseInt(e.target.value))}\n                    min=\"6\"\n                    max=\"20\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"session-timeout\">Session Timeout (hours)</Label>\n                  <Input\n                    id=\"session-timeout\"\n                    type=\"number\"\n                    value={settings.sessionTimeout}\n                    onChange={(e) => updateSetting(\"sessionTimeout\", parseInt(e.target.value))}\n                    min=\"1\"\n                    max=\"168\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label htmlFor=\"two-factor\">Two-Factor Authentication</Label>\n                  <p className=\"text-sm text-muted-foreground\">Require 2FA for admin accounts</p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Switch\n                    id=\"two-factor\"\n                    checked={settings.twoFactorAuth}\n                    onCheckedChange={(checked) => updateSetting(\"twoFactorAuth\", checked)}\n                  />\n                  {settings.twoFactorAuth && <Badge variant=\"default\">Enabled</Badge>}\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"ip-whitelist\">IP Whitelist (Admin Access)</Label>\n                <Textarea\n                  id=\"ip-whitelist\"\n                  placeholder=\"Enter IP addresses, one per line (optional)\"\n                  value={settings.ipWhitelist}\n                  onChange={(e) => updateSetting(\"ipWhitelist\", e.target.value)}\n                  rows={3}\n                />\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Leave empty to allow access from any IP address\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Save Changes */}\n          <div className=\"flex justify-end\">\n            <Button onClick={handleSave} disabled={isLoading} className=\"w-full sm:w-auto\">\n              <Save className=\"h-4 w-4 mr-2\" />\n              {isLoading ? \"Saving...\" : \"Save All Settings\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":14272},"README.md":{"content":"# LA Plumb Prep - Louisiana Plumbing Certification Platform\n\nA comprehensive plumbing certification platform for Louisiana plumbers featuring courses, AI-powered tools, job board, and subscription management.\n\n## Features\n\n- ðŸŽ“ **Course Management** - Interactive lessons, podcasts, quizzes, and study materials\n- ðŸ¤– **AI Tools** - Photo analysis, plan review, pipe sizing, and AI mentor chat\n- ðŸ’¼ **Job Board** - Student-exclusive job opportunities with application tracking\n- ðŸ’³ **Subscription Plans** - Tiered pricing with Stripe integration\n- ðŸ“§ **Email Automation** - Automated campaigns and notifications\n- ðŸ‘¥ **Referral System** - Commission-based referral tracking\n- ðŸ“± **Responsive Design** - Works on all devices\n\n## Tech Stack\n\n- **Frontend**: React, TypeScript, Tailwind CSS, shadcn/ui\n- **Backend**: Node.js, Express, TypeScript\n- **Database**: PostgreSQL with Drizzle ORM\n- **Authentication**: Session-based with bcrypt\n- **Payments**: Stripe\n- **AI**: OpenAI GPT-4\n- **Email**: SendGrid\n\n## Environment Variables\n\nCreate these environment variables in your Render dashboard:\n\n### Required\n- `DATABASE_URL` - PostgreSQL connection string\n- `SESSION_SECRET` - Session encryption key (generate random string)\n- `STRIPE_SECRET_KEY` - Stripe secret key (sk_...)\n- `VITE_STRIPE_PUBLIC_KEY` - Stripe publishable key (pk_...)\n\n### Optional\n- `SENDGRID_API_KEY` - For email functionality\n- `OPENAI_API_KEY` - For AI tools\n- `NOREPLY_USER` - Email automation sender\n- `NOREPLY_PASS` - Email password\n- `SUPPORT_EMAIL` - Support email address\n\n## Deployment on Render\n\n1. **Create GitHub Repository**:\n   ```bash\n   # Already initialized, just add remote\n   git remote add origin https://github.com/yourusername/la-plumb-prep.git\n   git add .\n   git commit -m \"Initial commit\"\n   git push -u origin main\n   ```\n\n2. **Deploy on Render**:\n   - Go to [render.com](https://render.com)\n   - Click \"New +\" â†’ \"Web Service\"\n   - Connect your GitHub repository\n   - Render will auto-detect the `render.yaml` configuration\n\n3. **Configure Environment Variables**:\n   - In Render dashboard, go to your service â†’ Environment\n   - Add all required environment variables listed above\n\n4. **Database Setup**:\n   - Render will create PostgreSQL database automatically\n   - Run database migrations: `npm run db:push`\n\n## Local Development\n\n1. **Install Dependencies**:\n   ```bash\n   npm install\n   ```\n\n2. **Setup Environment Variables**:\n   - Copy environment variables from Replit Secrets\n   - Create `.env` file (not included in repo)\n\n3. **Run Development Server**:\n   ```bash\n   npm run dev\n   ```\n\n4. **Build for Production**:\n   ```bash\n   npm run build\n   npm start\n   ```\n\n## Production Considerations\n\n- Database migrations are handled by `npm run db:push`\n- Static assets are served from `/dist/public/`\n- Session storage uses PostgreSQL for scalability\n- All secrets are managed through environment variables\n\n## Support\n\nFor issues or questions, contact through the platform's support system.","size_bytes":3010},"render.yaml":{"content":"services:\n  - type: web\n    name: la-plumb-prep\n    env: node\n    buildCommand: npm install && npm run build\n    startCommand: npm start\n    envVars:\n      - key: NODE_ENV\n        value: production\n      - key: DATABASE_URL\n        fromDatabase:\n          name: la-plumb-prep-db\n          property: connectionString\n    # Add your environment variables in Render dashboard:\n    # STRIPE_SECRET_KEY, VITE_STRIPE_PUBLIC_KEY, SENDGRID_API_KEY, etc.\n\ndatabases:\n  - name: la-plumb-prep-db\n    databaseName: la_plumb_prep\n    user: la_plumb_prep_user","size_bytes":545},"scripts/import-data.js":{"content":"import { drizzle } from 'drizzle-orm/neon-serverless';\nimport { Pool } from '@neondatabase/serverless';\nimport * as schema from '../shared/schema.js';\nimport fs from 'fs';\nimport path from 'path';\n\nif (!process.env.DATABASE_URL) {\n  throw new Error('DATABASE_URL environment variable is required');\n}\n\nconst pool = new Pool({ connectionString: process.env.DATABASE_URL });\nconst db = drizzle(pool, { schema });\n\nasync function importData() {\n  try {\n    console.log('Starting data import...');\n\n    // Import courses\n    if (fs.existsSync('./data/courses.json')) {\n      const coursesData = JSON.parse(fs.readFileSync('./data/courses.json', 'utf8'));\n      if (coursesData.length > 0) {\n        await db.insert(schema.courses).values(coursesData).onConflictDoNothing();\n        console.log(`Imported ${coursesData.length} courses`);\n      }\n    }\n\n    // Import course content\n    if (fs.existsSync('./data/course_content.json')) {\n      const contentData = JSON.parse(fs.readFileSync('./data/course_content.json', 'utf8'));\n      if (contentData.length > 0) {\n        await db.insert(schema.courseContent).values(contentData).onConflictDoNothing();\n        console.log(`Imported ${contentData.length} course content items`);\n      }\n    }\n\n    // Import course enrollments\n    if (fs.existsSync('./data/course_enrollments.json')) {\n      const enrollmentData = JSON.parse(fs.readFileSync('./data/course_enrollments.json', 'utf8'));\n      if (enrollmentData.length > 0) {\n        await db.insert(schema.courseEnrollments).values(enrollmentData).onConflictDoNothing();\n        console.log(`Imported ${enrollmentData.length} course enrollments`);\n      }\n    }\n\n    console.log('Data import completed successfully!');\n  } catch (error) {\n    console.error('Error importing data:', error);\n    process.exit(1);\n  } finally {\n    await pool.end();\n  }\n}\n\nimportData();","size_bytes":1864},"server/competitionNotifications.ts":{"content":"import { db } from \"./db\";\nimport { users, monthlyCompetitions, competitionNotifications, emailQueue } from \"@shared/schema\";\nimport { eq, and, sql } from \"drizzle-orm\";\nimport { format, subDays, addHours } from \"date-fns\";\n\nexport class CompetitionNotificationService {\n  \n  // Schedule all notifications for a competition\n  async scheduleCompetitionNotifications(competitionId: string) {\n    const competition = await this.getCompetition(competitionId);\n    if (!competition) return;\n\n    const activeUsers = await this.getActiveUsers();\n    \n    for (const user of activeUsers) {\n      // Schedule advance notice (3 days before)\n      await this.scheduleNotification(\n        competitionId,\n        user.id,\n        \"advance_notice\",\n        \"Monthly Competition Reminder\",\n        `Get ready! The ${competition.title} starts ${format(new Date(competition.startDate), \"MMMM d\")}. Test your Louisiana plumbing code knowledge and compete for subscription rewards!`,\n        subDays(new Date(competition.startDate), 3)\n      );\n\n      // Schedule day-of notification (competition start time)\n      await this.scheduleNotification(\n        competitionId,\n        user.id,\n        \"day_of\",\n        \"ðŸ† Competition is LIVE NOW!\",\n        `The ${competition.title} is now active! You have ${competition.timeLimit} minutes to complete ${competition.questionCount} questions. Winners get free subscription time!`,\n        new Date(competition.startDate)\n      );\n    }\n  }\n\n  // Schedule a single notification\n  private async scheduleNotification(\n    competitionId: string,\n    userId: string,\n    type: string,\n    title: string,\n    message: string,\n    scheduledTime: Date\n  ) {\n    // Create dashboard/in-app notification\n    await db.insert(competitionNotifications).values({\n      competitionId,\n      userId,\n      notificationType: type,\n      channel: \"dashboard\",\n      title,\n      message,\n    });\n\n    // Schedule email notification\n    const user = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n    if (user[0]?.email) {\n      await this.scheduleEmail(\n        user[0].email,\n        user[0].firstName || \"Student\",\n        title,\n        message,\n        competitionId,\n        scheduledTime\n      );\n    }\n  }\n\n  // Schedule email notification\n  private async scheduleEmail(\n    email: string,\n    firstName: string,\n    subject: string,\n    message: string,\n    competitionId: string,\n    scheduledTime: Date\n  ) {\n    const emailTemplate = this.generateEmailTemplate(firstName, subject, message, competitionId);\n    \n    await db.insert(emailQueue).values({\n      recipientEmail: email,\n      senderEmail: process.env.NOREPLY_USER || \"noreply@latrainer.com\",\n      subject,\n      htmlContent: emailTemplate,\n      textContent: message,\n      scheduledFor: scheduledTime,\n      status: \"pending\",\n      retryCount: 0,\n    });\n  }\n\n  // Generate HTML email template\n  private generateEmailTemplate(firstName: string, subject: string, message: string, competitionId: string): string {\n    return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <title>${subject}</title>\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: linear-gradient(135deg, #3B82F6, #1D4ED8); color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }\n        .content { background: #fff; padding: 30px; border: 1px solid #e5e7eb; }\n        .footer { background: #f9fafb; padding: 20px; text-align: center; border-radius: 0 0 8px 8px; }\n        .btn { display: inline-block; background: #10B981; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; margin: 20px 0; }\n        .btn:hover { background: #059669; }\n        .highlight { background: #FEF3C7; padding: 15px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #F59E0B; }\n      </style>\n    </head>\n    <body>\n      <div class=\"container\">\n        <div class=\"header\">\n          <h1>ðŸ† ${subject}</h1>\n          <p>LA Plumb Prep - Official State Prep Course</p>\n        </div>\n        \n        <div class=\"content\">\n          <h2>Hello ${firstName}!</h2>\n          <p>${message}</p>\n          \n          <div class=\"highlight\">\n            <strong>Competition Details:</strong><br>\n            ðŸ“… When: Last day of the month<br>\n            â±ï¸ Duration: 120 minutes<br>\n            ðŸ“ Questions: 100 questions<br>\n            ðŸ… Rewards: 1st place = Free month, 2nd place = Half month free\n          </div>\n          \n          <a href=\"${process.env.VITE_APP_URL || 'https://latrainer.com'}/competitions\" class=\"btn\">\n            View Competition Details\n          </a>\n          \n          <p>Don't miss out on this opportunity to test your Louisiana plumbing code knowledge and compete for valuable prizes!</p>\n          \n          <p>Good luck!<br>\n          The LA Plumb Prep Team</p>\n        </div>\n        \n        <div class=\"footer\">\n          <p><small>\n            You received this email because you're enrolled in LA Plumb Prep courses.<br>\n            <a href=\"${process.env.VITE_APP_URL || 'https://latrainer.com'}/unsubscribe\">Unsubscribe from competition notifications</a>\n          </small></p>\n        </div>\n      </div>\n    </body>\n    </html>\n    `;\n  }\n\n  // Send results notifications after competition ends\n  async sendResultsNotifications(competitionId: string) {\n    const competition = await this.getCompetition(competitionId);\n    if (!competition) return;\n\n    // Get all participants and their results\n    const participants = await db.execute(sql`\n      SELECT \n        ca.userId,\n        ca.score,\n        ca.rank,\n        ca.pointsEarned,\n        u.email,\n        u.firstName,\n        u.lastName\n      FROM competition_attempts ca\n      JOIN users u ON ca.userId = u.id\n      WHERE ca.competitionId = ${competitionId}\n      ORDER BY ca.rank ASC\n    `);\n\n    for (const participant of participants.rows) {\n      const isWinner = participant.rank <= 2;\n      const title = isWinner \n        ? `ðŸŽ‰ Congratulations! You placed #${participant.rank} in ${competition.title}!`\n        : `ðŸ“Š Your ${competition.title} Results`;\n      \n      const message = isWinner\n        ? `Amazing work! You ranked #${participant.rank} and earned ${participant.pointsEarned} points. Your subscription reward will be applied automatically.`\n        : `You completed the competition with a score of ${participant.score}% and earned ${participant.pointsEarned} points. Keep practicing for next month's competition!`;\n\n      // Send in-app notification\n      await db.insert(competitionNotifications).values({\n        competitionId,\n        userId: participant.userId as string,\n        notificationType: \"results\",\n        channel: \"in_app\",\n        title,\n        message,\n        sentAt: new Date(),\n      });\n\n      // Send email notification\n      if (participant.email) {\n        const emailTemplate = this.generateResultsEmail(\n          participant.firstName as string || \"Student\",\n          title,\n          message,\n          participant.score as number,\n          participant.rank as number,\n          participant.pointsEarned as number\n        );\n\n        await db.insert(emailQueue).values({\n          recipientEmail: participant.email as string,\n          senderEmail: process.env.NOREPLY_USER || \"noreply@latrainer.com\",\n          subject: title,\n          htmlContent: emailTemplate,\n          textContent: message,\n          scheduledFor: new Date(),\n          status: \"pending\",\n          retryCount: 0,\n        });\n      }\n    }\n  }\n\n  // Generate results email template\n  private generateResultsEmail(\n    firstName: string,\n    subject: string,\n    message: string,\n    score: number,\n    rank: number,\n    points: number\n  ): string {\n    const isWinner = rank <= 2;\n    const rankColor = rank === 1 ? \"#FFD700\" : rank === 2 ? \"#C0C0C0\" : \"#CD7F32\";\n    \n    return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <title>${subject}</title>\n      <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }\n        .content { background: #fff; padding: 30px; border: 1px solid #e5e7eb; }\n        .footer { background: #f9fafb; padding: 20px; text-align: center; border-radius: 0 0 8px 8px; }\n        .results-card { background: #f8fafc; border: 2px solid ${rankColor}; border-radius: 8px; padding: 20px; margin: 20px 0; text-align: center; }\n        .score { font-size: 48px; font-weight: bold; color: ${rankColor}; }\n        .rank-badge { background: ${rankColor}; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold; }\n        .btn { display: inline-block; background: #3B82F6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; margin: 20px 0; }\n      </style>\n    </head>\n    <body>\n      <div class=\"container\">\n        <div class=\"header\">\n          <h1>${isWinner ? \"ðŸ†\" : \"ðŸ“Š\"} ${subject}</h1>\n          <p>LA Plumb Prep Competition Results</p>\n        </div>\n        \n        <div class=\"content\">\n          <h2>Hello ${firstName}!</h2>\n          <p>${message}</p>\n          \n          <div class=\"results-card\">\n            <div class=\"score\">${score.toFixed(1)}%</div>\n            <div style=\"margin: 10px 0;\">\n              <span class=\"rank-badge\">Rank #${rank}</span>\n            </div>\n            <p><strong>${points} Points Earned</strong></p>\n          </div>\n          \n          ${isWinner ? `\n          <div style=\"background: #FEF3C7; padding: 20px; border-radius: 8px; border-left: 4px solid #F59E0B; margin: 20px 0;\">\n            <h3>ðŸŽ‰ Congratulations on your ${rank === 1 ? \"1st place\" : \"2nd place\"} finish!</h3>\n            <p>Your subscription reward will be automatically applied to your account.</p>\n          </div>\n          ` : `\n          <div style=\"background: #DBEAFE; padding: 20px; border-radius: 8px; border-left: 4px solid #3B82F6; margin: 20px 0;\">\n            <h3>Keep practicing for next month's competition!</h3>\n            <p>Every month is a new opportunity to compete and win valuable prizes.</p>\n          </div>\n          `}\n          \n          <a href=\"${process.env.VITE_APP_URL || 'https://latrainer.com'}/leaderboard\" class=\"btn\">\n            View Full Leaderboard\n          </a>\n          \n          <p>Thank you for participating in our monthly competition!</p>\n          \n          <p>Best regards,<br>\n          The LA Plumb Prep Team</p>\n        </div>\n        \n        <div class=\"footer\">\n          <p><small>\n            <a href=\"${process.env.VITE_APP_URL || 'https://latrainer.com'}/competitions\">View Next Competition</a> |\n            <a href=\"${process.env.VITE_APP_URL || 'https://latrainer.com'}/unsubscribe\">Unsubscribe</a>\n          </small></p>\n        </div>\n      </div>\n    </body>\n    </html>\n    `;\n  }\n\n  // Get unread notifications for a user\n  async getUserNotifications(userId: string) {\n    return await db.select()\n      .from(competitionNotifications)\n      .where(and(\n        eq(competitionNotifications.userId, userId),\n        eq(competitionNotifications.isRead, false)\n      ))\n      .orderBy(competitionNotifications.createdAt);\n  }\n\n  // Mark notification as read\n  async markNotificationRead(notificationId: string) {\n    await db.update(competitionNotifications)\n      .set({ \n        isRead: true, \n        readAt: new Date() \n      })\n      .where(eq(competitionNotifications.id, notificationId));\n  }\n\n  // Helper methods\n  private async getCompetition(competitionId: string) {\n    const [competition] = await db.select()\n      .from(monthlyCompetitions)\n      .where(eq(monthlyCompetitions.id, competitionId))\n      .limit(1);\n    return competition;\n  }\n\n  private async getActiveUsers() {\n    return await db.select({\n      id: users.id,\n      email: users.email,\n      firstName: users.firstName,\n      lastName: users.lastName,\n    })\n    .from(users)\n    .where(eq(users.isActive, true));\n  }\n}\n\nexport const competitionNotificationService = new CompetitionNotificationService();","size_bytes":12396},"client/src/components/dashboard-notifications.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\nimport { Bell, Trophy, Calendar, Medal, ArrowRight } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\n\nexport function DashboardNotifications() {\n  const { data: notifications = [], isLoading } = useQuery({\n    queryKey: [\"/api/notifications\"],\n    refetchInterval: 30000, // Check for new notifications every 30 seconds\n  });\n\n  const { data: currentCompetition } = useQuery({\n    queryKey: [\"/api/competitions/current\"],\n  });\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"w-5 h-5\" />\n            Notifications\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"animate-pulse space-y-3\">\n            <div className=\"h-4 bg-gray-200 rounded\"></div>\n            <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const unreadNotifications = notifications.filter((n: any) => !n.isRead);\n  const recentNotifications = notifications.slice(0, 3);\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"advance_notice\": return Calendar;\n      case \"day_of\": return Trophy;\n      case \"results\": return Medal;\n      default: return Bell;\n    }\n  };\n\n  const getNotificationColor = (type: string) => {\n    switch (type) {\n      case \"advance_notice\": return \"text-blue-500 bg-blue-100\";\n      case \"day_of\": return \"text-green-500 bg-green-100\";\n      case \"results\": return \"text-purple-500 bg-purple-100\";\n      default: return \"text-gray-500 bg-gray-100\";\n    }\n  };\n\n  // Special banner for live competition\n  const isCompetitionLive = currentCompetition?.status === \"active\";\n  const isCompetitionSoon = currentCompetition?.status === \"upcoming\";\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Live Competition Banner */}\n      {isCompetitionLive && (\n        <Card className=\"border-2 border-green-500 bg-gradient-to-r from-green-50 to-green-100\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 bg-green-500 rounded-full\">\n                  <Trophy className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <h3 className=\"font-bold text-green-800\">ðŸ”´ LIVE: Monthly Competition</h3>\n                  <p className=\"text-sm text-green-700\">\n                    {currentCompetition.title} is active now! \n                    {currentCompetition.timeLimit} minutes to complete.\n                  </p>\n                </div>\n              </div>\n              <Link href={`/competition/${currentCompetition.id}/test`}>\n                <Button className=\"bg-green-600 hover:bg-green-700\" data-testid=\"start-live-competition\">\n                  Start Now\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Upcoming Competition Banner */}\n      {isCompetitionSoon && (\n        <Card className=\"border-2 border-blue-500 bg-gradient-to-r from-blue-50 to-blue-100\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 bg-blue-500 rounded-full\">\n                  <Calendar className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <h3 className=\"font-bold text-blue-800\">Upcoming Competition</h3>\n                  <p className=\"text-sm text-blue-700\">\n                    {currentCompetition.title} starts {formatDistanceToNow(new Date(currentCompetition.startDate), { addSuffix: true })}\n                  </p>\n                </div>\n              </div>\n              <Link href=\"/competitions\">\n                <Button variant=\"outline\" className=\"border-blue-500 text-blue-600 hover:bg-blue-50\">\n                  View Details\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Notifications Card */}\n      <Card data-testid=\"dashboard-notifications\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Bell className=\"w-5 h-5\" />\n              Recent Notifications\n              {unreadNotifications.length > 0 && (\n                <Badge variant=\"secondary\" data-testid=\"unread-notifications-count\">\n                  {unreadNotifications.length} unread\n                </Badge>\n              )}\n            </CardTitle>\n            {notifications.length > 3 && (\n              <Button variant=\"ghost\" size=\"sm\" asChild>\n                <Link href=\"/notifications\">\n                  <span className=\"sr-only\">View all notifications</span>\n                  <ArrowRight className=\"w-4 h-4\" />\n                </Link>\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        \n        <CardContent>\n          {notifications.length === 0 ? (\n            <div className=\"text-center py-6 text-gray-500\">\n              <Bell className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n              <p>No notifications yet</p>\n              <p className=\"text-sm mt-1\">\n                You'll receive updates about competitions, achievements, and more!\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {recentNotifications.map((notification: any) => {\n                const IconComponent = getNotificationIcon(notification.notificationType);\n                const iconStyles = getNotificationColor(notification.notificationType);\n                \n                return (\n                  <div\n                    key={notification.id}\n                    className={`p-3 rounded-lg border transition-colors ${\n                      !notification.isRead \n                        ? \"bg-blue-50 border-blue-200\" \n                        : \"bg-gray-50 border-gray-200\"\n                    }`}\n                    data-testid={`dashboard-notification-${notification.id}`}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      <div className={`p-2 rounded-full ${iconStyles}`}>\n                        <IconComponent className=\"w-4 h-4\" />\n                      </div>\n                      \n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className={`text-sm font-medium ${\n                          !notification.isRead ? \"text-gray-900\" : \"text-gray-700\"\n                        }`}>\n                          {notification.title}\n                        </h4>\n                        <p className=\"text-sm text-gray-600 mt-1\">\n                          {notification.message}\n                        </p>\n                        <p className=\"text-xs text-gray-500 mt-2\">\n                          {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true })}\n                        </p>\n                      </div>\n                      \n                      {!notification.isRead && (\n                        <div className=\"w-2 h-2 bg-blue-500 rounded-full mt-2\" />\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n              \n              {notifications.length > 3 && (\n                <div className=\"pt-3 border-t\">\n                  <Link href=\"/notifications\">\n                    <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                      View All Notifications ({notifications.length})\n                    </Button>\n                  </Link>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":8201},"client/src/components/notifications-bell.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Bell, Trophy, Calendar, Medal } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function NotificationsBell() {\n  const [isOpen, setIsOpen] = useState(false);\n  const queryClient = useQueryClient();\n\n  const { data: notifications = [], isLoading } = useQuery({\n    queryKey: [\"/api/notifications\"],\n    refetchInterval: 30000, // Check for new notifications every 30 seconds\n  });\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      await apiRequest(\"POST\", `/api/notifications/${notificationId}/read`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    },\n  });\n\n  const unreadCount = notifications.filter((n: any) => !n.isRead).length;\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"advance_notice\": return Calendar;\n      case \"day_of\": return Trophy;\n      case \"results\": return Medal;\n      default: return Bell;\n    }\n  };\n\n  const getNotificationColor = (type: string) => {\n    switch (type) {\n      case \"advance_notice\": return \"text-blue-500\";\n      case \"day_of\": return \"text-green-500\";\n      case \"results\": return \"text-purple-500\";\n      default: return \"text-gray-500\";\n    }\n  };\n\n  const handleNotificationClick = (notification: any) => {\n    if (!notification.isRead) {\n      markAsReadMutation.mutate(notification.id);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Button variant=\"ghost\" size=\"sm\" disabled>\n        <Bell className=\"w-5 h-5\" />\n      </Button>\n    );\n  }\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          className=\"relative\"\n          data-testid=\"notifications-bell\"\n        >\n          <Bell className=\"w-5 h-5\" />\n          {unreadCount > 0 && (\n            <Badge \n              className=\"absolute -top-2 -right-2 w-5 h-5 p-0 flex items-center justify-center bg-red-500 text-white text-xs\"\n              data-testid=\"notification-count\"\n            >\n              {unreadCount > 9 ? \"9+\" : unreadCount}\n            </Badge>\n          )}\n        </Button>\n      </PopoverTrigger>\n      \n      <PopoverContent className=\"w-80 p-0\" align=\"end\">\n        <Card className=\"border-0 shadow-lg\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Bell className=\"w-5 h-5\" />\n              Notifications\n              {unreadCount > 0 && (\n                <Badge variant=\"secondary\" data-testid=\"header-notification-count\">\n                  {unreadCount} new\n                </Badge>\n              )}\n            </CardTitle>\n          </CardHeader>\n          \n          <CardContent className=\"p-0\">\n            {notifications.length === 0 ? (\n              <div className=\"p-6 text-center text-gray-500\">\n                <Bell className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                <p>No notifications yet</p>\n              </div>\n            ) : (\n              <ScrollArea className=\"h-80\">\n                <div className=\"space-y-1\">\n                  {notifications.map((notification: any) => {\n                    const IconComponent = getNotificationIcon(notification.notificationType);\n                    const iconColor = getNotificationColor(notification.notificationType);\n                    \n                    return (\n                      <div\n                        key={notification.id}\n                        className={`p-4 border-b cursor-pointer transition-colors hover:bg-gray-50 ${\n                          !notification.isRead ? \"bg-blue-50 border-l-4 border-l-blue-500\" : \"\"\n                        }`}\n                        onClick={() => handleNotificationClick(notification)}\n                        data-testid={`notification-${notification.id}`}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <div className={`p-2 rounded-full bg-gray-100 ${iconColor}`}>\n                            <IconComponent className=\"w-4 h-4\" />\n                          </div>\n                          \n                          <div className=\"flex-1 min-w-0\">\n                            <h4 className={`text-sm font-medium ${\n                              !notification.isRead ? \"text-gray-900\" : \"text-gray-700\"\n                            }`}>\n                              {notification.title}\n                            </h4>\n                            <p className=\"text-sm text-gray-600 mt-1 line-clamp-2\">\n                              {notification.message}\n                            </p>\n                            <p className=\"text-xs text-gray-500 mt-2\">\n                              {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true })}\n                            </p>\n                          </div>\n                          \n                          {!notification.isRead && (\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full mt-2\" />\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </ScrollArea>\n            )}\n          </CardContent>\n        </Card>\n      </PopoverContent>\n    </Popover>\n  );\n}","size_bytes":5890},"client/src/pages/achievements.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Award, Star, Trophy, Target, Zap, Medal, Calendar, Book, Users } from \"lucide-react\";\n\nexport default function Achievements() {\n  const { data: userAchievements, isLoading } = useQuery({\n    queryKey: [\"/api/achievements/user\"],\n  });\n\n  const { data: pointsSummary } = useQuery({\n    queryKey: [\"/api/points/summary\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 py-8\">\n        <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-8 bg-gray-200 rounded w-1/3\"></div>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {[...Array(6)].map((_, i) => (\n                <div key={i} className=\"h-48 bg-gray-200 rounded\"></div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // All possible achievements with their requirements\n  const allAchievements = [\n    {\n      id: \"first_competition\",\n      title: \"First Competition\",\n      description: \"Complete your first monthly competition\",\n      icon: Trophy,\n      category: \"competition\",\n      difficulty: \"bronze\",\n      points: 100,\n      requirement: \"Complete 1 competition\"\n    },\n    {\n      id: \"competition_veteran\",\n      title: \"Competition Veteran\", \n      description: \"Complete 5 monthly competitions\",\n      icon: Medal,\n      category: \"competition\",\n      difficulty: \"silver\",\n      points: 300,\n      requirement: \"Complete 5 competitions\"\n    },\n    {\n      id: \"competition_master\",\n      title: \"Competition Master\",\n      description: \"Complete 10 monthly competitions\",\n      icon: Star,\n      category: \"competition\", \n      difficulty: \"gold\",\n      points: 500,\n      requirement: \"Complete 10 competitions\"\n    },\n    {\n      id: \"perfect_score\",\n      title: \"Perfect Score\",\n      description: \"Achieve 100% on a competition\",\n      icon: Target,\n      category: \"performance\",\n      difficulty: \"gold\",\n      points: 500,\n      requirement: \"Score 100% on any competition\"\n    },\n    {\n      id: \"top_performer\",\n      title: \"Top Performer\",\n      description: \"Finish in the top 3 of a competition\",\n      icon: Award,\n      category: \"performance\",\n      difficulty: \"silver\",\n      points: 250,\n      requirement: \"Rank in top 3\"\n    },\n    {\n      id: \"speed_demon\",\n      title: \"Speed Demon\",\n      description: \"Complete a competition in under 60 minutes\",\n      icon: Zap,\n      category: \"performance\",\n      difficulty: \"silver\",\n      points: 200,\n      requirement: \"Complete in under 60 minutes\"\n    },\n    {\n      id: \"early_bird\",\n      title: \"Early Bird\",\n      description: \"Join a competition within the first hour\",\n      icon: Calendar,\n      category: \"participation\",\n      difficulty: \"bronze\",\n      points: 50,\n      requirement: \"Join within first hour\"\n    },\n    {\n      id: \"knowledge_seeker\",\n      title: \"Knowledge Seeker\", \n      description: \"Answer 100 questions correctly across all competitions\",\n      icon: Book,\n      category: \"knowledge\",\n      difficulty: \"silver\",\n      points: 300,\n      requirement: \"100 correct answers total\"\n    },\n    {\n      id: \"community_member\",\n      title: \"Community Member\",\n      description: \"Be part of the plumbing community\",\n      icon: Users,\n      category: \"community\",\n      difficulty: \"bronze\",\n      points: 50,\n      requirement: \"Register and complete profile\"\n    }\n  ];\n\n  const getIconComponent = (iconName: string) => {\n    const iconMap: { [key: string]: any } = {\n      Trophy, Star, Medal, Target, Zap, Award, Calendar, Book, Users\n    };\n    return iconMap[iconName] || Award;\n  };\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case \"bronze\": return \"bg-orange-100 text-orange-800 border-orange-200\";\n      case \"silver\": return \"bg-gray-100 text-gray-800 border-gray-200\";\n      case \"gold\": return \"bg-yellow-100 text-yellow-800 border-yellow-200\";\n      default: return \"bg-blue-100 text-blue-800 border-blue-200\";\n    }\n  };\n\n  const getCategoryColor = (category: string) => {\n    switch (category) {\n      case \"competition\": return \"from-blue-500 to-blue-600\";\n      case \"performance\": return \"from-green-500 to-green-600\";\n      case \"participation\": return \"from-purple-500 to-purple-600\";\n      case \"knowledge\": return \"from-orange-500 to-orange-600\";\n      case \"community\": return \"from-pink-500 to-pink-600\";\n      default: return \"from-gray-500 to-gray-600\";\n    }\n  };\n\n  // Check if user has earned each achievement\n  const getUserAchievementStatus = (achievementId: string) => {\n    if (!userAchievements) return { earned: false, progress: 0 };\n    \n    const userAchievement = userAchievements.find((a: any) => a.achievementId === achievementId);\n    if (userAchievement) {\n      return { earned: true, progress: 100, earnedAt: userAchievement.earnedAt };\n    }\n    \n    // Calculate progress based on user stats\n    const progress = calculateProgress(achievementId);\n    return { earned: false, progress };\n  };\n\n  const calculateProgress = (achievementId: string) => {\n    if (!pointsSummary) return 0;\n    \n    switch (achievementId) {\n      case \"first_competition\":\n        return pointsSummary.competitionsEntered >= 1 ? 100 : (pointsSummary.competitionsEntered * 100);\n      case \"competition_veteran\":\n        return Math.min(100, (pointsSummary.competitionsEntered / 5) * 100);\n      case \"competition_master\":\n        return Math.min(100, (pointsSummary.competitionsEntered / 10) * 100);\n      case \"community_member\":\n        return 100; // Earned by being registered\n      default:\n        return 0;\n    }\n  };\n\n  const earnedAchievements = allAchievements.filter(achievement => \n    getUserAchievementStatus(achievement.id).earned\n  );\n\n  const totalPoints = earnedAchievements.reduce((sum, achievement) => sum + achievement.points, 0);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 py-8\" data-testid=\"achievements-page\">\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-4xl font-bold text-gray-900 mb-4\" data-testid=\"page-title\">\n            Your Achievements\n          </h1>\n          <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\" data-testid=\"page-description\">\n            Track your progress and unlock badges as you advance in your plumbing certification journey\n          </p>\n        </div>\n\n        {/* Summary Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card className=\"bg-gradient-to-r from-blue-500 to-blue-600 text-white\">\n            <CardContent className=\"p-6 text-center\">\n              <Award className=\"w-8 h-8 mx-auto mb-2 opacity-90\" />\n              <div className=\"text-3xl font-bold\" data-testid=\"total-achievements\">\n                {earnedAchievements.length}\n              </div>\n              <div className=\"text-sm opacity-90\">Achievements Earned</div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"bg-gradient-to-r from-purple-500 to-purple-600 text-white\">\n            <CardContent className=\"p-6 text-center\">\n              <Star className=\"w-8 h-8 mx-auto mb-2 opacity-90\" />\n              <div className=\"text-3xl font-bold\" data-testid=\"achievement-points\">\n                {totalPoints}\n              </div>\n              <div className=\"text-sm opacity-90\">Achievement Points</div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"bg-gradient-to-r from-green-500 to-green-600 text-white\">\n            <CardContent className=\"p-6 text-center\">\n              <Trophy className=\"w-8 h-8 mx-auto mb-2 opacity-90\" />\n              <div className=\"text-3xl font-bold\" data-testid=\"competitions-completed\">\n                {pointsSummary?.competitionsEntered || 0}\n              </div>\n              <div className=\"text-sm opacity-90\">Competitions</div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"bg-gradient-to-r from-orange-500 to-orange-600 text-white\">\n            <CardContent className=\"p-6 text-center\">\n              <Target className=\"w-8 h-8 mx-auto mb-2 opacity-90\" />\n              <div className=\"text-3xl font-bold\" data-testid=\"completion-rate\">\n                {Math.round((earnedAchievements.length / allAchievements.length) * 100)}%\n              </div>\n              <div className=\"text-sm opacity-90\">Completion Rate</div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Achievements Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {allAchievements.map((achievement) => {\n            const status = getUserAchievementStatus(achievement.id);\n            const IconComponent = getIconComponent(achievement.icon.name);\n            \n            return (\n              <Card \n                key={achievement.id}\n                className={`relative overflow-hidden transition-all duration-200 ${\n                  status.earned \n                    ? \"ring-2 ring-green-400 shadow-lg transform hover:scale-105\" \n                    : \"hover:shadow-md opacity-80\"\n                }`}\n                data-testid={`achievement-${achievement.id}`}\n              >\n                <div className={`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${getCategoryColor(achievement.category)}`} />\n                \n                <CardHeader className=\"pb-2\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className={`p-3 rounded-lg bg-gradient-to-r ${getCategoryColor(achievement.category)} text-white`}>\n                      <IconComponent className=\"w-6 h-6\" />\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Badge className={getDifficultyColor(achievement.difficulty)} data-testid={`difficulty-${achievement.id}`}>\n                        {achievement.difficulty}\n                      </Badge>\n                      {status.earned && (\n                        <Badge className=\"bg-green-100 text-green-800 border-green-200\" data-testid={`earned-badge-${achievement.id}`}>\n                          âœ“ Earned\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                  \n                  <CardTitle className=\"text-lg\" data-testid={`title-${achievement.id}`}>\n                    {achievement.title}\n                  </CardTitle>\n                  <p className=\"text-sm text-gray-600\" data-testid={`description-${achievement.id}`}>\n                    {achievement.description}\n                  </p>\n                </CardHeader>\n                \n                <CardContent>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-600\">Requirement:</span>\n                      <span className=\"font-medium\" data-testid={`requirement-${achievement.id}`}>\n                        {achievement.requirement}\n                      </span>\n                    </div>\n                    \n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-600\">Points:</span>\n                      <span className=\"font-bold text-blue-600\" data-testid={`points-${achievement.id}`}>\n                        {achievement.points}\n                      </span>\n                    </div>\n                    \n                    {!status.earned && (\n                      <div>\n                        <div className=\"flex justify-between text-sm mb-1\">\n                          <span className=\"text-gray-600\">Progress:</span>\n                          <span data-testid={`progress-text-${achievement.id}`}>\n                            {Math.round(status.progress)}%\n                          </span>\n                        </div>\n                        <Progress \n                          value={status.progress} \n                          className=\"h-2\"\n                          data-testid={`progress-bar-${achievement.id}`}\n                        />\n                      </div>\n                    )}\n                    \n                    {status.earned && status.earnedAt && (\n                      <div className=\"text-sm text-green-600 font-medium\" data-testid={`earned-date-${achievement.id}`}>\n                        Earned: {new Date(status.earnedAt).toLocaleDateString()}\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":13110},"client/src/pages/checkout.tsx":{"content":"import { useStripe, Elements, PaymentElement, useElements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useEffect, useState } from 'react';\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useLocation } from \"wouter\";\nimport { Building2 } from \"lucide-react\";\n\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\n\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\ninterface CustomerInfo {\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone?: string;\n}\n\nconst CheckoutForm = ({ planName, price, priceId, tier }: { \n  planName: string; \n  price: string; \n  priceId: string;\n  tier: string;\n}) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [isLoading, setIsLoading] = useState(false);\n  const [customerInfo, setCustomerInfo] = useState<CustomerInfo>({\n    firstName: '',\n    lastName: '',\n    email: '',\n    phone: ''\n  });\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    setCustomerInfo(prev => ({ ...prev, [name]: value }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    if (!stripe || !elements) {\n      setIsLoading(false);\n      return;\n    }\n\n    // Validate customer information\n    if (!customerInfo.firstName || !customerInfo.lastName || !customerInfo.email) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      setIsLoading(false);\n      return;\n    }\n\n    try {\n      // Confirm payment with customer info\n      const { error } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: `${window.location.origin}/checkout/success?plan=${tier}&email=${encodeURIComponent(customerInfo.email)}`,\n          payment_method_data: {\n            billing_details: {\n              name: `${customerInfo.firstName} ${customerInfo.lastName}`,\n              email: customerInfo.email,\n              phone: customerInfo.phone || undefined,\n            }\n          }\n        },\n      });\n\n      if (error) {\n        toast({\n          title: \"Payment Failed\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      } else {\n        // Payment succeeded - this will be handled by the success page\n        toast({\n          title: \"Payment Processing\",\n          description: \"Processing your enrollment...\",\n        });\n      }\n    } catch (err: any) {\n      toast({\n        title: \"Payment Error\",\n        description: err.message || \"An error occurred during payment\",\n        variant: \"destructive\",\n      });\n    }\n\n    setIsLoading(false);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\" data-testid=\"checkout-form\">\n      {/* Plan Summary */}\n      <div className=\"bg-muted/50 rounded-lg p-6\">\n        <h3 className=\"text-lg font-semibold mb-2\" data-testid=\"plan-summary-title\">\n          {planName} Plan\n        </h3>\n        <p className=\"text-2xl font-bold text-primary\" data-testid=\"plan-summary-price\">\n          {price}/month\n        </p>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          50% off first month â€¢ Cancel anytime\n        </p>\n      </div>\n\n      {/* Customer Information */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Contact Information</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"firstName\">First Name *</Label>\n              <Input\n                id=\"firstName\"\n                name=\"firstName\"\n                value={customerInfo.firstName}\n                onChange={handleInputChange}\n                required\n                data-testid=\"input-first-name\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"lastName\">Last Name *</Label>\n              <Input\n                id=\"lastName\"\n                name=\"lastName\"\n                value={customerInfo.lastName}\n                onChange={handleInputChange}\n                required\n                data-testid=\"input-last-name\"\n              />\n            </div>\n          </div>\n          <div>\n            <Label htmlFor=\"email\">Email Address *</Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              value={customerInfo.email}\n              onChange={handleInputChange}\n              required\n              data-testid=\"input-email\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"phone\">Phone Number (Optional)</Label>\n            <Input\n              id=\"phone\"\n              name=\"phone\"\n              type=\"tel\"\n              value={customerInfo.phone}\n              onChange={handleInputChange}\n              data-testid=\"input-phone\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Payment Information */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Payment Information</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <PaymentElement />\n        </CardContent>\n      </Card>\n      \n      <Button \n        type=\"submit\" \n        className=\"w-full\" \n        size=\"lg\" \n        disabled={!stripe || isLoading}\n        data-testid=\"button-complete-payment\"\n      >\n        {isLoading ? \"Processing...\" : `Complete Enrollment - ${price}/month`}\n      </Button>\n\n      <p className=\"text-xs text-muted-foreground text-center\">\n        By completing this purchase, you agree to our terms of service and privacy policy.\n        Your account will be created automatically and login credentials will be emailed to you.\n      </p>\n    </form>\n  );\n};\n\nexport default function Checkout() {\n  const [location] = useLocation();\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [planDetails, setPlanDetails] = useState<any>(null);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    // Parse URL parameters\n    const urlParams = new URLSearchParams(location.split('?')[1] || '');\n    const plan = urlParams.get('plan');\n    const priceId = urlParams.get('priceId');\n    const planName = urlParams.get('planName');\n    const price = urlParams.get('price');\n\n    if (!plan || !priceId || !planName || !price) {\n      toast({\n        title: \"Invalid Payment Link\",\n        description: \"Please select a plan from the pricing page\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setPlanDetails({ plan, priceId, planName, price });\n\n    // Create payment intent with customer info collection\n    apiRequest(\"POST\", \"/api/create-payment-intent\", { \n      priceId,\n      tier: plan,\n      collectCustomerInfo: true\n    })\n    .then((response) => response.json())\n    .then((data) => {\n      setClientSecret(data.clientSecret);\n    })\n    .catch((error) => {\n      toast({\n        title: \"Payment Setup Failed\",\n        description: error.message || \"Failed to setup payment\",\n        variant: \"destructive\",\n      });\n    });\n  }, [location, toast]);\n\n  if (!clientSecret || !planDetails) {\n    return (\n      <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"text-center mb-8\">\n            <div className=\"flex items-center justify-center space-x-2 mb-6\">\n              <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n              </div>\n              <div className=\"text-left\">\n                <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n                <p className=\"text-xs text-muted-foreground\">Official State Prep Course</p>\n              </div>\n            </div>\n            <div className=\"animate-pulse space-y-3\">\n              <div className=\"h-4 bg-gray-200 rounded\"></div>\n              <div className=\"h-4 bg-gray-200 rounded w-3/4 mx-auto\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center space-x-2 mb-6\">\n            <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n              <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n            </div>\n            <div className=\"text-left\">\n              <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n              <p className=\"text-xs text-muted-foreground\">Official State Prep Course</p>\n            </div>\n          </div>\n          <h2 className=\"text-3xl font-bold text-foreground\" data-testid=\"checkout-title\">\n            Complete Your Enrollment\n          </h2>\n          <p className=\"text-muted-foreground mt-2\">\n            Join thousands of plumbers advancing their careers\n          </p>\n        </div>\n\n        {/* Checkout Form */}\n        <Elements stripe={stripePromise} options={{ clientSecret }}>\n          <CheckoutForm \n            planName={planDetails.planName}\n            price={planDetails.price}\n            priceId={planDetails.priceId}\n            tier={planDetails.plan}\n          />\n        </Elements>\n      </div>\n    </div>\n  );\n}","size_bytes":9945},"client/src/pages/competition-test.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Clock, AlertCircle, CheckCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function CompetitionTest() {\n  const { competitionId } = useParams<{ competitionId: string }>();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [answers, setAnswers] = useState<{ [key: number]: number }>({});\n  const [timeRemaining, setTimeRemaining] = useState<number>(0);\n  const [startTime] = useState(Date.now());\n\n  // Start competition attempt\n  const { data: attempt, isLoading } = useQuery({\n    queryKey: [`/api/competitions/${competitionId}/start`],\n    queryFn: async () => {\n      const response = await fetch(`/api/competitions/${competitionId}/start`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) throw new Error(\"Failed to start competition\");\n      return response.json();\n    },\n    enabled: !!competitionId,\n  });\n\n  // Submit competition attempt\n  const submitMutation = useMutation({\n    mutationFn: async (submissionData: any) => {\n      const response = await fetch(`/api/competitions/${competitionId}/submit`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(submissionData),\n      });\n      if (!response.ok) throw new Error(\"Failed to submit competition\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/competitions/history\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/leaderboard\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/points/summary\"] });\n      \n      toast({\n        title: \"Competition Submitted!\",\n        description: `You scored ${data.score}% and earned ${data.pointsEarned} points!`,\n      });\n      \n      setLocation(\"/competitions\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Submission Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Timer effect\n  useEffect(() => {\n    if (!attempt) return;\n    \n    const competition = attempt.competition;\n    const timeLimitMs = competition.timeLimit * 60 * 1000;\n    const endTime = startTime + timeLimitMs;\n    \n    const timer = setInterval(() => {\n      const now = Date.now();\n      const remaining = Math.max(0, endTime - now);\n      setTimeRemaining(remaining);\n      \n      if (remaining === 0) {\n        handleSubmit();\n      }\n    }, 1000);\n    \n    return () => clearInterval(timer);\n  }, [attempt, startTime]);\n\n  const handleAnswerChange = (questionIndex: number, answerIndex: number) => {\n    setAnswers(prev => ({\n      ...prev,\n      [questionIndex]: answerIndex\n    }));\n  };\n\n  const handleSubmit = () => {\n    if (!attempt) return;\n    \n    const timeSpent = Math.floor((Date.now() - startTime) / 1000);\n    const questions = attempt.questions.map((q: any, index: number) => ({\n      ...q,\n      userAnswer: answers[index] ?? null\n    }));\n    \n    submitMutation.mutate({\n      questions,\n      timeSpent\n    });\n  };\n\n  const formatTime = (ms: number) => {\n    const minutes = Math.floor(ms / 60000);\n    const seconds = Math.floor((ms % 60000) / 1000);\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 py-8\">\n        <div className=\"max-w-4xl mx-auto px-4\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-8 bg-gray-200 rounded w-1/3\"></div>\n            <div className=\"h-64 bg-gray-200 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!attempt) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 py-8\">\n        <div className=\"max-w-4xl mx-auto px-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-red-600\">\n                <AlertCircle className=\"w-6 h-6\" />\n                Competition Not Available\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p>This competition is not currently available or you may have already completed it.</p>\n              <Button onClick={() => setLocation(\"/competitions\")} className=\"mt-4\">\n                Return to Competitions\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  const questions = attempt.questions;\n  const currentQ = questions[currentQuestion];\n  const progress = ((currentQuestion + 1) / questions.length) * 100;\n  const answeredCount = Object.keys(answers).length;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\" data-testid=\"competition-test\">\n      <div className=\"max-w-4xl mx-auto px-4\">\n        {/* Header */}\n        <div className=\"mb-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h1 className=\"text-2xl font-bold\" data-testid=\"competition-title\">\n              {attempt.competition.title}\n            </h1>\n            <div className=\"flex items-center gap-2 text-lg font-semibold\">\n              <Clock className=\"w-5 h-5\" />\n              <span data-testid=\"time-remaining\" className={timeRemaining < 300000 ? \"text-red-600\" : \"\"}>\n                {formatTime(timeRemaining)}\n              </span>\n            </div>\n          </div>\n          \n          {/* Progress */}\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm text-gray-600\">\n              <span>Question {currentQuestion + 1} of {questions.length}</span>\n              <span data-testid=\"answered-count\">{answeredCount} answered</span>\n            </div>\n            <Progress value={progress} className=\"h-2\" />\n          </div>\n        </div>\n\n        {/* Question Card */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\" data-testid=\"question-text\">\n              {currentQ.question}\n            </CardTitle>\n            {currentQ.category && (\n              <p className=\"text-sm text-gray-600\" data-testid=\"question-category\">\n                Category: {currentQ.category}\n              </p>\n            )}\n          </CardHeader>\n          <CardContent>\n            <RadioGroup \n              value={answers[currentQuestion]?.toString()} \n              onValueChange={(value) => handleAnswerChange(currentQuestion, parseInt(value))}\n            >\n              {currentQ.options.map((option: string, index: number) => (\n                <div key={index} className=\"flex items-center space-x-2\">\n                  <RadioGroupItem \n                    value={index.toString()} \n                    id={`option-${index}`}\n                    data-testid={`option-${index}`}\n                  />\n                  <Label htmlFor={`option-${index}`} className=\"flex-1 cursor-pointer\">\n                    {option}\n                  </Label>\n                </div>\n              ))}\n            </RadioGroup>\n          </CardContent>\n        </Card>\n\n        {/* Navigation */}\n        <div className=\"flex items-center justify-between mb-6\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setCurrentQuestion(Math.max(0, currentQuestion - 1))}\n            disabled={currentQuestion === 0}\n            data-testid=\"prev-question\"\n          >\n            Previous\n          </Button>\n          \n          <div className=\"text-sm text-gray-600\">\n            {answers[currentQuestion] !== undefined && (\n              <span className=\"flex items-center gap-1 text-green-600\">\n                <CheckCircle className=\"w-4 h-4\" />\n                Answered\n              </span>\n            )}\n          </div>\n          \n          <Button\n            onClick={() => setCurrentQuestion(Math.min(questions.length - 1, currentQuestion + 1))}\n            disabled={currentQuestion === questions.length - 1}\n            data-testid=\"next-question\"\n          >\n            Next\n          </Button>\n        </div>\n\n        {/* Question Navigation */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Question Navigation</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-10 gap-2\">\n              {questions.map((_: any, index: number) => (\n                <Button\n                  key={index}\n                  variant={currentQuestion === index ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => setCurrentQuestion(index)}\n                  className={`w-10 h-10 ${\n                    answers[index] !== undefined \n                      ? \"bg-green-100 border-green-300 text-green-700\" \n                      : \"\"\n                  }`}\n                  data-testid={`nav-question-${index}`}\n                >\n                  {index + 1}\n                </Button>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Submit Section */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Submit Competition</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-center\">\n                <div>\n                  <div className=\"text-2xl font-bold text-blue-600\" data-testid=\"total-questions\">\n                    {questions.length}\n                  </div>\n                  <div className=\"text-sm text-gray-600\">Total Questions</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold text-green-600\" data-testid=\"answered-questions\">\n                    {answeredCount}\n                  </div>\n                  <div className=\"text-sm text-gray-600\">Answered</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"unanswered-questions\">\n                    {questions.length - answeredCount}\n                  </div>\n                  <div className=\"text-sm text-gray-600\">Remaining</div>\n                </div>\n              </div>\n              \n              {questions.length - answeredCount > 0 && (\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                  <p className=\"text-yellow-800 text-sm\">\n                    You have {questions.length - answeredCount} unanswered questions. \n                    You can submit now or continue answering.\n                  </p>\n                </div>\n              )}\n              \n              <Button \n                onClick={handleSubmit}\n                disabled={submitMutation.isPending}\n                className=\"w-full\"\n                data-testid=\"submit-competition\"\n              >\n                {submitMutation.isPending ? \"Submitting...\" : \"Submit Competition\"}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":11623},"client/src/pages/competitions.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Link } from \"wouter\";\nimport { Clock, Trophy, Users, Medal, Target, Calendar, Award } from \"lucide-react\";\nimport { formatDistanceToNow, format } from \"date-fns\";\n\nexport default function Competitions() {\n  const { data: currentCompetition, isLoading: competitionLoading } = useQuery({\n    queryKey: [\"/api/competitions/current\"],\n  });\n\n  const { data: userHistory, isLoading: historyLoading } = useQuery({\n    queryKey: [\"/api/competitions/history\"],\n  });\n\n  const { data: leaderboard, isLoading: leaderboardLoading } = useQuery({\n    queryKey: [\"/api/leaderboard\"],\n    queryFn: () => fetch(\"/api/leaderboard\").then(res => res.json()),\n  });\n\n  const { data: pointsSummary } = useQuery({\n    queryKey: [\"/api/points/summary\"],\n  });\n\n  if (competitionLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-8 bg-gray-200 rounded w-1/3\"></div>\n            <div className=\"h-64 bg-gray-200 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"active\": return \"bg-green-500\";\n      case \"upcoming\": return \"bg-blue-500\";\n      case \"completed\": return \"bg-gray-500\";\n      default: return \"bg-gray-400\";\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case \"active\": return \"Live Now\";\n      case \"upcoming\": return \"Coming Soon\";\n      case \"completed\": return \"Completed\";\n      default: return status;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\" data-testid=\"competitions-page\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-4xl font-bold text-gray-900 mb-4\" data-testid=\"page-title\">\n            Monthly Competitions\n          </h1>\n          <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\" data-testid=\"page-description\">\n            Compete with fellow plumbers in monthly challenges. Win free subscription time and showcase your expertise!\n          </p>\n        </div>\n\n        {/* Points Summary */}\n        {pointsSummary && (\n          <Card className=\"mb-8 bg-gradient-to-r from-purple-500 to-pink-500 text-white\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Award className=\"w-6 h-6\" />\n                Your Performance\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold\" data-testid=\"total-points\">\n                    {pointsSummary.totalPoints}\n                  </div>\n                  <div className=\"text-sm opacity-90\">Total Points</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold\" data-testid=\"competitions-entered\">\n                    {pointsSummary.competitionsEntered || 0}\n                  </div>\n                  <div className=\"text-sm opacity-90\">Competitions Entered</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold\" data-testid=\"best-rank\">\n                    {pointsSummary.bestRank ? `#${pointsSummary.bestRank}` : \"N/A\"}\n                  </div>\n                  <div className=\"text-sm opacity-90\">Best Rank</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Current Competition */}\n        {currentCompetition && (\n          <Card className=\"mb-8 border-2 border-primary shadow-lg\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2 text-2xl\" data-testid=\"current-competition-title\">\n                    <Trophy className=\"w-6 h-6 text-yellow-500\" />\n                    {currentCompetition.title}\n                  </CardTitle>\n                  <CardDescription className=\"text-lg mt-2\" data-testid=\"current-competition-description\">\n                    {currentCompetition.description}\n                  </CardDescription>\n                </div>\n                <Badge \n                  className={`${getStatusColor(currentCompetition.status)} text-white px-4 py-2 text-sm`}\n                  data-testid={`status-badge-${currentCompetition.status}`}\n                >\n                  {getStatusText(currentCompetition.status)}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6\">\n                <div className=\"flex items-center gap-3\">\n                  <Calendar className=\"w-5 h-5 text-blue-500\" />\n                  <div>\n                    <div className=\"font-semibold\">Test Date</div>\n                    <div className=\"text-sm text-gray-600\" data-testid=\"competition-date\">\n                      {format(new Date(currentCompetition.startDate), \"MMMM d, yyyy\")}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <Clock className=\"w-5 h-5 text-green-500\" />\n                  <div>\n                    <div className=\"font-semibold\">Time Limit</div>\n                    <div className=\"text-sm text-gray-600\" data-testid=\"time-limit\">\n                      {currentCompetition.timeLimit} minutes\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <Target className=\"w-5 h-5 text-orange-500\" />\n                  <div>\n                    <div className=\"font-semibold\">Questions</div>\n                    <div className=\"text-sm text-gray-600\" data-testid=\"question-count\">\n                      {currentCompetition.questionCount} questions\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <Medal className=\"w-5 h-5 text-purple-500\" />\n                  <div>\n                    <div className=\"font-semibold\">Rewards</div>\n                    <div className=\"text-sm text-gray-600\" data-testid=\"rewards\">\n                      1st: Free Month, 2nd: Half Month\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {currentCompetition.status === \"active\" && (\n                <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 mb-4\">\n                  <h4 className=\"font-semibold text-green-800 mb-2\">Competition is Live!</h4>\n                  <p className=\"text-green-700 text-sm mb-3\">\n                    You have until {format(new Date(currentCompetition.endDate), \"h:mm a\")} to complete your test.\n                  </p>\n                  <Link href={`/competition/${currentCompetition.id}/test`}>\n                    <Button className=\"bg-green-600 hover:bg-green-700\" data-testid=\"start-competition-btn\">\n                      Start Competition Test\n                    </Button>\n                  </Link>\n                </div>\n              )}\n\n              {currentCompetition.status === \"upcoming\" && (\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                  <h4 className=\"font-semibold text-blue-800 mb-2\">Competition Starting Soon</h4>\n                  <p className=\"text-blue-700 text-sm\">\n                    Competition begins {formatDistanceToNow(new Date(currentCompetition.startDate), { addSuffix: true })}\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Quick Actions */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Link href=\"/leaderboard\">\n            <Card className=\"cursor-pointer hover:shadow-lg transition-shadow h-full\">\n              <CardHeader className=\"text-center\">\n                <Trophy className=\"w-12 h-12 text-yellow-500 mx-auto mb-2\" />\n                <CardTitle data-testid=\"leaderboard-link\">View Leaderboard</CardTitle>\n                <CardDescription>See top performers</CardDescription>\n              </CardHeader>\n            </Card>\n          </Link>\n\n          <Link href=\"/achievements\">\n            <Card className=\"cursor-pointer hover:shadow-lg transition-shadow h-full\">\n              <CardHeader className=\"text-center\">\n                <Award className=\"w-12 h-12 text-purple-500 mx-auto mb-2\" />\n                <CardTitle data-testid=\"achievements-link\">Your Achievements</CardTitle>\n                <CardDescription>Track your progress</CardDescription>\n              </CardHeader>\n            </Card>\n          </Link>\n\n          <Card className=\"h-full\">\n            <CardHeader className=\"text-center\">\n              <Users className=\"w-12 h-12 text-blue-500 mx-auto mb-2\" />\n              <CardTitle>Community</CardTitle>\n              <CardDescription data-testid=\"total-participants\">\n                {leaderboard?.length || 0} active competitors\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </div>\n\n        {/* Competition History */}\n        {userHistory && userHistory.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Your Competition History</CardTitle>\n              <CardDescription>Track your previous performance</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {userHistory.map((attempt: any) => (\n                  <div key={attempt.id} className=\"flex items-center justify-between p-4 border rounded-lg\" data-testid={`history-item-${attempt.id}`}>\n                    <div>\n                      <h4 className=\"font-semibold\">{attempt.competition?.title}</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        {format(new Date(attempt.completedAt), \"MMMM d, yyyy\")}\n                      </p>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"font-bold text-lg\" data-testid={`score-${attempt.id}`}>\n                        {parseFloat(attempt.score).toFixed(1)}%\n                      </div>\n                      {attempt.rank && (\n                        <div className=\"text-sm text-gray-600\" data-testid={`rank-${attempt.id}`}>\n                          Rank #{attempt.rank}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":11423},"client/src/pages/leaderboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Trophy, Medal, Award, Crown, Target, TrendingUp } from \"lucide-react\";\n\nexport default function Leaderboard() {\n  const { data: leaderboard, isLoading } = useQuery({\n    queryKey: [\"/api/leaderboard\"],\n    queryFn: () => fetch(\"/api/leaderboard\").then(res => res.json()),\n  });\n\n  const { data: currentUser } = useQuery({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-8 bg-gray-200 rounded w-1/3\"></div>\n            <div className=\"h-96 bg-gray-200 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const getRankIcon = (rank: number) => {\n    switch (rank) {\n      case 1: return <Crown className=\"w-6 h-6 text-yellow-500\" />;\n      case 2: return <Trophy className=\"w-6 h-6 text-gray-400\" />;\n      case 3: return <Medal className=\"w-6 h-6 text-orange-500\" />;\n      default: return <Award className=\"w-6 h-6 text-blue-500\" />;\n    }\n  };\n\n  const getRankColor = (rank: number) => {\n    switch (rank) {\n      case 1: return \"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white\";\n      case 2: return \"bg-gradient-to-r from-gray-300 to-gray-500 text-white\";\n      case 3: return \"bg-gradient-to-r from-orange-400 to-orange-600 text-white\";\n      default: return \"bg-white border\";\n    }\n  };\n\n  const getInitials = (firstName?: string, lastName?: string, username?: string) => {\n    if (firstName && lastName) {\n      return `${firstName[0]}${lastName[0]}`.toUpperCase();\n    }\n    if (username) {\n      return username.slice(0, 2).toUpperCase();\n    }\n    return \"??\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\" data-testid=\"leaderboard-page\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-4xl font-bold text-gray-900 mb-4\" data-testid=\"page-title\">\n            Competition Leaderboard\n          </h1>\n          <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\" data-testid=\"page-description\">\n            See how you rank against other Louisiana plumbing professionals\n          </p>\n        </div>\n\n        {/* Top 3 Podium */}\n        {leaderboard && leaderboard.length > 0 && (\n          <div className=\"mb-8\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n              {/* 2nd Place */}\n              {leaderboard[1] && (\n                <Card className={`${getRankColor(2)} transform md:-translate-y-4`}>\n                  <CardHeader className=\"text-center pb-2\">\n                    <div className=\"flex justify-center mb-2\">\n                      {getRankIcon(2)}\n                    </div>\n                    <div className=\"text-lg font-bold\" data-testid=\"rank-2-name\">\n                      {leaderboard[1].firstName} {leaderboard[1].lastName}\n                    </div>\n                    <div className=\"text-sm opacity-90\">2nd Place</div>\n                  </CardHeader>\n                  <CardContent className=\"text-center pt-0\">\n                    <div className=\"text-2xl font-bold\" data-testid=\"rank-2-points\">\n                      {leaderboard[1].totalPoints}\n                    </div>\n                    <div className=\"text-sm opacity-90\">Total Points</div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* 1st Place */}\n              {leaderboard[0] && (\n                <Card className={`${getRankColor(1)} transform md:-translate-y-8`}>\n                  <CardHeader className=\"text-center pb-2\">\n                    <div className=\"flex justify-center mb-2\">\n                      {getRankIcon(1)}\n                    </div>\n                    <div className=\"text-xl font-bold\" data-testid=\"rank-1-name\">\n                      {leaderboard[0].firstName} {leaderboard[0].lastName}\n                    </div>\n                    <div className=\"text-sm opacity-90\">Champion</div>\n                  </CardHeader>\n                  <CardContent className=\"text-center pt-0\">\n                    <div className=\"text-3xl font-bold\" data-testid=\"rank-1-points\">\n                      {leaderboard[0].totalPoints}\n                    </div>\n                    <div className=\"text-sm opacity-90\">Total Points</div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* 3rd Place */}\n              {leaderboard[2] && (\n                <Card className={`${getRankColor(3)} transform md:-translate-y-4`}>\n                  <CardHeader className=\"text-center pb-2\">\n                    <div className=\"flex justify-center mb-2\">\n                      {getRankIcon(3)}\n                    </div>\n                    <div className=\"text-lg font-bold\" data-testid=\"rank-3-name\">\n                      {leaderboard[2].firstName} {leaderboard[2].lastName}\n                    </div>\n                    <div className=\"text-sm opacity-90\">3rd Place</div>\n                  </CardHeader>\n                  <CardContent className=\"text-center pt-0\">\n                    <div className=\"text-2xl font-bold\" data-testid=\"rank-3-points\">\n                      {leaderboard[2].totalPoints}\n                    </div>\n                    <div className=\"text-sm opacity-90\">Total Points</div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Full Leaderboard */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"w-6 h-6\" />\n              Full Rankings\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {!leaderboard || leaderboard.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <Target className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-600\">No competition data yet. Be the first to compete!</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {leaderboard.map((user: any, index: number) => {\n                  const rank = index + 1;\n                  const isCurrentUser = currentUser && user.id === currentUser.id;\n                  \n                  return (\n                    <div\n                      key={user.id}\n                      className={`flex items-center justify-between p-4 rounded-lg transition-colors ${\n                        isCurrentUser \n                          ? \"bg-blue-50 border-2 border-blue-200\" \n                          : \"bg-gray-50 hover:bg-gray-100\"\n                      }`}\n                      data-testid={`leaderboard-row-${rank}`}\n                    >\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"flex items-center justify-center w-10 h-10\">\n                          {rank <= 3 ? (\n                            getRankIcon(rank)\n                          ) : (\n                            <div className=\"text-lg font-bold text-gray-600\" data-testid={`rank-${rank}`}>\n                              #{rank}\n                            </div>\n                          )}\n                        </div>\n                        \n                        <Avatar className=\"w-10 h-10\">\n                          <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                            {getInitials(user.firstName, user.lastName, user.username)}\n                          </AvatarFallback>\n                        </Avatar>\n                        \n                        <div>\n                          <div className=\"font-semibold flex items-center gap-2\" data-testid={`user-name-${rank}`}>\n                            {user.firstName} {user.lastName}\n                            {isCurrentUser && (\n                              <Badge variant=\"secondary\" className=\"text-xs\">You</Badge>\n                            )}\n                          </div>\n                          <div className=\"text-sm text-gray-600\" data-testid={`user-subscription-${rank}`}>\n                            {user.subscriptionTier} member\n                          </div>\n                        </div>\n                      </div>\n                      \n                      <div className=\"text-right\">\n                        <div className=\"text-xl font-bold text-primary\" data-testid={`user-points-${rank}`}>\n                          {user.totalPoints}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">points</div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Current User Position (if not in top visible) */}\n        {currentUser && leaderboard && leaderboard.length > 10 && (\n          <Card className=\"mt-6 border-2 border-blue-200\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Your Position</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-blue-600 mb-2\">\n                  Your position will be calculated after competitions\n                </div>\n                <p className=\"text-gray-600\">Participate in monthly competitions to see your ranking</p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":10002},"client/src/pages/pay-per-use-checkout.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useStripe, useElements, PaymentElement, Elements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useLocation, Link } from 'wouter';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { ArrowLeft, CheckCircle, XCircle } from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\n\n// Make sure to call `loadStripe` outside of a component's render to avoid\n// recreating the `Stripe` object on every render.\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst CheckoutForm = ({ service, amount, onSuccess, onError }: {\n  service: string;\n  amount: number;\n  onSuccess: (paymentIntentId: string) => void;\n  onError: (error: string) => void;\n}) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const { error, paymentIntent } = await stripe.confirmPayment({\n        elements,\n        redirect: 'if_required',\n      });\n\n      if (error) {\n        onError(error.message || 'Payment failed');\n        toast({\n          title: \"Payment Failed\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      } else if (paymentIntent && paymentIntent.status === 'succeeded') {\n        onSuccess(paymentIntent.id);\n        toast({\n          title: \"Payment Successful\",\n          description: `Your ${service} payment has been processed!`,\n        });\n      }\n    } catch (err: any) {\n      onError(err.message || 'Payment failed');\n      toast({\n        title: \"Payment Error\",\n        description: err.message || 'An unexpected error occurred',\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <PaymentElement />\n      <Button\n        type=\"submit\"\n        className=\"w-full\"\n        disabled={!stripe || isLoading}\n        data-testid=\"confirm-payment-button\"\n      >\n        {isLoading ? 'Processing...' : `Pay $${amount.toFixed(2)}`}\n      </Button>\n    </form>\n  );\n};\n\nexport default function PayPerUseCheckout() {\n  const [, setLocation] = useLocation();\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [service, setService] = useState(\"\");\n  const [amount, setAmount] = useState(0);\n  const [paymentStatus, setPaymentStatus] = useState<'pending' | 'processing' | 'succeeded' | 'failed'>('pending');\n  const [result, setResult] = useState<any>(null);\n\n  useEffect(() => {\n    // Get service type from URL params\n    const urlParams = new URLSearchParams(window.location.search);\n    const serviceType = urlParams.get('service');\n    const data = urlParams.get('data');\n\n    if (!serviceType) {\n      setLocation('/tools');\n      return;\n    }\n\n    const initializePayment = async () => {\n      try {\n        let endpoint = '';\n        let serviceDisplayName = '';\n        \n        switch (serviceType) {\n          case 'photo-analysis':\n            endpoint = '/api/pay-per-use/photo-analysis';\n            serviceDisplayName = 'Photo Analysis';\n            break;\n          case 'plan-analysis':\n            endpoint = '/api/pay-per-use/plan-analysis';\n            serviceDisplayName = 'Plan Analysis';\n            break;\n          case 'mentor-question':\n            endpoint = '/api/pay-per-use/mentor-question';\n            serviceDisplayName = 'AI Mentor Question';\n            break;\n          default:\n            setLocation('/tools');\n            return;\n        }\n\n        const response = await apiRequest(\"POST\", endpoint, {\n          [serviceType === 'photo-analysis' ? 'imageData' : \n           serviceType === 'plan-analysis' ? 'planData' : 'question']: data\n        });\n\n        const result = await response.json();\n        setClientSecret(result.clientSecret);\n        setAmount(result.amount);\n        setService(serviceDisplayName);\n      } catch (error: any) {\n        console.error('Failed to initialize payment:', error);\n        setLocation('/tools');\n      }\n    };\n\n    initializePayment();\n  }, [setLocation]);\n\n  const handlePaymentSuccess = async (paymentIntentId: string) => {\n    setPaymentStatus('processing');\n    \n    try {\n      const urlParams = new URLSearchParams(window.location.search);\n      const serviceType = urlParams.get('service');\n      const data = urlParams.get('data');\n\n      const response = await apiRequest(\"POST\", \"/api/pay-per-use/process\", {\n        paymentIntentId,\n        service: serviceType,\n        data: {\n          [serviceType === 'photo-analysis' ? 'imageData' : \n           serviceType === 'plan-analysis' ? 'planData' : 'question']: data\n        }\n      });\n\n      const result = await response.json();\n      setResult(result.result);\n      setPaymentStatus('succeeded');\n    } catch (error: any) {\n      console.error('Failed to process service:', error);\n      setPaymentStatus('failed');\n    }\n  };\n\n  const handlePaymentError = (error: string) => {\n    console.error('Payment error:', error);\n    setPaymentStatus('failed');\n  };\n\n  if (!clientSecret) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  if (paymentStatus === 'processing') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"w-full max-w-md mx-4\">\n          <CardContent className=\"p-8 text-center\">\n            <div className=\"animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4\" />\n            <h2 className=\"text-xl font-semibold mb-2\">Processing Your Request</h2>\n            <p className=\"text-muted-foreground\">\n              Your payment was successful! We're now analyzing your data...\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (paymentStatus === 'succeeded') {\n    return (\n      <div className=\"min-h-screen bg-background p-4\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center space-x-2 text-green-600\">\n                <CheckCircle className=\"w-6 h-6\" />\n                <CardTitle>Analysis Complete!</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg\">\n                <p className=\"text-green-800 dark:text-green-200\">\n                  Your {service} has been completed successfully.\n                </p>\n              </div>\n              \n              {result && (\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">Results:</h3>\n                  <div className=\"bg-muted p-4 rounded-lg\">\n                    <pre className=\"whitespace-pre-wrap text-sm\">{JSON.stringify(result, null, 2)}</pre>\n                  </div>\n                </div>\n              )}\n              \n              <div className=\"flex space-x-4\">\n                <Link href=\"/tools\" className=\"flex-1\">\n                  <Button variant=\"outline\" className=\"w-full\">\n                    <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                    Back to Tools\n                  </Button>\n                </Link>\n                <Link href=\"/tools/ai-pricing\" className=\"flex-1\">\n                  <Button className=\"w-full\">\n                    Upgrade to Unlimited\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (paymentStatus === 'failed') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"w-full max-w-md mx-4\">\n          <CardHeader>\n            <div className=\"flex items-center space-x-2 text-red-600\">\n              <XCircle className=\"w-6 h-6\" />\n              <CardTitle>Payment Failed</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">\n              There was an issue processing your payment. Please try again.\n            </p>\n            <Link href=\"/tools\" className=\"block\">\n              <Button variant=\"outline\" className=\"w-full\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Tools\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4\">\n      <div className=\"max-w-lg mx-auto\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-center\">Pay Per Use - {service}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"mb-6 p-4 bg-muted rounded-lg\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"font-medium\">{service}</span>\n                <span className=\"text-2xl font-bold text-primary\">${amount.toFixed(2)}</span>\n              </div>\n            </div>\n            \n            <Elements stripe={stripePromise} options={{ clientSecret }}>\n              <CheckoutForm\n                service={service}\n                amount={amount}\n                onSuccess={handlePaymentSuccess}\n                onError={handlePaymentError}\n              />\n            </Elements>\n            \n            <div className=\"mt-6 text-center\">\n              <Link href=\"/tools\">\n                <Button variant=\"ghost\" size=\"sm\">\n                  <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                  Cancel and go back\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":10399},"client/src/pages/payment-settings.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { DollarSign, CreditCard, User, ArrowLeft, CheckCircle, Clock, XCircle, AlertTriangle } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\ninterface PaymentSettings {\n  preferredPaymentMethod: \"paypal\" | \"stripe_transfer\" | \"account_credit\";\n  paypalEmail?: string;\n  accountBalance: number;\n  minimumPayout: number;\n}\n\ninterface PayoutRequest {\n  id: string;\n  amount: number;\n  paymentMethod: string;\n  status: \"pending\" | \"processing\" | \"completed\" | \"failed\" | \"cancelled\";\n  requestedAt: string;\n  processedAt?: string;\n  completedAt?: string;\n  failureReason?: string;\n  transactionId?: string;\n}\n\ninterface AccountTransaction {\n  id: string;\n  amount: number;\n  type: \"credit\" | \"debit\" | \"refund\";\n  description: string;\n  balanceBefore: number;\n  balanceAfter: number;\n  createdAt: string;\n}\n\nexport default function PaymentSettings() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [payoutType, setPayoutType] = useState<\"full\" | \"custom\">(\"full\");\n  const [customAmount, setCustomAmount] = useState<string>(\"\");\n\n  // Fetch payment settings\n  const { data: settings, isLoading: settingsLoading } = useQuery({\n    queryKey: [\"/api/payment/settings\"],\n    retry: false,\n  });\n\n  // Fetch payout requests\n  const { data: payoutRequests, isLoading: payoutsLoading } = useQuery({\n    queryKey: [\"/api/payment/payouts\"],\n    retry: false,\n  });\n\n  // Fetch account transactions\n  const { data: transactions, isLoading: transactionsLoading } = useQuery({\n    queryKey: [\"/api/payment/transactions\"],\n    retry: false,\n  });\n\n  // Update payment preferences mutation\n  const updatePreferencesMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"PUT\", \"/api/payment/settings\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Settings Updated\",\n        description: \"Your payment preferences have been saved.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payment/settings\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update payment settings\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Request payout mutation\n  const requestPayoutMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/payment/request-payout\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Payout Requested\",\n        description: \"Your payout request has been submitted for processing.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/payment/payouts\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/referrals/stats\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Request Failed\",\n        description: error.message || \"Failed to request payout\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleUpdateSettings = (formData: FormData) => {\n    const paymentMethod = formData.get(\"paymentMethod\") as string;\n    const paypalEmail = formData.get(\"paypalEmail\") as string;\n    const minimumPayout = parseFloat(formData.get(\"minimumPayout\") as string);\n\n    updatePreferencesMutation.mutate({\n      paymentMethod,\n      paypalEmail: paymentMethod === \"paypal\" ? paypalEmail : undefined,\n      minimumPayout,\n    });\n  };\n\n  const handleRequestPayout = () => {\n    let requestAmount = settings?.unpaidEarnings || 0;\n    \n    if (payoutType === \"custom\") {\n      requestAmount = parseFloat(customAmount);\n      if (isNaN(requestAmount) || requestAmount <= 0) {\n        toast({\n          title: \"Invalid Amount\",\n          description: \"Please enter a valid payout amount\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      if (requestAmount > (settings?.unpaidEarnings || 0)) {\n        toast({\n          title: \"Amount Too High\",\n          description: `Maximum available: $${settings?.unpaidEarnings?.toFixed(2)}`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n    }\n\n    if (requestAmount < (settings?.minimumPayout || 25)) {\n      toast({\n        title: \"Amount Too Low\",\n        description: `Minimum payout amount is $${settings?.minimumPayout || 25}`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    requestPayoutMutation.mutate({\n      paymentMethod: settings.preferredPaymentMethod,\n      amount: requestAmount,\n    });\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n      case \"processing\":\n        return <Clock className=\"h-4 w-4 text-blue-600\" />;\n      case \"failed\":\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\n      case \"cancelled\":\n        return <XCircle className=\"h-4 w-4 text-gray-600\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-yellow-600\" />;\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"text-green-600 bg-green-50\";\n      case \"processing\":\n        return \"text-blue-600 bg-blue-50\";\n      case \"failed\":\n        return \"text-red-600 bg-red-50\";\n      case \"cancelled\":\n        return \"text-gray-600 bg-gray-50\";\n      default:\n        return \"text-yellow-600 bg-yellow-50\";\n    }\n  };\n\n  if (settingsLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <section className=\"py-8\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"mb-6\">\n            <Link href=\"/referrals\">\n              <Button variant=\"outline\" className=\"mb-4\" data-testid=\"back-to-referrals\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Referrals\n              </Button>\n            </Link>\n            <h1 className=\"text-3xl font-bold\">Payment Settings</h1>\n            <p className=\"text-muted-foreground mt-2\">\n              Manage your payment preferences and view payout history\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Left Column - Settings */}\n            <div className=\"space-y-6\">\n              {/* Account Balance */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <DollarSign className=\"h-5 w-5 text-green-600\" />\n                    Account Balance\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"text-center\">\n                      <div className=\"text-3xl font-bold text-green-600\">\n                        ${settings?.accountBalance?.toFixed(2) || \"0.00\"}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">Available Balance</div>\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                      <div className=\"text-center p-3 bg-gray-50 rounded\">\n                        <div className=\"font-bold\">${settings?.unpaidEarnings?.toFixed(2) || \"0.00\"}</div>\n                        <div className=\"text-muted-foreground\">Unpaid Earnings</div>\n                      </div>\n                      <div className=\"text-center p-3 bg-gray-50 rounded\">\n                        <div className=\"font-bold\">${settings?.minimumPayout?.toFixed(2) || \"25.00\"}</div>\n                        <div className=\"text-muted-foreground\">Min Payout</div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Payment Preferences */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <CreditCard className=\"h-5 w-5\" />\n                    Payment Preferences\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <form action={handleUpdateSettings} className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"paymentMethod\">Preferred Payment Method</Label>\n                      <Select name=\"paymentMethod\" defaultValue={settings?.preferredPaymentMethod || \"paypal\"}>\n                        <SelectTrigger data-testid=\"payment-method-select\">\n                          <SelectValue placeholder=\"Select payment method\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"paypal\">PayPal</SelectItem>\n                          <SelectItem value=\"stripe_transfer\">Bank Transfer (Stripe)</SelectItem>\n                          <SelectItem value=\"account_credit\">Account Credit</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"paypalEmail\">PayPal Email (if using PayPal)</Label>\n                      <Input\n                        id=\"paypalEmail\"\n                        name=\"paypalEmail\"\n                        type=\"email\"\n                        defaultValue={settings?.paypalEmail || \"\"}\n                        placeholder=\"your-paypal@email.com\"\n                        data-testid=\"paypal-email\"\n                      />\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"minimumPayout\">Minimum Payout Amount</Label>\n                      <Input\n                        id=\"minimumPayout\"\n                        name=\"minimumPayout\"\n                        type=\"number\"\n                        min=\"25\"\n                        step=\"0.01\"\n                        defaultValue={settings?.minimumPayout || 25}\n                        data-testid=\"minimum-payout\"\n                      />\n                      <div className=\"text-xs text-muted-foreground mt-1\">\n                        Minimum $25 for PayPal/Stripe, $10 for account credit\n                      </div>\n                    </div>\n\n                    <Button\n                      type=\"submit\"\n                      disabled={updatePreferencesMutation.isPending}\n                      className=\"w-full\"\n                      data-testid=\"update-settings\"\n                    >\n                      {updatePreferencesMutation.isPending ? \"Updating...\" : \"Update Settings\"}\n                    </Button>\n                  </form>\n                </CardContent>\n              </Card>\n\n              {/* Request Payout */}\n              <Card className=\"border-green-200 bg-green-50\">\n                <CardHeader>\n                  <CardTitle className=\"text-green-800\">Request Payout</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"text-sm text-green-700\">\n                      Available for payout: <strong>${settings?.unpaidEarnings?.toFixed(2) || \"0.00\"}</strong>\n                    </div>\n\n                    <RadioGroup value={payoutType} onValueChange={(value: \"full\" | \"custom\") => setPayoutType(value)}>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"full\" id=\"full\" />\n                        <Label htmlFor=\"full\" className=\"text-sm\">\n                          Request full amount (${settings?.unpaidEarnings?.toFixed(2) || \"0.00\"})\n                        </Label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"custom\" id=\"custom\" />\n                        <Label htmlFor=\"custom\" className=\"text-sm\">\n                          Custom amount\n                        </Label>\n                      </div>\n                    </RadioGroup>\n\n                    {payoutType === \"custom\" && (\n                      <div>\n                        <Label htmlFor=\"customAmount\" className=\"text-sm\">Custom Payout Amount</Label>\n                        <Input\n                          id=\"customAmount\"\n                          type=\"number\"\n                          min=\"0\"\n                          max={settings?.unpaidEarnings || 0}\n                          step=\"0.01\"\n                          value={customAmount}\n                          onChange={(e) => setCustomAmount(e.target.value)}\n                          placeholder={`Min: $${settings?.minimumPayout || 25}, Max: $${settings?.unpaidEarnings?.toFixed(2) || \"0.00\"}`}\n                          className=\"mt-1\"\n                          data-testid=\"custom-payout-amount\"\n                        />\n                      </div>\n                    )}\n\n                    <div className=\"text-xs text-green-600\">\n                      {payoutType === \"full\" \n                        ? \"You'll receive the full available amount\"\n                        : \"Specify how much you want to withdraw\"\n                      }\n                    </div>\n\n                    <Button\n                      onClick={handleRequestPayout}\n                      disabled={!settings?.unpaidEarnings || (settings?.unpaidEarnings < (settings?.minimumPayout || 25)) || requestPayoutMutation.isPending}\n                      className=\"w-full bg-green-600 hover:bg-green-700\"\n                      data-testid=\"request-payout\"\n                    >\n                      {requestPayoutMutation.isPending \n                        ? \"Processing...\" \n                        : `Request ${payoutType === \"full\" ? \"Full\" : \"Custom\"} Payout`\n                      }\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Right Column - History */}\n            <div className=\"lg:col-span-2 space-y-6\">\n              {/* Payout Requests */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Payout Requests</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {payoutsLoading ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                    </div>\n                  ) : payoutRequests && payoutRequests.length > 0 ? (\n                    <div className=\"space-y-4\">\n                      {payoutRequests.map((payout: PayoutRequest) => (\n                        <div key={payout.id} className=\"flex justify-between items-center p-4 border rounded-lg\">\n                          <div>\n                            <div className=\"font-medium\">${payout.amount.toFixed(2)}</div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {new Date(payout.requestedAt).toLocaleDateString()} â€¢ {payout.paymentMethod}\n                            </div>\n                            {payout.failureReason && (\n                              <div className=\"text-xs text-red-600 mt-1\">\n                                <AlertTriangle className=\"h-3 w-3 inline mr-1\" />\n                                {payout.failureReason}\n                              </div>\n                            )}\n                          </div>\n                          <div className=\"text-right\">\n                            <div className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(payout.status)}`}>\n                              {getStatusIcon(payout.status)}\n                              {payout.status.charAt(0).toUpperCase() + payout.status.slice(1)}\n                            </div>\n                            {payout.transactionId && (\n                              <div className=\"text-xs text-muted-foreground mt-1\">\n                                ID: {payout.transactionId}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No payout requests yet\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Account Transactions */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Account Transactions</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {transactionsLoading ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <div className=\"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full\" />\n                    </div>\n                  ) : transactions && transactions.length > 0 ? (\n                    <div className=\"space-y-3\">\n                      {transactions.slice(0, 10).map((transaction: AccountTransaction) => (\n                        <div key={transaction.id} className=\"flex justify-between items-center p-3 border rounded\">\n                          <div>\n                            <div className=\"font-medium\">{transaction.description}</div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {new Date(transaction.createdAt).toLocaleDateString()}\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className={`font-bold ${transaction.type === 'debit' ? 'text-red-600' : 'text-green-600'}`}>\n                              {transaction.type === 'debit' ? '-' : '+'}${transaction.amount.toFixed(2)}\n                            </div>\n                            <div className=\"text-xs text-muted-foreground\">\n                              Balance: ${transaction.balanceAfter.toFixed(2)}\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      No transactions yet\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":19432},"client/src/pages/podcast-view.tsx":{"content":"import { useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, Loader2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport PodcastPlayer from \"@/components/podcast-player\";\n\nexport default function PodcastView() {\n  const [match, params] = useRoute(\"/course/:courseId/podcast/:contentId\");\n  const contentId = params?.contentId;\n  const courseId = params?.courseId;\n  const [podcastProgress, setPodcastProgress] = useState(0);\n  const [isCompleted, setIsCompleted] = useState(false);\n  \n  const { data: content, isLoading, error } = useQuery({\n    queryKey: [`/api/content/${contentId}/display`],\n    enabled: !!contentId,\n  });\n\n  // Load saved progress from localStorage\n  useEffect(() => {\n    if (contentId) {\n      const savedProgress = localStorage.getItem(`podcast-progress-${contentId}`);\n      if (savedProgress) {\n        const progress = JSON.parse(savedProgress);\n        setPodcastProgress(progress.sentenceIndex || 0);\n        setIsCompleted(progress.completed || false);\n      }\n    }\n  }, [contentId]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (error || !content) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-red-500 mb-4\">Failed to load content</p>\n          <Button asChild>\n            <Link href=\"/courses\">Back to Courses</Link>\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Extract podcast content safely\n  const podcastContent = (content as any)?.content?.extracted?.transcript || \n                        (content as any)?.content?.extracted?.content || \n                        (content as any)?.content?.extracted?.text || \n                        (content as any)?.content?.podcast?.transcript ||\n                        (content as any)?.content?.text || \n                        'No podcast content available';\n\n  // Check for autostart from URL\n  const urlParams = new URLSearchParams(window.location.search);\n  const shouldAutoStart = urlParams.get('autostart') === 'true';\n\n  const handleProgressUpdate = (sentenceIndex: number, totalSentences: number) => {\n    const progress = (sentenceIndex / totalSentences) * 100;\n    setPodcastProgress(sentenceIndex);\n    \n    // Save progress to localStorage\n    localStorage.setItem(`podcast-progress-${contentId}`, JSON.stringify({\n      sentenceIndex,\n      totalSentences,\n      completed: sentenceIndex >= totalSentences - 1,\n      timestamp: Date.now()\n    }));\n\n    // Mark as completed if finished\n    if (sentenceIndex >= totalSentences - 1) {\n      setIsCompleted(true);\n    }\n  };\n\n  const handleReturnToLesson = () => {\n    // Navigate back to lesson page\n    window.location.href = `/course/${courseId}/lesson/${content?.section || ''}`;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <Button asChild variant=\"outline\" className=\"mb-6\">\n          <Link href=\"/courses\">\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Courses\n          </Link>\n        </Button>\n\n        <Card className=\"mb-6\">\n          <CardHeader className=\"text-center\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <span className=\"text-2xl\">ðŸŽ§</span>\n            </div>\n            <CardTitle className=\"text-2xl\">\n              {content?.title || 'Podcast Lesson'}\n            </CardTitle>\n            <p className=\"text-muted-foreground\">\n              Audio lesson with interactive transcript\n            </p>\n          </CardHeader>\n        </Card>\n\n        <PodcastPlayer \n          content={podcastContent} \n          autoStart={shouldAutoStart}\n          initialProgress={podcastProgress}\n          onProgressUpdate={handleProgressUpdate}\n        />\n\n        <Card className=\"mt-6\">\n          <CardContent className=\"p-6 text-center\">\n            <Button \n              className=\"w-full max-w-sm mx-auto\"\n              onClick={handleReturnToLesson}\n            >\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Return to Lesson {isCompleted && '(Completed)'}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":4654},"client/src/pages/admin/bulk-studyplan-import.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Upload, FileText, CheckCircle, AlertCircle, Clock, BookOpen } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { PLUMBING_CODE_SECTIONS, filterSectionsByChapter } from \"@/lib/plumbing-code-sections\";\n\nexport default function BulkStudyPlanImport() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [selectedChapter, setSelectedChapter] = useState(\"\");\n  const [selectedSection, setSelectedSection] = useState(\"\");\n  const [selectedDifficulty, setSelectedDifficulty] = useState(\"medium\");\n\n  // Filter sections based on selected chapter\n  const filteredSections = selectedChapter ? filterSectionsByChapter(selectedChapter) : [];\n\n  // Reset section when chapter changes\n  useEffect(() => {\n    setSelectedSection(\"\");\n  }, [selectedChapter]);\n  const [studyPlanText, setStudyPlanText] = useState(\"\");\n  const [previewPlans, setPreviewPlans] = useState<any[]>([]);\n  const [importStatus, setImportStatus] = useState<\"idle\" | \"parsing\" | \"previewing\" | \"importing\" | \"success\">(\"idle\");\n\n  // Fetch courses\n  const { data: courses } = useQuery({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const bulkImportMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/study-plans/bulk-import\", data),\n    onSuccess: (result: any) => {\n      const { imported, duplicatesSkipped, totalSubmitted } = result;\n      \n      if (duplicatesSkipped > 0) {\n        toast({ \n          title: \"Import completed with duplicates detected\", \n          description: `Added ${imported} new study plans. Skipped ${duplicatesSkipped} duplicates out of ${totalSubmitted} total.`,\n          variant: \"default\"\n        });\n      } else {\n        toast({ \n          title: \"All study plans imported successfully!\", \n          description: `Added ${imported} new study plans to the course.`\n        });\n      }\n      \n      setImportStatus(\"success\");\n      setStudyPlanText(\"\");\n      setPreviewPlans([]);\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Import failed\",\n        description: error.message || \"Failed to import study plans\",\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  });\n\n  const parseStudyPlans = () => {\n    if (!studyPlanText.trim()) {\n      toast({\n        title: \"No content\",\n        description: \"Please enter study plans to parse\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setImportStatus(\"parsing\");\n\n    try {\n      const parsed = parseStudyPlansFromText(studyPlanText);\n      if (parsed.length === 0) {\n        throw new Error(\"No valid study plans found. Please check the format.\");\n      }\n      \n      setPreviewPlans(parsed);\n      setImportStatus(\"previewing\");\n      toast({\n        title: \"Study plans parsed successfully!\",\n        description: `Found ${parsed.length} study plan sessions ready for import.`\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Parse error\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  };\n\n  const isSectionValid = selectedSection && selectedSection.trim().length > 0;\n\n  const importStudyPlans = () => {\n    if (!selectedCourse) {\n      toast({\n        title: \"No course selected\",\n        description: \"Please select a course first\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!selectedChapter || !selectedSection) {\n      toast({\n        title: \"Chapter and Section required\",\n        description: \"Please select both chapter and section for organization\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!isSectionValid) {\n      toast({\n        title: \"Invalid section number\",\n        description: \"Enter a valid section number (e.g., 101)\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Update study plans with current chapter and section values to prevent stale data\n    const payloadPlans = previewPlans.map(plan => ({\n      ...plan,\n      chapter: selectedChapter,\n      category: selectedChapter,\n      section: selectedSection,\n      codeReference: `${selectedChapter} - Section ${selectedSection}`,\n      difficulty: selectedDifficulty\n    }));\n\n    setImportStatus(\"importing\");\n    bulkImportMutation.mutate({\n      courseId: selectedCourse,\n      studyPlans: payloadPlans\n    });\n  };\n\n  const parseStudyPlansFromText = (text: string) => {\n    const studyPlans: any[] = [];\n    \n    // Split by time duration headers (10 minutes, 15 minutes, 1 hour, etc.)\n    const timeSections = text.split(/(?=\\d+(?:\\.\\d+)?\\s+(?:minutes?|hours?)\\n)/i);\n    \n    timeSections.forEach((section, index) => {\n      const lines = section.trim().split('\\n').filter(line => line.trim());\n      if (lines.length < 3) return;\n      \n      // Extract duration from first line - handle both minutes and hours\n      const minuteMatch = lines[0].match(/(\\d+)\\s+minutes?/i);\n      const hourMatch = lines[0].match(/(\\d+(?:\\.\\d+)?)\\s+hours?/i);\n      \n      let duration = 0;\n      if (minuteMatch) {\n        duration = parseInt(minuteMatch[1]);\n      } else if (hourMatch) {\n        duration = Math.round(parseFloat(hourMatch[1]) * 60); // Convert hours to minutes\n      } else {\n        return; // No valid duration found\n      }\n      \n      // Look for study plan content after the duration\n      let planTitle = \"\";\n      let planContent = \"\";\n      let startIndex = 1;\n      \n      // Find the plan title (usually has \"Study Plan\" in it)\n      for (let i = 1; i < lines.length; i++) {\n        if (lines[i].includes(\"Study Plan\") || lines[i].includes(\"study plan\")) {\n          planTitle = lines[i].trim();\n          startIndex = i + 1;\n          break;\n        }\n      }\n      \n      // If no specific title found, create one\n      if (!planTitle) {\n        planTitle = `${duration}-Minute Study Plan`;\n        startIndex = 1;\n      }\n      \n      // Collect all content after the title\n      planContent = lines.slice(startIndex).join('\\n').trim();\n      \n      if (planTitle.length > 3 && planContent.length > 20) {\n        studyPlans.push({\n          id: crypto.randomUUID(),\n          title: planTitle,\n          content: planContent,\n          duration: duration,\n          type: 'study_plan',\n          createdAt: new Date(),\n        });\n      }\n    });\n    \n    // If no time-based sections found, try parsing by major headings\n    if (studyPlans.length === 0) {\n      const sections = text.split(/\\n(?=[A-Z].*Study Plan)/);\n      \n      sections.forEach((section, index) => {\n        const lines = section.trim().split('\\n').filter(line => line.trim());\n        if (lines.length < 2) return;\n        \n        const title = lines[0].trim();\n        const content = lines.slice(1).join('\\n').trim();\n        \n        // Try to extract duration from content\n        const durationMatch = content.match(/(\\d+)[-\\s]*minute/i);\n        const duration = durationMatch ? parseInt(durationMatch[1]) : 30; // Default 30 minutes\n        \n        if (title.length > 3 && content.length > 20) {\n          studyPlans.push({\n            id: crypto.randomUUID(),\n            title: title,\n            content: content,\n            duration: duration,\n            type: 'study_plan',\n            createdAt: new Date(),\n          });\n        }\n      });\n    }\n    \n    return studyPlans;\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Bulk Study Plan Import</h1>\n          <p className=\"text-muted-foreground\">\n            Import adaptive study plans with time-based sessions and interactive content\n          </p>\n        </div>\n\n        {/* Course and Chapter/Section Selection */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Course & Louisiana Plumbing Code Organization</CardTitle>\n            <CardDescription>Choose course, chapter, section and difficulty level for all study plans in this batch</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Label htmlFor=\"course\">Select Course</Label>\n                <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select a course\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {(courses as any[])?.map((course: any) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"chapter\">Chapter</Label>\n                <Select value={selectedChapter} onValueChange={setSelectedChapter}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select chapter\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Chapter 1\">Chapter 1 - Administration</SelectItem>\n                    <SelectItem value=\"Chapter 2\">Chapter 2 - Definitions</SelectItem>\n                    <SelectItem value=\"Chapter 3\">Chapter 3 - General Regulations</SelectItem>\n                    <SelectItem value=\"Chapter 4\">Chapter 4 - Fixtures, Faucets and Fittings</SelectItem>\n                    <SelectItem value=\"Chapter 5\">Chapter 5 - Water Heaters</SelectItem>\n                    <SelectItem value=\"Chapter 6\">Chapter 6 - Water Supply and Distribution</SelectItem>\n                    <SelectItem value=\"Chapter 7\">Chapter 7 - Sanitary Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 8\">Chapter 8 - Indirect/Special Waste</SelectItem>\n                    <SelectItem value=\"Chapter 9\">Chapter 9 - Vents</SelectItem>\n                    <SelectItem value=\"Chapter 10\">Chapter 10 - Traps, Interceptors and Separators</SelectItem>\n                    <SelectItem value=\"Chapter 11\">Chapter 11 - Storm Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 12\">Chapter 12 - Special Piping and Storage Systems</SelectItem>\n                    <SelectItem value=\"Chapter 13\">Chapter 13 - Health Care Facilities and Other Special Occupancies</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"section\">Section</Label>\n                <Input \n                  id=\"section\"\n                  type=\"text\"\n                  value={selectedSection} \n                  onChange={(e) => setSelectedSection(e.target.value)}\n                  placeholder={selectedChapter ? `Enter section number (e.g., 101, 103, 105...)` : \"Select chapter first\"}\n                  disabled={!selectedChapter}\n                  className=\"w-full\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"difficulty\">Difficulty Level</Label>\n                <Select value={selectedDifficulty} onValueChange={setSelectedDifficulty}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select difficulty\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"easy\">Easy - Basic recall</SelectItem>\n                    <SelectItem value=\"hard\">Hard - Analysis</SelectItem>\n                    <SelectItem value=\"very_hard\">Very Hard - Synthesis</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n\n        {/* Study Plan Input */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Paste Your Study Plans</CardTitle>\n            <CardDescription>Copy and paste time-based study plans with structured learning sessions</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"studyplans\">Study Plans Content</Label>\n                <Textarea\n                  id=\"studyplans\"\n                  value={studyPlanText}\n                  onChange={(e) => setStudyPlanText(e.target.value)}\n                  rows={15}\n                  placeholder={`Paste your study plans here...\n\nExample:\n10 minutes\n\n10-Minute Study Plan: LSPC Administration & Authority\n\nMinutes 0-2: Core Adoption & Naming\nFocus on how the Department of Health and Hospitals, Office of Public Health, adopts Part XIV (Plumbing) of the Sanitary Code, State of Louisiana (LAC 51:XIV).\nUnderstand that this is also known as the \"Louisiana State Plumbing Code\" (LSPC) and that these terms are interchangeable.\n\nMinutes 2-5: Source of Authority\nIdentify R.S. 36:258(B) as the first source of authority for the sanitary code.\nNote that more specific provisions are found in Chapters 1 and 4 of Title 40 of the Louisiana Revised Statutes.\n\n15 minutes\n\n15-Minute Study Plan: LSPC Administration & Authority\n\nMinutes 0-2: Recap & Core Adoption\nQuickly review that the Department of Health and Hospitals, Office of Public Health, adopts Part XIV...`}\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n              \n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={parseStudyPlans}\n                  disabled={!studyPlanText.trim() || importStatus === \"parsing\"}\n                  className=\"flex items-center gap-2\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  {importStatus === \"parsing\" ? \"Parsing...\" : \"Parse Study Plans\"}\n                </Button>\n                \n                {previewPlans.length > 0 && (\n                  <Button \n                    onClick={importStudyPlans}\n                    disabled={!selectedCourse || importStatus === \"importing\"}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <Upload className=\"h-4 w-4\" />\n                    {importStatus === \"importing\" ? \"Importing...\" : `Import ${previewPlans.length} Study Plans`}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Preview */}\n        {previewPlans.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                Preview ({previewPlans.length} study plans found)\n              </CardTitle>\n              <CardDescription>Review the parsed study plans before importing</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                {previewPlans.map((plan, index) => (\n                  <div key={index} className=\"border rounded-lg p-4\">\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <h4 className=\"font-semibold text-blue-600 mb-1\">Study Plan Title</h4>\n                          <p className=\"text-sm bg-blue-50 p-2 rounded font-medium\">\n                            {plan.title}\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-1 text-sm text-muted-foreground bg-gray-100 px-2 py-1 rounded\">\n                          <Clock className=\"h-3 w-3\" />\n                          {plan.duration} min\n                        </div>\n                      </div>\n                      <div>\n                        <h4 className=\"font-semibold text-green-600 mb-2\">Content Preview</h4>\n                        <div className=\"text-sm bg-green-50 p-3 rounded whitespace-pre-line max-h-32 overflow-y-auto\">\n                          {plan.content.substring(0, 500)}{plan.content.length > 500 ? \"...\" : \"\"}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {importStatus === \"success\" && (\n          <Alert className=\"mt-6\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Study plans imported successfully! You can now view them in the Content Management section.\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":17570},"client/src/pages/admin/system-analytics.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Users, BookOpen, DollarSign, TrendingUp, Eye, UserPlus, CreditCard, GraduationCap, UserCheck } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport default function SystemAnalytics() {\n  const [timeRange, setTimeRange] = useState(\"30\");\n\n  // Fetch analytics data\n  const { data: analytics } = useQuery({\n    queryKey: [\"/api/admin/analytics\", timeRange],\n  });\n\n  // Type-safe analytics data with defaults\n  const stats = {\n    totalUsers: (analytics as any)?.totalUsers || 0,\n    activeStudents: (analytics as any)?.activeStudents || 0,\n    totalRevenue: (analytics as any)?.totalRevenue || 0,\n    courseCompletions: (analytics as any)?.courseCompletions || 0,\n    newSignups: (analytics as any)?.newSignups || 0,\n    subscriptionConversions: (analytics as any)?.subscriptionConversions || 0,\n    jobApplications: (analytics as any)?.jobApplications || 0,\n    betaFeedbackScore: (analytics as any)?.betaFeedbackScore || 0\n  };\n\n  // Fetch course-specific enrollment data\n  const { data: courseStats } = useQuery({\n    queryKey: [\"/api/admin/course-analytics\"],\n  });\n\n  // Fetch students list\n  const { data: studentsData } = useQuery({\n    queryKey: [\"/api/admin/students\"],\n  });\n\n  // Type-safe course stats with defaults\n  const coursesData = {\n    journeymanEnrolled: (courseStats as any)?.journeymanEnrolled || 0,\n    journeymanProgress: (courseStats as any)?.journeymanProgress || 0,\n    journeymanCompletion: (courseStats as any)?.journeymanCompletion || 0,\n    backflowWaitlist: (courseStats as any)?.backflowWaitlist || 0\n  };\n\n  const students = (studentsData as any)?.students || [];\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\">System Analytics</h1>\n            <p className=\"text-muted-foreground\">\n              Monitor platform performance and user engagement\n            </p>\n          </div>\n          <Select value={timeRange} onValueChange={setTimeRange}>\n            <SelectTrigger className=\"w-48\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"7\">Last 7 days</SelectItem>\n              <SelectItem value=\"30\">Last 30 days</SelectItem>\n              <SelectItem value=\"90\">Last 90 days</SelectItem>\n              <SelectItem value=\"365\">Last year</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Key Metrics Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.totalUsers}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                +{stats.newSignups} new this period\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Active Students</CardTitle>\n              <GraduationCap className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.activeStudents}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Currently enrolled\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Revenue</CardTitle>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">${stats.totalRevenue}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Total platform revenue\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Course Completions</CardTitle>\n              <BookOpen className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.courseCompletions}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                Lessons completed\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Detailed Analytics */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle>User Engagement</CardTitle>\n              <CardDescription>Student activity and progression metrics</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Beta Feedback Score</span>\n                  <span className=\"text-2xl font-bold text-green-600\">{stats.betaFeedbackScore}/5</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Avg. Session Duration</span>\n                  <span className=\"text-sm\">24 minutes</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Course Progress Rate</span>\n                  <span className=\"text-sm\">73%</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">AI Tool Usage</span>\n                  <span className=\"text-sm\">156 queries this month</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Business Metrics</CardTitle>\n              <CardDescription>Revenue and conversion analytics</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Subscription Conversions</span>\n                  <span className=\"text-2xl font-bold text-blue-600\">{stats.subscriptionConversions}%</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Avg. Revenue per User</span>\n                  <span className=\"text-sm\">$89</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Referral Commission Paid</span>\n                  <span className=\"text-sm\">$2,340</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Job Placements</span>\n                  <span className=\"text-sm\">{stats.jobApplications} applications</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Course Analytics */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Course Performance</CardTitle>\n            <CardDescription>Detailed analytics for each course offering</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded-lg\">\n                <div>\n                  <h3 className=\"font-semibold\">Louisiana Journeyman Prep</h3>\n                  <p className=\"text-sm text-muted-foreground\">Active Course</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Enrolled Students</p>\n                  <div className=\"flex items-center gap-2\">\n                    <p className=\"text-lg font-semibold\">{coursesData.journeymanEnrolled}</p>\n                    <Dialog>\n                      <DialogTrigger asChild>\n                        <Button variant=\"outline\" size=\"sm\" className=\"text-xs\" data-testid=\"button-view-students\">\n                          <UserCheck className=\"w-3 h-3 mr-1\" />\n                          View List\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n                        <DialogHeader>\n                          <DialogTitle>Enrolled Students ({students.length})</DialogTitle>\n                          <DialogDescription>\n                            List of all currently enrolled students with their subscription details\n                          </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"space-y-4\">\n                          {students.length > 0 ? (\n                            <div className=\"grid gap-3\">\n                              {students.map((student: any, index: number) => (\n                                <Card key={student.id} className=\"p-4\" data-testid={`student-card-${index}`}>\n                                  <div className=\"flex items-center justify-between\">\n                                    <div className=\"flex items-center space-x-3\">\n                                      <div className=\"w-10 h-10 bg-primary rounded-full flex items-center justify-center\">\n                                        <span className=\"text-primary-foreground font-semibold text-sm\">\n                                          {(student.firstName?.[0] || student.email[0]).toUpperCase()}\n                                        </span>\n                                      </div>\n                                      <div>\n                                        <h4 className=\"font-semibold text-sm\" data-testid={`student-name-${index}`}>\n                                          {student.firstName && student.lastName \n                                            ? `${student.firstName} ${student.lastName}`\n                                            : student.email\n                                          }\n                                        </h4>\n                                        <p className=\"text-xs text-muted-foreground\" data-testid={`student-email-${index}`}>\n                                          {student.email}\n                                        </p>\n                                        <p className=\"text-xs text-muted-foreground\">\n                                          Joined: {new Date(student.createdAt).toLocaleDateString()}\n                                        </p>\n                                      </div>\n                                    </div>\n                                    <div className=\"flex items-center space-x-2\">\n                                      <Badge \n                                        variant={student.subscriptionTier === 'master' ? 'default' : \n                                               student.subscriptionTier === 'professional' ? 'secondary' : 'outline'}\n                                        className=\"text-xs\"\n                                      >\n                                        {student.subscriptionTier}\n                                      </Badge>\n                                      {student.isBetaTester && (\n                                        <Badge variant=\"destructive\" className=\"text-xs\">\n                                          Beta\n                                        </Badge>\n                                      )}\n                                      <Badge \n                                        variant={student.isActive ? 'default' : 'secondary'}\n                                        className=\"text-xs\"\n                                      >\n                                        {student.isActive ? 'Active' : 'Inactive'}\n                                      </Badge>\n                                    </div>\n                                  </div>\n                                </Card>\n                              ))}\n                            </div>\n                          ) : (\n                            <div className=\"text-center py-8 text-muted-foreground\">\n                              No enrolled students found\n                            </div>\n                          )}\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  </div>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Avg. Progress</p>\n                  <p className=\"text-lg font-semibold\">{coursesData.journeymanProgress}%</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Completion Rate</p>\n                  <p className=\"text-lg font-semibold\">{coursesData.journeymanCompletion}%</p>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded-lg opacity-60\">\n                <div>\n                  <h3 className=\"font-semibold\">Backflow Prevention</h3>\n                  <p className=\"text-sm text-muted-foreground\">Coming Soon</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Waitlist</p>\n                  <p className=\"text-lg font-semibold\">{coursesData.backflowWaitlist}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Expected Launch</p>\n                  <p className=\"text-lg font-semibold\">Q2 2025</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Interest Score</p>\n                  <p className=\"text-lg font-semibold\">High</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":15110},"client/src/pages/checkout/success.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCircle, Mail, Lock, Building2 } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function CheckoutSuccess() {\n  const [location] = useLocation();\n  const [isProcessing, setIsProcessing] = useState(true);\n  const [credentials, setCredentials] = useState<any>(null);\n  const [customerEmail, setCustomerEmail] = useState(\"\");\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(location.split('?')[1] || '');\n    const plan = urlParams.get('plan');\n    const email = urlParams.get('email');\n    const paymentIntentId = urlParams.get('payment_intent');\n\n    if (email) {\n      setCustomerEmail(decodeURIComponent(email));\n    }\n\n    if (paymentIntentId && plan && email) {\n      // Process the successful payment and create account\n      processSuccessfulPayment(paymentIntentId, plan, decodeURIComponent(email));\n    } else {\n      setIsProcessing(false);\n    }\n  }, [location]);\n\n  const processSuccessfulPayment = async (paymentIntentId: string, plan: string, email: string) => {\n    try {\n      const response = await apiRequest(\"POST\", \"/api/process-payment-success\", {\n        paymentIntentId,\n        plan,\n        email\n      });\n      const data = await response.json();\n      \n      setCredentials(data.credentials);\n      setIsProcessing(false);\n      \n      toast({\n        title: \"Account Created Successfully!\",\n        description: \"Check your email for login credentials and receipt\",\n      });\n    } catch (error: any) {\n      console.error(\"Error processing payment success:\", error);\n      setIsProcessing(false);\n      toast({\n        title: \"Processing Error\",\n        description: \"Payment successful, but there was an issue creating your account. Please contact support.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (isProcessing) {\n    return (\n      <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"text-center\">\n            <div className=\"flex items-center justify-center space-x-2 mb-6\">\n              <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n                <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n              </div>\n              <div className=\"text-left\">\n                <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n                <p className=\"text-xs text-muted-foreground\">Official State Prep Course</p>\n              </div>\n            </div>\n            <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4\"></div>\n            <h2 className=\"text-2xl font-bold mb-2\">Processing Your Enrollment...</h2>\n            <p className=\"text-muted-foreground\">Creating your account and sending confirmation email</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center space-x-2 mb-6\">\n            <div className=\"w-12 h-12 bg-primary rounded-lg flex items-center justify-center\">\n              <Building2 className=\"w-7 h-7 text-primary-foreground\" />\n            </div>\n            <div className=\"text-left\">\n              <h1 className=\"text-xl font-bold text-primary\">LA Plumb Prep</h1>\n              <p className=\"text-xs text-muted-foreground\">Official State Prep Course</p>\n            </div>\n          </div>\n          \n          <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <CheckCircle className=\"w-8 h-8 text-green-600\" />\n          </div>\n          \n          <h2 className=\"text-3xl font-bold text-foreground mb-2\" data-testid=\"success-title\">\n            Welcome to LA Plumb Prep!\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Your enrollment was successful and your account has been created\n          </p>\n        </div>\n\n        {/* Success Details */}\n        <div className=\"space-y-6\">\n          {/* Credentials Card */}\n          {credentials && (\n            <Card className=\"border-green-200 bg-green-50\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-green-800\">\n                  <Lock className=\"w-5 h-5\" />\n                  Your Login Credentials\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div>\n                  <p className=\"text-sm text-green-700 font-medium\">Username:</p>\n                  <p className=\"text-lg font-mono bg-white p-2 rounded border\" data-testid=\"generated-username\">\n                    {credentials.username}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-green-700 font-medium\">Temporary Password:</p>\n                  <p className=\"text-lg font-mono bg-white p-2 rounded border\" data-testid=\"generated-password\">\n                    {credentials.password}\n                  </p>\n                </div>\n                <div className=\"bg-green-100 border border-green-300 rounded p-3 text-sm text-green-800\">\n                  <p className=\"font-medium\">Important:</p>\n                  <ul className=\"mt-1 space-y-1 text-xs\">\n                    <li>â€¢ Save these credentials in a safe place</li>\n                    <li>â€¢ You can change your password after logging in</li>\n                    <li>â€¢ These credentials have also been emailed to you</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Email Confirmation */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Mail className=\"w-5 h-5\" />\n                Check Your Email\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p className=\"text-muted-foreground\">\n                We've sent confirmation emails to <strong>{customerEmail}</strong>:\n              </p>\n              <ul className=\"space-y-2 text-sm\">\n                <li className=\"flex items-center gap-2\">\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                  Payment receipt and subscription details\n                </li>\n                <li className=\"flex items-center gap-2\">\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                  Account verification with login credentials\n                </li>\n                <li className=\"flex items-center gap-2\">\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                  Getting started guide and course access\n                </li>\n              </ul>\n              <div className=\"bg-blue-50 border border-blue-200 rounded p-3 text-sm text-blue-800\">\n                Don't see the emails? Check your spam folder or contact support.\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Next Steps */}\n          <Card>\n            <CardHeader>\n              <CardTitle>What's Next?</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-4\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold\">\n                    1\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium\">Log into your account</h4>\n                    <p className=\"text-sm text-muted-foreground\">Use the credentials above or from your email</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold\">\n                    2\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium\">Complete your profile</h4>\n                    <p className=\"text-sm text-muted-foreground\">Update your password and profile information</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold\">\n                    3\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium\">Start your first course</h4>\n                    <p className=\"text-sm text-muted-foreground\">Begin with Louisiana Journeyman Prep</p>\n                  </div>\n                </div>\n              </div>\n              \n              <Button asChild className=\"w-full mt-6\" size=\"lg\" data-testid=\"button-login\">\n                <a href=\"/login\">\n                  Login to Your Account\n                </a>\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9568},"client/src/pages/plan-analysis-tool.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  FileText, \n  Upload, \n  CheckCircle, \n  MapPin, \n  Calculator, \n  FileCheck, \n  AlertTriangle,\n  Zap,\n  Download,\n  DollarSign,\n  Clock,\n  Brain,\n  Target,\n  ArrowRight,\n  Package,\n  Ruler,\n  Settings\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\n\nexport default function PlanAnalysisTool() {\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [analysisResult, setAnalysisResult] = useState<any>(null);\n  const [uploadedFile, setUploadedFile] = useState<File | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const calculatePricing = (fileSizeBytes: number) => {\n    const sizeMB = fileSizeBytes / (1024 * 1024);\n    \n    if (sizeMB <= 2) return { tier: \"Small\", price: 4.99, description: \"â‰¤2MB\" };\n    if (sizeMB <= 10) return { tier: \"Medium\", price: 9.99, description: \"2-10MB\" };\n    if (sizeMB <= 25) return { tier: \"Large\", price: 19.99, description: \"10-25MB\" };\n    return { tier: \"Enterprise\", price: 39.99, description: \"25MB+\" };\n  };\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      setUploadedFile(file);\n      setAnalysisResult(null);\n    }\n  };\n\n  const handleAnalyze = async () => {\n    if (!uploadedFile) return;\n\n    const pricing = calculatePricing(uploadedFile.size);\n    \n    // Redirect to checkout with file info\n    setLocation(`/pay-per-use?service=plan-analysis&amount=${pricing.price}&fileName=${encodeURIComponent(uploadedFile.name)}&fileSize=${uploadedFile.size}`);\n  };\n\n  const pricingTiers = [\n    {\n      tier: \"Small Files\",\n      size: \"â‰¤2MB\",\n      price: \"$4.99\",\n      description: \"Perfect for simple floor plans and basic schematics\",\n      features: [\n        \"Basic material list generation\",\n        \"Standard code compliance check\",\n        \"Simple fitting identification\",\n        \"PDF export included\"\n      ],\n      color: \"bg-green-50 border-green-200\"\n    },\n    {\n      tier: \"Medium Files\", \n      size: \"2-10MB\",\n      price: \"$9.99\",\n      description: \"Ideal for detailed blueprints and multi-room layouts\",\n      features: [\n        \"Comprehensive material lists\",\n        \"Advanced code analysis\",\n        \"Detailed fitting mapping\",\n        \"Cost estimation included\",\n        \"3D visualization support\"\n      ],\n      color: \"bg-blue-50 border-blue-200\",\n      popular: true\n    },\n    {\n      tier: \"Large Files\",\n      size: \"10-25MB\", \n      price: \"$19.99\",\n      description: \"For complex commercial plans and multi-story buildings\",\n      features: [\n        \"Enterprise-grade analysis\",\n        \"Multi-floor coordination\",\n        \"Advanced material optimization\",\n        \"Detailed cost breakdowns\",\n        \"Priority processing\",\n        \"CAD file support\"\n      ],\n      color: \"bg-purple-50 border-purple-200\"\n    },\n    {\n      tier: \"Enterprise Files\",\n      size: \"25MB+\",\n      price: \"$39.99\", \n      description: \"Large-scale commercial and industrial projects\",\n      features: [\n        \"Industrial-grade processing\",\n        \"Complex system analysis\",\n        \"Advanced optimization algorithms\",\n        \"Custom material specifications\",\n        \"Expedited delivery\",\n        \"Technical support included\"\n      ],\n      color: \"bg-orange-50 border-orange-200\"\n    }\n  ];\n\n  const features = [\n    {\n      icon: MapPin,\n      title: \"Spatial Coordinate Mapping\",\n      description: \"Advanced AI identifies exact locations of fittings, valves, and connections with precise coordinates and confidence scores.\",\n      benefits: [\n        \"Numbered fitting overlays on plans\",\n        \"GPS-style coordinate mapping\", \n        \"95%+ accuracy in fitting detection\",\n        \"Confidence scores for each identification\"\n      ]\n    },\n    {\n      icon: Package,\n      title: \"Automatic Material List Generation\",\n      description: \"Generate comprehensive material lists with quantities, specifications, and current market pricing automatically.\",\n      benefits: [\n        \"Accurate pipe sizing calculations\",\n        \"Fitting type identification\",\n        \"Quantity calculations with 10% buffer\",\n        \"Real-time pricing from major suppliers\"\n      ]\n    },\n    {\n      icon: FileCheck,\n      title: \"Louisiana Code Compliance\",\n      description: \"Comprehensive analysis against Louisiana Plumbing Code requirements with detailed violation reporting.\",\n      benefits: [\n        \"Clearance requirement validation\",\n        \"Installation angle verification\", \n        \"Code violation flagging\",\n        \"Corrective action recommendations\"\n      ]\n    },\n    {\n      icon: Calculator,\n      title: \"Cost Estimation Engine\",\n      description: \"Professional-grade cost analysis with labor estimates, material costs, and project timeline predictions.\",\n      benefits: [\n        \"Material cost calculations\",\n        \"Labor hour estimations\",\n        \"Total project cost projections\",\n        \"Cost optimization suggestions\"\n      ]\n    },\n    {\n      icon: Brain,\n      title: \"AI-Powered Analysis\",\n      description: \"GPT-5 powered analysis engine trained specifically on Louisiana plumbing codes and industry standards.\",\n      benefits: [\n        \"Louisiana-specific code knowledge\",\n        \"Industry best practices integration\",\n        \"Continuous learning improvements\",\n        \"Professional-grade accuracy\"\n      ]\n    },\n    {\n      icon: Download,\n      title: \"Professional Reports\",\n      description: \"Generate detailed PDF reports with analysis results, material lists, and compliance summaries.\",\n      benefits: [\n        \"Formatted PDF exports\",\n        \"Professional documentation\",\n        \"Client-ready presentations\",\n        \"Compliance certificates\"\n      ]\n    }\n  ];\n\n  const sampleResults = [\n    {\n      title: \"Spatial Mapping Results\",\n      description: \"AI-identified 47 fittings with coordinate precision\",\n      items: [\n        \"Kitchen sink connection: (X: 145.2, Y: 67.8) - 95% confidence\",\n        \"Main water line: (X: 203.1, Y: 145.9) - 98% confidence\", \n        \"Bathroom fixtures: (X: 89.4, Y: 201.3) - 92% confidence\",\n        \"Hot water heater: (X: 256.7, Y: 78.2) - 97% confidence\"\n      ]\n    },\n    {\n      title: \"Generated Material List\",\n      description: \"Comprehensive list with current pricing\",\n      items: [\n        \"3/4\\\" Copper Type L Pipe: 124 ft - $387.40\",\n        \"1/2\\\" PEX Tubing: 89 ft - $156.80\",\n        \"3/4\\\" Ball Valves: 8 units - $127.20\",\n        \"Pipe Fittings (Various): 34 units - $89.60\"\n      ]\n    },\n    {\n      title: \"Code Compliance Check\",\n      description: \"Louisiana code analysis results\",\n      items: [\n        \"âœ… All clearances meet minimum requirements\",\n        \"âš ï¸ Hot water line needs additional insulation (Section 605.11)\",\n        \"âœ… Fixture spacing complies with accessibility standards\",\n        \"âš ï¸ Shutoff valve placement requires adjustment\"\n      ]\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 text-white\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <div className=\"flex items-center justify-center gap-3 mb-6\">\n              <FileText className=\"w-16 h-16 text-blue-200\" />\n              <h1 className=\"text-5xl lg:text-6xl font-bold\" data-testid=\"plan-analysis-title\">\n                Plan Analysis Tool\n              </h1>\n            </div>\n            <p className=\"text-xl text-blue-100 max-w-3xl mx-auto mb-8\" data-testid=\"plan-analysis-description\">\n              Revolutionary AI-powered plan analysis with spatial coordinate mapping, automated material lists, and Louisiana code compliance checking. Pay only for what you analyze.\n            </p>\n            \n            {/* Key Stats */}\n            <div className=\"grid grid-cols-3 gap-8 max-w-2xl mx-auto mb-8\">\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-blue-200\">95%+</div>\n                <div className=\"text-sm text-blue-300\">Accuracy Rate</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-blue-200\">5 Min</div>\n                <div className=\"text-sm text-blue-300\">Average Analysis</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-blue-200\">$4.99</div>\n                <div className=\"text-sm text-blue-300\">Starting Price</div>\n              </div>\n            </div>\n\n            {/* Upload Section */}\n            <div className=\"max-w-md mx-auto\">\n              <Card className=\"bg-white/10 border-white/20\">\n                <CardContent className=\"p-6\">\n                  <div className=\"space-y-4\">\n                    <input\n                      type=\"file\"\n                      ref={fileInputRef}\n                      onChange={handleFileSelect}\n                      accept=\".pdf,.dwg,.png,.jpg,.jpeg\"\n                      className=\"hidden\"\n                      data-testid=\"file-input\"\n                    />\n                    \n                    {uploadedFile ? (\n                      <div className=\"space-y-4\">\n                        <div className=\"p-4 bg-white/10 rounded-lg\">\n                          <div className=\"flex items-center gap-3\">\n                            <FileText className=\"w-6 h-6 text-blue-200\" />\n                            <div className=\"text-left\">\n                              <div className=\"font-medium text-white\">{uploadedFile.name}</div>\n                              <div className=\"text-sm text-blue-200\">\n                                {(uploadedFile.size / (1024 * 1024)).toFixed(2)} MB\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                        \n                        <div className=\"p-4 bg-green-500/20 border border-green-400/30 rounded-lg\">\n                          <div className=\"text-center\">\n                            <div className=\"font-semibold text-green-100\">\n                              {calculatePricing(uploadedFile.size).tier} Plan Analysis\n                            </div>\n                            <div className=\"text-2xl font-bold text-white\">\n                              ${calculatePricing(uploadedFile.size).price}\n                            </div>\n                            <div className=\"text-sm text-green-200\">\n                              {calculatePricing(uploadedFile.size).description}\n                            </div>\n                          </div>\n                        </div>\n                        \n                        <Button \n                          onClick={handleAnalyze}\n                          className=\"w-full bg-green-600 hover:bg-green-700 text-white\"\n                          size=\"lg\"\n                          disabled={isAnalyzing}\n                          data-testid=\"analyze-plan-button\"\n                        >\n                          {isAnalyzing ? (\n                            <>Analyzing Plan...</>\n                          ) : (\n                            <>\n                              Analyze Plan - ${calculatePricing(uploadedFile.size).price}\n                              <ArrowRight className=\"w-4 h-4 ml-2\" />\n                            </>\n                          )}\n                        </Button>\n                      </div>\n                    ) : (\n                      <Button \n                        onClick={() => fileInputRef.current?.click()}\n                        variant=\"outline\"\n                        className=\"w-full border-white/30 text-white hover:bg-white/10\"\n                        size=\"lg\"\n                        data-testid=\"upload-plan-button\"\n                      >\n                        <Upload className=\"w-5 h-5 mr-2\" />\n                        Upload Plan or Blueprint\n                      </Button>\n                    )}\n                    \n                    <p className=\"text-xs text-blue-200\">\n                      Supports PDF, DWG, PNG, JPG files up to 50MB\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Tiers */}\n      <section className=\"py-20 bg-muted/30\" data-testid=\"pricing-tiers\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold text-foreground mb-4\">\n              Transparent File-Size Based Pricing\n            </h2>\n            <p className=\"text-xl text-muted-foreground\">\n              Automatic pricing based on your file size - no hidden fees, no subscriptions required.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            {pricingTiers.map((tier, index) => (\n              <Card \n                key={tier.tier}\n                className={`${tier.color} ${tier.popular ? 'ring-2 ring-blue-500 relative' : ''}`}\n                data-testid={`pricing-tier-${index}`}\n              >\n                {tier.popular && (\n                  <Badge className=\"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white\">\n                    Most Popular\n                  </Badge>\n                )}\n                <CardHeader>\n                  <CardTitle className=\"flex items-center justify-between\">\n                    {tier.tier}\n                    <span className=\"text-2xl font-bold text-primary\">{tier.price}</span>\n                  </CardTitle>\n                  <div className=\"text-lg font-semibold text-muted-foreground\">{tier.size}</div>\n                  <p className=\"text-sm text-muted-foreground\">{tier.description}</p>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    {tier.features.map((feature, idx) => (\n                      <div key={idx} className=\"flex items-start space-x-2\">\n                        <CheckCircle className=\"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                        <span className=\"text-sm\">{feature}</span>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section className=\"py-20\" data-testid=\"features-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl font-bold text-foreground mb-4\">\n              Advanced AI Analysis Features\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\">\n              Our GPT-5 powered analysis engine provides professional-grade insights that would take hours to calculate manually.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12\">\n            {features.map((feature, index) => (\n              <Card key={feature.title} className=\"p-8\" data-testid={`feature-${index}`}>\n                <div className=\"flex items-start space-x-4\">\n                  <div className=\"p-3 bg-primary/10 rounded-lg flex-shrink-0\">\n                    <feature.icon className=\"w-8 h-8 text-primary\" />\n                  </div>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <h3 className=\"text-xl font-bold text-foreground mb-2\">{feature.title}</h3>\n                      <p className=\"text-muted-foreground\">{feature.description}</p>\n                    </div>\n                    <div className=\"space-y-2\">\n                      {feature.benefits.map((benefit, idx) => (\n                        <div key={idx} className=\"flex items-start space-x-2\">\n                          <CheckCircle className=\"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                          <span className=\"text-sm text-muted-foreground\">{benefit}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Sample Results */}\n      <section className=\"py-20 bg-muted/30\" data-testid=\"sample-results\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold text-foreground mb-4\">\n              See What You Get\n            </h2>\n            <p className=\"text-xl text-muted-foreground\">\n              Example results from our Plan Analysis Tool showing the detailed insights you'll receive.\n            </p>\n          </div>\n          \n          <Tabs defaultValue=\"spatial\" className=\"max-w-4xl mx-auto\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"spatial\">Spatial Mapping</TabsTrigger>\n              <TabsTrigger value=\"materials\">Material Lists</TabsTrigger>\n              <TabsTrigger value=\"compliance\">Code Compliance</TabsTrigger>\n            </TabsList>\n            \n            {sampleResults.map((result, index) => (\n              <TabsContent \n                key={index}\n                value={[\"spatial\", \"materials\", \"compliance\"][index]}\n                className=\"mt-8\"\n              >\n                <Card className=\"p-8\">\n                  <div className=\"text-center mb-6\">\n                    <h3 className=\"text-2xl font-bold text-foreground mb-2\">{result.title}</h3>\n                    <p className=\"text-muted-foreground\">{result.description}</p>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    {result.items.map((item, idx) => (\n                      <Card key={idx} className=\"p-4 bg-muted/20\">\n                        <div className=\"flex items-start space-x-3\">\n                          <div className=\"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0 mt-1\">\n                            <span className=\"text-xs font-semibold text-primary\">{idx + 1}</span>\n                          </div>\n                          <span className=\"text-sm\">{item}</span>\n                        </div>\n                      </Card>\n                    ))}\n                  </div>\n                </Card>\n              </TabsContent>\n            ))}\n          </Tabs>\n        </div>\n      </section>\n\n      {/* How It Works */}\n      <section className=\"py-20\" data-testid=\"how-it-works\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold text-foreground mb-4\">\n              How It Works\n            </h2>\n            <p className=\"text-xl text-muted-foreground\">\n              Simple 4-step process to get professional plan analysis in minutes.\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n            {[\n              {\n                step: \"1\",\n                title: \"Upload Plan\",\n                description: \"Upload your construction plan, blueprint, or schematic in PDF, DWG, or image format.\",\n                icon: Upload\n              },\n              {\n                step: \"2\", \n                title: \"Auto-Pricing\",\n                description: \"System automatically detects file size and calculates pricing ($4.99-$39.99).\",\n                icon: DollarSign\n              },\n              {\n                step: \"3\",\n                title: \"AI Analysis\",\n                description: \"GPT-5 analyzes your plan for fittings, materials, codes, and costs in under 5 minutes.\",\n                icon: Brain\n              },\n              {\n                step: \"4\",\n                title: \"Get Results\",\n                description: \"Receive detailed PDF report with material lists, coordinates, and compliance check.\",\n                icon: Download\n              }\n            ].map((step, index) => (\n              <Card key={step.step} className=\"text-center p-6\" data-testid={`step-${index}`}>\n                <div className=\"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <step.icon className=\"w-8 h-8 text-primary\" />\n                </div>\n                <div className=\"w-8 h-8 bg-primary rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <span className=\"text-white font-bold\">{step.step}</span>\n                </div>\n                <h3 className=\"text-lg font-semibold text-foreground mb-2\">{step.title}</h3>\n                <p className=\"text-sm text-muted-foreground\">{step.description}</p>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-20 bg-gradient-to-r from-blue-600 to-blue-700 text-white\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl lg:text-4xl font-bold mb-6\">\n            Ready to Analyze Your Plans?\n          </h2>\n          <p className=\"text-xl text-blue-100 mb-8\">\n            Join hundreds of Louisiana plumbers using AI to streamline their project planning and ensure code compliance.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Button \n              onClick={() => fileInputRef.current?.click()}\n              size=\"lg\"\n              className=\"bg-white text-blue-600 hover:bg-blue-50\"\n              data-testid=\"cta-upload-button\"\n            >\n              <Upload className=\"w-5 h-5 mr-2\" />\n              Upload Your Plan Now\n            </Button>\n            <Link href=\"/tools/ai-pricing\">\n              <Button variant=\"outline\" size=\"lg\" className=\"border-white text-white hover:bg-white/10\">\n                View AI Tools Pricing\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":22941},"client/src/pages/admin/bulk-podcast-import.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Mic, Volume2, Play, Pause, Download, Save, CheckCircle } from \"lucide-react\";\n\nexport default function BulkPodcastImport() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [selectedChapter, setSelectedChapter] = useState(\"\");\n  const [selectedSection, setSelectedSection] = useState(\"\");\n  const [selectedDifficulty, setSelectedDifficulty] = useState(\"hard\");\n  \n  // TTS Integration for podcast creation\n  const [ttsTitle, setTtsTitle] = useState(\"\");\n  const [ttsContent, setTtsContent] = useState(\"\");\n  const [ttsError, setTtsError] = useState(\"\");\n  const [ttsAudioResult, setTtsAudioResult] = useState<any>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [currentSentenceIndex, setCurrentSentenceIndex] = useState(0);\n  const [frozenSentences, setFrozenSentences] = useState<any[]>([]);\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const textScrollRef = useRef<HTMLDivElement>(null);\n\n  // Parse text into sentences with timing estimates for TTS\n  const parseTextIntoSentences = (text: string) => {\n    if (!text) return [];\n    \n    const sentences = text.split(/(?<=[.!?])\\s+/).filter(s => s.trim().length > 0);\n    const wordsPerSecond = 2.5; // Average speech rate\n    let currentStartTime = 0;\n    \n    return sentences.map((sentence, index) => {\n      const wordCount = sentence.split(/\\s+/).filter(w => w.length > 0).length;\n      const duration = wordCount / wordsPerSecond;\n      const startTime = currentStartTime;\n      currentStartTime += duration;\n      \n      return {\n        index,\n        text: sentence.trim(),\n        startTime,\n        endTime: currentStartTime,\n        duration,\n        wordCount\n      };\n    });\n  };\n\n  const sentences = ttsAudioResult ? frozenSentences : parseTextIntoSentences(ttsContent);\n\n  // TTS Audio event handlers\n  const handlePlayPause = () => {\n    if (audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        audioRef.current.play().catch(error => {\n          console.error('Audio play failed:', error);\n          setIsPlaying(false);\n        });\n      }\n    }\n  };\n\n  const handleTimeUpdate = () => {\n    if (audioRef.current) {\n      const time = audioRef.current.currentTime;\n      setCurrentTime(time);\n      \n      const currentSentence = sentences.findIndex(s => \n        time >= s.startTime && time < s.endTime\n      );\n      if (currentSentence !== -1 && currentSentence !== currentSentenceIndex) {\n        setCurrentSentenceIndex(currentSentence);\n      }\n    }\n  };\n\n  const handleLoadedMetadata = () => {\n    if (audioRef.current) {\n      const actualDuration = audioRef.current.duration;\n      setDuration(actualDuration);\n      \n      if (ttsAudioResult && frozenSentences.length > 0 && Math.abs(actualDuration - ttsAudioResult.duration) > 0.1) {\n        const rescaleFactor = actualDuration / ttsAudioResult.duration;\n        const rescaledSentences = frozenSentences.map(sentence => ({\n          ...sentence,\n          startTime: sentence.startTime * rescaleFactor,\n          endTime: sentence.endTime * rescaleFactor,\n          duration: sentence.duration * rescaleFactor\n        }));\n        setFrozenSentences(rescaledSentences);\n      }\n    }\n  };\n\n  const handleSentenceClick = (sentenceIndex: number) => {\n    if (audioRef.current && sentences[sentenceIndex]) {\n      audioRef.current.currentTime = sentences[sentenceIndex].startTime;\n      setCurrentSentenceIndex(sentenceIndex);\n    }\n  };\n\n  useEffect(() => {\n    if (textScrollRef.current && sentences.length > 0) {\n      const currentElement = textScrollRef.current.querySelector(`[data-sentence=\"${currentSentenceIndex}\"]`);\n      if (currentElement) {\n        currentElement.scrollIntoView({ \n          behavior: 'smooth', \n          block: 'center' \n        });\n      }\n    }\n  }, [currentSentenceIndex]);\n\n  // TTS Generation mutation\n  const generateTTSMutation = useMutation({\n    mutationFn: async (data: { text: string; title: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/text-to-speech\", data);\n      return response.json();\n    },\n    onSuccess: (result: any) => {\n      if (result.success) {\n        const generatedSentences = parseTextIntoSentences(ttsContent);\n        const totalEstimatedDuration = generatedSentences.reduce((sum, s) => sum + s.duration, 0);\n        const scaleFactor = result.duration / totalEstimatedDuration;\n        \n        const normalizedSentences = generatedSentences.map(sentence => ({\n          ...sentence,\n          startTime: sentence.startTime * scaleFactor,\n          endTime: sentence.endTime * scaleFactor,\n          duration: sentence.duration * scaleFactor\n        }));\n        \n        setFrozenSentences(normalizedSentences);\n        setCurrentSentenceIndex(0);\n        setCurrentTime(0);\n        \n        setTtsAudioResult({\n          audioUrl: result.audioUrl,\n          title: result.title,\n          duration: result.duration,\n          contentId: result.contentId\n        });\n        \n        toast({\n          title: \"Audio Generated Successfully!\",\n          description: `Generated ${Math.floor(result.duration / 60)}:${(result.duration % 60).toString().padStart(2, '0')} of audio`,\n        });\n      } else {\n        setTtsError(result.message || \"Failed to generate audio\");\n      }\n    },\n    onError: (error: any) => {\n      setTtsError(error.message || \"Failed to generate audio\");\n      toast({\n        title: \"Generation Failed\",\n        description: error.message || \"Failed to convert text to speech\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleTTSGenerate = () => {\n    if (!ttsContent.trim()) {\n      setTtsError(\"Please enter content to convert to speech\");\n      return;\n    }\n\n    if (ttsContent.length > 4096) {\n      setTtsError(\"Content must be 4096 characters or less\");\n      return;\n    }\n\n    setTtsError(\"\");\n    generateTTSMutation.mutate({\n      text: ttsContent,\n      title: ttsTitle || \"Generated Podcast Audio\"\n    });\n  };\n\n  const handleTTSClear = () => {\n    setTtsTitle(\"\");\n    setTtsContent(\"\");\n    setTtsAudioResult(null);\n    setTtsError(\"\");\n    setFrozenSentences([]);\n    setCurrentSentenceIndex(0);\n    setCurrentTime(0);\n    setIsPlaying(false);\n  };\n\n  const handleTTSDownload = () => {\n    if (ttsAudioResult) {\n      const link = document.createElement('a');\n      link.href = ttsAudioResult.audioUrl;\n      link.download = `${ttsAudioResult.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.mp3`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  };\n\n  // Save TTS episode to podcast system\n  const saveTTSEpisodeMutation = useMutation({\n    mutationFn: async (episodeData: any) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/podcast/create-episode\", episodeData);\n      return response.json();\n    },\n    onSuccess: (result: any) => {\n      toast({\n        title: \"Episode Saved Successfully!\",\n        description: `\"${ttsTitle || 'Generated Episode'}\" has been added to the course and is now available to students.`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/courses\"] });\n      \n      // Clear the TTS form after successful save\n      handleTTSClear();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Save Failed\",\n        description: error.message || \"Failed to save episode to course\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSaveTTSEpisode = () => {\n    if (!ttsAudioResult) {\n      toast({\n        title: \"No Audio Generated\",\n        description: \"Please generate audio first before saving the episode\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!selectedCourse) {\n      toast({\n        title: \"No Course Selected\",\n        description: \"Please select a course before saving the episode\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!selectedChapter || !selectedSection) {\n      toast({\n        title: \"Missing Organization\",\n        description: \"Please select both chapter and section before saving\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const episodeData = {\n      courseId: selectedCourse,\n      chapter: selectedChapter,\n      section: selectedSection,\n      difficulty: selectedDifficulty,\n      title: ttsTitle || \"Generated Podcast Episode\",\n      transcript: ttsContent,\n      audioUrl: ttsAudioResult.audioUrl,\n      duration: ttsAudioResult.duration,\n      contentId: ttsAudioResult.contentId,\n      type: 'podcast'\n    };\n\n    saveTTSEpisodeMutation.mutate(episodeData);\n  };\n\n  // Fetch courses\n  const { data: courses } = useQuery({\n    queryKey: [\"/api/courses\"],\n  });\n\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Podcast Import with Text-to-Speech</h1>\n          <p className=\"text-muted-foreground\">\n            Create podcast episodes with synchronized audio and scrolling text\n          </p>\n        </div>\n\n        {/* Course Organization */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Course & Louisiana Plumbing Code Organization</CardTitle>\n            <CardDescription>Choose course, chapter, section and difficulty level for your podcast episode</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Label htmlFor=\"course\">Select Course</Label>\n                <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select a course\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {(courses as any[])?.map((course: any) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"chapter\">Chapter</Label>\n                <Select value={selectedChapter} onValueChange={setSelectedChapter}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select chapter\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Chapter 1\">Chapter 1 - Administration</SelectItem>\n                    <SelectItem value=\"Chapter 2\">Chapter 2 - Definitions</SelectItem>\n                    <SelectItem value=\"Chapter 3\">Chapter 3 - General Regulations</SelectItem>\n                    <SelectItem value=\"Chapter 4\">Chapter 4 - Fixtures, Faucets and Fittings</SelectItem>\n                    <SelectItem value=\"Chapter 5\">Chapter 5 - Water Heaters</SelectItem>\n                    <SelectItem value=\"Chapter 6\">Chapter 6 - Water Supply and Distribution</SelectItem>\n                    <SelectItem value=\"Chapter 7\">Chapter 7 - Sanitary Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 8\">Chapter 8 - Indirect/Special Waste</SelectItem>\n                    <SelectItem value=\"Chapter 9\">Chapter 9 - Vents</SelectItem>\n                    <SelectItem value=\"Chapter 10\">Chapter 10 - Traps, Interceptors and Separators</SelectItem>\n                    <SelectItem value=\"Chapter 11\">Chapter 11 - Storm Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 12\">Chapter 12 - Special Piping and Storage Systems</SelectItem>\n                    <SelectItem value=\"Chapter 13\">Chapter 13 - Health Care Facilities and Other Special Occupancies</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"section\">Section</Label>\n                <Input\n                  id=\"section\"\n                  value={selectedSection}\n                  onChange={(e) => setSelectedSection(e.target.value)}\n                  placeholder=\"Enter section number (e.g., 101)\"\n                  disabled={!selectedChapter}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"difficulty\">Difficulty Level</Label>\n                <Select value={selectedDifficulty} onValueChange={setSelectedDifficulty}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select difficulty\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"easy\">Easy - Basic recall</SelectItem>\n                    <SelectItem value=\"hard\">Hard - Analysis</SelectItem>\n                    <SelectItem value=\"very_hard\">Very Hard - Synthesis</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Create Individual Podcast Episode with Text-to-Speech */}\n        <Card className=\"border-purple-200 bg-purple-50 mb-6\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-purple-800\">\n              <Mic className=\"h-5 w-5\" />\n              Create Individual Podcast Episode with Text-to-Speech\n            </CardTitle>\n            <CardDescription className=\"text-purple-700\">\n              Create a single podcast episode with synchronized audio generation. Perfect for testing or creating individual content pieces.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"tts-title\">Episode Title</Label>\n              <Input\n                id=\"tts-title\"\n                value={ttsTitle}\n                onChange={(e) => setTtsTitle(e.target.value)}\n                placeholder=\"Louisiana State Plumbing Code Â§101 Administration\"\n                className=\"bg-white\"\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"tts-content\">Episode Content</Label>\n              <Textarea\n                id=\"tts-content\"\n                value={ttsContent}\n                onChange={(e) => setTtsContent(e.target.value)}\n                placeholder=\"Enter your podcast content here... This will be converted to audio with synchronized text display for students.\"\n                rows={8}\n                className=\"bg-white\"\n              />\n              <div className=\"flex justify-between text-sm text-muted-foreground mt-1\">\n                <span>Words: {ttsContent.split(/\\s+/).filter(w => w.length > 0).length} | Characters: {ttsContent.length}/4096</span>\n                <span>Est. Duration: ~{Math.round(ttsContent.split(/\\s+/).filter(w => w.length > 0).length / 150 * 60)}s</span>\n              </div>\n            </div>\n\n            {ttsError && (\n              <Alert className=\"border-red-200 bg-red-50\">\n                <AlertDescription className=\"text-red-700\">{ttsError}</AlertDescription>\n              </Alert>\n            )}\n\n            <div className=\"flex gap-2\">\n              <Button \n                onClick={handleTTSGenerate}\n                disabled={generateTTSMutation.isPending || !ttsContent.trim()}\n                className=\"flex-1\"\n              >\n                <Volume2 className=\"h-4 w-4 mr-2\" />\n                {generateTTSMutation.isPending ? \"Generating Audio...\" : \"Generate Audio\"}\n              </Button>\n              <Button variant=\"outline\" onClick={handleTTSClear}>\n                Clear\n              </Button>\n            </div>\n\n            {/* Audio Player with Scrolling Text */}\n            {ttsAudioResult && (\n              <div className=\"space-y-4 p-4 bg-white rounded-lg border\">\n                <div className=\"flex items-center justify-between\">\n                  <h4 className=\"font-medium text-green-700\">âœ“ Ready to Generate Audio</h4>\n                  <div className=\"flex gap-2\">\n                    <Button size=\"sm\" variant=\"outline\" onClick={handleTTSDownload}>\n                      <Download className=\"h-4 w-4 mr-1\" />\n                      Download\n                    </Button>\n                  </div>\n                </div>\n\n                <audio \n                  ref={audioRef}\n                  src={ttsAudioResult.audioUrl}\n                  onTimeUpdate={handleTimeUpdate}\n                  onLoadedMetadata={handleLoadedMetadata}\n                  onPlay={() => setIsPlaying(true)}\n                  onPause={() => setIsPlaying(false)}\n                  onEnded={() => setIsPlaying(false)}\n                  className=\"w-full\"\n                  controls\n                />\n\n                <div className=\"text-center\">\n                  <p className=\"text-sm text-muted-foreground mb-2\">\n                    Click on sentences below to jump to that part of the audio\n                  </p>\n                </div>\n\n                {/* Scrolling Text Display */}\n                <div \n                  ref={textScrollRef}\n                  className=\"max-h-64 overflow-y-auto p-4 bg-gray-50 rounded border\"\n                >\n                  {sentences.map((sentence, index) => (\n                    <span\n                      key={index}\n                      data-sentence={index}\n                      onClick={() => handleSentenceClick(index)}\n                      className={`cursor-pointer transition-all duration-300 ${\n                        index === currentSentenceIndex\n                          ? 'bg-blue-200 text-blue-900 font-medium'\n                          : 'hover:bg-gray-200'\n                      }`}\n                      style={{ display: 'inline' }}\n                    >\n                      {sentence.text}{' '}\n                    </span>\n                  ))}\n                </div>\n\n                <div className=\"flex justify-center\">\n                  <Button \n                    onClick={handleSaveTTSEpisode}\n                    disabled={saveTTSEpisodeMutation.isPending}\n                    className=\"w-full sm:w-auto\"\n                  >\n                    <Save className=\"h-4 w-4 mr-2\" />\n                    {saveTTSEpisodeMutation.isPending ? \"Saving Episode...\" : \"Save Episode to Course\"}\n                  </Button>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n      </div>\n    </div>\n  );\n}","size_bytes":19465},"client/src/pages/admin/bulk-ai-chat-import.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Upload, FileText, CheckCircle, AlertCircle, Brain } from \"lucide-react\";\nimport { PLUMBING_CODE_SECTIONS } from \"@/lib/plumbing-code-sections\";\n\nexport default function BulkAIChatImport() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [selectedChapter, setSelectedChapter] = useState(\"\");\n  const [selectedSection, setSelectedSection] = useState(\"\");\n  const [selectedDifficulty, setSelectedDifficulty] = useState(\"medium\");\n  const [chatContentText, setChatContentText] = useState(\"\");\n  const [previewContent, setPreviewContent] = useState<any[]>([]);\n  const [importStatus, setImportStatus] = useState<\"idle\" | \"parsing\" | \"previewing\" | \"importing\" | \"success\">(\"idle\");\n\n\n  // Fetch courses\n  const { data: courses } = useQuery({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const bulkImportMutation = useMutation({\n    mutationFn: async (data: any) => await apiRequest(\"POST\", \"/api/admin/ai-chat/bulk-import\", data),\n    onSuccess: (result: any) => {\n      const { imported, duplicatesSkipped, totalSubmitted } = result;\n      \n      if (duplicatesSkipped > 0) {\n        toast({ \n          title: \"Import completed with duplicates detected\", \n          description: `Added ${imported} new AI chat content. Skipped ${duplicatesSkipped} duplicates out of ${totalSubmitted} total.`,\n          variant: \"default\"\n        });\n      } else {\n        toast({ \n          title: \"All AI chat content imported successfully!\", \n          description: `Added ${imported} new content pieces to the AI mentor system.`\n        });\n      }\n      \n      setImportStatus(\"success\");\n      setChatContentText(\"\");\n      setPreviewContent([]);\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/course-content\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Import failed\",\n        description: error.message || \"Failed to import AI chat content\",\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  });\n\n  const parseAIChatContent = () => {\n    if (!chatContentText.trim()) {\n      toast({\n        title: \"No content\",\n        description: \"Please enter AI chat content to parse\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setImportStatus(\"parsing\");\n\n    try {\n      const parsed = parseAIChatFromText(chatContentText);\n      if (parsed.length === 0) {\n        throw new Error(\"No valid AI chat content found. Please check the format.\");\n      }\n      \n      setPreviewContent(parsed);\n      setImportStatus(\"previewing\");\n      toast({\n        title: \"AI chat content parsed successfully!\",\n        description: `Found ${parsed.length} content pieces ready for import.`\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Parse error\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      setImportStatus(\"idle\");\n    }\n  };\n\n  const isSectionValid = selectedSection && selectedSection.trim().length > 0;\n\n  const importAIChatContent = () => {\n    if (!selectedCourse) {\n      toast({\n        title: \"No course selected\",\n        description: \"Please select a course first\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!selectedChapter || !selectedSection) {\n      toast({\n        title: \"Chapter and Section required\",\n        description: \"Please select both chapter and section for organization\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!isSectionValid) {\n      toast({\n        title: \"Invalid section number\",\n        description: \"Enter a valid section number (e.g., 101)\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Update content with current chapter and section values to prevent stale data\n    const payloadContent = previewContent.map(content => ({\n      ...content,\n      chapter: selectedChapter,\n      category: selectedChapter,\n      section: selectedSection,\n      codeReference: `${selectedChapter} - Section ${selectedSection}`,\n      difficulty: selectedDifficulty\n    }));\n\n    setImportStatus(\"importing\");\n    bulkImportMutation.mutate({\n      courseId: selectedCourse,\n      chatContent: payloadContent\n    });\n  };\n\n  const parseAIChatFromText = (text: string) => {\n    const content: any[] = [];\n    \n    // Split by Q&A patterns (Q:, A:, Question:, Answer:)\n    const qaSections = text.split(/(?=Q:|Question:|QUESTION:)/i);\n    \n    qaSections.forEach((section, index) => {\n      const lines = section.trim().split('\\n').filter(line => line.trim());\n      if (lines.length < 2) return;\n      \n      // Extract question\n      const questionLine = lines[0];\n      const questionMatch = questionLine.match(/^(?:Q:|Question:|QUESTION:)\\s*(.+)/i);\n      if (!questionMatch) return;\n      \n      const question = questionMatch[1].trim();\n      \n      // Find answer\n      let answerStartIndex = -1;\n      for (let i = 1; i < lines.length; i++) {\n        if (lines[i].match(/^(?:A:|Answer:|ANSWER:)/i)) {\n          answerStartIndex = i;\n          break;\n        }\n      }\n      \n      if (answerStartIndex === -1) {\n        // If no explicit answer marker, treat remaining lines as answer\n        answerStartIndex = 1;\n      }\n      \n      // Extract answer text\n      const answerLines = lines.slice(answerStartIndex);\n      const answerText = answerLines.join('\\n')\n        .replace(/^(?:A:|Answer:|ANSWER:)\\s*/i, '') // Remove answer prefix\n        .trim();\n      \n      if (question.length > 5 && answerText.length > 20) {\n        content.push({\n          id: crypto.randomUUID(),\n          question: question,\n          answer: answerText,\n          type: 'ai_chat_qa',\n          context: 'Louisiana State Plumbing Code',\n          tags: extractTags(question + ' ' + answerText),\n          createdAt: new Date(),\n        });\n      }\n    });\n    \n    // If no Q&A pattern found, try parsing by educational topics\n    if (content.length === 0) {\n      const topics = text.split(/\\n\\s*\\n/).filter(p => p.trim());\n      \n      topics.forEach((topic, index) => {\n        const lines = topic.trim().split('\\n');\n        if (lines.length < 2) return;\n        \n        // Use first line as topic, rest as explanation\n        const topicTitle = lines[0].trim();\n        const explanation = lines.slice(1).join('\\n').trim();\n        \n        if (topicTitle.length > 5 && explanation.length > 20) {\n          content.push({\n            id: crypto.randomUUID(),\n            question: `What about ${topicTitle}?`,\n            answer: explanation,\n            type: 'ai_chat_topic',\n            context: 'Louisiana State Plumbing Code',\n            tags: extractTags(topicTitle + ' ' + explanation),\n            createdAt: new Date(),\n          });\n        }\n      });\n    }\n    \n    return content;\n  };\n\n  const extractTags = (text: string) => {\n    const commonTerms = [\n      'LSPC', 'Louisiana State Plumbing Code', 'plumbing', 'code', 'regulation',\n      'administration', 'approval', 'installation', 'inspection', 'testing',\n      'fixtures', 'water heaters', 'drainage', 'vents', 'pipes', 'fittings',\n      'health', 'safety', 'compliance', 'authority', 'department'\n    ];\n    \n    const foundTerms = commonTerms.filter(term => \n      text.toLowerCase().includes(term.toLowerCase())\n    );\n    \n    return foundTerms.slice(0, 5); // Limit to 5 tags\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\">Bulk AI Chat Content Import</h1>\n          <p className=\"text-muted-foreground\">\n            Import educational content for the AI mentor chat system with Q&A format\n          </p>\n        </div>\n\n        {/* Course and Chapter/Section Selection */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Course & Louisiana Plumbing Code Organization</CardTitle>\n            <CardDescription>Choose course, chapter, section and difficulty level for all AI chat content in this batch</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <Label htmlFor=\"course\">Select Course</Label>\n                <Select value={selectedCourse} onValueChange={setSelectedCourse}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select a course\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {(courses as any[])?.map((course: any) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"chapter\">Chapter</Label>\n                <Select value={selectedChapter} onValueChange={setSelectedChapter}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select chapter\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Chapter 1\">Chapter 1 - Administration</SelectItem>\n                    <SelectItem value=\"Chapter 2\">Chapter 2 - Definitions</SelectItem>\n                    <SelectItem value=\"Chapter 3\">Chapter 3 - General Regulations</SelectItem>\n                    <SelectItem value=\"Chapter 4\">Chapter 4 - Fixtures, Faucets and Fittings</SelectItem>\n                    <SelectItem value=\"Chapter 5\">Chapter 5 - Water Heaters</SelectItem>\n                    <SelectItem value=\"Chapter 6\">Chapter 6 - Water Supply and Distribution</SelectItem>\n                    <SelectItem value=\"Chapter 7\">Chapter 7 - Sanitary Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 8\">Chapter 8 - Indirect/Special Waste</SelectItem>\n                    <SelectItem value=\"Chapter 9\">Chapter 9 - Vents</SelectItem>\n                    <SelectItem value=\"Chapter 10\">Chapter 10 - Traps, Interceptors and Separators</SelectItem>\n                    <SelectItem value=\"Chapter 11\">Chapter 11 - Storm Drainage</SelectItem>\n                    <SelectItem value=\"Chapter 12\">Chapter 12 - Special Piping and Storage Systems</SelectItem>\n                    <SelectItem value=\"Chapter 13\">Chapter 13 - Health Care Facilities and Other Special Occupancies</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"section\">Section</Label>\n                <Input\n                  id=\"section\"\n                  value={selectedSection}\n                  onChange={(e) => setSelectedSection(e.target.value)}\n                  placeholder=\"Enter section number (e.g., 101, 103, 105...)\"\n                  disabled={!selectedChapter}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"difficulty\">Difficulty Level</Label>\n                <Select value={selectedDifficulty} onValueChange={setSelectedDifficulty}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\"Select difficulty\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"easy\">Easy - Basic recall</SelectItem>\n                    <SelectItem value=\"hard\">Hard - Analysis</SelectItem>\n                    <SelectItem value=\"very_hard\">Very Hard - Synthesis</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n\n        {/* AI Chat Content Input */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Paste Your AI Chat Content</CardTitle>\n            <CardDescription>Copy and paste Q&A content or educational material for AI mentor training</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"chatcontent\">AI Chat Content</Label>\n                <Textarea\n                  id=\"chatcontent\"\n                  value={chatContentText}\n                  onChange={(e) => setChatContentText(e.target.value)}\n                  rows={15}\n                  placeholder={`Paste your AI chat content here...\n\nExample:\nThis section, Â§101, deals with the general administration of the Louisiana State Plumbing Code (LSPC).\n\nðŸ§  Key Concept: Louisiana State Plumbing Code (LSPC)\nThis is the official set of rules and regulations governing plumbing work in Louisiana.\n\nWho enforces the LSPC?\n\nThe Department of Health and Hospitals, Office of Public Health, is responsible for adopting the code.\n\nðŸ§  Key Concept: Enforcement Authority\nThe \"Department of Health and Hospitals, Office of Public Health\" is the agency that adopts and oversees the Louisiana State Plumbing Code.\n\nðŸ’¡ Key Information: Code History\nPromulgated: June 2002\nAmended: November 2012`}\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n              \n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={parseAIChatContent}\n                  disabled={!chatContentText.trim() || importStatus === \"parsing\"}\n                  className=\"flex items-center gap-2\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  {importStatus === \"parsing\" ? \"Parsing...\" : \"Parse Content\"}\n                </Button>\n                \n                {previewContent.length > 0 && (\n                  <Button \n                    onClick={importAIChatContent}\n                    disabled={!selectedCourse || importStatus === \"importing\"}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <Upload className=\"h-4 w-4\" />\n                    {importStatus === \"importing\" ? \"Importing...\" : `Import ${previewContent.length} Items`}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Preview */}\n        {previewContent.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                Preview ({previewContent.length} AI chat items found)\n              </CardTitle>\n              <CardDescription>Review the parsed content before importing</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                {previewContent.map((item, index) => (\n                  <div key={index} className=\"border rounded-lg p-4\">\n                    <div className=\"space-y-3\">\n                      <div>\n                        <h4 className=\"font-semibold text-blue-600 mb-2\">Question</h4>\n                        <p className=\"text-sm bg-blue-50 p-3 rounded\">\n                          {item.question}\n                        </p>\n                      </div>\n                      <div>\n                        <h4 className=\"font-semibold text-green-600 mb-2\">Answer</h4>\n                        <div className=\"text-sm bg-green-50 p-3 rounded whitespace-pre-line\">\n                          {item.answer.substring(0, 300)}{item.answer.length > 300 ? \"...\" : \"\"}\n                        </div>\n                      </div>\n                      {item.tags && item.tags.length > 0 && (\n                        <div>\n                          <h4 className=\"font-semibold text-purple-600 mb-2\">Tags</h4>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {item.tags.map((tag: string, i: number) => (\n                              <span key={i} className=\"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded\">\n                                {tag}\n                              </span>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {importStatus === \"success\" && (\n          <Alert className=\"mt-6\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              AI chat content imported successfully! The AI mentor system now has new training data.\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":17413},"client/src/pages/study-companion.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Send, Bot, User, Sparkles, BookOpen, Lightbulb, Zap } from \"lucide-react\";\n\ninterface ChatMessage {\n  id: string;\n  content: string;\n  role: \"user\" | \"assistant\";\n  timestamp: Date;\n  emotion?: \"happy\" | \"excited\" | \"helpful\" | \"thinking\" | \"encouraging\";\n}\n\nexport default function StudyCompanion() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [message, setMessage] = useState(\"\");\n  const [isTyping, setIsTyping] = useState(false);\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [quizContext, setQuizContext] = useState<any>(null);\n\n  // Fetch chat history\n  const { data: chatHistory = [] } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/study-companion/chat\"],\n  });\n\n  // Fetch user's current progress for context\n  const { data: userProgress } = useQuery({\n    queryKey: [\"/api/user/progress\"],\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (userMessage: string) => {\n      return await apiRequest(\"POST\", \"/api/mentor/chat\", {\n        message: userMessage,\n        context: userProgress\n      });\n    },\n    onSuccess: (response) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/study-companion/chat\"] });\n      setIsTyping(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Chat Error\",\n        description: error.message || \"Failed to send message\",\n        variant: \"destructive\"\n      });\n      setIsTyping(false);\n    }\n  });\n\n  // Check for quiz review context on mount and auto-start conversation\n  useEffect(() => {\n    const storedContext = sessionStorage.getItem('aiMentorContext');\n    if (storedContext) {\n      try {\n        const context = JSON.parse(storedContext);\n        if (context.type === 'quiz_review') {\n          setQuizContext(context);\n          // Clear the context from session storage\n          sessionStorage.removeItem('aiMentorContext');\n          \n          // Auto-start conversation with quiz context\n          const quizMessage = `I just completed the ${context.title} and got ${context.incorrectCount} questions wrong out of ${context.totalQuestions} total (${context.score}% score). Can you help me understand the questions I missed?\\n\\nHere are the questions I got wrong:\\n\\n${context.questions}`;\n          \n          setIsTyping(true);\n          sendMessageMutation.mutate(quizMessage);\n        }\n      } catch (error) {\n        console.error('Error parsing quiz context:', error);\n      }\n    }\n  }, [sendMessageMutation]);\n\n  const handleSendMessage = async () => {\n    if (!message.trim() || sendMessageMutation.isPending) return;\n\n    const userMessage = message.trim();\n    setMessage(\"\");\n    setIsTyping(true);\n\n    try {\n      await sendMessageMutation.mutateAsync(userMessage);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    if (scrollAreaRef.current) {\n      const scrollElement = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]');\n      if (scrollElement) {\n        scrollElement.scrollTop = scrollElement.scrollHeight;\n      }\n    }\n  }, [chatHistory, isTyping]);\n\n  // Focus input on mount\n  useEffect(() => {\n    inputRef.current?.focus();\n  }, []);\n\n  const getCharacterEmoji = (emotion?: string) => {\n    switch (emotion) {\n      case \"excited\": return \"ðŸŽ‰\";\n      case \"helpful\": return \"ðŸ¤\";\n      case \"thinking\": return \"ðŸ¤”\";\n      case \"encouraging\": return \"ðŸ’ª\";\n      default: return \"ðŸ”§\"; // Plumbing tool emoji as default\n    }\n  };\n\n  const getCharacterName = () => \"Pipe Buddy\";\n\n  const renderMessage = (msg: ChatMessage) => {\n    const isUser = msg.role === \"user\";\n    const characterEmoji = getCharacterEmoji(msg.emotion);\n    \n    return (\n      <div\n        key={msg.id}\n        className={`flex gap-3 mb-4 ${isUser ? \"flex-row-reverse\" : \"flex-row\"}`}\n      >\n        <Avatar className=\"w-8 h-8 mt-1\">\n          {isUser ? (\n            <AvatarFallback className=\"bg-blue-500 text-white\">\n              <User className=\"w-4 h-4\" />\n            </AvatarFallback>\n          ) : (\n            <AvatarFallback className=\"bg-gradient-to-br from-purple-500 to-blue-500 text-white\">\n              {characterEmoji}\n            </AvatarFallback>\n          )}\n        </Avatar>\n        \n        <div className={`flex flex-col ${isUser ? \"items-end\" : \"items-start\"} max-w-[80%]`}>\n          <div className=\"flex items-center gap-2 mb-1\">\n            <span className=\"text-xs text-muted-foreground font-medium\">\n              {isUser ? \"You\" : getCharacterName()}\n            </span>\n            {!isUser && msg.emotion && (\n              <Badge variant=\"secondary\" className=\"text-xs px-2 py-0\">\n                {msg.emotion}\n              </Badge>\n            )}\n            <span className=\"text-xs text-muted-foreground\">\n              {new Date(msg.timestamp).toLocaleTimeString([], { \n                hour: '2-digit', \n                minute: '2-digit' \n              })}\n            </span>\n          </div>\n          \n          <div\n            className={`rounded-lg px-4 py-2 ${\n              isUser\n                ? \"bg-primary text-primary-foreground\"\n                : \"bg-muted\"\n            }`}\n          >\n            <div className=\"text-sm whitespace-pre-wrap\">{msg.content}</div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white text-xl\">\n              ðŸ”§\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold\">Study Companion</h1>\n              <p className=\"text-muted-foreground\">\n                Meet {getCharacterName()}, your friendly Louisiana plumbing study buddy!\n              </p>\n            </div>\n          </div>\n          \n          {/* Character intro and quick actions */}\n          <Card className=\"mb-6\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-start gap-4\">\n                <Avatar className=\"w-16 h-16\">\n                  <AvatarFallback className=\"bg-gradient-to-br from-purple-500 to-blue-500 text-white text-2xl\">\n                    ðŸ”§\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-lg font-semibold mb-2\">\n                    Hey there, future plumbing pro! ðŸ‘‹\n                  </h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    I'm {getCharacterName()}, and I'm here to make learning the Louisiana State Plumbing Code \n                    fun and engaging! Ask me anything about pipes, codes, techniques, or just chat \n                    about your plumbing journey. I love helping students succeed! \n                  </p>\n                  \n                  <div className=\"flex flex-wrap gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setMessage(\"Explain pipe sizing basics\")}\n                      className=\"text-xs\"\n                    >\n                      <BookOpen className=\"w-3 h-3 mr-1\" />\n                      Pipe Sizing\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setMessage(\"What are common code violations?\")}\n                      className=\"text-xs\"\n                    >\n                      <Lightbulb className=\"w-3 h-3 mr-1\" />\n                      Code Tips\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setMessage(\"Give me a study motivation boost!\")}\n                      className=\"text-xs\"\n                    >\n                      <Zap className=\"w-3 h-3 mr-1\" />\n                      Motivation\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Chat Interface */}\n        <Card className=\"h-[600px] flex flex-col\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Sparkles className=\"w-5 h-5\" />\n              Chat with {getCharacterName()}\n            </CardTitle>\n            <CardDescription>\n              Your personalized AI study companion for Louisiana plumbing certification\n            </CardDescription>\n          </CardHeader>\n          \n          <CardContent className=\"flex-1 flex flex-col p-0\">\n            {/* Messages Area */}\n            <ScrollArea className=\"flex-1 p-6\" ref={scrollAreaRef}>\n              <div className=\"space-y-4\">\n                {chatHistory.length === 0 && (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <Bot className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n                    <p className=\"text-lg font-medium mb-2\">Start a conversation!</p>\n                    <p className=\"text-sm\">\n                      Ask me anything about Louisiana plumbing codes, techniques, or just say hello!\n                    </p>\n                  </div>\n                )}\n                \n                {chatHistory.map(renderMessage)}\n                \n                {/* Typing indicator */}\n                {isTyping && (\n                  <div className=\"flex gap-3 mb-4\">\n                    <Avatar className=\"w-8 h-8 mt-1\">\n                      <AvatarFallback className=\"bg-gradient-to-br from-purple-500 to-blue-500 text-white\">\n                        ðŸ”§\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex flex-col items-start max-w-[80%]\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <span className=\"text-xs text-muted-foreground font-medium\">\n                          {getCharacterName()}\n                        </span>\n                        <Badge variant=\"secondary\" className=\"text-xs px-2 py-0\">\n                          thinking\n                        </Badge>\n                      </div>\n                      <div className=\"bg-muted rounded-lg px-4 py-2\">\n                        <div className=\"flex space-x-1\">\n                          <div className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\"></div>\n                          <div className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                          <div className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </ScrollArea>\n            \n            {/* Input Area */}\n            <div className=\"p-6 border-t\">\n              <div className=\"flex gap-2\">\n                <Input\n                  ref={inputRef}\n                  value={message}\n                  onChange={(e) => setMessage(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Ask me anything about Louisiana plumbing...\"\n                  disabled={sendMessageMutation.isPending}\n                  className=\"flex-1\"\n                  data-testid=\"input-chat-message\"\n                />\n                <Button\n                  onClick={handleSendMessage}\n                  disabled={!message.trim() || sendMessageMutation.isPending}\n                  size=\"icon\"\n                  data-testid=\"button-send-message\"\n                >\n                  <Send className=\"w-4 h-4\" />\n                </Button>\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                ðŸ’¡ Tip: Ask about specific code sections, pipe materials, installation techniques, or exam prep!\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":13236},"server/openai-service.ts":{"content":"import OpenAI from \"openai\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\nexport interface StudyCompanionResponse {\n  content: string;\n  emotion: \"happy\" | \"excited\" | \"helpful\" | \"thinking\" | \"encouraging\";\n}\n\nexport class StudyCompanionService {\n  private static getCharacterPersonality(): string {\n    return `You are \"Pipe Buddy\" ðŸ”§, a fun and enthusiastic study companion for Louisiana plumbing certification students. \n\nPERSONALITY TRAITS:\n- Friendly, encouraging, and slightly playful\n- Uses plumbing puns and metaphors naturally (but not excessively)\n- Louisiana-focused with local knowledge and pride\n- Expert in Louisiana State Plumbing Code (LSPC)\n- Motivational but realistic about challenges\n- Uses emojis appropriately to add warmth\n\nKNOWLEDGE AREAS:\n- Louisiana State Plumbing Code (LSPC) expertise\n- Pipe sizing, materials, and installation techniques\n- Code compliance and common violations\n- Exam preparation strategies\n- Real-world plumbing scenarios in Louisiana\n- Study techniques and motivation\n\nCOMMUNICATION STYLE:\n- Keep responses concise but thorough\n- Use \"you\" to address the student directly\n- Include practical examples when explaining concepts\n- Offer encouragement and study tips\n- Ask follow-up questions to engage learning\n- Reference Louisiana-specific requirements when relevant\n\nRESPONSE FORMAT:\n- Always be helpful and educational\n- Include relevant code sections when applicable\n- Break down complex topics into digestible parts\n- Celebrate progress and effort\n- Provide actionable next steps when appropriate\n\nRemember: You're here to make learning Louisiana plumbing codes enjoyable and successful!`;\n  }\n\n  static async generateResponse(\n    userMessage: string,\n    userProgress?: any,\n    chatHistory?: any[]\n  ): Promise<StudyCompanionResponse> {\n    try {\n      // Build context from user progress\n      let contextInfo = \"\";\n      if (userProgress) {\n        contextInfo = `\\n\\nSTUDENT CONTEXT:\n- Current courses: ${userProgress.enrolledCourses?.join(\", \") || \"None\"}\n- Progress level: ${userProgress.overallProgress || 0}% complete\n- Recent topics: ${userProgress.recentTopics?.join(\", \") || \"General study\"}`;\n      }\n\n      // Build conversation history for context\n      let conversationContext = \"\";\n      if (chatHistory && chatHistory.length > 0) {\n        const recentMessages = chatHistory.slice(-6); // Last 6 messages for context\n        conversationContext = \"\\n\\nRECENT CONVERSATION:\\n\" + \n          recentMessages.map(msg => `${msg.role}: ${msg.content}`).join(\"\\n\");\n      }\n\n      const systemPrompt = this.getCharacterPersonality() + contextInfo + conversationContext;\n\n      const response = await openai.chat.completions.create({\n        model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025\n        messages: [\n          {\n            role: \"system\",\n            content: systemPrompt + '\\n\\nIMPORTANT: Always respond with valid JSON in this exact format: {\"content\": \"your response here\", \"emotion\": \"happy|excited|helpful|thinking|encouraging\"}'\n          },\n          {\n            role: \"user\",\n            content: userMessage\n          }\n        ],\n        max_tokens: 800,\n        temperature: 0.8, // Slightly creative for personality\n        response_format: { type: \"json_object\" }\n      });\n\n      let parsedResponse;\n      try {\n        parsedResponse = JSON.parse(response.choices[0].message.content || \"{}\");\n      } catch (parseError) {\n        // Fallback if JSON parsing fails\n        parsedResponse = {\n          content: response.choices[0].message.content || \"I'm having trouble processing that right now. Could you try asking again?\",\n          emotion: \"helpful\"\n        };\n      }\n\n      return {\n        content: parsedResponse.content || \"I'm here to help with your Louisiana plumbing studies! What would you like to learn about?\",\n        emotion: this.determineEmotion(parsedResponse.content || \"\", userMessage)\n      };\n\n    } catch (error) {\n      console.error(\"OpenAI API error:\", error);\n      \n      // Fallback response with character personality\n      return {\n        content: \"Oops! I'm having a bit of a pipe blockage in my circuits right now ðŸ”§ Could you try asking your question again? I'm excited to help you master that Louisiana plumbing code!\",\n        emotion: \"helpful\"\n      };\n    }\n  }\n\n  private static determineEmotion(content: string, userMessage: string): \"happy\" | \"excited\" | \"helpful\" | \"thinking\" | \"encouraging\" {\n    const contentLower = content.toLowerCase();\n    const messageLower = userMessage.toLowerCase();\n    \n    // Encouraging for motivation or difficulty\n    if (messageLower.includes(\"motivation\") || messageLower.includes(\"difficult\") || messageLower.includes(\"struggling\") || contentLower.includes(\"you've got this\") || contentLower.includes(\"keep going\")) {\n      return \"encouraging\";\n    }\n    \n    // Excited for achievements or positive responses\n    if (contentLower.includes(\"great\") || contentLower.includes(\"awesome\") || contentLower.includes(\"excellent\") || contentLower.includes(\"congratulations\")) {\n      return \"excited\";\n    }\n    \n    // Thinking for complex technical questions\n    if (messageLower.includes(\"explain\") || messageLower.includes(\"how\") || messageLower.includes(\"why\") || contentLower.includes(\"let me break this down\")) {\n      return \"thinking\";\n    }\n    \n    // Happy for greetings and general positive interactions\n    if (messageLower.includes(\"hello\") || messageLower.includes(\"hi\") || messageLower.includes(\"thanks\") || contentLower.includes(\"happy to help\")) {\n      return \"happy\";\n    }\n    \n    // Default to helpful\n    return \"helpful\";\n  }\n\n  // Method to generate study suggestions based on user progress\n  static async generateStudySuggestions(userProgress: any, currentSection?: string): Promise<string[]> {\n    try {\n      // Section-specific suggestions\n      const sectionSpecificSuggestions: { [key: string]: string[] } = {\n        '101': [\n          \"Ask about the Louisiana State Health Officer's authority in plumbing code enforcement\",\n          \"What are the key responsibilities of local plumbing inspectors under Section 101?\",\n          \"How does the delegation of authority work from state to local levels?\",\n          \"What legal statutes support Louisiana plumbing code enforcement?\",\n          \"Explain the historical development of Louisiana plumbing code from 2002 to 2012\"\n        ],\n        '103': [\n          \"What are the permit requirements for different types of plumbing work in Louisiana?\",\n          \"When can plumbing work be done without a permit in Louisiana?\",\n          \"What documentation must be submitted with a plumbing permit application?\",\n          \"How long are plumbing permits valid in Louisiana?\",\n          \"What are the fees associated with different types of plumbing permits?\"\n        ],\n        '105': [\n          \"What qualifications are required for plumbing inspectors in Louisiana?\",\n          \"How often must plumbing inspections be conducted during installation?\",\n          \"What happens if a plumbing installation fails inspection?\",\n          \"What records must be kept by plumbing inspectors?\",\n          \"What are the appeals process for inspection decisions?\"\n        ],\n        '107': [\n          \"What are the violation notice procedures in Louisiana plumbing code?\",\n          \"What penalties can be imposed for plumbing code violations?\",\n          \"How are emergency situations handled under Louisiana plumbing enforcement?\",\n          \"What is the process for appealing code violation citations?\",\n          \"When can plumbing work be ordered to stop for safety violations?\"\n        ],\n        '109': [\n          \"What are the requirements for plumbing plan approval in Louisiana?\",\n          \"When must engineered drawings be submitted for plumbing systems?\",\n          \"What technical standards must plumbing plans meet?\",\n          \"How long does the plan review process typically take?\",\n          \"What are the fees for plumbing plan review and approval?\"\n        ]\n      };\n\n      const suggestions = sectionSpecificSuggestions[currentSection || '101'] || sectionSpecificSuggestions['101'];\n      \n      // Randomize and return 4 suggestions\n      const shuffled = [...suggestions].sort(() => Math.random() - 0.5);\n      return shuffled.slice(0, 4);\n      \n    } catch (error) {\n      console.error(\"Error generating study suggestions:\", error);\n      const fallback = currentSection === '101' ? [\n        \"Ask about the Louisiana State Health Officer's authority in plumbing code enforcement\",\n        \"What are the key responsibilities of local plumbing inspectors under Section 101?\",\n        \"How does the delegation of authority work from state to local levels?\",\n        \"What legal statutes support Louisiana plumbing code enforcement?\"\n      ] : [\n        \"Review Louisiana State Plumbing Code Section 101 - Administration\",\n        \"Practice pipe sizing calculations for residential installations\", \n        \"Study backflow prevention requirements for Louisiana\",\n        \"Review common code violations and prevention strategies\"\n      ];\n      return fallback;\n    }\n  }\n}","size_bytes":9337},"server/amazon-affiliate.ts":{"content":"/**\n * Amazon Affiliate Integration\n * Uses SiteStripe approach - generates affiliate links without requiring API access\n */\n\nexport interface AmazonProduct {\n  title: string;\n  price: string;\n  image: string;\n  url: string;\n  rating?: string;\n  reviews?: string;\n  category: string;\n  asin?: string;\n}\n\nexport interface ProductSearchParams {\n  query: string;\n  category?: string;\n  maxResults?: number;\n}\n\nexport class AmazonAffiliateService {\n  private associateTag: string;\n\n  constructor(associateTag: string = 'laplumbprep-20') {\n    this.associateTag = associateTag;\n  }\n\n  /**\n   * Generate affiliate link with associate tag\n   */\n  generateAffiliateLink(productUrl: string, asin?: string): string {\n    if (asin) {\n      return `https://www.amazon.com/dp/${asin}?tag=${this.associateTag}`;\n    }\n    \n    // Extract ASIN from URL if possible\n    const asinMatch = productUrl.match(/\\/dp\\/([A-Z0-9]{10})/i) || \n                     productUrl.match(/\\/gp\\/product\\/([A-Z0-9]{10})/i);\n    \n    if (asinMatch) {\n      return `https://www.amazon.com/dp/${asinMatch[1]}?tag=${this.associateTag}`;\n    }\n    \n    // Fallback: append tag to existing URL\n    const separator = productUrl.includes('?') ? '&' : '?';\n    return `${productUrl}${separator}tag=${this.associateTag}`;\n  }\n\n  /**\n   * Search Amazon products using web scraping approach\n   * Note: This is a simplified version for demo. For production, consider using Amazon's PA API when available.\n   */\n  async searchProducts(params: ProductSearchParams): Promise<AmazonProduct[]> {\n    const { query, category = 'all', maxResults = 12 } = params;\n    \n    // For now, return plumbing-specific products as examples\n    // In a real implementation, you could web scrape Amazon search results\n    const plumbingProducts: AmazonProduct[] = [\n      {\n        title: \"RIDGID 31632 Model 103 Close Quarters Tubing Cutter\",\n        price: \"$23.97\",\n        image: \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZCNzI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+UklER0lEIFR1YmluZyBDdXR0ZXI8L3RleHQ+Cjwvc3ZnPg==\",\n        url: `https://www.amazon.com/dp/B000BQTCPQ?tag=${this.associateTag}`,\n        rating: \"4.5\",\n        reviews: \"1,203\",\n        category: \"tools\",\n        asin: \"B000BQTCPQ\"\n      },\n      {\n        title: \"SharkBite U720A 1/2-Inch Slip Coupling, 2-Pack\",\n        price: \"$8.47\",\n        image: \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZCNzI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+U2hhcmtCaXRlIENvdXBsaW5nPC90ZXh0Pgo8L3N2Zz4=\",\n        url: `https://www.amazon.com/dp/B004I9YBRQ?tag=${this.associateTag}`,\n        rating: \"4.6\",\n        reviews: \"2,154\",\n        category: \"pipe_fittings\",\n        asin: \"B004I9YBRQ\"\n      },\n      {\n        title: \"DEWALT Pipe Threading Machine, Heavy Duty (DWPN50)\",\n        price: \"$2,397.00\",\n        image: \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRkZEQjAwIi8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzAwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+REVXQUxUIFRocmVhZGluZyBNYWNoaW5lPC90ZXh0Pgo8L3N2Zz4=\",\n        url: `https://www.amazon.com/dp/B00I4V5ZSS?tag=${this.associateTag}`,\n        rating: \"4.7\",\n        reviews: \"89\",\n        category: \"tools\",\n        asin: \"B00I4V5ZSS\"\n      },\n      {\n        title: \"General Tools & Instruments 1/8 Digital Pipe Locator\",\n        price: \"$89.99\",\n        image: \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjMTBCOTgxIi8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+RGlnaXRhbCBQaXBlIExvY2F0b3I8L3RleHQ+Cjwvc3ZnPg==\",\n        url: `https://www.amazon.com/dp/B00K2MZKXW?tag=${this.associateTag}`,\n        rating: \"4.1\",\n        reviews: \"342\",\n        category: \"measuring_tools\",\n        asin: \"B00K2MZKXW\"\n      },\n      {\n        title: \"Milwaukee M12 Fuel Hackzall Reciprocating Saw Kit\",\n        price: \"$199.00\",\n        image: \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjREMxNjI2Ii8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+TWlsd2F1a2VlIEhhY2t6YWxsPC90ZXh0Pgo8L3N2Zz4=\",\n        url: `https://www.amazon.com/dp/B07D7Z1VPR?tag=${this.associateTag}`,\n        rating: \"4.8\",\n        reviews: \"567\",\n        category: \"tools\",\n        asin: \"B07D7Z1VPR\"\n      },\n      {\n        title: \"Legend Valve 101-143NL T-451 FIP Ball Valve, Bronze\",\n        price: \"$22.95\",\n        image: \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjQzA2NTAwIi8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+QnJvbnplIEJhbGwgVmFsdmU8L3RleHQ+Cjwvc3ZnPg==\",\n        url: `https://www.amazon.com/dp/B008L8KPTY?tag=${this.associateTag}`,\n        rating: \"4.4\",\n        reviews: \"198\",\n        category: \"valves\",\n        asin: \"B008L8KPTY\"\n      }\n    ];\n\n    // Filter by category if specified\n    let results = plumbingProducts;\n    if (category !== 'all') {\n      results = plumbingProducts.filter(product => product.category === category);\n    }\n\n    // Filter by search query\n    if (query.trim()) {\n      const searchTerms = query.toLowerCase().split(' ');\n      results = results.filter(product => \n        searchTerms.some(term => \n          product.title.toLowerCase().includes(term) ||\n          product.category.toLowerCase().includes(term)\n        )\n      );\n    }\n\n    return results.slice(0, maxResults);\n  }\n\n  /**\n   * Get featured plumbing products\n   */\n  async getFeaturedProducts(): Promise<AmazonProduct[]> {\n    return this.searchProducts({ query: '', category: 'all', maxResults: 6 });\n  }\n\n  /**\n   * Get popular tools for plumbers\n   */\n  async getPopularTools(): Promise<AmazonProduct[]> {\n    return this.searchProducts({ query: '', category: 'tools', maxResults: 8 });\n  }\n}\n\nexport const amazonAffiliate = new AmazonAffiliateService('laplumbprep-20');","size_bytes":7314},"client/src/components/AmazonProductSearch.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Star, ExternalLink, ShoppingCart } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\ninterface AmazonProduct {\n  title: string;\n  price: string;\n  image: string;\n  url: string;\n  rating?: string;\n  reviews?: string;\n  category: string;\n  asin?: string;\n}\n\ninterface ProductSearchProps {\n  showSearch?: boolean;\n  maxResults?: number;\n  category?: string;\n  title?: string;\n}\n\nexport function AmazonProductSearch({ \n  showSearch = true, \n  maxResults = 12, \n  category = 'all',\n  title = \"Plumbing Tools & Supplies\"\n}: ProductSearchProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(category);\n  const [debouncedQuery, setDebouncedQuery] = useState(\"\");\n\n  // Debounce search query\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedQuery(searchQuery);\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [searchQuery]);\n\n  const { data: products, isLoading } = useQuery({\n    queryKey: ['/api/amazon/search', debouncedQuery, selectedCategory, maxResults],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        query: debouncedQuery,\n        category: selectedCategory,\n        maxResults: maxResults.toString()\n      });\n      const response = await fetch(`/api/amazon/search?${params}`);\n      if (!response.ok) throw new Error('Failed to fetch products');\n      return response.json();\n    },\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  const categories = [\n    { value: 'all', label: 'All Products' },\n    { value: 'tools', label: 'Tools' },\n    { value: 'pipe_fittings', label: 'Pipe Fittings' },\n    { value: 'valves', label: 'Valves' },\n    { value: 'safety_equipment', label: 'Safety Equipment' },\n    { value: 'measuring_tools', label: 'Measuring Tools' },\n    { value: 'books', label: 'Books & Manuals' },\n    { value: 'supplies', label: 'Supplies' }\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"text-center\">\n        <h2 className=\"text-3xl font-bold tracking-tight\">{title}</h2>\n        <p className=\"text-muted-foreground mt-2\">\n          Professional tools and supplies for plumbing professionals. \n          <span className=\"text-primary font-medium\"> Earn us a small commission with no extra cost to you!</span>\n        </p>\n      </div>\n\n      {/* Search Controls */}\n      {showSearch && (\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n            <Input\n              placeholder=\"Search for tools, fittings, valves...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-amazon-search\"\n            />\n          </div>\n          <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n            <SelectTrigger className=\"w-full sm:w-48\" data-testid=\"select-product-category\">\n              <SelectValue placeholder=\"Category\" />\n            </SelectTrigger>\n            <SelectContent>\n              {categories.map(cat => (\n                <SelectItem key={cat.value} value={cat.value}>\n                  {cat.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      )}\n\n      {/* Products Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n        {isLoading ? (\n          // Loading skeletons\n          Array.from({ length: maxResults }).map((_, i) => (\n            <Card key={i} className=\"overflow-hidden\">\n              <CardHeader className=\"p-0\">\n                <Skeleton className=\"h-48 w-full\" />\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                <Skeleton className=\"h-4 w-full mb-2\" />\n                <Skeleton className=\"h-4 w-2/3 mb-2\" />\n                <Skeleton className=\"h-6 w-1/3\" />\n              </CardContent>\n            </Card>\n          ))\n        ) : (\n          products?.products?.map((product: AmazonProduct, index: number) => (\n            <Card key={index} className=\"overflow-hidden hover:shadow-lg transition-shadow group\" data-testid={`card-product-${index}`}>\n              <CardHeader className=\"p-0\">\n                <div className=\"relative overflow-hidden\">\n                  <img \n                    src={product.image} \n                    alt={product.title}\n                    className=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\"\n                    onError={(e) => {\n                      const target = e.target as HTMLImageElement;\n                      target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNTAgMTIwQzE2NS41IDEyMCAxNzggMTMyLjUgMTc4IDE0OEMxNzggMTYzLjUgMTY1LjUgMTc2IDE1MCAxNzZDMTM0LjUgMTc2IDEyMiAxNjMuNSAxMjIgMTQ4QzEyMiAxMzIuNSAxMzQuNSAxMjAgMTUwIDEyMFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHN2Zz4K';\n                    }}\n                  />\n                  <Badge \n                    variant=\"secondary\" \n                    className=\"absolute top-2 right-2 bg-white/90 text-primary\"\n                  >\n                    {categories.find(c => c.value === product.category)?.label || product.category}\n                  </Badge>\n                </div>\n              </CardHeader>\n              \n              <CardContent className=\"p-4\">\n                <CardTitle className=\"text-sm font-medium line-clamp-2 mb-4\" data-testid={`text-product-title-${index}`}>\n                  {product.title}\n                </CardTitle>\n                \n                <div className=\"text-sm text-muted-foreground mb-2\">\n                  See current pricing and details on Amazon\n                </div>\n              </CardContent>\n              \n              <CardFooter className=\"p-4 pt-0\">\n                <Button asChild className=\"w-full\" size=\"sm\">\n                  <a \n                    href={product.url}\n                    target=\"_blank\"\n                    rel=\"nofollow sponsored noopener noreferrer\"\n                    data-testid={`link-product-${index}`}\n                  >\n                    <ShoppingCart className=\"w-4 h-4 mr-2\" />\n                    View on Amazon\n                    <ExternalLink className=\"w-4 h-4 ml-2\" />\n                  </a>\n                </Button>\n              </CardFooter>\n            </Card>\n          ))\n        )}\n      </div>\n\n      {/* No Results */}\n      {!isLoading && products?.products?.length === 0 && (\n        <div className=\"text-center py-12\">\n          <ShoppingCart className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium mb-2\">No products found</h3>\n          <p className=\"text-muted-foreground\">\n            Try adjusting your search terms or category filter.\n          </p>\n        </div>\n      )}\n\n      {/* Disclaimer */}\n      <div className=\"bg-muted/50 rounded-lg p-4 text-center\">\n        <p className=\"text-sm text-muted-foreground\">\n          <strong>Amazon Associate Disclosure:</strong> As an Amazon Associate, we earn from qualifying purchases. \n          When you click on our links and make a purchase, we may receive a small commission at no extra cost to you. \n          This helps support our platform and educational content.\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport function FeaturedProducts() {\n  const { data: products, isLoading } = useQuery({\n    queryKey: ['/api/amazon/featured'],\n    queryFn: async () => {\n      const response = await fetch('/api/amazon/featured');\n      if (!response.ok) throw new Error('Failed to fetch featured products');\n      return response.json();\n    },\n    staleTime: 10 * 60 * 1000, // 10 minutes\n  });\n\n  return (\n    <AmazonProductSearch \n      showSearch={false}\n      maxResults={6}\n      title=\"Featured Tools for Plumbers\"\n    />\n  );\n}","size_bytes":8674},"client/src/lib/plumbing-code-sections.ts":{"content":"// Utility functions for chapter-based filtering\nexport function getChapterFromSection(sectionValue: string): number {\n  return Math.floor(parseInt(sectionValue, 10) / 100);\n}\n\nexport function parseChapterNumber(chapterStr: string): number {\n  const match = chapterStr.match(/\\d+/);\n  return match ? parseInt(match[0], 10) : 0;\n}\n\nexport function filterSectionsByChapter(chapterStr: string): typeof PLUMBING_CODE_SECTIONS {\n  const chapterNum = parseChapterNumber(chapterStr);\n  return PLUMBING_CODE_SECTIONS.filter(section => \n    getChapterFromSection(section.value) === chapterNum\n  ).sort((a, b) => parseInt(a.value, 10) - parseInt(b.value, 10));\n}\n\n// Louisiana Plumbing Code sections data - you can add sections here\nexport const PLUMBING_CODE_SECTIONS: Array<{ value: string; label: string }> = [\n  // Add your sections here in the format:\n  // { value: \"101\", label: \"Â§101 - Section Title\" },\n];","size_bytes":904},"client/src/pages/amazon-products.tsx":{"content":"import { AmazonProductSearch } from \"@/components/AmazonProductSearch\";\n\nexport default function AmazonProductsPage() {\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <AmazonProductSearch />\n    </div>\n  );\n}","size_bytes":228},"client/src/components/interactive-quiz.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  ChevronLeft, \n  ChevronRight, \n  CheckCircle, \n  XCircle, \n  BookOpen,\n  RotateCcw,\n  ArrowRight,\n  MessageCircle\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface QuizQuestion {\n  id: string;\n  question: string;\n  options: string[];\n  correctAnswer: number;\n  explanation?: string;\n  codeReference?: string;\n  difficulty: 'easy' | 'medium' | 'hard' | 'very_hard';\n}\n\ninterface QuizAttempt {\n  id: string;\n  questions: QuizQuestion[];\n  userAnswers: { [questionIndex: number]: number };\n  score?: number;\n  passed?: boolean;\n  incorrectQuestions?: QuizQuestion[];\n}\n\ninterface InteractiveQuizProps {\n  section: string;\n  contentId: string;\n  title?: string;\n  onComplete?: () => void;\n}\n\nexport default function InteractiveQuiz({ section, contentId, title, onComplete }: InteractiveQuizProps) {\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [answers, setAnswers] = useState<{ [key: number]: number }>({});\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [showReview, setShowReview] = useState(false);\n  const [startTime] = useState(Date.now());\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n\n  // Fetch quiz questions for this section\n  const { data: quizData, isLoading } = useQuery<QuizAttempt>({\n    queryKey: [`/api/quiz/${section}/start`],\n    queryFn: async () => {\n      const response = await fetch(`/api/quiz/${section}/start`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) throw new Error(\"Failed to start quiz\");\n      return response.json();\n    },\n  });\n\n  // Submit quiz mutation\n  const submitMutation = useMutation({\n    mutationFn: async () => {\n      const timeSpent = Math.floor((Date.now() - startTime) / 1000);\n      const questionsWithAnswers = quizData?.questions.map((q, index) => ({\n        id: q.id,\n        question: q.question,  // Keep consistent field naming\n        userAnswer: answers[index] ?? null,\n        correctAnswer: q.correctAnswer,\n        isCorrect: answers[index] === q.correctAnswer\n      }));\n\n      return await apiRequest(\"POST\", `/api/quiz/${section}/submit`, {\n        contentId,\n        questions: questionsWithAnswers,\n        timeSpent\n      });\n    },\n    onSuccess: (result: any) => {\n      setIsSubmitted(true);\n      queryClient.invalidateQueries({ queryKey: [`/api/quiz/${section}`] });\n      \n      if (result.passed) {\n        toast({\n          title: \"Congratulations!\",\n          description: `You passed with ${result.score}%! Moving to next section.`,\n        });\n        setTimeout(() => onComplete?.(), 2000);\n      } else {\n        toast({\n          title: \"Keep studying!\",\n          description: `You scored ${result.score}%. Let's review your mistakes with AI help.`,\n          variant: \"destructive\",\n        });\n        // Automatically redirect to AI chat instead of showing review\n        handleGetAIHelp();\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Submission failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p>Loading quiz questions...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!quizData?.questions?.length) {\n    return (\n      <Card>\n        <CardContent className=\"p-6 text-center\">\n          <p className=\"text-muted-foreground\">No questions available for this section.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const questions = quizData.questions;\n  const currentQ = questions[currentQuestion];\n  const progress = ((currentQuestion + 1) / questions.length) * 100;\n  const answeredCount = Object.keys(answers).length;\n  const allAnswered = answeredCount === questions.length;\n\n  const handleAnswerChange = (answerIndex: number) => {\n    setAnswers(prev => ({\n      ...prev,\n      [currentQuestion]: answerIndex\n    }));\n  };\n\n  const handleNext = () => {\n    if (currentQuestion < questions.length - 1) {\n      setCurrentQuestion(currentQuestion + 1);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentQuestion > 0) {\n      setCurrentQuestion(currentQuestion - 1);\n    }\n  };\n\n  const handleQuestionJump = (questionIndex: number) => {\n    setCurrentQuestion(questionIndex);\n  };\n\n  const handleSubmit = () => {\n    if (!allAnswered) {\n      toast({\n        title: \"Incomplete Quiz\",\n        description: \"Please answer all questions before submitting.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    submitMutation.mutate();\n  };\n\n  const handleRetry = () => {\n    setAnswers({});\n    setCurrentQuestion(0);\n    setIsSubmitted(false);\n    setShowReview(false);\n    queryClient.invalidateQueries({ queryKey: [`/api/quiz/${section}`] });\n  };\n\n  const handleGetAIHelp = () => {\n    // Calculate results for AI context\n    const incorrectQuestions = questions.filter((_, index) => \n      answers[index] !== undefined && answers[index] !== questions[index].correctAnswer\n    );\n    const score = Math.round((Object.keys(answers).length - incorrectQuestions.length) / questions.length * 100);\n\n    // Create a summary of incorrect questions for AI context\n    const incorrectQuestionsText = incorrectQuestions.map((question, index) => {\n      const originalIndex = questions.findIndex(q => q.id === question.id);\n      const userAnswer = answers[originalIndex];\n      const correctAnswer = question.correctAnswer;\n      \n      return `Question ${originalIndex + 1}: ${question.question}\\n` +\n        `Your answer: ${question.options[userAnswer]}\\n` +\n        `Correct answer: ${question.options[correctAnswer]}\\n` +\n        `${question.explanation ? `Explanation: ${question.explanation}\\n` : ''}` +\n        `${question.codeReference ? `Code Reference: ${question.codeReference}\\n` : ''}`;\n    }).join('\\n---\\n');\n\n    // Navigate to AI mentor with context about incorrect questions\n    const aiContext = {\n      type: 'quiz_review',\n      section: section,\n      title: title || `Section ${section} Quiz`,\n      incorrectCount: incorrectQuestions.length,\n      totalQuestions: questions.length,\n      score: score,\n      questions: incorrectQuestionsText\n    };\n\n    // Store context in session storage for the AI mentor to use\n    sessionStorage.setItem('aiMentorContext', JSON.stringify(aiContext));\n    \n    // Navigate to study companion (AI mentor)\n    setLocation('/study-companion');\n  };\n\n  // Calculate results for completion check\n  const score = Math.round((answeredCount - questions.filter((_, index) => \n    answers[index] !== undefined && answers[index] !== questions[index].correctAnswer\n  ).length) / questions.length * 100);\n  \n  // Check if this is a chapter review (requires 80%) or regular quiz (requires 70%)\n  const isChapterReview = title?.toLowerCase().includes('chapter review') || false;\n  const requiredScore = isChapterReview ? 80 : 70;\n  const passed = score >= requiredScore;\n\n  if (isSubmitted && passed) {\n    return (\n      <Card>\n        <CardContent className=\"p-6 text-center space-y-4\">\n          <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto\" />\n          <div className=\"space-y-2\">\n            <h2 className=\"text-2xl font-bold text-green-700\">Congratulations!</h2>\n            <p className=\"text-lg\">You passed with {score}%</p>\n            <p className=\"text-muted-foreground\">\n              You can now proceed to the next section.\n            </p>\n          </div>\n          \n          <Button onClick={() => onComplete?.()} className=\"w-full max-w-sm\">\n            <ArrowRight className=\"w-4 h-4 mr-2\" />\n            Continue to Next Section\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Progress and Navigation */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Section {section} Quiz</CardTitle>\n            <Badge variant=\"secondary\">\n              Question {currentQuestion + 1} of {questions.length}\n            </Badge>\n          </div>\n          <Progress value={progress} className=\"w-full\" />\n          <div className=\"flex justify-between text-sm text-muted-foreground\">\n            <span>Progress: {Math.round(progress)}%</span>\n            <span>Answered: {answeredCount}/{questions.length}</span>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Question Navigation */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex flex-wrap gap-2\">\n            {questions.map((_, index) => (\n              <Button\n                key={index}\n                variant={\n                  index === currentQuestion \n                    ? \"default\" \n                    : answers[index] !== undefined \n                    ? \"secondary\" \n                    : \"outline\"\n                }\n                size=\"sm\"\n                onClick={() => handleQuestionJump(index)}\n                className=\"w-10 h-10\"\n                data-testid={`question-nav-${index + 1}`}\n              >\n                {index + 1}\n              </Button>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Current Question */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">\n            Question {currentQuestion + 1}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <p className=\"text-lg font-medium\">{currentQ.question}</p>\n          \n          <RadioGroup\n            value={answers[currentQuestion]?.toString()}\n            onValueChange={(value) => handleAnswerChange(parseInt(value))}\n          >\n            {currentQ.options.map((option, index) => (\n              <div key={index} className=\"flex items-center space-x-2 p-3 rounded border hover:bg-gray-50\">\n                <RadioGroupItem \n                  value={index.toString()} \n                  id={`option-${index}`}\n                  data-testid={`answer-option-${String.fromCharCode(65 + index)}`}\n                />\n                <Label \n                  htmlFor={`option-${index}`} \n                  className=\"flex-1 cursor-pointer\"\n                >\n                  <span className=\"font-medium mr-2\">\n                    {String.fromCharCode(65 + index)}.\n                  </span>\n                  {option}\n                </Label>\n              </div>\n            ))}\n          </RadioGroup>\n        </CardContent>\n      </Card>\n\n      {/* Navigation Controls */}\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex justify-between items-center\">\n            <Button\n              variant=\"outline\"\n              onClick={handlePrevious}\n              disabled={currentQuestion === 0}\n              data-testid=\"button-previous-question\"\n            >\n              <ChevronLeft className=\"w-4 h-4 mr-2\" />\n              Previous\n            </Button>\n\n            <div className=\"flex gap-2\">\n              {currentQuestion < questions.length - 1 ? (\n                <Button\n                  onClick={handleNext}\n                  data-testid=\"button-next-question\"\n                >\n                  Next\n                  <ChevronRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              ) : (\n                <Button\n                  onClick={handleSubmit}\n                  disabled={!allAnswered || submitMutation.isPending}\n                  variant={allAnswered ? \"default\" : \"secondary\"}\n                  data-testid=\"button-submit-quiz\"\n                >\n                  {submitMutation.isPending ? (\n                    <>\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                      Submitting...\n                    </>\n                  ) : (\n                    <>\n                      Submit Quiz\n                      <CheckCircle className=\"w-4 h-4 ml-2\" />\n                    </>\n                  )}\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Answer Summary */}\n      {answeredCount > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium\">Answer Summary</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground\">\n              {answeredCount} of {questions.length} questions answered\n              {!allAnswered && (\n                <span className=\"text-orange-600 ml-2\">\n                  ({questions.length - answeredCount} remaining)\n                </span>\n              )}\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":13614},"client/src/pages/cart.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Trash2, Plus, Minus, ShoppingBag } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function Cart() {\n  const [guestCartItems, setGuestCartItems] = useState<any[]>([]);\n  const { toast } = useToast();\n\n  const { data: user } = useQuery({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n\n  const { data: apiCartItems } = useQuery({\n    queryKey: [\"/api/cart\"],\n    enabled: !!user,\n    retry: false,\n  });\n\n  // Load guest cart from localStorage\n  useEffect(() => {\n    if (!user) {\n      const guestCart = JSON.parse(localStorage.getItem(\"guest-cart\") || \"[]\");\n      setGuestCartItems(guestCart);\n    }\n  }, [user]);\n\n  const cartItems = user ? (apiCartItems || []) : guestCartItems;\n\n  const updateGuestCartQuantity = (productId: string, newQuantity: number) => {\n    const updatedCart = guestCartItems.map(item => \n      item.productId === productId \n        ? { ...item, quantity: newQuantity }\n        : item\n    ).filter(item => item.quantity > 0);\n    \n    setGuestCartItems(updatedCart);\n    localStorage.setItem(\"guest-cart\", JSON.stringify(updatedCart));\n    window.dispatchEvent(new Event('cartUpdated'));\n  };\n\n  const removeGuestCartItem = (productId: string) => {\n    const updatedCart = guestCartItems.filter(item => item.productId !== productId);\n    setGuestCartItems(updatedCart);\n    localStorage.setItem(\"guest-cart\", JSON.stringify(updatedCart));\n    window.dispatchEvent(new Event('cartUpdated'));\n    \n    toast({\n      title: \"Item removed\",\n      description: \"Product has been removed from your cart\",\n    });\n  };\n\n  const calculateTotal = () => {\n    return cartItems.reduce((total, item) => {\n      const price = parseFloat(item.product?.price || item.price || \"0\");\n      return total + (price * item.quantity);\n    }, 0).toFixed(2);\n  };\n\n  if (cartItems.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background py-8\">\n        <div className=\"container mx-auto px-4\">\n          <h1 className=\"text-3xl font-bold mb-8\">Shopping Cart</h1>\n          <Card className=\"text-center py-12\">\n            <CardContent>\n              <ShoppingBag className=\"w-16 h-16 mx-auto mb-4 text-muted-foreground\" />\n              <h2 className=\"text-xl font-semibold mb-2\">Your cart is empty</h2>\n              <p className=\"text-muted-foreground mb-6\">\n                Add some products to get started\n              </p>\n              <Link href=\"/store\">\n                <Button>Continue Shopping</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-8\">\n      <div className=\"container mx-auto px-4\">\n        <h1 className=\"text-3xl font-bold mb-8\">Shopping Cart</h1>\n        \n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Cart Items */}\n          <div className=\"lg:col-span-2 space-y-4\">\n            {cartItems.map((item, index) => {\n              const product = item.product || item;\n              return (\n                <Card key={item.productId || index}>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center space-x-4\">\n                      {/* Product Image */}\n                      <div className=\"flex-shrink-0\">\n                        <img\n                          src={product.image || \"/placeholder-product.jpg\"}\n                          alt={product.title || product.name}\n                          className=\"w-20 h-20 object-cover rounded-lg\"\n                        />\n                      </div>\n\n                      {/* Product Details */}\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold text-lg\">\n                          {product.title || product.name}\n                        </h3>\n                        <p className=\"text-muted-foreground text-sm\">\n                          {product.category}\n                        </p>\n                        <div className=\"flex items-center justify-between mt-2\">\n                          <span className=\"text-lg font-bold text-primary\">\n                            ${parseFloat(product.price || \"0\").toFixed(2)}\n                          </span>\n                          {product.rating && (\n                            <Badge variant=\"outline\">\n                              â­ {product.rating}\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n\n                      {/* Quantity Controls */}\n                      <div className=\"flex items-center space-x-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"icon\"\n                          onClick={() => \n                            user \n                              ? {} // TODO: API call for authenticated users\n                              : updateGuestCartQuantity(item.productId, item.quantity - 1)\n                          }\n                          disabled={item.quantity <= 1}\n                        >\n                          <Minus className=\"h-4 w-4\" />\n                        </Button>\n                        <span className=\"w-12 text-center font-medium\">\n                          {item.quantity}\n                        </span>\n                        <Button\n                          variant=\"outline\"\n                          size=\"icon\"\n                          onClick={() => \n                            user \n                              ? {} // TODO: API call for authenticated users\n                              : updateGuestCartQuantity(item.productId, item.quantity + 1)\n                          }\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n\n                      {/* Remove Button */}\n                      <Button\n                        variant=\"outline\"\n                        size=\"icon\"\n                        onClick={() => \n                          user \n                            ? {} // TODO: API call for authenticated users\n                            : removeGuestCartItem(item.productId)\n                        }\n                        className=\"text-red-600 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n\n          {/* Order Summary */}\n          <div className=\"lg:col-span-1\">\n            <Card className=\"sticky top-8\">\n              <CardHeader>\n                <CardTitle>Order Summary</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex justify-between\">\n                  <span>Items ({cartItems.length})</span>\n                  <span>${calculateTotal()}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Shipping</span>\n                  <span className=\"text-green-600\">Free</span>\n                </div>\n                <Separator />\n                <div className=\"flex justify-between text-lg font-bold\">\n                  <span>Total</span>\n                  <span>${calculateTotal()}</span>\n                </div>\n\n                {!user && (\n                  <div className=\"bg-blue-50 p-3 rounded-lg\">\n                    <p className=\"text-sm text-blue-800 mb-2\">\n                      Sign in to save your cart and complete your purchase\n                    </p>\n                    <div className=\"space-y-2\">\n                      <Link href=\"/login\">\n                        <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\n                          Sign In\n                        </Button>\n                      </Link>\n                      <Link href=\"/register\">\n                        <Button size=\"sm\" className=\"w-full\">\n                          Create Account\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                )}\n\n                <Button className=\"w-full\" size=\"lg\">\n                  Proceed to Checkout\n                </Button>\n\n                <Link href=\"/store\">\n                  <Button variant=\"outline\" className=\"w-full\">\n                    Continue Shopping\n                  </Button>\n                </Link>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9048},"client/src/pages/ai-photo-pricing.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Camera, FileText, Clock, Star, ArrowRight, Upload } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function AIPhotoPricing() {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [analysis, setAnalysis] = useState<any>(null);\n  const { toast } = useToast();\n\n  // Check authentication and subscription status\n  const { data: user } = useQuery({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n\n  const { data: subscription } = useQuery({\n    queryKey: [\"/api/subscription-status\"],\n    enabled: !!user,\n  });\n\n  // Pay-per-use photo analysis with payment collection\n  const analyzePhotoPayment = useMutation({\n    mutationFn: async ({ file, paymentMethodId }: { file: File, paymentMethodId: string }) => {\n      const formData = new FormData();\n      formData.append('photo', file);\n      formData.append('paymentMethodId', paymentMethodId);\n      \n      const response = await fetch(\"/api/photo-analysis/pay-per-use\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData,\n      });\n      if (!response.ok) throw new Error(\"Failed to process photo analysis\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setAnalysis(data);\n      setIsAnalyzing(false);\n      toast({\n        title: \"Analysis Complete\",\n        description: `Charged $${data.cost} for professional analysis.`,\n      });\n    },\n    onError: (error: any) => {\n      setIsAnalyzing(false);\n      toast({\n        title: \"Analysis Failed\",\n        description: error.message || \"Failed to analyze photo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Create payment intent for pay-per-use\n  const createPaymentIntent = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/create-photo-payment-intent\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ amount: 499 }), // $4.99\n      });\n      if (!response.ok) throw new Error(\"Failed to create payment intent\");\n      return response.json();\n    },\n  });\n\n  // Create payment session for photo analysis credits (bulk purchase)\n  const purchasePhotoAnalysis = useMutation({\n    mutationFn: async ({ credits, amount, planName }: { credits: number, amount: number, planName: string }) => {\n      const response = await fetch(\"/api/create-photo-credits-payment\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ credits, amount, planName }),\n      });\n      if (!response.ok) throw new Error(\"Failed to create payment session\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.url) {\n        window.location.href = data.url;\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to process payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const plans = [\n    {\n      name: \"Starter Pack\",\n      credits: 10,\n      price: 19.99,\n      description: \"Perfect for small projects\",\n      features: [\n        \"10 photo analyses\",\n        \"Code compliance checking\",\n        \"Installation review\",\n        \"Detailed reports\",\n        \"Email support\",\n      ],\n      popular: false,\n    },\n    {\n      name: \"Professional\",\n      credits: 25,\n      price: 39.99,\n      description: \"Most popular for contractors\",\n      features: [\n        \"25 photo analyses\",\n        \"Code compliance checking\", \n        \"Installation review\",\n        \"Detailed reports\",\n        \"Priority support\",\n        \"Save 20% per analysis\",\n      ],\n      popular: true,\n    },\n    {\n      name: \"Business\",\n      credits: 50,\n      price: 69.99,\n      description: \"Best value for companies\",\n      features: [\n        \"50 photo analyses\",\n        \"Code compliance checking\",\n        \"Installation review\", \n        \"Detailed reports\",\n        \"Priority support\",\n        \"Save 30% per analysis\",\n        \"Bulk processing\",\n      ],\n      popular: false,\n    },\n  ];\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      if (file.size > 10 * 1024 * 1024) { // 10MB limit\n        toast({\n          title: \"File too large\",\n          description: \"Please choose a file smaller than 10MB.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setSelectedFile(file);\n      setAnalysis(null);\n    }\n  };\n\n  const handlePayPerUseAnalysis = async () => {\n    if (!selectedFile) return;\n    \n    if (!user) {\n      toast({\n        title: \"Sign in required\",\n        description: \"Please sign in to use photo analysis\",\n      });\n      return;\n    }\n\n    setIsAnalyzing(true);\n    \n    try {\n      // Create payment intent\n      const paymentData = await createPaymentIntent.mutateAsync();\n      \n      // Redirect to Stripe Checkout for payment\n      window.location.href = paymentData.url;\n    } catch (error: any) {\n      setIsAnalyzing(false);\n      toast({\n        title: \"Payment Error\",\n        description: error.message || \"Failed to initialize payment\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handlePurchase = (plan: any) => {\n    if (!user) {\n      toast({\n        title: \"Sign in required\",\n        description: \"Please sign in to purchase photo analysis credits\",\n      });\n      return;\n    }\n    \n    setIsProcessing(true);\n    purchasePhotoAnalysis.mutate({ \n      credits: plan.credits, \n      amount: plan.price,\n      planName: plan.name\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        {/* Header */}\n        <div className=\"text-center mb-16\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <Camera className=\"h-12 w-12 text-blue-600 mr-4\" />\n            <h1 className=\"text-4xl font-bold text-gray-900 dark:text-white\">\n              AI Photo Analysis\n            </h1>\n          </div>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto\">\n            Get instant code compliance checking and professional installation reviews using our advanced AI technology\n          </p>\n        </div>\n\n        {/* Pay-Per-Use Analysis Tool */}\n        <Card className=\"mb-12 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-2xl text-blue-900\">Try Analysis Now - Pay Per Use</CardTitle>\n            <CardDescription className=\"text-blue-700\">\n              $4.99 per photo analysis - Only pay when you use it\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n              {/* Upload Section */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-semibold\">Upload Photo</h3>\n                <div className=\"border-2 border-dashed border-blue-300 rounded-lg p-8 text-center bg-white\">\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handleFileSelect}\n                    className=\"hidden\"\n                    id=\"photo-upload\"\n                  />\n                  <label\n                    htmlFor=\"photo-upload\"\n                    className=\"cursor-pointer flex flex-col items-center\"\n                  >\n                    <Camera className=\"h-12 w-12 text-blue-400 mb-4\" />\n                    <span className=\"text-lg font-medium text-blue-700 mb-2\">\n                      Choose photo to analyze\n                    </span>\n                    <span className=\"text-sm text-blue-600\">\n                      Max 10MB â€¢ JPG, PNG, HEIC\n                    </span>\n                  </label>\n                </div>\n\n                {selectedFile && (\n                  <div className=\"bg-green-50 p-4 rounded-lg border border-green-200\">\n                    <div className=\"flex items-center\">\n                      <CheckCircle className=\"h-5 w-5 text-green-600 mr-2\" />\n                      <span className=\"font-medium text-green-800\">\n                        {selectedFile.name}\n                      </span>\n                    </div>\n                  </div>\n                )}\n\n                <Button\n                  onClick={handlePayPerUseAnalysis}\n                  disabled={!selectedFile || isAnalyzing}\n                  className=\"w-full\"\n                  size=\"lg\"\n                >\n                  {isAnalyzing ? (\n                    <>\n                      <Clock className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Analyzing...\n                    </>\n                  ) : (\n                    <>\n                      <Camera className=\"h-4 w-4 mr-2\" />\n                      Analyze Photo ($4.99)\n                    </>\n                  )}\n                </Button>\n              </div>\n\n              {/* Results Section */}\n              <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-semibold\">Analysis Results</h3>\n                <div className=\"bg-white rounded-lg p-6 border border-gray-200 min-h-[200px]\">\n                  {!analysis ? (\n                    <div className=\"text-center py-8 text-gray-500\">\n                      Upload and analyze a photo to see professional results\n                    </div>\n                  ) : (\n                    <div className=\"space-y-4\">\n                      <div className={`p-4 rounded-lg ${analysis.isCompliant ? 'bg-green-50' : 'bg-yellow-50'}`}>\n                        <div className=\"flex items-center mb-2\">\n                          <CheckCircle className={`h-5 w-5 mr-2 ${analysis.isCompliant ? 'text-green-600' : 'text-yellow-600'}`} />\n                          <span className={`font-medium ${analysis.isCompliant ? 'text-green-800' : 'text-yellow-800'}`}>\n                            {analysis.isCompliant ? 'Code Compliant' : 'Violations Found'}\n                          </span>\n                        </div>\n                      </div>\n\n                      {analysis.violations && analysis.violations.length > 0 && (\n                        <div>\n                          <h4 className=\"font-medium text-gray-900 mb-2\">Code Violations:</h4>\n                          <ul className=\"text-sm text-gray-700 space-y-1\">\n                            {analysis.violations.map((violation: string, index: number) => (\n                              <li key={index}>â€¢ {violation}</li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n\n                      {analysis.recommendations && analysis.recommendations.length > 0 && (\n                        <div>\n                          <h4 className=\"font-medium text-gray-900 mb-2\">Recommendations:</h4>\n                          <ul className=\"text-sm text-gray-700 space-y-1\">\n                            {analysis.recommendations.map((rec: string, index: number) => (\n                              <li key={index}>â€¢ {rec}</li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* How it works */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 mb-16\">\n          <div className=\"text-center\">\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Camera className=\"h-8 w-8 text-blue-600\" />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\">Upload Photo</h3>\n            <p className=\"text-gray-600 dark:text-gray-300\">\n              Take a photo of your plumbing installation or upload existing images\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Star className=\"h-8 w-8 text-blue-600\" />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\">AI Analysis</h3>\n            <p className=\"text-gray-600 dark:text-gray-300\">\n              Our AI analyzes your photo for Louisiana plumbing code compliance\n            </p>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <FileText className=\"h-8 w-8 text-blue-600\" />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\">Get Report</h3>\n            <p className=\"text-gray-600 dark:text-gray-300\">\n              Receive detailed analysis with violations, recommendations, and corrections\n            </p>\n          </div>\n        </div>\n\n        {/* Pricing Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12\">\n          {plans.map((plan) => (\n            <Card \n              key={plan.name} \n              className={`relative ${plan.popular ? 'border-blue-500 shadow-lg' : ''}`}\n            >\n              {plan.popular && (\n                <Badge className=\"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-1\">\n                  Most Popular\n                </Badge>\n              )}\n              <CardHeader className=\"text-center\">\n                <CardTitle className=\"text-2xl\">{plan.name}</CardTitle>\n                <CardDescription>{plan.description}</CardDescription>\n                <div className=\"mt-4\">\n                  <span className=\"text-4xl font-bold text-blue-600\">${plan.price}</span>\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    ${(plan.price / plan.credits).toFixed(2)} per analysis\n                  </p>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <ul className=\"space-y-3 mb-8\">\n                  {plan.features.map((feature, index) => (\n                    <li key={index} className=\"flex items-center\">\n                      <CheckCircle className=\"h-5 w-5 text-green-500 mr-3\" />\n                      <span className=\"text-sm\">{feature}</span>\n                    </li>\n                  ))}\n                </ul>\n                <Button \n                  className=\"w-full\" \n                  size=\"lg\"\n                  variant={plan.popular ? \"default\" : \"outline\"}\n                  onClick={() => handlePurchase(plan)}\n                  disabled={isProcessing}\n                >\n                  {isProcessing ? \"Processing...\" : `Purchase ${plan.credits} Credits`}\n                </Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {/* Current subscription info */}\n        {user && subscription?.hasActiveSubscription && (\n          <Card className=\"mb-8 bg-green-50 border-green-200\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center\">\n                <CheckCircle className=\"h-6 w-6 text-green-600 mr-3\" />\n                <div>\n                  <h3 className=\"font-semibold text-green-800\">Subscription Active</h3>\n                  <p className=\"text-green-700\">\n                    You have an active subscription. Photo analysis credits are 20% off for subscribers.\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Try free version */}\n        <Card className=\"bg-blue-50 border-blue-200\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-lg font-semibold text-blue-800 mb-2\">\n                  Try the Free Version First\n                </h3>\n                <p className=\"text-blue-700\">\n                  Get a basic analysis with our free photo analyzer tool to see if it meets your needs.\n                </p>\n              </div>\n              <div className=\"ml-4\">\n                <Link href=\"/ai-photo-analysis\">\n                  <Button variant=\"outline\" className=\"border-blue-300 text-blue-700\">\n                    Try Free Version\n                    <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* FAQ or additional info */}\n        <div className=\"mt-16 text-center\">\n          <h2 className=\"text-2xl font-bold mb-4\">Questions?</h2>\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\n            Contact us for bulk pricing or enterprise solutions\n          </p>\n          <Link href=\"/contact\">\n            <Button variant=\"outline\">Contact Support</Button>\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":17661},"client/src/pages/backflow-prevention-pricing.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Star, Clock, BookOpen, Users, Award } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function BackflowPreventionPricing() {\n  useEffect(() => {\n    document.title = \"Backflow Prevention Training - LA Plumb Prep\";\n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute('content', 'Comprehensive training course covering backflow prevention testing, repairs, and field report completion. Learn proper testing procedures and regulatory compliance.');\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-green-600/10 to-teal-600/10\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <div className=\"flex justify-center mb-6\">\n            <Badge className=\"bg-yellow-100 text-yellow-800 px-6 py-2 text-lg\">\n              Coming Soon\n            </Badge>\n          </div>\n          <h1 className=\"text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6\">\n            Backflow Prevention Training\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8\">\n            Comprehensive training course covering backflow prevention testing, repairs, and field report completion. Learn proper testing procedures, equipment maintenance, and regulatory compliance for backflow prevention assemblies.\n          </p>\n          \n          {/* Course Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-2xl mx-auto mb-12\">\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-green-600 mb-2\">16</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Lessons</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-green-600 mb-2\">6-8</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Weeks</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-green-600 mb-2\">Inter</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Level</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-green-600 mb-2\">24/7</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Support</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* What You'll Learn */}\n      <section className=\"py-16 bg-white dark:bg-gray-800\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            Master Backflow Prevention\n          </h2>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <div className=\"text-center p-6\">\n              <BookOpen className=\"h-12 w-12 text-green-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Testing Procedures</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Learn proper testing techniques for all backflow device types</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Award className=\"h-12 w-12 text-green-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Repair Techniques</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Hands-on training for repairing and maintaining assemblies</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Users className=\"h-12 w-12 text-green-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Field Reports</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Complete field report completion and regulatory compliance</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Coming Soon */}\n      <section className=\"py-16 bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-4\">\n            Coming Soon\n          </h2>\n          <p className=\"text-xl text-gray-600 dark:text-gray-400 mb-8\">\n            This specialized training course is in development. Join our waitlist for early access!\n          </p>\n          \n          <Card className=\"max-w-md mx-auto\">\n            <CardContent className=\"pt-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Get Notified</h3>\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Be the first to access this specialized training with early bird pricing.\n              </p>\n              <Link href=\"/pricing\">\n                <Button className=\"w-full\">\n                  Join Waitlist\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":5419},"client/src/pages/louisiana-journeyman-prep-pricing.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { CheckCircle, Star, Clock, BookOpen, Users, Award } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport BetaBanner from \"@/components/beta-banner\";\n\nexport default function LouisianaJourneymanPrepPricing() {\n  const [selectedPlan, setSelectedPlan] = useState<string | null>(null);\n  const [isAnnual, setIsAnnual] = useState(false);\n  const [isBetaTester] = useState(true); // Would come from user session/API in real app\n\n  useEffect(() => {\n    document.title = \"Louisiana Journeyman Plumber Exam Prep Course - Pass Your State License Test\";\n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute('content', 'Pass your Louisiana journeyman plumber exam with our comprehensive prep course. 120+ practice questions, Louisiana State Plumbing Code training, video lessons, and AI mentoring. Beta pricing: $19.99/month. 95% pass rate.');\n    }\n  }, []);\n\n  const calculatePrice = (basePrice: number, isAnnual: boolean, isBeta: boolean) => {\n    if (isAnnual && isBeta) {\n      // Beta annual: 50% off first month + 25% off remaining 11 months\n      const firstMonth = basePrice * 0.5;\n      const remainingMonths = basePrice * 0.75 * 11;\n      return parseFloat((firstMonth + remainingMonths).toFixed(2)); // Round to 2 decimals\n    }\n    \n    let price = basePrice;\n    \n    if (isAnnual) {\n      price = price * 12 * 0.8; // 20% annual discount on 12 months\n    }\n    \n    if (isBeta && !isAnnual) {\n      price = price * 0.75; // 25% off for beta testers (monthly only)\n    }\n    \n    return parseFloat(price.toFixed(2)); // Round to 2 decimals\n  };\n\n  const getPriceId = (planId: string, isAnnual: boolean, isBeta: boolean) => {\n    // Real Stripe Price IDs from your account\n    const priceMapping = {\n      basic: {\n        monthly: {\n          regular: \"price_1S4EusByFL1L8uV24yWoGtnf\", // Basic Monthly - $49.99\n          beta: \"price_1S4E4SByFL1L8uV2fwNtzcdE\" // Beta Basic Monthly - $37.49\n        },\n        annual: {\n          regular: \"price_1S4EqJByFL1L8uV2KtL96A1l\", // Basic Annual - $599.88\n          beta: \"price_1S4Ek6ByFL1L8uV2AYQdiGj4\" // Beta Basic Annual - $437.41\n        }\n      },\n      professional: {\n        monthly: {\n          regular: \"price_1S4F7cByFL1L8uV2U5V4tOje\", // Professional Monthly - $79.99\n          beta: \"price_1S4E9wByFL1L8uV2wOO4VM4D\" // Beta Professional Monthly - $59.99\n        },\n        annual: {\n          regular: \"price_1S4F4wByFL1L8uV2xK3ArjCj\", // Professional Annual - $959.88\n          beta: \"price_1S4EZSByFL1L8uV2cRdBL3bp\" // Beta Professional Annual - $699.91\n        }\n      },\n      master: {\n        monthly: {\n          regular: \"price_1S4F1jByFL1L8uV2YfeGdK7U\", // Master Monthly - $99.99\n          beta: \"price_1S4ESMByFL1L8uV2SPXM5fs4\" // Beta Master Monthly - $74.99\n        },\n        annual: {\n          regular: \"price_1S4EyGByFL1L8uV2c2IPcRGY\", // Master Annual - $1199.88\n          beta: \"price_1S4EflByFL1L8uV2hXo6sAmI\" // Beta Master Annual - $874.91\n        }\n      }\n    };\n\n    const cycle = isAnnual ? 'annual' : 'monthly';\n    const type = isBeta ? 'beta' : 'regular';\n    return priceMapping[planId as keyof typeof priceMapping][cycle][type];\n  };\n\n  const handleSelectPlan = (planId: string) => {\n    setSelectedPlan(planId);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Beta Banner */}\n      {isBetaTester && (\n        <section className=\"py-6 bg-background\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <BetaBanner showCTA={false} />\n          </div>\n        </section>\n      )}\n\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-blue-600/10 to-indigo-600/10\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <div className=\"flex justify-center mb-6\">\n            <Badge className=\"bg-blue-100 text-blue-800 px-6 py-2 text-lg\">\n              Most Popular Course\n            </Badge>\n          </div>\n          <h1 className=\"text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6\">\n            Louisiana Journeyman Prep\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8\">\n            Comprehensive preparation for the Louisiana Journeyman Plumber License exam. Covers all aspects of the Louisiana Plumbing Code, practical applications, and exam strategies. Cancel anytime - only pay for days used.\n          </p>\n          \n          <div className=\"flex flex-col items-center space-y-6\">\n            <div className=\"flex items-center justify-center space-x-8 text-sm text-gray-600 dark:text-gray-400\">\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Cancel Anytime</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                <span>Pro-rated Billing</span>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-4 bg-white dark:bg-gray-800 p-3 rounded-lg border\">\n              <span className={`text-sm font-medium ${!isAnnual ? 'text-blue-600' : 'text-gray-600'}`}>Monthly</span>\n              <Switch checked={isAnnual} onCheckedChange={setIsAnnual} />\n              <span className={`text-sm font-medium ${isAnnual ? 'text-blue-600' : 'text-gray-600'}`}>Annual</span>\n              {isAnnual && <Badge className=\"bg-green-100 text-green-800 text-xs\">Save 20%</Badge>}\n            </div>\n          </div>\n          \n          {/* Course Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-2xl mx-auto mb-12\">\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-blue-600 mb-2\">120</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Lessons</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-blue-600 mb-2\">4-5</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Years Course</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-blue-600 mb-2\">95%</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Pass Rate</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-blue-600 mb-2\">24/7</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Support</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* What You'll Learn */}\n      <section className=\"py-16 bg-white dark:bg-gray-800\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            What You'll Master\n          </h2>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <div className=\"text-center p-6\">\n              <BookOpen className=\"h-12 w-12 text-blue-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Louisiana Plumbing Code</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Complete coverage of all 17 chapters with real-world applications</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Award className=\"h-12 w-12 text-blue-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Exam Preparation</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Practice tests and exam strategies proven to increase pass rates</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Users className=\"h-12 w-12 text-blue-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Expert Mentoring</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">AI-powered mentor available 24/7 for technical questions</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Section */}\n      <section className=\"py-16 bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-gray-900 dark:text-white mb-4\">\n            Get Started Today\n          </h2>\n          <p className=\"text-center text-gray-600 dark:text-gray-400 mb-12\">\n            Choose a subscription plan that works for you. Cancel anytime.\n          </p>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n            {[\n              {\n                id: \"basic\",\n                name: \"Basic\",\n                basePrice: 37.49,\n                tier: \"basic\",\n                description: \"Perfect for getting started\",\n                features: [\n                  \"Journeyman Prep Course\",\n                  \"Basic Calculator Tools\", \n                  \"Practice Tests\",\n                  \"Job Board Access\",\n                  \"Referral Commissions (10%)\",\n                  \"Email Support\"\n                ]\n              },\n              {\n                id: \"professional\",\n                name: \"Professional\",\n                basePrice: 59.99,\n                tier: \"professional\",\n                description: \"For serious professionals\",\n                popular: true,\n                features: [\n                  \"Everything in Basic\",\n                  \"Complete Calculator Suite\",\n                  \"AI Photo Analysis\",\n                  \"Plan Analysis Tools\",\n                  \"AI Mentor Support\",\n                  \"Priority Support\"\n                ]\n              },\n              {\n                id: \"master\",\n                name: \"Master\",\n                basePrice: 74.99,\n                tier: \"master\",\n                description: \"Complete mastery package\",\n                features: [\n                  \"Everything in Professional\",\n                  \"All Future Courses\",\n                  \"1-on-1 Mentoring\",\n                  \"Material List Generator\",\n                  \"Book Store Access\",\n                  \"White-Glove Support\"\n                ]\n              }\n            ].map((plan) => (\n              <Card \n                key={plan.id} \n                className={`p-6 hover:shadow-lg transition-all relative cursor-pointer ${\n                  plan.popular ? 'border-2 border-blue-500 scale-105' : ''\n                } ${\n                  selectedPlan === plan.id ? 'ring-2 ring-blue-500' : ''\n                }`}\n                onClick={() => handleSelectPlan(plan.id)}\n              >\n                {plan.popular && (\n                  <Badge className=\"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white\">\n                    Most Popular\n                  </Badge>\n                )}\n                <CardContent className=\"p-0\">\n                  <div className=\"text-center mb-8\">\n                    <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n                      {plan.name}\n                    </h3>\n                    <div className=\"text-4xl font-bold text-blue-600 mb-2\">\n                      {isAnnual ? (\n                        <>\n                          ${calculatePrice(plan.basePrice, isAnnual, isBetaTester)}\n                          <span className=\"text-xl font-normal text-gray-600\">/year</span>\n                        </>\n                      ) : (\n                        <>\n                          ${calculatePrice(plan.basePrice, isAnnual, isBetaTester)}\n                          <span className=\"text-xl font-normal text-gray-600\">/month</span>\n                        </>\n                      )}\n                      {(isAnnual || isBetaTester) && (\n                        <div className=\"text-sm space-y-1\">\n                          {plan.basePrice !== calculatePrice(plan.basePrice, isAnnual, isBetaTester) && (\n                            <div className=\"text-gray-500 line-through\">\n                              {isAnnual ? `$${(plan.basePrice * 12).toFixed(2)}/year` : `$${plan.basePrice.toFixed(2)}/month`}\n                            </div>\n                          )}\n                          {isBetaTester && (\n                            <div className=\"text-orange-600 font-semibold\">\n                              ðŸŽ‰ Beta: Extra 25% off + 50% off first month\n                            </div>\n                          )}\n                          {isAnnual && (\n                            <div className=\"text-green-600 font-normal\">\n                              Save ${((plan.basePrice * 12) - calculatePrice(plan.basePrice, isAnnual, isBetaTester)).toFixed(2)} per year (20% off)\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                    <p className=\"text-gray-600 dark:text-gray-400\">\n                      {plan.description}\n                    </p>\n                  </div>\n                  \n                  <div className=\"space-y-4 mb-8\">\n                    {plan.features.map((feature, index) => (\n                      <div key={index} className=\"flex items-center space-x-3\">\n                        <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                        <span className=\"text-gray-900 dark:text-white\">{feature}</span>\n                      </div>\n                    ))}\n                  </div>\n                  \n                  <Link href={`/checkout?plan=${plan.tier}&priceId=${getPriceId(plan.id, isAnnual, isBetaTester)}&planName=${plan.name}&price=$${calculatePrice(plan.basePrice, isAnnual, isBetaTester).toFixed(2)}`}>\n                    <Button \n                      className={`w-full ${plan.popular ? 'bg-blue-600 hover:bg-blue-700' : ''}`}\n                      size=\"lg\"\n                    >\n                      Get Started Now\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":14589},"client/src/pages/master-plumber-prep-pricing.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Star, Clock, BookOpen, Users, Award } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function MasterPlumberPrepPricing() {\n  useEffect(() => {\n    document.title = \"Master Plumber Prep - LA Plumb Prep\";\n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute('content', 'Advanced certification preparation for Louisiana master plumber license covering business practices, advanced code knowledge, and supervisory responsibilities.');\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-purple-600/10 to-indigo-600/10\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <div className=\"flex justify-center mb-6\">\n            <Badge className=\"bg-yellow-100 text-yellow-800 px-6 py-2 text-lg\">\n              Coming Soon\n            </Badge>\n          </div>\n          <h1 className=\"text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6\">\n            Master Plumber Prep\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8\">\n            Advanced certification preparation for Louisiana master plumber license covering business practices, advanced code knowledge, and supervisory responsibilities.\n          </p>\n          \n          {/* Course Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-2xl mx-auto mb-12\">\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-purple-600 mb-2\">48</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Lessons</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-purple-600 mb-2\">6-12</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Months</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-purple-600 mb-2\">Advanced</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Level</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-purple-600 mb-2\">24/7</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Support</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* What You'll Learn */}\n      <section className=\"py-16 bg-white dark:bg-gray-800\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            Master Advanced Skills\n          </h2>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <div className=\"text-center p-6\">\n              <BookOpen className=\"h-12 w-12 text-purple-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Business Management</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Learn to run a successful plumbing business with proper licensing</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Award className=\"h-12 w-12 text-purple-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Advanced Code Knowledge</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Master complex commercial and industrial plumbing systems</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Users className=\"h-12 w-12 text-purple-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Team Leadership</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Supervisory skills and crew management techniques</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Coming Soon */}\n      <section className=\"py-16 bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-4\">\n            Coming Soon\n          </h2>\n          <p className=\"text-xl text-gray-600 dark:text-gray-400 mb-8\">\n            We're putting the finishing touches on this advanced course. Be the first to know when it's ready!\n          </p>\n          \n          <Card className=\"max-w-md mx-auto\">\n            <CardContent className=\"pt-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Get Notified</h3>\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Join our waitlist and get 25% off when the course launches.\n              </p>\n              <Link href=\"/pricing\">\n                <Button className=\"w-full\">\n                  Join Waitlist\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":5342},"client/src/pages/medical-gas-installer-pricing.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Star, Clock, BookOpen, Users, Award } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function MedicalGasInstallerPricing() {\n  useEffect(() => {\n    document.title = \"Medical Gas Installer Certification - LA Plumb Prep\";\n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute('content', 'Specialized certification for medical gas system installation covering hospital-grade systems, safety protocols, and NFPA compliance requirements.');\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-teal-600/10 to-cyan-600/10\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <div className=\"flex justify-center mb-6\">\n            <Badge className=\"bg-yellow-100 text-yellow-800 px-6 py-2 text-lg\">\n              Coming Soon\n            </Badge>\n          </div>\n          <h1 className=\"text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6\">\n            Medical Gas Installer Certification\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8\">\n            Specialized certification for medical gas system installation covering hospital-grade systems, safety protocols, and NFPA compliance requirements for healthcare facilities.\n          </p>\n          \n          {/* Course Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-2xl mx-auto mb-12\">\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-teal-600 mb-2\">32</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Lessons</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-teal-600 mb-2\">4-6</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Months</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-teal-600 mb-2\">Advanced</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Level</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-teal-600 mb-2\">24/7</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Support</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* What You'll Learn */}\n      <section className=\"py-16 bg-white dark:bg-gray-800\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            Master Medical Gas Systems\n          </h2>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <div className=\"text-center p-6\">\n              <BookOpen className=\"h-12 w-12 text-teal-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Hospital-Grade Systems</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Installation and maintenance of critical medical gas delivery systems</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Award className=\"h-12 w-12 text-teal-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">NFPA Compliance</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Complete understanding of NFPA 99 and healthcare facility requirements</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Users className=\"h-12 w-12 text-teal-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Safety Protocols</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Critical safety procedures for healthcare environment installations</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Coming Soon */}\n      <section className=\"py-16 bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-4\">\n            Coming Soon\n          </h2>\n          <p className=\"text-xl text-gray-600 dark:text-gray-400 mb-8\">\n            This specialized healthcare certification course is in final development. Join our exclusive waitlist!\n          </p>\n          \n          <Card className=\"max-w-md mx-auto\">\n            <CardContent className=\"pt-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Get Notified</h3>\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Get priority access to this high-demand specialty certification course.\n              </p>\n              <Link href=\"/pricing\">\n                <Button className=\"w-full\">\n                  Join Waitlist\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":5408},"client/src/pages/natural-gas-certification-pricing.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, Star, Clock, BookOpen, Users, Award } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function NaturalGasCertificationPricing() {\n  useEffect(() => {\n    document.title = \"Natural Gas Certification - LA Plumb Prep\";\n    const metaDescription = document.querySelector('meta[name=\"description\"]');\n    if (metaDescription) {\n      metaDescription.setAttribute('content', 'Complete preparation for Louisiana natural gas certification covering safety protocols, installation procedures, and state regulations for natural gas systems.');\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Hero Section */}\n      <section className=\"py-20 bg-gradient-to-br from-orange-600/10 to-red-600/10\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <div className=\"flex justify-center mb-6\">\n            <Badge className=\"bg-yellow-100 text-yellow-800 px-6 py-2 text-lg\">\n              Coming Soon\n            </Badge>\n          </div>\n          <h1 className=\"text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6\">\n            Natural Gas Certification\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8\">\n            Complete preparation for Louisiana natural gas certification covering safety protocols, installation procedures, and state regulations for natural gas systems.\n          </p>\n          \n          {/* Course Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-2xl mx-auto mb-12\">\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-orange-600 mb-2\">24</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Lessons</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-orange-600 mb-2\">3-4</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Months</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-orange-600 mb-2\">Inter</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Level</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-3xl font-bold text-orange-600 mb-2\">24/7</div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Support</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* What You'll Learn */}\n      <section className=\"py-16 bg-white dark:bg-gray-800\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h2 className=\"text-3xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            Master Natural Gas Systems\n          </h2>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <div className=\"text-center p-6\">\n              <BookOpen className=\"h-12 w-12 text-orange-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Safety Protocols</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Critical safety procedures for natural gas installation and maintenance</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Award className=\"h-12 w-12 text-orange-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Installation Procedures</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Proper techniques for residential and commercial gas line installation</p>\n            </div>\n            <div className=\"text-center p-6\">\n              <Users className=\"h-12 w-12 text-orange-600 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">State Regulations</h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">Louisiana-specific codes and compliance requirements</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Coming Soon */}\n      <section className=\"py-16 bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-4\">\n            Coming Soon\n          </h2>\n          <p className=\"text-xl text-gray-600 dark:text-gray-400 mb-8\">\n            This essential certification course is currently in development. Reserve your spot today!\n          </p>\n          \n          <Card className=\"max-w-md mx-auto\">\n            <CardContent className=\"pt-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Get Notified</h3>\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Be among the first to access this critical safety training course.\n              </p>\n              <Link href=\"/pricing\">\n                <Button className=\"w-full\">\n                  Join Waitlist\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </section>\n    </div>\n  );\n}","size_bytes":5376},"client/src/pages/lesson-ai-chat.tsx":{"content":"import { useRoute, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, ChevronRight, MessageSquare } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport AIMentorChat from \"@/components/ai-mentor-chat\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\nexport default function LessonAIChat() {\n  const [match, params] = useRoute(\"/course/:courseId/lesson/:section/ai-chat\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const courseId = params?.courseId;\n  const section = params?.section;\n\n  if (!courseId || !section) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  // Track lesson step progress\n  const trackProgress = async (completed = false) => {\n    try {\n      await apiRequest(\"POST\", \"/api/lesson-progress/track\", {\n        courseId: resolvedCourseId,\n        section: parseInt(section),\n        stepType: \"ai_chat\",\n        stepIndex: 3,\n        isCompleted: completed\n      });\n    } catch (error) {\n      console.error(\"Failed to track progress:\", error);\n    }\n  };\n\n  const handleContinue = () => {\n    trackProgress(true);\n    navigate(`/course/${courseId}/lesson/${section}/study-notes`);\n  };\n\n  return (\n    <div className=\"bg-gradient-to-br from-blue-50 to-indigo-100 pb-16\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-back-lesson-flow\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <MessageSquare className=\"h-5 w-5 text-primary\" />\n            <h1 className=\"text-2xl font-bold\">Section {section} AI Study Assistant</h1>\n            <Badge variant=\"secondary\">Step 4 of 6</Badge>\n          </div>\n        </div>\n\n        {/* AI Chat Section */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center\">\n                <MessageSquare className=\"h-5 w-5 text-orange-600\" />\n              </div>\n              AI Study Assistant\n            </CardTitle>\n            <p className=\"text-muted-foreground\">\n              Get section-specific help with Louisiana plumbing code questions for Section {section}\n            </p>\n          </CardHeader>\n          <CardContent>\n            <AIMentorChat currentSection={section} />\n          </CardContent>\n        </Card>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"outline\" data-testid=\"button-back-lesson-flow-bottom\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          \n          <Button onClick={handleContinue} data-testid=\"button-continue-study-notes\">\n            Continue to Study Notes\n            <ChevronRight className=\"h-4 w-4 ml-2\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":4080},"client/src/pages/lesson-flashcards.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useRoute, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, ChevronRight, RotateCcw, ChevronLeft, Eye, EyeOff } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useState, useEffect } from \"react\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface CourseContent {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: string;\n  content: any;\n  duration?: number;\n  isActive: boolean;\n  sortOrder: number;\n}\n\ninterface Flashcard {\n  id: string;\n  front: string;\n  back: string;\n  difficulty?: string;\n  chapter?: number;\n  section?: number;\n  codeReference?: string;\n  category?: string;\n}\n\nexport default function LessonFlashcards() {\n  const [match, params] = useRoute(\"/course/:courseId/lesson/:section/flashcards\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const courseId = params?.courseId;\n  const section = params?.section;\n  \n  const [currentCardIndex, setCurrentCardIndex] = useState(0);\n  const [showAnswer, setShowAnswer] = useState(false);\n  const [studiedCards, setStudiedCards] = useState<Set<string>>(new Set());\n\n  if (!courseId || !section) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  // Fetch course content for this section\n  const { data: content, isLoading: isContentLoading } = useQuery({\n    queryKey: [`/api/courses/${resolvedCourseId}/content`],\n    enabled: !!resolvedCourseId,\n  });\n\n  // Find flashcards content for this section\n  const flashcardsContent = Array.isArray(content) ? content.find((item: CourseContent) => \n    String(item.section) === section && \n    (item.type === 'flashcards' || item.title?.toLowerCase().includes('flashcards'))\n  ) : undefined;\n\n  const flashcardsArray: Flashcard[] = flashcardsContent?.content?.extracted?.cards || flashcardsContent?.content?.flashcards || [];\n  const currentCard = flashcardsArray[currentCardIndex];\n\n  // Track lesson step progress\n  const trackProgress = async (completed = false) => {\n    try {\n      await apiRequest(\"POST\", \"/api/lesson-progress/track\", {\n        courseId: resolvedCourseId,\n        section: parseInt(section),\n        stepType: \"flashcards\",\n        stepIndex: 2,\n        isCompleted: completed,\n        currentPosition: { \n          cardIndex: currentCardIndex, \n          totalCards: flashcardsArray.length,\n          studiedCount: studiedCards.size\n        }\n      });\n    } catch (error) {\n      console.error(\"Failed to track progress:\", error);\n    }\n  };\n\n  // Load saved progress\n  useEffect(() => {\n    const loadProgress = async () => {\n      try {\n        const response = await apiRequest(\"GET\", `/api/lesson-progress/${resolvedCourseId}/${section}/flashcards`);\n        if (response.ok) {\n          const progress = await response.json();\n          if (progress.currentPosition?.cardIndex !== undefined) {\n            setCurrentCardIndex(progress.currentPosition.cardIndex);\n          }\n          if (progress.currentPosition?.studiedCount) {\n            // You might want to load which specific cards were studied\n          }\n        }\n      } catch (error) {\n        console.error(\"Failed to load progress:\", error);\n      }\n    };\n    \n    if (resolvedCourseId && section) {\n      loadProgress();\n    }\n  }, [resolvedCourseId, section]);\n\n  // Save progress when card changes\n  useEffect(() => {\n    if (flashcardsArray.length > 0 && currentCardIndex >= 0) {\n      trackProgress(false);\n    }\n  }, [currentCardIndex, studiedCards.size, flashcardsArray.length]);\n\n  const handleNextCard = () => {\n    if (currentCard) {\n      setStudiedCards(prev => new Set(prev).add(currentCard.id));\n    }\n    \n    if (currentCardIndex < flashcardsArray.length - 1) {\n      setCurrentCardIndex(prev => prev + 1);\n      setShowAnswer(false);\n    }\n  };\n\n  const handlePrevCard = () => {\n    if (currentCardIndex > 0) {\n      setCurrentCardIndex(prev => prev - 1);\n      setShowAnswer(false);\n    }\n  };\n\n  const handleContinue = () => {\n    const allStudied = studiedCards.size === flashcardsArray.length;\n    trackProgress(allStudied);\n    navigate(`/course/${courseId}/lesson/${section}/ai-chat`);\n  };\n\n  if (isContentLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-back-lesson-flow\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <RotateCcw className=\"h-5 w-5 text-primary\" />\n            <h1 className=\"text-2xl font-bold\">Section {section} Flashcards</h1>\n            <Badge variant=\"secondary\">Step 3 of 6</Badge>\n          </div>\n        </div>\n\n        {/* Progress */}\n        {flashcardsArray.length > 0 && (\n          <div className=\"mb-6\">\n            <div className=\"flex justify-between text-sm text-muted-foreground mb-2\">\n              <span>Card {currentCardIndex + 1} of {flashcardsArray.length}</span>\n              <span>{studiedCards.size} studied</span>\n            </div>\n            <div className=\"w-full bg-gray-200 rounded-full h-2\">\n              <div \n                className=\"bg-primary h-2 rounded-full transition-all duration-300\"\n                style={{ width: `${((currentCardIndex + 1) / flashcardsArray.length) * 100}%` }}\n              />\n            </div>\n          </div>\n        )}\n\n        {/* Flashcard */}\n        {currentCard ? (\n          <Card className=\"mb-8 min-h-[400px]\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center\">\n                    <RotateCcw className=\"h-5 w-5 text-purple-600\" />\n                  </div>\n                  Louisiana Plumbing Code Flashcard\n                </div>\n                {currentCard.codeReference && (\n                  <Badge variant=\"outline\">{currentCard.codeReference}</Badge>\n                )}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6\">\n                {/* Question */}\n                <div className=\"bg-blue-50 p-6 rounded-lg\">\n                  <h3 className=\"font-semibold text-blue-900 mb-3\">Question:</h3>\n                  <p className=\"text-blue-800 text-lg leading-relaxed\">{currentCard.front}</p>\n                </div>\n\n                {/* Answer */}\n                <div className=\"bg-green-50 p-6 rounded-lg\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <h3 className=\"font-semibold text-green-900\">Answer:</h3>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setShowAnswer(!showAnswer)}\n                      data-testid=\"button-toggle-answer\"\n                    >\n                      {showAnswer ? <EyeOff className=\"h-4 w-4 mr-2\" /> : <Eye className=\"h-4 w-4 mr-2\" />}\n                      {showAnswer ? \"Hide\" : \"Reveal\"} Answer\n                    </Button>\n                  </div>\n                  \n                  {showAnswer ? (\n                    <p className=\"text-green-800 text-lg leading-relaxed\">{currentCard.back}</p>\n                  ) : (\n                    <p className=\"text-green-600 italic\">Click \"Reveal Answer\" to see the solution</p>\n                  )}\n                </div>\n\n                {/* Card Navigation */}\n                <div className=\"flex justify-between items-center pt-4\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={handlePrevCard}\n                    disabled={currentCardIndex === 0}\n                    data-testid=\"button-prev-card\"\n                  >\n                    <ChevronLeft className=\"h-4 w-4 mr-2\" />\n                    Previous\n                  </Button>\n\n                  <div className=\"text-center\">\n                    {studiedCards.has(currentCard.id) && (\n                      <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800\">\n                        âœ“ Studied\n                      </Badge>\n                    )}\n                  </div>\n\n                  <Button\n                    onClick={handleNextCard}\n                    disabled={currentCardIndex === flashcardsArray.length - 1}\n                    data-testid=\"button-next-card\"\n                  >\n                    Next\n                    <ChevronRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card className=\"mb-8\">\n            <CardContent className=\"text-center py-12\">\n              <RotateCcw className=\"h-12 w-12 mx-auto mb-4 opacity-50 text-muted-foreground\" />\n              <p className=\"text-muted-foreground\">Flashcards for Section {section} are being prepared.</p>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Navigation */}\n        <div className=\"flex justify-between\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"outline\" data-testid=\"button-back-lesson-flow-bottom\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          \n          <Button onClick={handleContinue} data-testid=\"button-continue-ai-chat\">\n            Continue to AI Chat\n            <ChevronRight className=\"h-4 w-4 ml-2\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":11088},"client/src/pages/lesson-introduction.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, ChevronRight, BookOpen } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface CourseContent {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: string;\n  content: any;\n  quizgeckoUrl?: string;\n  duration?: number;\n  isActive: boolean;\n  sortOrder: number;\n}\n\nexport default function LessonIntroduction() {\n  const [match, params] = useRoute(\"/course/:courseId/lesson/:section/introduction\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const courseId = params?.courseId;\n  const section = params?.section;\n\n  if (!courseId || !section) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  // Fetch course content for this section\n  const { data: content, isLoading: isContentLoading } = useQuery({\n    queryKey: [`/api/courses/${resolvedCourseId}/content`],\n    enabled: !!resolvedCourseId,\n  });\n\n  // Find introduction content for this section - prioritize entries with proper content structure\n  const introContent = Array.isArray(content) ? content.find((item: CourseContent) => \n    String(item.section) === section && \n    (item.type === 'lesson' || item.title?.toLowerCase().includes('introduction')) &&\n    (item.content?.extracted?.content || item.content?.extracted?.html)\n  ) : undefined;\n\n  // Track lesson step progress\n  const trackProgress = async () => {\n    try {\n      await apiRequest(\"POST\", \"/api/lesson-progress/track\", {\n        courseId: resolvedCourseId,\n        section: parseInt(section),\n        stepType: \"introduction\",\n        stepIndex: 0,\n        isCompleted: true\n      });\n    } catch (error) {\n      console.error(\"Failed to track progress:\", error);\n    }\n  };\n\n  const handleContinue = () => {\n    trackProgress();\n    navigate(`/course/${courseId}/lesson/${section}/podcast`);\n  };\n\n  if (isContentLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-back-lesson-flow\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <BookOpen className=\"h-5 w-5 text-primary\" />\n            <h1 className=\"text-2xl font-bold\">Section {section} Introduction</h1>\n            <Badge variant=\"secondary\">Step 1 of 6</Badge>\n          </div>\n        </div>\n\n        {/* Content */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center\">\n                <BookOpen className=\"h-5 w-5 text-blue-600\" />\n              </div>\n              {introContent?.title || `Section ${section} Introduction`}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {(introContent?.content?.extracted?.content || introContent?.content?.extracted?.html) ? (\n              <div \n                className=\"prose max-w-none text-foreground prose-headings:text-foreground prose-strong:text-foreground prose-em:text-foreground prose-blockquote:text-muted-foreground prose-code:text-foreground\"\n                dangerouslySetInnerHTML={{ __html: (introContent.content.extracted.content || introContent.content.extracted.html || '').replace(/\\n/g, '<br/>') }}\n              />\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <BookOpen className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>Introduction content for Section {section} is being prepared.</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"outline\" data-testid=\"button-back-lesson-flow-bottom\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          \n          <Button onClick={handleContinue} data-testid=\"button-continue-podcast\">\n            Continue to Podcast\n            <ChevronRight className=\"h-4 w-4 ml-2\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5763},"client/src/pages/lesson-podcast.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, ChevronRight, Headphones } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useState, useEffect } from \"react\";\nimport PodcastSyncPlayer from \"@/components/podcast-sync-player\";\n\n// Utility function to clean HTML content for display\nfunction cleanHtmlContent(content: string): string {\n  if (!content) return '';\n  \n  // If content contains HTML tags as text (not actual HTML), strip them\n  if (content.includes('&lt;') || content.includes('&gt;') || \n      (content.includes('<') && content.includes('>') && \n       !content.match(/<\\s*\\w+[^>]*>/))) {\n    // Remove HTML tags that are showing as text\n    return content\n      .replace(/<\\/?[^>]+(>|$)/g, '') // Remove HTML tags\n      .replace(/&lt;/g, '<')\n      .replace(/&gt;/g, '>')\n      .replace(/&amp;/g, '&')\n      .replace(/&nbsp;/g, ' ')\n      .replace(/\\s+/g, ' ') // Normalize whitespace\n      .trim();\n  }\n  \n  return content;\n}\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface CourseContent {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: string;\n  content: any;\n  duration?: number;\n  isActive: boolean;\n  sortOrder: number;\n}\n\nexport default function LessonPodcast() {\n  const [match, params] = useRoute(\"/course/:courseId/lesson/:section/podcast\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const courseId = params?.courseId;\n  const section = params?.section;\n  \n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n\n  if (!courseId || !section) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  // Fetch course content for this section\n  const { data: content, isLoading: isContentLoading } = useQuery({\n    queryKey: [`/api/courses/${resolvedCourseId}/content`],\n    enabled: !!resolvedCourseId,\n  });\n\n  // Find podcast content for this section\n  const podcastContent = Array.isArray(content) ? content.find((item: CourseContent) => \n    String(item.section) === section && \n    (item.type === 'podcast' || item.title?.toLowerCase().includes('podcast')) &&\n    (item.content?.extracted?.transcript || item.content?.extracted?.content || item.content?.text)\n  ) : undefined;\n\n\n  // Track lesson step progress with current position\n  const trackProgress = async (completed = false, position = currentTime) => {\n    try {\n      await apiRequest(\"POST\", \"/api/lesson-progress/track\", {\n        courseId: resolvedCourseId,\n        section: parseInt(section),\n        stepType: \"podcast\",\n        stepIndex: 1,\n        isCompleted: completed,\n        currentPosition: { timestamp: position, duration }\n      });\n    } catch (error) {\n      console.error(\"Failed to track progress:\", error);\n    }\n  };\n\n  // Handle progress updates from the podcast player\n  const handleProgressUpdate = (time: number, dur: number) => {\n    setCurrentTime(time);\n    if (dur && dur !== duration) {\n      setDuration(dur);\n    }\n  };\n\n  // Load saved progress\n  useEffect(() => {\n    const loadProgress = async () => {\n      try {\n        const response = await apiRequest(\"GET\", `/api/lesson-progress/${resolvedCourseId}/${section}/podcast`);\n        if (response.ok) {\n          const progress = await response.json();\n          if (progress.currentPosition?.timestamp) {\n            setCurrentTime(progress.currentPosition.timestamp);\n          }\n        }\n      } catch (error) {\n        console.error(\"Failed to load progress:\", error);\n      }\n    };\n    \n    if (resolvedCourseId && section) {\n      loadProgress();\n    }\n  }, [resolvedCourseId, section]);\n\n  // Save progress periodically\n  useEffect(() => {\n    const interval = setInterval(() => {\n      if (currentTime > 0) {\n        trackProgress(false, currentTime);\n      }\n    }, 30000); // Save every 30 seconds\n    \n    return () => clearInterval(interval);\n  }, [currentTime]);\n\n  const handleContinue = () => {\n    trackProgress(true, currentTime);\n    navigate(`/course/${courseId}/lesson/${section}/flashcards`);\n  };\n\n  if (isContentLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-back-lesson-flow\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <Headphones className=\"h-5 w-5 text-primary\" />\n            <h1 className=\"text-2xl font-bold\">Section {section} Podcast</h1>\n            <Badge variant=\"secondary\">Step 2 of 6</Badge>\n          </div>\n        </div>\n\n        {/* Content */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center\">\n                <Headphones className=\"h-5 w-5 text-green-600\" />\n              </div>\n              {podcastContent?.title || `Section ${section} Podcast`}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {(podcastContent?.content?.extracted?.transcript || podcastContent?.content?.extracted?.content || podcastContent?.content?.text) ? (\n              <div className=\"space-y-6\">\n                {/* Synchronized Audio Player and Transcript */}\n                <PodcastSyncPlayer\n                  audioSrc={podcastContent?.content?.audioUrl}\n                  transcript={cleanHtmlContent(podcastContent.content.extracted?.transcript || podcastContent.content.extracted?.content || podcastContent.content.text || '')}\n                  segments={podcastContent?.content?.segments}\n                  onProgressUpdate={handleProgressUpdate}\n                />\n\n                {/* Podcast learning objectives */}\n                <div className=\"bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg\">\n                  <h3 className=\"font-semibold text-blue-900 mb-3\">Learning Objectives</h3>\n                  <p className=\"text-blue-800\">After completing this lesson, you'll understand the administrative framework governing Louisiana plumbing work.</p>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Headphones className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>Podcast content for Section {section} is being prepared.</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"outline\" data-testid=\"button-back-lesson-flow-bottom\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          \n          <Button onClick={handleContinue} data-testid=\"button-continue-flashcards\">\n            Continue to Flashcards\n            <ChevronRight className=\"h-4 w-4 ml-2\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8491},"client/src/pages/lesson-quiz.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ArrowLeft, HelpCircle } from \"lucide-react\";\nimport InteractiveQuiz from \"@/components/interactive-quiz\";\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface CourseContent {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: string;\n  content: any;\n  duration?: number;\n  isActive: boolean;\n  sortOrder: number;\n}\n\nexport default function LessonQuiz() {\n  const [match, params] = useRoute(\"/course/:courseId/lesson/:section/quiz\");\n  const courseId = params?.courseId;\n  const section = params?.section;\n\n  if (!courseId || !section) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  // Fetch course content to get the quiz content ID\n  const { data: content, isLoading: isContentLoading } = useQuery({\n    queryKey: [`/api/courses/${resolvedCourseId}/content`],\n    enabled: !!resolvedCourseId,\n  });\n\n  // Find quiz content for this section\n  const quizContent = Array.isArray(content) ? content.find((item: CourseContent) => \n    String(item.section) === section && \n    (item.type === 'quiz' || item.title?.toLowerCase().includes('quiz'))\n  ) : undefined;\n\n  // Loading state\n  if (isContentLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 dark:from-gray-900 dark:to-gray-800 py-8\">\n        <div className=\"container mx-auto px-4 max-w-4xl\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n            <p className=\"text-gray-600 dark:text-gray-400\">Loading quiz...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 dark:from-gray-900 dark:to-gray-800 py-8\">\n      <div className=\"container mx-auto px-4 max-w-4xl\">\n        <div className=\"mb-6\">\n          <Link to={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-back-lesson\">\n              <ArrowLeft className=\"h-4 w-4\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n        </div>\n\n        <div className=\"mb-6\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <HelpCircle className=\"h-6 w-6 text-blue-600\" />\n            <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n              Section {section} Quiz\n            </h1>\n          </div>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Step 6 of 6 â€¢ Test your knowledge of this section\n          </p>\n        </div>\n\n        {/* Use InteractiveQuiz component which properly handles questions from the API */}\n        <InteractiveQuiz\n          section={section}\n          contentId={quizContent?.id || `section-${section}-quiz`}\n          title={`Section ${section} Quiz`}\n          onComplete={() => {\n            // Navigate back to lesson flow after completion\n            window.location.href = `/course/${courseId}/lesson/${section}`;\n          }}\n        />\n      </div>\n    </div>\n  );\n}","size_bytes":3854},"client/src/pages/lesson-study-notes.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, ChevronRight, NotebookPen, Download, Bookmark } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\n// Function to clean up markdown formatting for clean display\nfunction cleanMarkdownFormatting(text: string): string {\n  if (!text) return text;\n  \n  return text\n    // Remove markdown headers (# ## ###)\n    .replace(/^#{1,6}\\s+/gm, '')\n    // Remove bold formatting (**text**)\n    .replace(/\\*\\*(.*?)\\*\\*/g, '$1')\n    // Remove italic formatting (*text*)\n    .replace(/\\*(.*?)\\*/g, '$1')\n    // Clean up extra whitespace\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim();\n}\n\n// Map friendly course identifiers to database UUIDs\nfunction getCourseUUID(courseSlug: string): string {\n  const courseMapping: { [key: string]: string } = {\n    'journeyman-prep': 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b',\n    'backflow-prevention': 'b06e5cc6-3cec-4fe6-81ae-5f7cf5ade62e',\n    'natural-gas': 'ce9dfb3e-f6ef-40ed-b578-25bff53eb2dc',\n    'medical-gas': '547ca2fb-e3b3-46c7-a3ef-9e082401b510',\n    'master-plumber': '2b8778aa-c3ec-43cd-887a-77ca0824a294'\n  };\n  return courseMapping[courseSlug] || courseSlug;\n}\n\ninterface StudyNotesContent {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: string;\n  content: {\n    keyPoints?: string[];\n    notes?: string;\n    text?: string;\n    codeReferences?: Array<{\n      section: string;\n      description: string;\n    }>;\n    extracted?: {\n      title?: string;\n      content?: string;\n    };\n  };\n  duration?: number;\n  isActive: boolean;\n  sortOrder: number;\n}\n\nexport default function LessonStudyNotes() {\n  const [match, params] = useRoute(\"/course/:courseId/lesson/:section/study-notes\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const courseId = params?.courseId;\n  const section = params?.section;\n\n  if (!courseId || !section) {\n    return <div>Lesson not found</div>;\n  }\n\n  // Resolve friendly course ID to UUID for API calls\n  const resolvedCourseId = getCourseUUID(courseId);\n\n  // Fetch section-specific study notes\n  const { data: studyNotesContent, isLoading: isContentLoading } = useQuery<StudyNotesContent>({\n    queryKey: [`/api/courses/${resolvedCourseId}/sections/${section}/study-notes`],\n    enabled: !!resolvedCourseId && !!section,\n  });\n\n  // Track lesson step progress\n  const trackProgress = async (completed = false) => {\n    try {\n      await apiRequest(\"POST\", \"/api/lesson-progress/track\", {\n        courseId: resolvedCourseId,\n        section: parseInt(section),\n        stepType: \"study_notes\",\n        stepIndex: 4,\n        isCompleted: completed\n      });\n    } catch (error) {\n      console.error(\"Failed to track progress:\", error);\n    }\n  };\n\n  const handleContinue = () => {\n    trackProgress(true);\n    navigate(`/course/${courseId}/lesson/${section}/quiz`);\n  };\n\n\n  if (isContentLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-back-lesson-flow\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <NotebookPen className=\"h-5 w-5 text-primary\" />\n            <h1 className=\"text-2xl font-bold\">Section {section} Study Notes</h1>\n            <Badge variant=\"secondary\">Step 5 of 6</Badge>\n          </div>\n        </div>\n\n        {/* Content */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center\">\n                  <NotebookPen className=\"h-5 w-5 text-yellow-600\" />\n                </div>\n                {studyNotesContent?.title || `Section ${section} Study Notes`}\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  data-testid=\"button-bookmark-notes\"\n                >\n                  <Bookmark className=\"h-4 w-4 mr-2\" />\n                  Bookmark\n                </Button>\n              </div>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {studyNotesContent?.content?.notes || studyNotesContent?.content?.text ? (\n              <div className=\"space-y-6\">\n                {/* Key Points Summary */}\n                <div className=\"bg-blue-50 border-l-4 border-blue-400 p-6 rounded-r-lg\">\n                  <h3 className=\"font-semibold text-blue-900 mb-3 flex items-center gap-2\">\n                    <Bookmark className=\"h-4 w-4\" />\n                    Key Points Summary\n                  </h3>\n                  <div className=\"text-blue-800 space-y-2\">\n                    {studyNotesContent.content.keyPoints?.map((point: string, index: number) => (\n                      <div key={index} className=\"flex items-start gap-2\">\n                        <span className=\"font-bold text-blue-600\">â€¢</span>\n                        <span>{point}</span>\n                      </div>\n                    )) || (\n                      <p>Key points for Section {section} are being prepared.</p>\n                    )}\n                  </div>\n                </div>\n\n                {/* Detailed Notes */}\n                <div className=\"prose max-w-none text-foreground prose-headings:text-foreground prose-strong:text-foreground prose-em:text-foreground prose-blockquote:text-muted-foreground prose-code:text-foreground\">\n                  <div \n                    className=\"leading-relaxed\"\n                    dangerouslySetInnerHTML={{\n                      __html: studyNotesContent.content.notes || studyNotesContent.content.text || 'Study notes are being prepared.'\n                    }}\n                  />\n                </div>\n\n                {/* Code References */}\n                {studyNotesContent.content.codeReferences && (\n                  <div className=\"bg-gray-50 p-6 rounded-lg\">\n                    <h3 className=\"font-semibold text-gray-900 mb-3\">Code References</h3>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                      {studyNotesContent.content.codeReferences.map((ref: any, index: number) => (\n                        <div key={index} className=\"bg-white p-3 rounded border\">\n                          <div className=\"font-medium text-sm text-gray-600\">{ref.section}</div>\n                          <div className=\"text-gray-800\">{ref.description}</div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Study Tips */}\n                <div className=\"bg-green-50 border-l-4 border-green-400 p-6 rounded-r-lg\">\n                  <h3 className=\"font-semibold text-green-900 mb-3\">Study Tips</h3>\n                  <div className=\"text-green-800 space-y-2\">\n                    <p>â€¢ Review these notes before taking the section quiz</p>\n                    <p>â€¢ Focus on understanding concepts rather than memorizing</p>\n                    <p>â€¢ Use the AI mentor chat if you need clarification on any topic</p>\n                    <p>â€¢ Practice with flashcards to reinforce key terms and definitions</p>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <NotebookPen className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>Study notes for Section {section} are being prepared.</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between\">\n          <Link href={`/course/${courseId}/lesson/${section}`}>\n            <Button variant=\"outline\" data-testid=\"button-back-lesson-flow-bottom\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Lesson Flow\n            </Button>\n          </Link>\n          \n          <Button onClick={handleContinue} data-testid=\"button-continue-quiz\">\n            Continue to Quiz\n            <ChevronRight className=\"h-4 w-4 ml-2\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9208},"client/src/pages/admin/text-to-speech.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Loader2, Play, Download, Volume2, FileText, Pause } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function TextToSpeech() {\n  const [text, setText] = useState(\"\");\n  const [title, setTitle] = useState(\"\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [audioResult, setAudioResult] = useState<{\n    audioUrl: string;\n    title: string;\n    duration: number;\n    contentId: string;\n  } | null>(null);\n  const [error, setError] = useState(\"\");\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [currentSentenceIndex, setCurrentSentenceIndex] = useState(0);\n  const [frozenSentences, setFrozenSentences] = useState<any[]>([]);\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const textScrollRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  // Parse text into sentences with timing estimates\n  const parseTextIntoSentences = (text: string) => {\n    if (!text) return [];\n    \n    // Split by sentence endings, keeping the punctuation\n    const sentences = text.split(/(?<=[.!?])\\s+/).filter(s => s.trim().length > 0);\n    const wordsPerSecond = 2.5; // Average speech rate\n    let currentStartTime = 0;\n    \n    return sentences.map((sentence, index) => {\n      const wordCount = sentence.split(/\\s+/).filter(w => w.length > 0).length;\n      const duration = wordCount / wordsPerSecond;\n      const startTime = currentStartTime;\n      currentStartTime += duration;\n      \n      return {\n        index,\n        text: sentence.trim(),\n        startTime,\n        endTime: currentStartTime,\n        duration,\n        wordCount\n      };\n    });\n  };\n\n  // Use frozen sentences for synchronization if audio exists, otherwise parse current text for preview\n  const sentences = audioResult ? frozenSentences : parseTextIntoSentences(text);\n\n  // Audio event handlers\n  const handlePlayPause = () => {\n    if (audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        audioRef.current.play().catch(error => {\n          console.error('Audio play failed:', error);\n          setIsPlaying(false);\n        });\n      }\n    }\n  };\n\n  const handleTimeUpdate = () => {\n    if (audioRef.current) {\n      const time = audioRef.current.currentTime;\n      setCurrentTime(time);\n      \n      // Find current sentence based on time\n      const currentSentence = sentences.findIndex(s => \n        time >= s.startTime && time < s.endTime\n      );\n      if (currentSentence !== -1 && currentSentence !== currentSentenceIndex) {\n        setCurrentSentenceIndex(currentSentence);\n      }\n    }\n  };\n\n  const handleLoadedMetadata = () => {\n    if (audioRef.current) {\n      const actualDuration = audioRef.current.duration;\n      setDuration(actualDuration);\n      \n      // If actual duration differs from reported, rescale frozen sentences\n      if (audioResult && frozenSentences.length > 0 && Math.abs(actualDuration - audioResult.duration) > 0.1) {\n        const rescaleFactor = actualDuration / audioResult.duration;\n        const rescaledSentences = frozenSentences.map(sentence => ({\n          ...sentence,\n          startTime: sentence.startTime * rescaleFactor,\n          endTime: sentence.endTime * rescaleFactor,\n          duration: sentence.duration * rescaleFactor\n        }));\n        setFrozenSentences(rescaledSentences);\n      }\n    }\n  };\n\n  const handleSentenceClick = (sentenceIndex: number) => {\n    if (audioRef.current && sentences[sentenceIndex]) {\n      audioRef.current.currentTime = sentences[sentenceIndex].startTime;\n      setCurrentSentenceIndex(sentenceIndex);\n    }\n  };\n\n  // Auto-scroll to current sentence\n  useEffect(() => {\n    if (textScrollRef.current && sentences.length > 0) {\n      const currentElement = textScrollRef.current.querySelector(`[data-sentence=\"${currentSentenceIndex}\"]`);\n      if (currentElement) {\n        currentElement.scrollIntoView({ \n          behavior: 'smooth', \n          block: 'center' \n        });\n      }\n    }\n  }, [currentSentenceIndex]);\n\n  const handleGenerate = async () => {\n    if (!text.trim()) {\n      setError(\"Please enter text content to convert to speech\");\n      return;\n    }\n\n    if (text.length > 4096) {\n      setError(\"Text content must be 4096 characters or less\");\n      return;\n    }\n\n    setIsGenerating(true);\n    setError(\"\");\n    setAudioResult(null);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/text-to-speech\", {\n        text, \n        title: title || \"Generated Audio\"\n      });\n      const result = await response.json();\n\n      if (result.success) {\n        // Freeze sentences for this audio and normalize timing to actual duration\n        const generatedSentences = parseTextIntoSentences(text);\n        const totalEstimatedDuration = generatedSentences.reduce((sum, s) => sum + s.duration, 0);\n        const scaleFactor = result.duration / totalEstimatedDuration;\n        \n        const normalizedSentences = generatedSentences.map(sentence => ({\n          ...sentence,\n          startTime: sentence.startTime * scaleFactor,\n          endTime: sentence.endTime * scaleFactor,\n          duration: sentence.duration * scaleFactor\n        }));\n        \n        setFrozenSentences(normalizedSentences);\n        setCurrentSentenceIndex(0);\n        setCurrentTime(0);\n        \n        setAudioResult({\n          audioUrl: result.audioUrl,\n          title: result.title,\n          duration: result.duration,\n          contentId: result.contentId\n        });\n        toast({\n          title: \"Audio Generated Successfully\",\n          description: `Generated ${Math.floor(result.duration / 60)}:${(result.duration % 60).toString().padStart(2, '0')} of audio`,\n        });\n      } else {\n        setError(result.message || \"Failed to generate audio\");\n      }\n    } catch (error: any) {\n      setError(error.message || \"Failed to generate audio\");\n      toast({\n        title: \"Generation Failed\",\n        description: error.message || \"Failed to convert text to speech\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const handleDownload = () => {\n    if (audioResult) {\n      const link = document.createElement('a');\n      link.href = audioResult.audioUrl;\n      link.download = `${audioResult.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.mp3`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  };\n\n  const handleClear = () => {\n    setText(\"\");\n    setTitle(\"\");\n    setAudioResult(null);\n    setError(\"\");\n    setFrozenSentences([]);\n    setCurrentSentenceIndex(0);\n    setCurrentTime(0);\n    setIsPlaying(false);\n  };\n\n  const wordCount = text.split(/\\s+/).filter(word => word.length > 0).length;\n  const charCount = text.length;\n  const estimatedDuration = Math.ceil(wordCount / 2.5); // ~2.5 words per second\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2\">\n            <Volume2 className=\"h-8 w-8 text-blue-600\" />\n            Text-to-Speech Converter\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-300 mt-2\">\n            Convert your scripts and content into high-quality audio using AI-powered text-to-speech\n          </p>\n        </div>\n\n        <div className=\"grid lg:grid-cols-2 gap-6\">\n          {/* Input Section */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                Script Input\n              </CardTitle>\n              <CardDescription>\n                Enter your script or content to convert to audio\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\">Audio Title (Optional)</Label>\n                <Input\n                  id=\"title\"\n                  data-testid=\"input-title\"\n                  placeholder=\"Enter title for your audio file\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"script\">Script Content</Label>\n                <Textarea\n                  id=\"script\"\n                  data-testid=\"input-script\"\n                  placeholder=\"Paste your script or content here... Text will be cleaned for optimal audio generation.\"\n                  value={text}\n                  onChange={(e) => setText(e.target.value)}\n                  rows={12}\n                  className=\"min-h-[300px] font-mono text-sm\"\n                />\n                <div className=\"flex justify-between text-sm text-gray-500\">\n                  <span>Words: {wordCount} | Characters: {charCount}/4096</span>\n                  <span>Est. Duration: ~{estimatedDuration}s</span>\n                </div>\n              </div>\n\n              {error && (\n                <Alert variant=\"destructive\">\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              <div className=\"flex gap-2\">\n                <Button\n                  onClick={handleGenerate}\n                  disabled={isGenerating || !text.trim()}\n                  className=\"flex-1\"\n                  data-testid=\"button-generate\"\n                >\n                  {isGenerating ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Generating Audio...\n                    </>\n                  ) : (\n                    <>\n                      <Volume2 className=\"mr-2 h-4 w-4\" />\n                      Generate Audio\n                    </>\n                  )}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={handleClear}\n                  disabled={isGenerating}\n                  data-testid=\"button-clear\"\n                >\n                  Clear\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Output Section */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Play className=\"h-5 w-5\" />\n                Generated Audio\n              </CardTitle>\n              <CardDescription>\n                Your converted audio will appear here\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {audioResult ? (\n                <div className=\"space-y-4\">\n                  <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800\">\n                    <h3 className=\"font-medium text-green-800 dark:text-green-200 mb-2\">\n                      âœ… Audio Generated Successfully\n                    </h3>\n                    <p className=\"text-sm text-green-700 dark:text-green-300\">\n                      <strong>Title:</strong> {audioResult.title}<br />\n                      <strong>Duration:</strong> {Math.floor(audioResult.duration / 60)}:{(audioResult.duration % 60).toString().padStart(2, '0')}<br />\n                      <strong>File ID:</strong> {audioResult.contentId}\n                    </p>\n                  </div>\n\n                  {/* Custom Audio Player with Controls */}\n                  <div className=\"space-y-4\">\n                    <audio\n                      ref={audioRef}\n                      src={audioResult.audioUrl}\n                      onTimeUpdate={handleTimeUpdate}\n                      onLoadedMetadata={handleLoadedMetadata}\n                      onPlay={() => setIsPlaying(true)}\n                      onPause={() => setIsPlaying(false)}\n                      onEnded={() => setIsPlaying(false)}\n                      className=\"hidden\"\n                    />\n\n                    {/* Audio Controls */}\n                    <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg\">\n                      <div className=\"flex items-center gap-4 mb-3\">\n                        <Button\n                          onClick={handlePlayPause}\n                          size=\"sm\"\n                          data-testid=\"button-play-pause\"\n                          className=\"flex items-center gap-2\"\n                        >\n                          {isPlaying ? <Pause className=\"h-4 w-4\" /> : <Play className=\"h-4 w-4\" />}\n                          {isPlaying ? 'Pause' : 'Play'}\n                        </Button>\n                        \n                        <div className=\"flex-1 text-sm text-gray-600 dark:text-gray-300\">\n                          {Math.floor(currentTime / 60)}:{Math.floor(currentTime % 60).toString().padStart(2, '0')} / {Math.floor(duration / 60)}:{Math.floor(duration % 60).toString().padStart(2, '0')}\n                        </div>\n\n                        <Button\n                          onClick={handleDownload}\n                          variant=\"outline\"\n                          size=\"sm\"\n                          data-testid=\"button-download\"\n                        >\n                          <Download className=\"mr-2 h-4 w-4\" />\n                          Download\n                        </Button>\n                      </div>\n\n                      {/* Seekable Progress Bar */}\n                      <div \n                        className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 cursor-pointer\"\n                        onClick={(e) => {\n                          if (audioRef.current && duration) {\n                            const rect = e.currentTarget.getBoundingClientRect();\n                            const clickX = e.clientX - rect.left;\n                            const percentage = clickX / rect.width;\n                            const newTime = percentage * duration;\n                            audioRef.current.currentTime = newTime;\n                            setCurrentTime(newTime);\n                            \n                            // Update sentence highlight for paused seeking\n                            const newSentenceIndex = sentences.findIndex(s => \n                              newTime >= s.startTime && newTime < s.endTime\n                            );\n                            if (newSentenceIndex !== -1) {\n                              setCurrentSentenceIndex(newSentenceIndex);\n                            }\n                          }\n                        }}\n                        data-testid=\"progress-bar\"\n                      >\n                        <div \n                          className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                          style={{ width: `${duration ? (currentTime / duration) * 100 : 0}%` }}\n                        />\n                      </div>\n                    </div>\n\n                    {/* Synchronized Text Display */}\n                    {sentences.length > 0 && (\n                      <div className=\"bg-white dark:bg-gray-900 border rounded-lg p-4\">\n                        <h4 className=\"font-medium mb-3 text-gray-900 dark:text-white\">\n                          ðŸ“– Follow Along Text (Click any sentence to jump)\n                        </h4>\n                        <div \n                          ref={textScrollRef}\n                          className=\"max-h-64 overflow-y-auto space-y-2\"\n                        >\n                          {sentences.map((sentence, index) => (\n                            <div\n                              key={index}\n                              data-sentence={index}\n                              data-testid={`sentence-${index}`}\n                              onClick={() => handleSentenceClick(index)}\n                              className={`p-3 rounded cursor-pointer transition-all duration-300 ${\n                                index === currentSentenceIndex\n                                  ? 'bg-blue-100 dark:bg-blue-900/40 border-l-4 border-blue-500 font-medium text-blue-900 dark:text-blue-100 shadow-sm'\n                                  : 'hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'\n                              }`}\n                            >\n                              <div className=\"flex items-start gap-3\">\n                                <span className=\"text-xs text-gray-500 mt-1 min-w-[3rem]\">\n                                  {Math.floor(sentence.startTime / 60)}:{Math.floor(sentence.startTime % 60).toString().padStart(2, '0')}\n                                </span>\n                                <span className={index === currentSentenceIndex ? 'text-blue-900 dark:text-blue-100' : ''}>\n                                  {sentence.text}\n                                </span>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                        <div className=\"mt-3 text-xs text-gray-500\">\n                          ðŸ’¡ Tip: Click on any sentence to jump to that part of the audio\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-center py-12 text-gray-500\">\n                  <Volume2 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>No audio generated yet</p>\n                  <p className=\"text-sm\">Enter script and click \"Generate Audio\" to create your audio file</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Usage Instructions */}\n        <Card className=\"mt-6\">\n          <CardHeader>\n            <CardTitle>How to Use</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid md:grid-cols-3 gap-4 text-sm\">\n              <div>\n                <h4 className=\"font-medium mb-2\">ðŸ“ 1. Prepare Content</h4>\n                <p className=\"text-gray-600 dark:text-gray-300\">\n                  Paste your script or content. HTML tags will be automatically removed for clean audio output.\n                </p>\n              </div>\n              <div>\n                <h4 className=\"font-medium mb-2\">ðŸŽ™ï¸ 2. Generate Audio</h4>\n                <p className=\"text-gray-600 dark:text-gray-300\">\n                  Click \"Generate Audio\" to convert your text using high-quality AI voice synthesis.\n                </p>\n              </div>\n              <div>\n                <h4 className=\"font-medium mb-2\">â¬‡ï¸ 3. Download & Use</h4>\n                <p className=\"text-gray-600 dark:text-gray-300\">\n                  Listen to preview and download the MP3 file for use in your projects.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":19659},"server/types/express.d.ts":{"content":"declare global {\n  namespace Express {\n    interface Request {\n      isAuthenticated(): boolean;\n      user?: {\n        id: string;\n        email: string;\n        stripeCustomerId?: string;\n        stripeSubscriptionId?: string;\n        subscriptionTier?: string;\n        firstName?: string;\n        lastName?: string;\n        username?: string;\n      };\n    }\n  }\n}\n\nexport {};","size_bytes":378},"client/src/pages/admin/store-manager.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { \n  Plus, \n  Link as LinkIcon, \n  Package, \n  Edit3, \n  Trash2, \n  ExternalLink,\n  Loader2,\n  CheckCircle,\n  AlertCircle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function StoreManager() {\n  const [urlToAdd, setUrlToAdd] = useState(\"\");\n  const [isExtracting, setIsExtracting] = useState(false);\n  const [extractedData, setExtractedData] = useState<any>(null);\n  const [editingProduct, setEditingProduct] = useState<any>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch all products\n  const { data: productsData, isLoading } = useQuery({\n    queryKey: [\"/api/products\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/products?limit=100\");\n      if (!response.ok) throw new Error(\"Failed to fetch products\");\n      return response.json();\n    },\n  });\n\n  const categories = [\n    { value: \"gas_detection\", label: \"Gas Detection\" },\n    { value: \"pipe_tools\", label: \"Pipe Tools\" },\n    { value: \"measuring\", label: \"Measuring Tools\" },\n    { value: \"safety\", label: \"Safety Equipment\" },\n    { value: \"valves\", label: \"Valves\" },\n    { value: \"fittings\", label: \"Fittings\" },\n    { value: \"books\", label: \"Books & Manuals\" },\n    { value: \"training_materials\", label: \"Training Materials\" },\n  ];\n\n  // Extract product data from URL\n  const extractFromUrl = async () => {\n    if (!urlToAdd.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a valid URL\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsExtracting(true);\n    try {\n      const response = await fetch(\"/api/extract-product\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ url: urlToAdd }),\n      });\n\n      if (!response.ok) throw new Error(\"Failed to extract product data\");\n      \n      const data = await response.json();\n      if (data.success) {\n        setExtractedData({\n          ...data,\n          category: \"pipe_tools\", // default category\n          isFeatured: false,\n          isActive: true\n        });\n        toast({\n          title: \"Success\",\n          description: \"Product data extracted successfully!\",\n        });\n      } else {\n        throw new Error(data.message || \"Failed to extract product data\");\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsExtracting(false);\n    }\n  };\n\n  // Save product mutation\n  const saveProductMutation = useMutation({\n    mutationFn: async (productData: any) => {\n      if (editingProduct) {\n        // Update existing product\n        const response = await fetch(`/api/products/${editingProduct.id}`, {\n          method: \"PUT\",\n          headers: { \"Content-Type\": \"application/json\" },\n          credentials: \"include\",\n          body: JSON.stringify(productData),\n        });\n        if (!response.ok) throw new Error(\"Failed to update product\");\n        return response.json();\n      } else {\n        // Create new product\n        const response = await fetch(\"/api/products\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          credentials: \"include\",\n          body: JSON.stringify(productData),\n        });\n        if (!response.ok) throw new Error(\"Failed to create product\");\n        return response.json();\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setExtractedData(null);\n      setEditingProduct(null);\n      setUrlToAdd(\"\");\n      toast({\n        title: \"Success\",\n        description: editingProduct ? \"Product updated successfully!\" : \"Product added successfully!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete product mutation\n  const deleteProductMutation = useMutation({\n    mutationFn: async (productId: string) => {\n      const response = await fetch(`/api/products/${productId}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete product\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: \"Success\",\n        description: \"Product deleted successfully!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSaveProduct = () => {\n    if (!extractedData) return;\n    \n    const productData = {\n      name: extractedData.name,\n      description: extractedData.description,\n      shortDescription: extractedData.shortDescription,\n      category: extractedData.category,\n      price: extractedData.price.replace(/[^0-9.]/g, ''),\n      amazonUrl: extractedData.amazonUrl,\n      imageUrl: extractedData.imageUrl,\n      brand: extractedData.brand,\n      features: extractedData.features || [],\n      isFeatured: extractedData.isFeatured,\n      isActive: extractedData.isActive,\n    };\n\n    saveProductMutation.mutate(productData);\n  };\n\n  const handleEditProduct = (product: any) => {\n    setEditingProduct(product);\n    setExtractedData({\n      name: product.name,\n      description: product.description,\n      shortDescription: product.shortDescription,\n      category: product.category,\n      price: `$${product.price}`,\n      amazonUrl: product.amazonUrl,\n      imageUrl: product.imageUrl,\n      brand: product.brand,\n      features: product.features || [],\n      isFeatured: product.isFeatured,\n      isActive: product.isActive,\n    });\n  };\n\n  const handleDeleteProduct = (productId: string) => {\n    if (confirm(\"Are you sure you want to delete this product?\")) {\n      deleteProductMutation.mutate(productId);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-7xl mx-auto space-y-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\">Store Manager</h1>\n            <p className=\"text-muted-foreground\">Add and manage products for your store by URL</p>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Package className=\"w-5 h-5 text-muted-foreground\" />\n            <span className=\"text-sm text-muted-foreground\">\n              {productsData?.products?.length || 0} products\n            </span>\n          </div>\n        </div>\n\n        {/* Add Product Section */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Plus className=\"w-5 h-5\" />\n              <span>Add New Product by URL</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex space-x-4\">\n              <div className=\"flex-1\">\n                <Label htmlFor=\"product-url\">Product URL (Amazon or other store links)</Label>\n                <Input\n                  id=\"product-url\"\n                  placeholder=\"https://www.amazon.com/product-name/dp/XXXXXXXXXX...\"\n                  value={urlToAdd}\n                  onChange={(e) => setUrlToAdd(e.target.value)}\n                  className=\"mt-1\"\n                />\n              </div>\n              <div className=\"flex items-end\">\n                <Button \n                  onClick={extractFromUrl} \n                  disabled={isExtracting || !urlToAdd.trim()}\n                  className=\"flex items-center space-x-2\"\n                >\n                  {isExtracting ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      <span>Extracting...</span>\n                    </>\n                  ) : (\n                    <>\n                      <LinkIcon className=\"w-4 h-4\" />\n                      <span>Extract Data</span>\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            {/* Extracted Data Form */}\n            {extractedData && (\n              <div className=\"space-y-4 pt-4 border-t\">\n                <div className=\"flex items-center space-x-2\">\n                  <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                  <h3 className=\"text-lg font-semibold\">Product Data Extracted</h3>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"product-name\">Product Name</Label>\n                    <Input\n                      id=\"product-name\"\n                      value={extractedData.name}\n                      onChange={(e) => setExtractedData({ ...extractedData, name: e.target.value })}\n                      className=\"mt-1\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"product-category\">Category</Label>\n                    <Select value={extractedData.category} onValueChange={(value) => setExtractedData({ ...extractedData, category: value })}>\n                      <SelectTrigger className=\"mt-1\">\n                        <SelectValue placeholder=\"Select category\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {categories.map(category => (\n                          <SelectItem key={category.value} value={category.value}>\n                            {category.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"product-price\">Price</Label>\n                    <Input\n                      id=\"product-price\"\n                      value={extractedData.price}\n                      onChange={(e) => setExtractedData({ ...extractedData, price: e.target.value })}\n                      className=\"mt-1\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"product-brand\">Brand</Label>\n                    <Input\n                      id=\"product-brand\"\n                      value={extractedData.brand || ''}\n                      onChange={(e) => setExtractedData({ ...extractedData, brand: e.target.value })}\n                      className=\"mt-1\"\n                    />\n                  </div>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"product-description\">Description</Label>\n                  <Textarea\n                    id=\"product-description\"\n                    value={extractedData.description}\n                    onChange={(e) => setExtractedData({ ...extractedData, description: e.target.value })}\n                    className=\"mt-1\"\n                    rows={4}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"product-url-final\">Product URL</Label>\n                  <Input\n                    id=\"product-url-final\"\n                    value={extractedData.amazonUrl}\n                    onChange={(e) => setExtractedData({ ...extractedData, amazonUrl: e.target.value })}\n                    className=\"mt-1\"\n                  />\n                </div>\n\n                <div className=\"flex items-center space-x-6\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      checked={extractedData.isFeatured}\n                      onCheckedChange={(checked) => setExtractedData({ ...extractedData, isFeatured: checked })}\n                    />\n                    <Label>Featured Product</Label>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      checked={extractedData.isActive}\n                      onCheckedChange={(checked) => setExtractedData({ ...extractedData, isActive: checked })}\n                    />\n                    <Label>Active</Label>\n                  </div>\n                </div>\n\n                <div className=\"flex space-x-4\">\n                  <Button \n                    onClick={handleSaveProduct}\n                    disabled={saveProductMutation.isPending}\n                    className=\"flex items-center space-x-2\"\n                  >\n                    {saveProductMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        <span>{editingProduct ? 'Updating...' : 'Saving...'}</span>\n                      </>\n                    ) : (\n                      <>\n                        <CheckCircle className=\"w-4 h-4\" />\n                        <span>{editingProduct ? 'Update Product' : 'Add Product'}</span>\n                      </>\n                    )}\n                  </Button>\n                  \n                  <Button \n                    variant=\"outline\" \n                    onClick={() => {\n                      setExtractedData(null);\n                      setEditingProduct(null);\n                      setUrlToAdd(\"\");\n                    }}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Existing Products */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Manage Existing Products</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-4\">\n                {Array.from({ length: 3 }, (_, i) => (\n                  <div key={i} className=\"animate-pulse border rounded-lg p-4\">\n                    <div className=\"h-4 bg-gray-200 rounded w-1/3 mb-2\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded w-2/3\"></div>\n                  </div>\n                ))}\n              </div>\n            ) : productsData?.products?.length > 0 ? (\n              <div className=\"space-y-4\">\n                {productsData.products.map((product: any) => (\n                  <div key={product.id} className=\"border rounded-lg p-4 flex items-center justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-3\">\n                        <h3 className=\"font-medium\">{product.name}</h3>\n                        <Badge variant={product.category === \"pipe_tools\" ? \"default\" : \"secondary\"}>\n                          {categories.find(c => c.value === product.category)?.label || product.category}\n                        </Badge>\n                        {product.isFeatured && (\n                          <Badge variant=\"outline\" className=\"bg-yellow-50 text-yellow-800\">\n                            Featured\n                          </Badge>\n                        )}\n                        {!product.isActive && (\n                          <Badge variant=\"destructive\">\n                            Inactive\n                          </Badge>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {product.brand} â€¢ ${product.price}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">\n                        {product.shortDescription}\n                      </p>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => window.open(product.amazonUrl, '_blank')}\n                      >\n                        <ExternalLink className=\"w-4 h-4\" />\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleEditProduct(product)}\n                      >\n                        <Edit3 className=\"w-4 h-4\" />\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleDeleteProduct(product.id)}\n                        disabled={deleteProductMutation.isPending}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-12\">\n                <Package className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium mb-2\">No products yet</h3>\n                <p className=\"text-muted-foreground\">\n                  Add your first product using the form above.\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":18018},"client/src/components/PodcastPlayer.tsx":{"content":"import { useState, useRef, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Slider } from '@/components/ui/slider';\nimport { Play, Pause, RotateCcw, Volume2, ArrowLeft, ChevronRight } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Link, useLocation } from 'wouter';\n\ninterface PodcastSegment {\n  speaker: string;\n  text: string;\n  startTime?: number;\n  endTime?: number;\n}\n\ninterface PodcastContent {\n  title: string;\n  transcript: string;\n  audioUrl?: string;\n  duration?: number;\n  segments?: PodcastSegment[];\n}\n\ninterface PodcastPlayerProps {\n  content: PodcastContent;\n  className?: string;\n  courseId?: string;\n  section?: string;\n  showNavigation?: boolean;\n}\n\ninterface Sentence {\n  index: number;\n  text: string;\n  startTime: number;\n  endTime: number;\n  duration: number;\n  wordCount: number;\n}\n\nexport function PodcastPlayer({ content, className, courseId, section, showNavigation = false }: PodcastPlayerProps) {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [volume, setVolume] = useState([0.8]);\n  const [currentSentenceIndex, setCurrentSentenceIndex] = useState(0);\n  \n  const audioRef = useRef<HTMLAudioElement>(null);\n  const textScrollRef = useRef<HTMLDivElement>(null);\n  \n  // Parse text into sentences with timing estimates\n  const parseTextIntoSentences = (text: string, audioDuration: number): Sentence[] => {\n    if (!text) return [];\n    \n    const sentences = text.split(/(?<=[.!?])\\s+/).filter(s => s.trim().length > 0);\n    const wordsPerSecond = 2.5; // Average speech rate\n    \n    // Calculate total estimated time\n    const totalWords = sentences.reduce((sum, sentence) => {\n      return sum + sentence.split(/\\s+/).filter(w => w.length > 0).length;\n    }, 0);\n    \n    const totalEstimatedTime = totalWords / wordsPerSecond;\n    const scaleFactor = audioDuration > 0 ? audioDuration / totalEstimatedTime : 1;\n    \n    let currentStartTime = 0;\n    \n    return sentences.map((sentence, index) => {\n      const wordCount = sentence.split(/\\s+/).filter(w => w.length > 0).length;\n      const estimatedDuration = (wordCount / wordsPerSecond) * scaleFactor;\n      const startTime = currentStartTime;\n      currentStartTime += estimatedDuration;\n      \n      return {\n        index,\n        text: sentence.trim(),\n        startTime,\n        endTime: currentStartTime,\n        duration: estimatedDuration,\n        wordCount\n      };\n    });\n  };\n\n  const sentences = parseTextIntoSentences(content.transcript, duration);\n  \n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    const updateTime = () => {\n      const time = audio.currentTime;\n      setCurrentTime(time);\n      \n      // Find current sentence based on time\n      const currentSentence = sentences.findIndex(s => \n        time >= s.startTime && time < s.endTime\n      );\n      if (currentSentence !== -1 && currentSentence !== currentSentenceIndex) {\n        setCurrentSentenceIndex(currentSentence);\n      }\n    };\n    \n    const updateDuration = () => setDuration(audio.duration || 0);\n    \n    audio.addEventListener('timeupdate', updateTime);\n    audio.addEventListener('loadedmetadata', updateDuration);\n    audio.addEventListener('ended', () => setIsPlaying(false));\n    audio.addEventListener('play', () => setIsPlaying(true));\n    audio.addEventListener('pause', () => setIsPlaying(false));\n    \n    return () => {\n      audio.removeEventListener('timeupdate', updateTime);\n      audio.removeEventListener('loadedmetadata', updateDuration);\n      audio.removeEventListener('ended', () => setIsPlaying(false));\n      audio.removeEventListener('play', () => setIsPlaying(true));\n      audio.removeEventListener('pause', () => setIsPlaying(false));\n    };\n  }, [sentences, currentSentenceIndex]);\n\n  // Auto-scroll to current sentence\n  useEffect(() => {\n    if (textScrollRef.current && sentences.length > 0) {\n      const currentElement = textScrollRef.current.querySelector(`[data-sentence=\"${currentSentenceIndex}\"]`);\n      if (currentElement) {\n        currentElement.scrollIntoView({ \n          behavior: 'smooth', \n          block: 'center' \n        });\n      }\n    }\n  }, [currentSentenceIndex]);\n\n  useEffect(() => {\n    if (audioRef.current) {\n      audioRef.current.volume = volume[0];\n    }\n  }, [volume]);\n\n  const togglePlayPause = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    if (isPlaying) {\n      audio.pause();\n    } else {\n      audio.play();\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  const handleSeek = (value: number[]) => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    \n    audio.currentTime = value[0];\n    setCurrentTime(value[0]);\n  };\n\n  const resetAudio = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    \n    audio.currentTime = 0;\n    setCurrentTime(0);\n    setCurrentSentenceIndex(0);\n  };\n\n  const handleSentenceClick = (sentenceIndex: number) => {\n    if (audioRef.current && sentences[sentenceIndex]) {\n      audioRef.current.currentTime = sentences[sentenceIndex].startTime;\n      setCurrentSentenceIndex(sentenceIndex);\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <Card className={cn(\"w-full max-w-4xl mx-auto\", className)}>\n      <CardHeader>\n        <CardTitle className=\"text-lg font-semibold\" data-testid=\"text-podcast-title\">\n          {content.title}\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-6\">\n        {/* Audio Element */}\n        {content.audioUrl && (\n          <audio\n            ref={audioRef}\n            src={content.audioUrl}\n            preload=\"metadata\"\n            className=\"hidden\"\n            data-testid=\"audio-player\"\n          />\n        )}\n        \n        {/* Audio Controls */}\n        <div className=\"flex items-center gap-4 p-4 bg-muted/50 rounded-lg\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={resetAudio}\n            disabled={!content.audioUrl}\n            data-testid=\"button-reset-audio\"\n          >\n            <RotateCcw className=\"h-4 w-4\" />\n          </Button>\n          \n          <Button\n            variant=\"default\"\n            size=\"sm\"\n            onClick={togglePlayPause}\n            disabled={!content.audioUrl}\n            data-testid=\"button-play-pause\"\n          >\n            {isPlaying ? <Pause className=\"h-4 w-4\" /> : <Play className=\"h-4 w-4\" />}\n          </Button>\n          \n          <div className=\"flex-1 space-y-2\">\n            <Slider\n              value={[currentTime]}\n              onValueChange={handleSeek}\n              max={duration}\n              step={1}\n              className=\"w-full\"\n              disabled={!content.audioUrl}\n              data-testid=\"slider-progress\"\n            />\n            <div className=\"flex justify-between text-sm text-muted-foreground\">\n              <span data-testid=\"text-current-time\">{formatTime(currentTime)}</span>\n              <span data-testid=\"text-total-duration\">{formatTime(duration)}</span>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2 w-32\">\n            <Volume2 className=\"h-4 w-4\" />\n            <Slider\n              value={volume}\n              onValueChange={setVolume}\n              max={1}\n              step={0.1}\n              className=\"flex-1\"\n              data-testid=\"slider-volume\"\n            />\n          </div>\n        </div>\n\n        {/* Current Sentence Display */}\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Current Text</h3>\n          <div className=\"text-center text-sm text-muted-foreground mb-2\">\n            Sentence {currentSentenceIndex + 1} of {sentences.length}\n          </div>\n          <div \n            className=\"min-h-32 p-6 bg-muted/30 rounded-lg border flex items-center justify-center\" \n            data-testid=\"container-current-sentence\"\n          >\n            <p \n              className=\"text-lg leading-relaxed text-center font-medium transition-all duration-500\"\n              data-testid=\"text-current-sentence\"\n            >\n              {sentences[currentSentenceIndex]?.text || \"Click play to start listening...\"}\n            </p>\n          </div>\n        </div>\n\n        {/* Full Transcript (Read-Only) */}\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Full Transcript</h3>\n          <div className=\"max-h-64 overflow-y-auto p-4 bg-muted/20 rounded-lg border text-sm text-muted-foreground leading-relaxed\" data-testid=\"container-full-transcript\">\n            {content.transcript}\n          </div>\n        </div>\n\n        {/* Audio Status */}\n        {!content.audioUrl && (\n          <div className=\"text-center p-8 text-muted-foreground\" data-testid=\"status-no-audio\">\n            <p>Audio not yet generated for this episode.</p>\n            <p className=\"text-sm mt-2\">The transcript is available for reading above.</p>\n          </div>\n        )}\n\n        {/* Navigation Buttons */}\n        {showNavigation && courseId && section && (\n          <div className=\"flex justify-between pt-6 border-t\">\n            <Link href={`/course/${courseId}/lesson/${section}`}>\n              <Button variant=\"outline\" data-testid=\"button-back-lesson-flow\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Lesson Flow\n              </Button>\n            </Link>\n            \n            <Link href={`/course/${courseId}/lesson/${section}/flashcards`}>\n              <Button data-testid=\"button-continue-next-step\">\n                Continue to Flashcards\n                <ChevronRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </Link>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":10104},"client/src/pages/PodcastsPage.tsx":{"content":"import { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { PodcastPlayer } from '@/components/PodcastPlayer';\nimport { Headphones, Clock, FileText, Volume2 } from 'lucide-react';\nimport { useState } from 'react';\n\ninterface PodcastEpisode {\n  id: string;\n  title: string;\n  type: string;\n  chapter: number;\n  section: number;\n  content: {\n    title: string;\n    transcript: string;\n    audioUrl?: string;\n    duration?: number;\n    segments?: any[];\n  };\n  duration: number; // in minutes\n  difficulty: 'easy' | 'hard' | 'very_hard';\n}\n\nexport function PodcastsPage() {\n  const [selectedEpisode, setSelectedEpisode] = useState<PodcastEpisode | null>(null);\n\n  const { data: episodes, isLoading } = useQuery({\n    queryKey: ['/api/courses/b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b/content'],\n    select: (data: any[]) => data.filter((item: any) => item.type === 'podcast')\n  });\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case 'easy': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\n      case 'hard': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';\n      case 'very_hard': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';\n      default: return 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200';\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-muted rounded w-1/3\"></div>\n          <div className=\"grid gap-4\">\n            {[1, 2, 3].map(i => (\n              <div key={i} className=\"h-32 bg-muted rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (selectedEpisode) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"mb-6\">\n          <Button \n            variant=\"outline\" \n            onClick={() => setSelectedEpisode(null)}\n            data-testid=\"button-back-to-episodes\"\n          >\n            â† Back to Episodes\n          </Button>\n        </div>\n        \n        <PodcastPlayer \n          content={selectedEpisode.content} \n          courseId=\"b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b\"\n          section={selectedEpisode.section?.toString()}\n          showNavigation={true}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 space-y-8\">\n      {/* Header */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"flex items-center justify-center gap-3 mb-4\">\n          <Headphones className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\" data-testid=\"text-page-title\">\n            Louisiana Plumbing Podcasts\n          </h1>\n        </div>\n        <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n          Listen to expert discussions on Louisiana plumbing code requirements. \n          Each episode includes audio with synchronized scrolling text for optimal learning.\n        </p>\n      </div>\n\n      {/* Episodes List */}\n      {episodes && episodes.length > 0 ? (\n        <div className=\"grid gap-6 max-w-4xl mx-auto\">\n          {episodes.map((episode: PodcastEpisode) => (\n            <Card \n              key={episode.id} \n              className=\"hover:shadow-md transition-shadow cursor-pointer\"\n              onClick={() => setSelectedEpisode(episode)}\n              data-testid={`card-episode-${episode.id}`}\n            >\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"space-y-2 flex-1\">\n                    <CardTitle className=\"text-lg leading-tight\" data-testid={`text-episode-title-${episode.id}`}>\n                      {episode.title}\n                    </CardTitle>\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <span data-testid={`text-chapter-${episode.id}`}>\n                        Chapter {episode.chapter} â€¢ Section {episode.section}\n                      </span>\n                    </div>\n                  </div>\n                  <Badge \n                    variant=\"secondary\" \n                    className={getDifficultyColor(episode.difficulty)}\n                    data-testid={`badge-difficulty-${episode.id}`}\n                  >\n                    {episode.difficulty.replace('_', ' ')}\n                  </Badge>\n                </div>\n              </CardHeader>\n              \n              <CardContent className=\"space-y-4\">\n                {/* Episode Stats */}\n                <div className=\"flex items-center gap-6 text-sm text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\">\n                    <Clock className=\"h-4 w-4\" />\n                    <span data-testid={`text-duration-${episode.id}`}>\n                      {episode.duration} min\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <FileText className=\"h-4 w-4\" />\n                    <span>Full Transcript</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    {episode.content.audioUrl ? (\n                      <>\n                        <Volume2 className=\"h-4 w-4 text-green-600\" />\n                        <span className=\"text-green-600\">Audio Available</span>\n                      </>\n                    ) : (\n                      <>\n                        <Volume2 className=\"h-4 w-4 text-yellow-600\" />\n                        <span className=\"text-yellow-600\">Audio Generating</span>\n                      </>\n                    )}\n                  </div>\n                </div>\n\n                {/* Transcript Preview */}\n                <div className=\"bg-muted/30 p-3 rounded border-l-4 border-primary/30\">\n                  <p className=\"text-sm text-muted-foreground line-clamp-2\" data-testid={`text-preview-${episode.id}`}>\n                    {episode.content.transcript.slice(0, 150)}...\n                  </p>\n                </div>\n\n                {/* Listen Button */}\n                <Button \n                  className=\"w-full\" \n                  onClick={(e) => {\n                    e.stopPropagation();\n                    setSelectedEpisode(episode);\n                  }}\n                  data-testid={`button-listen-${episode.id}`}\n                >\n                  <Headphones className=\"h-4 w-4 mr-2\" />\n                  {episode.content.audioUrl ? 'Listen Now' : 'Read Transcript'}\n                </Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 space-y-4\">\n          <Headphones className=\"h-16 w-16 text-muted-foreground mx-auto\" />\n          <h3 className=\"text-lg font-semibold\" data-testid=\"text-no-episodes\">\n            No Podcast Episodes Available\n          </h3>\n          <p className=\"text-muted-foreground\">\n            Podcast episodes are being prepared. Check back soon for educational content \n            about Louisiana plumbing code requirements.\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":7434},"import-sample-podcast.js":{"content":"// Sample podcast episode from user's attached file\nconst sampleEpisode = {\n  title: \"Louisiana State Plumbing Code Â§101 Administration\",\n  transcript: `Did you know that Louisiana has its own specific plumbing regulations? It's called the Louisiana State Plumbing Code, or LSPC, and it serves as the backbone of plumbing standards across the state.\n\nFormally, the LSPC is adopted as Part XIV of the Sanitary Code by the Department of Health and Hospitals, specifically under the Office of Public Health. It's a comprehensive legal document that outlines the expectations and requirements for all plumbing work in Louisiana.\n\nWhat's interesting is that this code goes by a few different names. Officially, it can be referred to as the Louisiana State Plumbing Code, or more formally as Part XIV (Plumbing) of the Sanitary Code, State of Louisiana. In legal and professional settings, it's often just referred to as \"this code\" or \"this Part,\" which shows how adaptable legislative language can be.\n\nNow, let's talk about where this code gets its authority.\n\nThe foundation of the LSPC's authority comes from R.S. 36:258(B), with additional supporting provisions found in Title 40 of the Louisiana Revised Statutes, particularly in Chapters 1 and 4. The official promulgation of the code is aligned with R.S. 40:4(A)(7) and R.S. 40:5, which provide the legal backing necessary for the code's enforcement and updates.\n\nHistorically, the LSPC was first adopted in June 2002, and it underwent a significant amendment in November 2012. These updates typically reflect evolving standards in both plumbing technology and public health priorities.\n\nThe Louisiana State Plumbing Code isn't just about technical specsâ€”it's a public health tool. Its regulations affect not just individual homes but the overall health of communities. That's why the Office of Public Health plays such a crucial role, overseeing the implementation of the code and ensuring compliance throughout the state.\n\nSo how is compliance maintained?\n\nTypically, this involves regular inspections carried out by authorized plumbing inspectors. These professionals ensure that any plumbing installation meets the requirements set forth in the code. On top of that, there's a strong focus on certification. Plumbing contractors in Louisiana are required to be certified, which means they've demonstrated a clear understanding of the LSPC and are committed to upholding its standards.\n\nThis certification process helps guarantee competency and safety in the field. When residents know that their plumbing systems are installed and maintained by certified professionals, it naturally builds public trust and confidence.\n\nBut staying compliant isn't just a one-time taskâ€”it requires ongoing education. Louisiana, along with professional plumbing associations, offers a variety of training sessions, workshops, and online resources to help plumbers stay up to date with any code changes and new technologies.\n\nThis creates a cycle of continuous improvement:\nâ†’ Updated codes lead to better practices,\nâ†’ which require more training,\nâ†’ which results in improved public health outcomes.\n\nThe bottom line is this: the Louisiana State Plumbing Code is about much more than pipes and fittings. It's about protecting the health and safety of every resident in the state.\n\nAs plumbing technology continues to evolve and public health needs shift, maintaining and adapting these regulatory frameworks will be essential. By understanding the legislative roots, enforcement mechanisms, and educational components of the LSPC, we can truly appreciate how critical these standards are to our everyday lives.`,\n  duration: 212, // ~3.5 minutes\n  chapter: \"Chapter 1\",\n  section: \"101\",\n  difficulty: \"hard\"\n};\n\n// Use this to import: fetch('/api/admin/podcast/bulk-import', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ courseId: 'b83c6ebe-f5bd-4787-8fd5-e3b177d9e79b', episodes: [sampleEpisode] }) })\nconsole.log(\"Sample episode data ready for import:\", sampleEpisode);","size_bytes":4064},"client/src/components/podcast-sync-player.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Play, Pause, SkipForward, RotateCcw, Volume2 } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface PodcastSegment {\n  start: number;\n  end: number;\n  text: string;\n}\n\ninterface PodcastSyncPlayerProps {\n  audioSrc?: string;\n  transcript: string;\n  segments?: PodcastSegment[];\n  onProgressUpdate?: (currentTime: number, duration: number) => void;\n}\n\nexport default function PodcastSyncPlayer({ \n  audioSrc, \n  transcript, \n  segments, \n  onProgressUpdate \n}: PodcastSyncPlayerProps) {\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const transcriptRef = useRef<HTMLDivElement>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [activeSegmentIndex, setActiveSegmentIndex] = useState(-1);\n  const [parsedSegments, setParsedSegments] = useState<PodcastSegment[]>([]);\n  const [currentSentence, setCurrentSentence] = useState(\"\");\n  const [isGeneratingAudio, setIsGeneratingAudio] = useState(false);\n  const [preGeneratedAudioUrl, setPreGeneratedAudioUrl] = useState<string | null>(null);\n  const [generationProgress, setGenerationProgress] = useState<string>(\"\");\n  const [wantsAutoPlay, setWantsAutoPlay] = useState(false);\n\n  // Parse transcript into sentences and create timing segments\n  const parseTranscriptToSegments = useCallback((text: string, totalDuration: number): PodcastSegment[] => {\n    if (!text) return [];\n\n    // Use Intl.Segmenter if available, otherwise use regex\n    let sentences: string[] = [];\n    \n    if (typeof Intl !== 'undefined' && 'Segmenter' in Intl) {\n      const segmenter = new Intl.Segmenter('en', { granularity: 'sentence' });\n      sentences = Array.from(segmenter.segment(text))\n        .map(segment => segment.segment.trim())\n        .filter(sentence => sentence.length > 0);\n    } else {\n      // Fallback regex for sentence splitting\n      sentences = text\n        .split(/[.!?]+/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n    }\n\n    if (sentences.length === 0) return [];\n\n    // Calculate timing based on word count proportions\n    const totalWords = sentences.reduce((total, sentence) => {\n      return total + sentence.split(/\\s+/).length;\n    }, 0);\n\n    let cumulativeTime = 0;\n    return sentences.map((sentence, index) => {\n      const wordsInSentence = sentence.split(/\\s+/).length;\n      const segmentDuration = (wordsInSentence / totalWords) * totalDuration;\n      const start = cumulativeTime;\n      const end = cumulativeTime + segmentDuration;\n      cumulativeTime = end;\n\n      return {\n        start,\n        end,\n        text: sentence\n      };\n    });\n  }, []);\n\n  // Pre-generate full audio from transcript\n  useEffect(() => {\n    if (transcript && !preGeneratedAudioUrl && !isGeneratingAudio) {\n      generateFullAudio();\n    }\n  }, [transcript]);\n\n  // Initialize segments when audio metadata loads\n  useEffect(() => {\n    if (segments) {\n      setParsedSegments(segments);\n    } else if (transcript) {\n      // Use actual duration if available, otherwise estimate based on word count\n      const estimatedDuration = duration > 0 ? duration : Math.max((transcript.split(/\\s+/).length / 150) * 60, 300); // 150 WPM, minimum 5 minutes\n      const generatedSegments = parseTranscriptToSegments(transcript, estimatedDuration);\n      setParsedSegments(generatedSegments);\n      \n      // Update the duration state if we estimated it\n      if (duration === 0) {\n        setDuration(estimatedDuration);\n      }\n    }\n  }, [segments, transcript, duration, parseTranscriptToSegments]);\n\n  // Generate full audio file from complete transcript\n  const generateFullAudio = async () => {\n    if (!transcript || isGeneratingAudio) return;\n    \n    setIsGeneratingAudio(true);\n    setGenerationProgress(\"Generating podcast audio...\");\n    \n    try {\n      console.log('Pre-generating full audio for transcript:', transcript.substring(0, 100) + '...');\n      \n      const response = await apiRequest(\"POST\", \"/api/openai/speech\", {\n        input: transcript,\n        voice: \"alloy\",\n        model: \"tts-1\"\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to generate speech');\n      }\n\n      const audioBlob = await response.blob();\n      const audioUrl = URL.createObjectURL(audioBlob);\n      \n      setPreGeneratedAudioUrl(audioUrl);\n      setGenerationProgress(\"Audio ready!\");\n      console.log('Pre-generation complete! Audio URL created:', audioUrl.substring(0, 50) + '...');\n      \n      // Auto-play if user pressed play during generation\n      if (wantsAutoPlay && audioRef.current) {\n        setTimeout(() => {\n          audioRef.current?.play();\n          setIsPlaying(true);\n          setWantsAutoPlay(false);\n        }, 100);\n      }\n      \n    } catch (error) {\n      console.error('Error pre-generating full audio:', error);\n      setGenerationProgress(\"Audio generation failed\");\n    } finally {\n      setIsGeneratingAudio(false);\n    }\n  };\n\n  // Create audio using OpenAI TTS API\n  const createOpenAIAudio = useCallback(async (text: string): Promise<string | null> => {\n    try {\n      setIsGeneratingAudio(true);\n      const response = await apiRequest(\"POST\", \"/api/openai/speech\", {\n        input: text,\n        voice: \"alloy\", // OpenAI voice options: alloy, echo, fable, onyx, nova, shimmer\n        model: \"tts-1\"\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to generate speech');\n      }\n\n      // Convert the response to blob and create object URL\n      const audioBlob = await response.blob();\n      const audioUrl = URL.createObjectURL(audioBlob);\n      \n      setIsGeneratingAudio(false);\n      return audioUrl;\n    } catch (error) {\n      console.error('Error generating speech:', error);\n      setIsGeneratingAudio(false);\n      return null;\n    }\n  }, []);\n\n  // Handle audio element events\n  const handleTimeUpdate = () => {\n    if (audioRef.current) {\n      const time = audioRef.current.currentTime;\n      setCurrentTime(time);\n      onProgressUpdate?.(time, duration);\n\n      // Find active segment\n      const activeIndex = parsedSegments.findIndex(\n        segment => time >= segment.start && time <= segment.end\n      );\n      \n      if (activeIndex !== -1 && activeIndex !== activeSegmentIndex) {\n        setActiveSegmentIndex(activeIndex);\n        \n        // Update the current sentence display\n        if (parsedSegments[activeIndex]) {\n          setCurrentSentence(parsedSegments[activeIndex].text);\n        }\n      }\n    }\n  };\n\n  const handleLoadedMetadata = () => {\n    if (audioRef.current) {\n      setDuration(audioRef.current.duration);\n    }\n  };\n\n  const handleEnded = () => {\n    setIsPlaying(false);\n    setActiveSegmentIndex(-1);\n  };\n\n  // Play/pause functionality - now using pre-generated audio\n  const handlePlayPause = async () => {\n    // Use original audioSrc if available, otherwise use pre-generated audio\n    const effectiveAudioSrc = audioSrc || preGeneratedAudioUrl;\n    \n    if (effectiveAudioSrc && audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        // Set the audio source if it hasn't been set yet\n        if (audioRef.current.src !== effectiveAudioSrc) {\n          audioRef.current.src = effectiveAudioSrc;\n        }\n        audioRef.current.play();\n      }\n      setIsPlaying(!isPlaying);\n    } else if (!preGeneratedAudioUrl && !isGeneratingAudio) {\n      // If no audio is available and we're not already generating, start generation\n      setWantsAutoPlay(true); // Remember user wants to play\n      generateFullAudio();\n    }\n  };\n\n  // Seek to specific sentence\n  const handleSegmentClick = (segmentIndex: number) => {\n    const segment = parsedSegments[segmentIndex];\n    if (!segment || !audioRef.current || duration === 0) return;\n    \n    audioRef.current.currentTime = segment.start;\n    setCurrentTime(segment.start);\n    setActiveSegmentIndex(segmentIndex);\n    setCurrentSentence(segment.text);\n  };\n\n  // Skip forward/backward\n  const handleSkip = (seconds: number) => {\n    if (audioRef.current && duration > 0) {\n      const newTime = Math.max(0, Math.min(duration, currentTime + seconds));\n      audioRef.current.currentTime = newTime;\n      setCurrentTime(newTime);\n    }\n  };\n\n  // Format time display\n  const formatTime = (time: number) => {\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time % 60);\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Audio Player Controls */}\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"space-y-4\">\n            {/* Audio element (hidden, for original audio or pre-generated audio) */}\n            {(audioSrc || preGeneratedAudioUrl) && (\n              <audio\n                ref={audioRef}\n                src={audioSrc || preGeneratedAudioUrl || undefined}\n                onTimeUpdate={handleTimeUpdate}\n                onLoadedMetadata={handleLoadedMetadata}\n                onEnded={handleEnded}\n                className=\"hidden\"\n                data-testid=\"audio-element\"\n              />\n            )}\n\n            {/* Header */}\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center\">\n                <Volume2 className=\"h-5 w-5 text-blue-600\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900\">Audio Lesson</h3>\n                <p className=\"text-sm text-gray-600\">\n                  {isGeneratingAudio ? generationProgress : \n                   (audioSrc ? 'High Quality Audio' : \n                   (preGeneratedAudioUrl ? 'OpenAI Text-to-Speech Ready' : 'AI Text-to-Speech Available'))}\n                </p>\n              </div>\n            </div>\n\n            {/* Controls */}\n            <div className=\"flex items-center gap-4\">\n              <Button\n                onClick={handlePlayPause}\n                variant=\"default\"\n                size=\"sm\"\n                className=\"flex items-center gap-2\"\n                disabled={isGeneratingAudio}\n                data-testid=\"button-play-pause\"\n              >\n                {isGeneratingAudio ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    Generating...\n                  </>\n                ) : (\n                  <>\n                    {isPlaying ? <Pause className=\"h-4 w-4\" /> : <Play className=\"h-4 w-4\" />}\n                    {isPlaying ? 'Pause' : 'Play'}\n                  </>\n                )}\n              </Button>\n\n              {(audioSrc || preGeneratedAudioUrl) && (\n                <>\n                  <Button\n                    onClick={() => handleSkip(-10)}\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    data-testid=\"button-rewind\"\n                  >\n                    <RotateCcw className=\"h-4 w-4\" />\n                  </Button>\n\n                  <Button\n                    onClick={() => handleSkip(10)}\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    data-testid=\"button-skip-forward\"\n                  >\n                    <SkipForward className=\"h-4 w-4\" />\n                  </Button>\n                </>\n              )}\n\n              <div className=\"flex-1 flex items-center gap-2 text-sm text-gray-600\">\n                <span data-testid=\"time-current\">{formatTime(currentTime)}</span>\n                <div className=\"flex-1 bg-gray-200 rounded-full h-2\">\n                  <div\n                    className=\"bg-primary h-2 rounded-full transition-all duration-300\"\n                    style={{ width: `${duration ? (currentTime / duration) * 100 : 0}%` }}\n                    data-testid=\"progress-bar\"\n                  />\n                </div>\n                <span data-testid=\"time-duration\">{formatTime(duration)}</span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Current Sentence Display */}\n      <Card>\n        <CardContent className=\"p-8\">\n          <div className=\"text-center min-h-[120px] flex items-center justify-center\">\n            {currentSentence ? (\n              <p \n                className=\"text-lg leading-relaxed text-gray-800 max-w-3xl\"\n                data-testid=\"current-sentence\"\n              >\n                {currentSentence}\n              </p>\n            ) : isGeneratingAudio ? (\n              <div className=\"text-gray-500 text-center\">\n                <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3\" />\n                <p className=\"text-base mb-2\">{generationProgress}</p>\n                <p className=\"text-sm\">Please wait while we prepare your audio lesson...</p>\n              </div>\n            ) : (\n              <div className=\"text-gray-500\">\n                <p className=\"text-base mb-2\">Press Play to start the lesson</p>\n                <p className=\"text-sm\">Smooth continuous audio playback with synchronized text</p>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":13518},"client/src/components/standalone-ai-mentor-chat.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MessageCircle, Send, Bot, User, Timer, Lock, Crown, BookOpen } from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useStudySession } from \"@/hooks/use-study-session\";\nimport { Link, useLocation } from \"wouter\";\n\ninterface Message {\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp: Date;\n}\n\ninterface StandaloneAIMentorChatProps {\n  className?: string;\n}\n\nexport default function StandaloneAIMentorChat({ className }: StandaloneAIMentorChatProps) {\n  const [currentMessage, setCurrentMessage] = useState(\"\");\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  \n  // Initialize study session tracking for chat\n  const studySession = useStudySession({\n    contentId: 'standalone-ai-mentor-chat',\n    contentType: 'chat',\n    autoStart: true\n  });\n\n  // Get current user data\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/me\"],\n    retry: false,\n  });\n\n  const userTier = user?.subscriptionTier || 'basic';\n  \n  // AI Mentor Chat is only available to professional and master users\n  const hasAIAccess = userTier === 'professional' || userTier === 'master';\n\n  const [messages, setMessages] = useState<Array<{role: 'user' | 'assistant', content: string, timestamp: Date}>>([]);\n\n  const chatMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const response = await fetch('/api/mentor/chat', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          message,\n          context: 'Complete Louisiana Plumbing Code',\n          // No currentSection - this is complete codebook access\n        }),\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to send message');\n      }\n      \n      return response;\n    },\n    onSuccess: async (response) => {\n      try {\n        const data = await response.json();\n        // Add user message and AI response to local state\n        setMessages(prev => [\n          ...prev,\n          { role: 'user', content: currentMessage, timestamp: new Date() },\n          { role: 'assistant', content: data.response, timestamp: new Date() }\n        ]);\n      } catch (error) {\n        console.error('Error parsing chat response:', error);\n        toast({\n          title: \"Chat Error\", \n          description: \"Failed to parse response\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Chat Error\",\n        description: error.message || \"Failed to send message\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSendMessage = () => {\n    if (!currentMessage.trim()) return;\n\n    // Store the message before clearing it\n    const messageToSend = currentMessage;\n    setCurrentMessage(\"\");\n    \n    chatMutation.mutate(messageToSend);\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    if (scrollAreaRef.current) {\n      scrollAreaRef.current.scrollTop = scrollAreaRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  // Redirect basic authenticated users to pricing page\n  useEffect(() => {\n    if (user && !hasAIAccess) {\n      setLocation('/pricing');\n    }\n  }, [user, hasAIAccess, setLocation]);\n\n  // Show upgrade prompt for unauthenticated users\n  if (!user || !hasAIAccess) {\n    return (\n      <div className={`max-w-4xl mx-auto ${className}`} data-testid=\"standalone-ai-mentor-chat\">\n        <Card className=\"min-h-[600px]\">\n          <CardHeader className=\"border-b\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 rounded-full bg-gradient-to-r from-orange-500 to-amber-600 flex items-center justify-center\">\n                  <Lock className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    AI Mentor Chat - Upgrade Required\n                  </CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Complete Louisiana plumbing codebook access with AI mentor\n                  </p>\n                </div>\n              </div>\n            </div>\n          </CardHeader>\n\n          <CardContent className=\"p-6 flex items-center justify-center\">\n            <div className=\"text-center max-w-md\">\n              <Crown className=\"w-16 h-16 mx-auto mb-4 text-orange-500\" />\n              <h3 className=\"text-xl font-semibold mb-2\">Complete Codebook AI Mentor</h3>\n              <p className=\"text-muted-foreground mb-6\">\n                Get instant answers about any Louisiana plumbing code section, regulation, or installation procedure. \n                Our AI mentor has complete knowledge of the entire Louisiana State Plumbing Code.\n              </p>\n              <div className=\"space-y-3 mb-6\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <BookOpen className=\"w-4 h-4 text-green-500\" />\n                  <span>Access to all Louisiana plumbing code sections</span>\n                </div>\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <Bot className=\"w-4 h-4 text-blue-500\" />\n                  <span>Intelligent AI responses with code references</span>\n                </div>\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <MessageCircle className=\"w-4 h-4 text-purple-500\" />\n                  <span>Unlimited questions and conversations</span>\n                </div>\n              </div>\n              <Button asChild className=\"bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700\">\n                <Link href=\"/pricing\">\n                  Upgrade to Professional Plan\n                </Link>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Professional/Master Plans: AI Chat Interface\n  return (\n    <div className={`max-w-4xl mx-auto ${className}`} data-testid=\"standalone-ai-mentor-chat\">\n      <Card className=\"h-[600px] flex flex-col\">\n        <CardHeader className=\"border-b\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center\">\n                <Bot className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  AI Mentor Chat\n                  <Badge className=\"text-xs bg-gradient-to-r from-green-500 to-emerald-600\">\n                    <BookOpen className=\"w-3 h-3 mr-1\" />\n                    Complete Codebook\n                  </Badge>\n                  <Badge className=\"text-xs bg-gradient-to-r from-blue-500 to-purple-600\">\n                    <Bot className=\"w-3 h-3 mr-1\" />\n                    AI-Powered\n                  </Badge>\n                </CardTitle>\n                <p className=\"text-sm text-muted-foreground\">\n                  Ask about any Louisiana plumbing code section, installation procedures, or code compliance\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n              <Timer className=\"w-4 h-4\" />\n              <span>Session: {studySession.formattedTime}</span>\n            </div>\n          </div>\n        </CardHeader>\n\n        <CardContent className=\"flex-1 flex flex-col p-0\">\n          {/* Chat Messages */}\n          <ScrollArea className=\"flex-1 p-4 overflow-x-hidden overflow-y-auto\" ref={scrollAreaRef}>\n            {messages.length > 0 ? (\n              <div className=\"space-y-4\">\n                {messages.map((message, index) => (\n                  <div\n                    key={index}\n                    className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    <div className={`flex items-start space-x-2 max-w-[80%] min-w-0 ${message.role === 'user' ? 'flex-row-reverse space-x-reverse' : ''}`}>\n                      <Avatar className=\"w-8 h-8\">\n                        <AvatarFallback className={message.role === 'user' ? 'bg-primary text-primary-foreground' : 'bg-gradient-to-r from-blue-500 to-purple-600 text-white'}>\n                          {message.role === 'user' ? <User className=\"w-4 h-4\" /> : <Bot className=\"w-4 h-4\" />}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className={`p-3 rounded-lg min-w-0 max-w-full ${\n                        message.role === 'user' \n                          ? 'bg-primary text-primary-foreground' \n                          : 'bg-muted'\n                      }`}>\n                        <p className=\"text-sm whitespace-pre-wrap break-words break-all\">{message.content}</p>\n                        <p className=\"text-xs opacity-70 mt-1\">\n                          {message.timestamp.toLocaleTimeString()}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Show thinking indicator when AI is processing */}\n                {chatMutation.isPending && (\n                  <div className=\"flex justify-start\">\n                    <div className=\"flex items-start space-x-2 max-w-[80%] min-w-0\">\n                      <Avatar className=\"w-8 h-8\">\n                        <AvatarFallback className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white\">\n                          <Bot className=\"w-4 h-4\" />\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"bg-muted rounded-lg p-3 min-w-0 max-w-full\">\n                        <div className=\"flex items-center space-x-2\">\n                          <div className=\"flex space-x-1\">\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\"></div>\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n                          </div>\n                          <span className=\"text-sm text-muted-foreground\">AI is thinking...</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center text-muted-foreground py-8\">\n                <Bot className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                <p className=\"text-lg font-medium mb-2\">Start a conversation with your AI mentor!</p>\n                <p className=\"text-sm\">Ask about any Louisiana plumbing codes, installation procedures, or code compliance.</p>\n                <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-3 max-w-2xl mx-auto\">\n                  <div className=\"text-left p-3 bg-muted/30 rounded-lg\">\n                    <p className=\"font-medium text-sm\">Example questions:</p>\n                    <ul className=\"text-xs space-y-1 mt-2 text-muted-foreground\">\n                      <li>â€¢ What are the pipe sizing requirements for 3-inch waste lines?</li>\n                      <li>â€¢ How do I calculate water pressure for a 4-story building?</li>\n                    </ul>\n                  </div>\n                  <div className=\"text-left p-3 bg-muted/30 rounded-lg\">\n                    <p className=\"font-medium text-sm\">Ask about any topic:</p>\n                    <ul className=\"text-xs space-y-1 mt-2 text-muted-foreground\">\n                      <li>â€¢ Installation procedures</li>\n                      <li>â€¢ Code compliance requirements</li>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n            )}\n          </ScrollArea>\n\n          {/* Message Input */}\n          <div className=\"p-4 border-t\">\n            <div className=\"flex space-x-2\">\n              <Input\n                value={currentMessage}\n                onChange={(e) => setCurrentMessage(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Ask your plumbing question...\"\n                disabled={chatMutation.isPending}\n                className=\"flex-1\"\n                data-testid=\"message-input\"\n              />\n              <Button\n                onClick={handleSendMessage}\n                disabled={!currentMessage.trim() || chatMutation.isPending}\n                data-testid=\"send-message\"\n              >\n                <Send className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              AI mentor trained on complete Louisiana plumbing codes and industry best practices\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":13973}},"version":1}